var Ox=Object.defineProperty;var Fx=(n,t,e)=>t in n?Ox(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var Ot=(n,t,e)=>Fx(n,typeof t!="symbol"?t+"":t,e);import{aG as Dx,r as fr,X as Bx,x as Cd,q as Si,K as ea,w as xn,o as su,l as Ci,g as Kn,N as Ml,C as Rl,ax as Vx,aH as Uo,c as Fi,_ as Gx,p as zx,h as an,aI as $x,aJ as Wx,aK as Hx,a as zt,t as Jg,aL as Qg,aM as qx,aN as Pd,A as Ux,T as Yx,b as ou,s as Kx,aO as Xx,aP as Jx,aQ as Qx,aR as Zx,aS as jx,aE as tS,aT as Zg,u as eS,d as nS,$ as rS}from"./index-CcBB2wp0.js";function Ll(){if(window.getSelection!==void 0){const n=window.getSelection();n.empty!==void 0?n.empty():n.removeAllRanges!==void 0&&(n.removeAllRanges(),Dx.is.mobile!==!0&&n.addRange(document.createRange()))}else document.selection!==void 0&&document.selection.empty()}const jg={target:{type:[Boolean,String,Element],default:!0},noParentEvent:Boolean},uM={...jg,contextMenu:Boolean};function iS({showing:n,avoidEmit:t,configureAnchorEl:e}){const{props:r,proxy:i,emit:o}=Kn(),a=fr(null);let l=null;function h(m){return a.value===null?!1:m===void 0||m.touches===void 0||m.touches.length<=1}const u={};e===void 0&&(Object.assign(u,{hide(m){i.hide(m)},toggle(m){i.toggle(m),m.qAnchorHandled=!0},toggleKey(m){Bx(m,13)===!0&&u.toggle(m)},contextClick(m){i.hide(m),Cd(m),Si(()=>{i.show(m),m.qAnchorHandled=!0})},prevent:Cd,mobileTouch(m){if(u.mobileCleanup(m),h(m)!==!0)return;i.hide(m),a.value.classList.add("non-selectable");const w=m.target;ea(u,"anchor",[[w,"touchmove","mobileCleanup","passive"],[w,"touchend","mobileCleanup","passive"],[w,"touchcancel","mobileCleanup","passive"],[a.value,"contextmenu","prevent","notPassive"]]),l=setTimeout(()=>{l=null,i.show(m),m.qAnchorHandled=!0},300)},mobileCleanup(m){a.value.classList.remove("non-selectable"),l!==null&&(clearTimeout(l),l=null),n.value===!0&&m!==void 0&&Ll()}}),e=function(m=r.contextMenu){if(r.noParentEvent===!0||a.value===null)return;let w;m===!0?i.$q.platform.is.mobile===!0?w=[[a.value,"touchstart","mobileTouch","passive"]]:w=[[a.value,"mousedown","hide","passive"],[a.value,"contextmenu","contextClick","notPassive"]]:w=[[a.value,"click","toggle","passive"],[a.value,"keyup","toggleKey","passive"]],ea(u,"anchor",w)});function d(){Ml(u,"anchor")}function g(m){for(a.value=m;a.value.classList.contains("q-anchor--skip");)a.value=a.value.parentNode;e()}function y(){if(r.target===!1||r.target===""||i.$el.parentNode===null)a.value=null;else if(r.target===!0)g(i.$el.parentNode);else{let m=r.target;if(typeof r.target=="string")try{m=document.querySelector(r.target)}catch{m=void 0}m!=null?(a.value=m.$el||m,e()):(a.value=null,console.error(`Anchor: target "${r.target}" not found`))}}return xn(()=>r.contextMenu,m=>{a.value!==null&&(d(),e(m))}),xn(()=>r.target,()=>{a.value!==null&&d(),y()}),xn(()=>r.noParentEvent,m=>{a.value!==null&&(m===!0?d():e())}),su(()=>{y(),t!==!0&&r.modelValue===!0&&a.value===null&&o("update:modelValue",!1)}),Ci(()=>{l!==null&&clearTimeout(l),d()}),{anchorEl:a,canShow:h,anchorEvents:u}}function sS(n,t){const e=fr(null);let r;function i(l,h){const u=`${h!==void 0?"add":"remove"}EventListener`,d=h!==void 0?h:r;l!==window&&l[u]("scroll",d,Rl.passive),window[u]("scroll",d,Rl.passive),r=h}function o(){e.value!==null&&(i(e.value),e.value=null)}const a=xn(()=>n.noParentEvent,()=>{e.value!==null&&(o(),t())});return Ci(a),{localScrollTarget:e,unconfigureScrollTarget:o,changeScrollEvent:i}}const oS={modelValue:{type:Boolean,default:null},"onUpdate:modelValue":[Function,Array]},aS=["beforeShow","show","beforeHide","hide"];function cS({showing:n,canShow:t,hideOnRouteChange:e,handleShow:r,handleHide:i,processOnMount:o}){const a=Kn(),{props:l,emit:h,proxy:u}=a;let d;function g(N){n.value===!0?w(N):y(N)}function y(N){if(l.disable===!0||N!==void 0&&N.qAnchorHandled===!0||t!==void 0&&t(N)!==!0)return;const A=l["onUpdate:modelValue"]!==void 0;A===!0&&(h("update:modelValue",!0),d=N,Si(()=>{d===N&&(d=void 0)})),(l.modelValue===null||A===!1)&&m(N)}function m(N){n.value!==!0&&(n.value=!0,h("beforeShow",N),r!==void 0?r(N):h("show",N))}function w(N){if(l.disable===!0)return;const A=l["onUpdate:modelValue"]!==void 0;A===!0&&(h("update:modelValue",!1),d=N,Si(()=>{d===N&&(d=void 0)})),(l.modelValue===null||A===!1)&&v(N)}function v(N){n.value!==!1&&(n.value=!1,h("beforeHide",N),i!==void 0?i(N):h("hide",N))}function _(N){l.disable===!0&&N===!0?l["onUpdate:modelValue"]!==void 0&&h("update:modelValue",!1):N===!0!==n.value&&(N===!0?m:v)(d)}xn(()=>l.modelValue,_),e!==void 0&&Vx(a)===!0&&xn(()=>u.$route.fullPath,()=>{e.value===!0&&n.value===!0&&w()}),o===!0&&su(()=>{_(l.modelValue)});const b={show:y,hide:w,toggle:g};return Object.assign(u,b),b}let Rr=[],Cs=[];function tp(n){Cs=Cs.filter(t=>t!==n)}function lS(n){tp(n),Cs.push(n)}function Ad(n){tp(n),Cs.length===0&&Rr.length!==0&&(Rr[Rr.length-1](),Rr=[])}function hM(n){Cs.length===0?n():Rr.push(n)}function fM(n){Rr=Rr.filter(t=>t!==n)}const yi=[];function dM(n){return yi.find(t=>t.contentEl!==null&&t.contentEl.contains(n))}function uS(n,t){do{if(n.$options.name==="QMenu"){if(n.hide(t),n.$props.separateClosePopup===!0)return Uo(n)}else if(n.__qPortal===!0){const e=Uo(n);return e!==void 0&&e.$options.name==="QPopupProxy"?(n.hide(t),e):n}n=Uo(n)}while(n!=null)}function gM(n,t,e){for(;e!==0&&n!==void 0&&n!==null;){if(n.__qPortal===!0){if(e--,n.$options.name==="QMenu"){n=uS(n,t);continue}n.hide(t)}n=Uo(n)}}const hS=Fi({name:"QPortal",setup(n,{slots:t}){return()=>t.default()}});function fS(n){for(n=n.parent;n!=null;){if(n.type.name==="QGlobalDialog")return!0;if(n.type.name==="QDialog"||n.type.name==="QMenu")return!1;n=n.parent}return!1}function dS(n,t,e,r){const i=fr(!1),o=fr(!1);let a=null;const l={},h=r==="dialog"&&fS(n);function u(g){if(g===!0){Ad(l),o.value=!0;return}o.value=!1,i.value===!1&&(h===!1&&a===null&&(a=Wx(!1,r)),i.value=!0,yi.push(n.proxy),lS(l))}function d(g){if(o.value=!1,g!==!0)return;Ad(l),i.value=!1;const y=yi.indexOf(n.proxy);y!==-1&&yi.splice(y,1),a!==null&&(Hx(a),a=null)}return Gx(()=>{d(!0)}),n.proxy.__qPortal=!0,zx(n.proxy,"contentEl",()=>t.value),{showPortal:u,hidePortal:d,portalIsActive:i,portalIsAccessible:o,renderPortal:()=>h===!0?e():i.value===!0?[an($x,{to:a},an(hS,e))]:void 0}}const yl={transitionShow:{type:String,default:"fade"},transitionHide:{type:String,default:"fade"},transitionDuration:{type:[String,Number],default:300}};function gS(n,t=()=>{},e=()=>{}){return{transitionProps:zt(()=>{const r=`q-transition--${n.transitionShow||t()}`,i=`q-transition--${n.transitionHide||e()}`;return{appear:!0,enterFromClass:`${r}-enter-from`,enterActiveClass:`${r}-enter-active`,enterToClass:`${r}-enter-to`,leaveFromClass:`${i}-leave-from`,leaveActiveClass:`${i}-leave-active`,leaveToClass:`${i}-leave-to`}}),transitionStyle:zt(()=>`--q-transition-duration: ${n.transitionDuration}ms`)}}function pS(){let n;const t=Kn();function e(){n=void 0}return Jg(e),Ci(e),{removeTick:e,registerTick(r){n=r,Si(()=>{n===r&&(Qg(t)===!1&&n(),n=void 0)})}}}function mS(){let n=null;const t=Kn();function e(){n!==null&&(clearTimeout(n),n=null)}return Jg(e),Ci(e),{removeTimeout:e,registerTimeout(r,i){e(),Qg(t)===!1&&(n=setTimeout(()=>{n=null,r()},i))}}}const yS=[Element,String],wS=[null,document,document.body,document.scrollingElement,document.documentElement];function vS(n,t){let e=qx(t);if(e===void 0){if(n==null)return window;e=n.closest(".scroll,.scroll-y,.overflow-auto")}return wS.includes(e)?window:e}function bS(n){return n===window?window.pageYOffset||window.scrollY||document.body.scrollTop||0:n.scrollTop}function pM(n){return n===window?window.pageXOffset||window.scrollX||document.body.scrollLeft||0:n.scrollLeft}function ep(n,t,e=0){const r=arguments[3]===void 0?performance.now():arguments[3],i=bS(n);if(e<=0){i!==t&&kl(n,t);return}requestAnimationFrame(o=>{const a=o-r,l=i+(t-i)/Math.max(a,e)*a;kl(n,l),l!==t&&ep(n,t,e-a,o)})}function kl(n,t){if(n===window){window.scrollTo(window.pageXOffset||window.scrollX||document.body.scrollLeft||0,t);return}n.scrollTop=t}function mM(n,t,e){if(e){ep(n,t,e);return}kl(n,t)}let Lo;function _S(){if(Lo!==void 0)return Lo;const n=document.createElement("p"),t=document.createElement("div");Pd(n,{width:"100%",height:"200px"}),Pd(t,{position:"absolute",top:"0px",left:"0px",visibility:"hidden",width:"200px",height:"150px",overflow:"hidden"}),t.appendChild(n),document.body.appendChild(t);const e=n.offsetWidth;t.style.overflow="scroll";let r=n.offsetWidth;return e===r&&(r=t.clientWidth),t.remove(),Lo=e-r,Lo}function yM(n,t=!0){return!n||n.nodeType!==Node.ELEMENT_NODE?!1:t?n.scrollHeight>n.clientHeight&&(n.classList.contains("scroll")||n.classList.contains("overflow-auto")||["auto","scroll"].includes(window.getComputedStyle(n)["overflow-y"])):n.scrollWidth>n.clientWidth&&(n.classList.contains("scroll")||n.classList.contains("overflow-auto")||["auto","scroll"].includes(window.getComputedStyle(n)["overflow-x"]))}const{notPassiveCapture:na}=Rl,kr=[];function ra(n){const t=n.target;if(t===void 0||t.nodeType===8||t.classList.contains("no-pointer-events")===!0)return;let e=yi.length-1;for(;e>=0;){const r=yi[e].$;if(r.type.name==="QTooltip"){e--;continue}if(r.type.name!=="QDialog")break;if(r.props.seamless!==!0)return;e--}for(let r=kr.length-1;r>=0;r--){const i=kr[r];if((i.anchorEl.value===null||i.anchorEl.value.contains(t)===!1)&&(t===document.body||i.innerRef.value!==null&&i.innerRef.value.contains(t)===!1))n.qClickOutside=!0,i.onClickOutside(n);else return}}function xS(n){kr.push(n),kr.length===1&&(document.addEventListener("mousedown",ra,na),document.addEventListener("touchstart",ra,na))}function Nd(n){const t=kr.findIndex(e=>e===n);t!==-1&&(kr.splice(t,1),kr.length===0&&(document.removeEventListener("mousedown",ra,na),document.removeEventListener("touchstart",ra,na)))}let Td,Ed;function Id(n){const t=n.split(" ");return t.length!==2?!1:["top","center","bottom"].includes(t[0])!==!0?(console.error("Anchor/Self position must start with one of top/center/bottom"),!1):["left","middle","right","start","end"].includes(t[1])!==!0?(console.error("Anchor/Self position must end with one of left/middle/right/start/end"),!1):!0}function SS(n){return n?!(n.length!==2||typeof n[0]!="number"||typeof n[1]!="number"):!0}const Ol={"start#ltr":"left","start#rtl":"right","end#ltr":"right","end#rtl":"left"};["left","middle","right"].forEach(n=>{Ol[`${n}#ltr`]=n,Ol[`${n}#rtl`]=n});function Md(n,t){const e=n.split(" ");return{vertical:e[0],horizontal:Ol[`${e[1]}#${t===!0?"rtl":"ltr"}`]}}function CS(n,t){let{top:e,left:r,right:i,bottom:o,width:a,height:l}=n.getBoundingClientRect();return t!==void 0&&(e-=t[1],r-=t[0],o+=t[1],i+=t[0],a+=t[0],l+=t[1]),{top:e,bottom:o,height:l,left:r,right:i,width:a,middle:r+(i-r)/2,center:e+(o-e)/2}}function PS(n,t,e){let{top:r,left:i}=n.getBoundingClientRect();return r+=t.top,i+=t.left,e!==void 0&&(r+=e[1],i+=e[0]),{top:r,bottom:r+1,height:1,left:i,right:i+1,width:1,middle:i,center:r}}function AS(n,t){return{top:0,center:t/2,bottom:t,left:0,middle:n/2,right:n}}function Rd(n,t,e,r){return{top:n[e.vertical]-t[r.vertical],left:n[e.horizontal]-t[r.horizontal]}}function np(n,t=0){if(n.targetEl===null||n.anchorEl===null||t>5)return;if(n.targetEl.offsetHeight===0||n.targetEl.offsetWidth===0){setTimeout(()=>{np(n,t+1)},10);return}const{targetEl:e,offset:r,anchorEl:i,anchorOrigin:o,selfOrigin:a,absoluteOffset:l,fit:h,cover:u,maxHeight:d,maxWidth:g}=n;if(Ux.is.ios===!0&&window.visualViewport!==void 0){const M=document.body.style,{offsetLeft:R,offsetTop:O}=window.visualViewport;R!==Td&&(M.setProperty("--q-pe-left",R+"px"),Td=R),O!==Ed&&(M.setProperty("--q-pe-top",O+"px"),Ed=O)}const{scrollLeft:y,scrollTop:m}=e,w=l===void 0?CS(i,u===!0?[0,0]:r):PS(i,l,r);Object.assign(e.style,{top:0,left:0,minWidth:null,minHeight:null,maxWidth:g,maxHeight:d,visibility:"visible"});const{offsetWidth:v,offsetHeight:_}=e,{elWidth:b,elHeight:N}=h===!0||u===!0?{elWidth:Math.max(w.width,v),elHeight:u===!0?Math.max(w.height,_):_}:{elWidth:v,elHeight:_};let A={maxWidth:g,maxHeight:d};(h===!0||u===!0)&&(A.minWidth=w.width+"px",u===!0&&(A.minHeight=w.height+"px")),Object.assign(e.style,A);const T=AS(b,N);let P=Rd(w,T,o,a);if(l===void 0||r===void 0)wl(P,w,T,o,a);else{const{top:M,left:R}=P;wl(P,w,T,o,a);let O=!1;if(P.top!==M){O=!0;const V=2*r[1];w.center=w.top-=V,w.bottom-=V+2}if(P.left!==R){O=!0;const V=2*r[0];w.middle=w.left-=V,w.right-=V+2}O===!0&&(P=Rd(w,T,o,a),wl(P,w,T,o,a))}A={top:P.top+"px",left:P.left+"px"},P.maxHeight!==void 0&&(A.maxHeight=P.maxHeight+"px",w.height>P.maxHeight&&(A.minHeight=A.maxHeight)),P.maxWidth!==void 0&&(A.maxWidth=P.maxWidth+"px",w.width>P.maxWidth&&(A.minWidth=A.maxWidth)),Object.assign(e.style,A),e.scrollTop!==m&&(e.scrollTop=m),e.scrollLeft!==y&&(e.scrollLeft=y)}function wl(n,t,e,r,i){const o=e.bottom,a=e.right,l=_S(),h=window.innerHeight-l,u=document.body.clientWidth;if(n.top<0||n.top+o>h)if(i.vertical==="center")n.top=t[r.vertical]>h/2?Math.max(0,h-o):0,n.maxHeight=Math.min(o,h);else if(t[r.vertical]>h/2){const d=Math.min(h,r.vertical==="center"?t.center:r.vertical===i.vertical?t.bottom:t.top);n.maxHeight=Math.min(o,d),n.top=Math.max(0,d-o)}else n.top=Math.max(0,r.vertical==="center"?t.center:r.vertical===i.vertical?t.top:t.bottom),n.maxHeight=Math.min(o,h-n.top);if(n.left<0||n.left+a>u)if(n.maxWidth=Math.min(a,u),i.horizontal==="middle")n.left=t[r.horizontal]>u/2?Math.max(0,u-a):0;else if(t[r.horizontal]>u/2){const d=Math.min(u,r.horizontal==="middle"?t.middle:r.horizontal===i.horizontal?t.right:t.left);n.maxWidth=Math.min(a,d),n.left=Math.max(0,d-n.maxWidth)}else n.left=Math.max(0,r.horizontal==="middle"?t.middle:r.horizontal===i.horizontal?t.left:t.right),n.maxWidth=Math.min(a,u-n.left)}const wM=Fi({name:"QTooltip",inheritAttrs:!1,props:{...jg,...oS,...yl,maxHeight:{type:String,default:null},maxWidth:{type:String,default:null},transitionShow:{...yl.transitionShow,default:"jump-down"},transitionHide:{...yl.transitionHide,default:"jump-up"},anchor:{type:String,default:"bottom middle",validator:Id},self:{type:String,default:"top middle",validator:Id},offset:{type:Array,default:()=>[14,14],validator:SS},scrollTarget:yS,delay:{type:Number,default:0},hideDelay:{type:Number,default:0},persistent:Boolean},emits:[...aS],setup(n,{slots:t,emit:e,attrs:r}){let i,o;const a=Kn(),{proxy:{$q:l}}=a,h=fr(null),u=fr(!1),d=zt(()=>Md(n.anchor,l.lang.rtl)),g=zt(()=>Md(n.self,l.lang.rtl)),y=zt(()=>n.persistent!==!0),{registerTick:m,removeTick:w}=pS(),{registerTimeout:v}=mS(),{transitionProps:_,transitionStyle:b}=gS(n),{localScrollTarget:N,changeScrollEvent:A,unconfigureScrollTarget:T}=sS(n,K),{anchorEl:P,canShow:M,anchorEvents:R}=iS({showing:u,configureAnchorEl:Ct}),{show:O,hide:V}=cS({showing:u,canShow:M,handleShow:tt,handleHide:dt,hideOnRouteChange:y,processOnMount:!0});Object.assign(R,{delayShow:Lt,delayHide:It});const{showPortal:$,hidePortal:G,renderPortal:Z}=dS(a,h,ot,"tooltip");if(l.platform.is.mobile===!0){const ht={anchorEl:P,innerRef:h,onClickOutside(ft){return V(ft),ft.target.classList.contains("q-dialog__backdrop")&&Kx(ft),!0}},Ft=zt(()=>n.modelValue===null&&n.persistent!==!0&&u.value===!0);xn(Ft,ft=>{(ft===!0?xS:Nd)(ht)}),Ci(()=>{Nd(ht)})}function tt(ht){$(),m(()=>{o=new MutationObserver(()=>Nt()),o.observe(h.value,{attributes:!1,childList:!0,characterData:!0,subtree:!0}),Nt(),K()}),i===void 0&&(i=xn(()=>l.screen.width+"|"+l.screen.height+"|"+n.self+"|"+n.anchor+"|"+l.lang.rtl,Nt)),v(()=>{$(!0),e("show",ht)},n.transitionDuration)}function dt(ht){w(),G(),wt(),v(()=>{G(!0),e("hide",ht)},n.transitionDuration)}function wt(){o!==void 0&&(o.disconnect(),o=void 0),i!==void 0&&(i(),i=void 0),T(),Ml(R,"tooltipTemp")}function Nt(){np({targetEl:h.value,offset:n.offset,anchorEl:P.value,anchorOrigin:d.value,selfOrigin:g.value,maxHeight:n.maxHeight,maxWidth:n.maxWidth})}function Lt(ht){if(l.platform.is.mobile===!0){Ll(),document.body.classList.add("non-selectable");const Ft=P.value,ft=["touchmove","touchcancel","touchend","click"].map(Wt=>[Ft,Wt,"delayHide","passiveCapture"]);ea(R,"tooltipTemp",ft)}v(()=>{O(ht)},n.delay)}function It(ht){l.platform.is.mobile===!0&&(Ml(R,"tooltipTemp"),Ll(),setTimeout(()=>{document.body.classList.remove("non-selectable")},10)),v(()=>{V(ht)},n.hideDelay)}function Ct(){if(n.noParentEvent===!0||P.value===null)return;const ht=l.platform.is.mobile===!0?[[P.value,"touchstart","delayShow","passive"]]:[[P.value,"mouseenter","delayShow","passive"],[P.value,"mouseleave","delayHide","passive"]];ea(R,"anchor",ht)}function K(){if(P.value!==null||n.scrollTarget!==void 0){N.value=vS(P.value,n.scrollTarget);const ht=n.noParentEvent===!0?Nt:V;A(N.value,ht)}}function X(){return u.value===!0?an("div",{...r,ref:h,class:["q-tooltip q-tooltip--style q-position-engine no-pointer-events",r.class],style:[r.style,b.value],role:"tooltip"},ou(t.default)):null}function ot(){return an(Yx,_.value,X)}return Ci(wt),Object.assign(a.proxy,{updatePosition:Nt}),Z}}),au={dark:{type:Boolean,default:null}};function cu(n,t){return zt(()=>n.dark===null?t.dark.isActive:n.dark)}const vM=Fi({name:"QCardSection",props:{tag:{type:String,default:"div"},horizontal:Boolean},setup(n,{slots:t}){const e=zt(()=>`q-card__section q-card__section--${n.horizontal===!0?"horiz row no-wrap":"vert"}`);return()=>an(n.tag,{class:e.value},ou(t.default))}}),bM=Fi({name:"QCard",props:{...au,tag:{type:String,default:"div"},square:Boolean,flat:Boolean,bordered:Boolean},setup(n,{slots:t}){const{proxy:{$q:e}}=Kn(),r=cu(n,e),i=zt(()=>"q-card"+(r.value===!0?" q-card--dark q-dark":"")+(n.bordered===!0?" q-card--bordered":"")+(n.square===!0?" q-card--square no-border-radius":"")+(n.flat===!0?" q-card--flat no-shadow":""));return()=>an(n.tag,{class:i.value},ou(t.default))}}),NS={true:"inset",item:"item-inset","item-thumbnail":"item-thumbnail-inset"},vl={xs:2,sm:4,md:8,lg:16,xl:24},_M=Fi({name:"QSeparator",props:{...au,spaced:[Boolean,String],inset:[Boolean,String],vertical:Boolean,color:String,size:String},setup(n){const t=Kn(),e=cu(n,t.proxy.$q),r=zt(()=>n.vertical===!0?"vertical":"horizontal"),i=zt(()=>` q-separator--${r.value}`),o=zt(()=>n.inset!==!1?`${i.value}-${NS[n.inset]}`:""),a=zt(()=>`q-separator${i.value}${o.value}`+(n.color!==void 0?` bg-${n.color}`:"")+(e.value===!0?" q-separator--dark":"")),l=zt(()=>{const h={};if(n.size!==void 0&&(h[n.vertical===!0?"width":"height"]=n.size),n.spaced!==!1){const u=n.spaced===!0?`${vl.md}px`:n.spaced in vl?`${vl[n.spaced]}px`:n.spaced,d=n.vertical===!0?["Left","Right"]:["Top","Bottom"];h[`margin${d[0]}`]=h[`margin${d[1]}`]=u}return h});return()=>an("hr",{class:a.value,style:l.value,"aria-orientation":r.value})}});function TS(n){return Zx()?(jx(n),!0):!1}function Pi(n){return typeof n=="function"?n():Xx(n)}const ES=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const IS=Object.prototype.toString,MS=n=>IS.call(n)==="[object Object]",Ps=()=>{};function lu(n,t){function e(...r){return new Promise((i,o)=>{Promise.resolve(n(()=>t.apply(this,r),{fn:t,thisArg:this,args:r})).then(i).catch(o)})}return e}const rp=n=>n();function ip(n,t={}){let e,r,i=Ps;const o=l=>{clearTimeout(l),i(),i=Ps};return l=>{const h=Pi(n),u=Pi(t.maxWait);return e&&o(e),h<=0||u!==void 0&&u<=0?(r&&(o(r),r=null),Promise.resolve(l())):new Promise((d,g)=>{i=t.rejectOnCancel?g:d,u&&!r&&(r=setTimeout(()=>{e&&o(e),r=null,d(l())},u)),e=setTimeout(()=>{r&&o(r),r=null,d(l())},h)})}}function sp(...n){let t=0,e,r=!0,i=Ps,o,a,l,h,u;!Jx(n[0])&&typeof n[0]=="object"?{delay:a,trailing:l=!0,leading:h=!0,rejectOnCancel:u=!1}=n[0]:[a,l=!0,h=!0,u=!1]=n;const d=()=>{e&&(clearTimeout(e),e=void 0,i(),i=Ps)};return y=>{const m=Pi(a),w=Date.now()-t,v=()=>o=y();return d(),m<=0?(t=Date.now(),v()):(w>m&&(h||!r)?(t=Date.now(),v()):l&&(o=new Promise((_,b)=>{i=u?b:_,e=setTimeout(()=>{t=Date.now(),r=!0,_(v()),d()},Math.max(0,m-w))})),!h&&!e&&(e=setTimeout(()=>r=!0,m)),r=!1,o)}}function RS(n=rp){const t=fr(!0);function e(){t.value=!1}function r(){t.value=!0}const i=(...o)=>{t.value&&n(...o)};return{isActive:Qx(t),pause:e,resume:r,eventFilter:i}}function LS(n){return Kn()}function kS(n,t=200,e={}){return lu(ip(t,e),n)}function xM(n,t=200,e=!1,r=!0,i=!1){return lu(sp(t,e,r,i),n)}function uu(n,t,e={}){const{eventFilter:r=rp,...i}=e;return xn(n,lu(r,t),i)}function OS(n,t,e={}){const{eventFilter:r,...i}=e,{eventFilter:o,pause:a,resume:l,isActive:h}=RS(r);return{stop:uu(n,t,{...i,eventFilter:o}),pause:a,resume:l,isActive:h}}function FS(n,t=!0,e){LS()?su(n,e):t?n():Si(n)}function SM(n,t,e={}){const{debounce:r=0,maxWait:i=void 0,...o}=e;return uu(n,t,{...o,eventFilter:ip(r,{maxWait:i})})}function CM(n,t,e={}){const{throttle:r=0,trailing:i=!0,leading:o=!0,...a}=e;return uu(n,t,{...a,eventFilter:sp(r,i,o)})}function DS(n){var t;const e=Pi(n);return(t=e?.$el)!=null?t:e}const Fl=ES?window:void 0;function Ld(...n){let t,e,r,i;if(typeof n[0]=="string"||Array.isArray(n[0])?([e,r,i]=n,t=Fl):[t,e,r,i]=n,!t)return Ps;Array.isArray(e)||(e=[e]),Array.isArray(r)||(r=[r]);const o=[],a=()=>{o.forEach(d=>d()),o.length=0},l=(d,g,y,m)=>(d.addEventListener(g,y,m),()=>d.removeEventListener(g,y,m)),h=xn(()=>[DS(t),Pi(i)],([d,g])=>{if(a(),!d)return;const y=MS(g)?{...g}:g;o.push(...e.flatMap(m=>r.map(w=>l(d,m,w,y))))},{immediate:!0,flush:"post"}),u=()=>{h(),a()};return TS(u),u}const ko=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Oo="__vueuse_ssr_handlers__",BS=VS();function VS(){return Oo in ko||(ko[Oo]=ko[Oo]||{}),ko[Oo]}function GS(n,t){return BS[n]||t}function zS(n){return n==null?"any":n instanceof Set?"set":n instanceof Map?"map":n instanceof Date?"date":typeof n=="boolean"?"boolean":typeof n=="string"?"string":typeof n=="object"?"object":Number.isNaN(n)?"any":"number"}const $S={boolean:{read:n=>n==="true",write:n=>String(n)},object:{read:n=>JSON.parse(n),write:n=>JSON.stringify(n)},number:{read:n=>Number.parseFloat(n),write:n=>String(n)},any:{read:n=>n,write:n=>String(n)},string:{read:n=>n,write:n=>String(n)},map:{read:n=>new Map(JSON.parse(n)),write:n=>JSON.stringify(Array.from(n.entries()))},set:{read:n=>new Set(JSON.parse(n)),write:n=>JSON.stringify(Array.from(n))},date:{read:n=>new Date(n),write:n=>n.toISOString()}},kd="vueuse-storage";function Dl(n,t,e,r={}){var i;const{flush:o="pre",deep:a=!0,listenToStorageChanges:l=!0,writeDefaults:h=!0,mergeDefaults:u=!1,shallow:d,window:g=Fl,eventFilter:y,onError:m=$=>{console.error($)},initOnMounted:w}=r,v=(d?tS:fr)(typeof t=="function"?t():t);if(!e)try{e=GS("getDefaultStorage",()=>{var $;return($=Fl)==null?void 0:$.localStorage})()}catch($){m($)}if(!e)return v;const _=Pi(t),b=zS(_),N=(i=r.serializer)!=null?i:$S[b],{pause:A,resume:T}=OS(v,()=>M(v.value),{flush:o,deep:a,eventFilter:y});g&&l&&FS(()=>{Ld(g,"storage",O),Ld(g,kd,V),w&&O()}),w||O();function P($,G){g&&g.dispatchEvent(new CustomEvent(kd,{detail:{key:n,oldValue:$,newValue:G,storageArea:e}}))}function M($){try{const G=e.getItem(n);if($==null)P(G,null),e.removeItem(n);else{const Z=N.write($);G!==Z&&(e.setItem(n,Z),P(G,Z))}}catch(G){m(G)}}function R($){const G=$?$.newValue:e.getItem(n);if(G==null)return h&&_!=null&&e.setItem(n,N.write(_)),_;if(!$&&u){const Z=N.read(G);return typeof u=="function"?u(Z,_):b==="object"&&!Array.isArray(Z)?{..._,...Z}:Z}else return typeof G!="string"?G:N.read(G)}function O($){if(!($&&$.storageArea!==e)){if($&&$.key==null){v.value=_;return}if(!($&&$.key!==n)){A();try{$?.newValue!==N.write(v.value)&&(v.value=R($))}catch(G){m(G)}finally{$?Si(T):T()}}}}function V($){O($.detail)}return v}function mr(n){return{all:n=n||new Map,on:function(t,e){var r=n.get(t);r?r.push(e):n.set(t,[e])},off:function(t,e){var r=n.get(t);r&&(e?r.splice(r.indexOf(e)>>>0,1):n.set(t,[]))},emit:function(t,e){var r=n.get(t);r&&r.slice().map(function(i){i(e)}),(r=n.get("*"))&&r.slice().map(function(i){i(t,e)})}}}const WS=(n,t)=>{const e=Object.keys(t),r=Object.values(t);return new Function(...e,`return ${n};`)(...r)},Ca=class Ca{id;name;type;emitter=mr();constructor(t,e){this.type=t,this.name=e??"",this.id=Ca.currentId++}static createSettings(t,...e){const r=new t(...e);return r.registerUpdates(),r}get settings(){return Object.values(this).filter(t=>t instanceof ie)}get shortSummary(){const t=new Array;return this.settings.forEach(e=>{const r=new Array;e.enabledParameters.forEach(i=>{r.push(`${i.abbreviatedLabel}: ${i.textValue}`)}),t.push(`${e.abbreviatedLabel}: [`+r.join(", ")+"]")}),t.join("  |  ")}registerUpdates(){this.settings.forEach(t=>{t.registerUpdates(),t.emitter.on("updatedParameterStatus",()=>{this.emitter.emit("updatedSettingStatus")})})}loadFromJson(t){this.name=t.name,this.settings.forEach(e=>{t[e.key]&&e.loadFromJson(t[e.key])})}getJson(){const t={name:this.name};return this.settings.forEach(e=>{t[e.key]=e.getJson()}),t}getContext({visGraph:t,nodes:e,links:r}){const i=e??t?.allLayoutNodes??[],o=r??t?.getAllConnections()??[];return{n:i.length,l:o.length}}};Ot(Ca,"currentId",0);let dr=Ca;class ie{key;label;description;optional;active;enabledParameters=[];emitter=mr();constructor({key:t,label:e,description:r,optional:i=!1,active:o=!1}){this.key=t,this.label=e||t,this.description=r,this.optional=i,this.active=i?o:!0}get parameters(){return Object.values(this).filter(t=>t instanceof rt)}get parameterMap(){return Object.fromEntries(this.parameters.map(t=>[t.key,t]))}get abbreviatedLabel(){const t=this.label??this.key,e=t.split(" ");return e.length>1?e.map(r=>r[0].toUpperCase()).join(""):t.slice(0,3).toUpperCase()}registerUpdates(){this.parameters.forEach(t=>{t.emitter.on("updated",()=>{this.updateParamsStatus()})}),this.updateParamsStatus()}updateParamsStatus(){let t=!1;return this.parameters.forEach(e=>{const r=e.updateStatus();t=t||r}),this.enabledParameters=this.parameters.filter(e=>e.enabled),t&&this.emitter.emit("updatedParameterStatus"),t}loadFromJson(t){try{this.active=t.active,this.parameters.forEach(e=>{t[e.key]&&e.loadFromJson(t[e.key])})}catch(e){console.error("Error loading settings from json",e)}}getJson(){const t={key:this.key,active:this.active};return this.parameters.forEach(e=>{t[e.key]=e.getJson()}),t}}const Pa=class Pa{key;label;description;optional;active=!1;default;choices=[];range;type;enabledCallback=!0;enabled=!0;_textValue;emitter=mr();tooltip=Pa.tooltip;constructor({key:t,label:e,description:r,defaultValue:i,type:o="string",optional:a=!1,active:l=!1,enabled:h=!0,range:u,choices:d}){this.key=t,this.label=e||t,this.description=r,this.optional=a,this.default=i,this.active=a?l:!0,this._textValue=i,this.type=o,this.enabledCallback=h,this.range=u,this.choices=d??[],this.updateStatus()}getValue(t){if(this.active){try{return WS(this._textValue,t??{})}catch{}if(this.type==="number"){const e=Number(this._textValue);if(!isNaN(e))return e}else{if(this.type==="string")return this._textValue;if(this.type==="color")return this._textValue;if(this.type==="boolean")return this._textValue==="true";if(this.type==="choice")return this._textValue}}}get value(){return this.getValue()??this._textValue}get textValue(){if(this.active)return this._textValue}set textValue(t){this._textValue=t,this.emitter.emit("updated")}updateStatus(){const t=this.enabled;return typeof this.enabledCallback=="function"?this.enabled=this.enabledCallback():this.enabled=this.enabledCallback,t!==this.enabled}get abbreviatedLabel(){const t=this.label??this.key,e=t.split(" ");return e.length>1?e.map(r=>r[0].toUpperCase()).join(""):t.slice(0,3)}loadFromJson(t){try{this.active=t.active,this._textValue=t.value}catch(e){console.error("Error loading settings from json",e)}}getJson(){return{key:this.key,active:this.active,value:this._textValue}}};Ot(Pa,"tooltip",["You can use the following graph variables:","- n: Number of nodes","- l: Number of links"]);let rt=Pa;const Aa=class Aa extends rt{tooltip=Aa.tooltip;getValue(t,e){let r={cs:1,cp:1,cn:1,co:1,ci:1,cl:1,r:1};if(t){const i=t.successorCount??0,o=t.predecessorCount??0,a=i+o,l=t.outDegree??0,h=t.inDegree??0,u=l+h,d=t.radius??1;e={cs:i,cp:o,cn:a,co:l,ci:h,cl:u,r:d}}return r={...r,...e},super.getValue(r)}};Ot(Aa,"tooltip",[...rt.tooltip,"You can use the following node params:","- cs: Number of successors","- cp: Number of predecessors","- cn: Number of neighbors","- co: Number of outgoing links","- ci: Number of incoming links","- cl: Number of links","- r: Radius of the node"]);let ia=Aa;const Na=class Na extends rt{tooltip=Na.tooltip;getValue(t,e){let r={ct:1,cs:1,cd:1,w:1};if(r={...r,...e},t){const i=(t.target.successorCount??1)+(t.target.predecessorCount??1)-1,o=(t.source.predecessorCount??1)+(t.source.successorCount??1)-1;r.ct=i,r.cs=o,r.cd=o+i,r.w=t.weight??1}return super.getValue(r)}};Ot(Na,"tooltip",[...rt.tooltip,"You can use the following link params:","- ct: Number of connections on the target node","- cs: Number of connections on the source node","- cd: Number of connections on both nodes (sum of degrees)","- w: Weight of the link"]);let As=Na;class Or extends rt{choices;constructor({key:t,label:e,description:r,choices:i,defaultValue:o,optional:a=!1,active:l=!1,enabled:h=!0}){super({key:t,label:e,description:r,type:"choice",optional:a,defaultValue:o,active:l,enabled:h}),this.choices=i}}class HS{key;description;isStoredDataset=!1;isSynthetic=!1;params;get isGenerator(){return!this.isStoredDataset}get isSyntheticDataset(){return this.isStoredDataset&&this.isSynthetic}get isRealDataset(){return this.isStoredDataset&&!this.isSynthetic}constructor(t,e){this.key=t,this.description=e.description,this.params=new Map,e.is_saved_dataset&&(this.isStoredDataset=!0),e.is_synthetic&&(this.isSynthetic=!0);for(const r of e.params)this.params.set(r.key,new rt({key:r.key,defaultValue:r.default??0,description:r.description,optional:!1,type:r.type,range:{min:r.range?.[0],max:r.range?.[1]},choices:r.choices}))}get paramList(){return Array.from(this.params.values())}get parameterRecord(){return Object.fromEntries(this.paramList.map(t=>[t.key,t]))}}class Od{generators=new Map;constructor(t){for(const[e,r]of Object.entries(t))this.generators.set(e,new HS(e,r))}}var ls=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function hu(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var qS=function(t){YS(t);var e=US(t);return t.on=e.on,t.off=e.off,t.fire=e.fire,t};function US(n){var t=Object.create(null);return{on:function(e,r,i){if(typeof r!="function")throw new Error("callback is expected to be a function");var o=t[e];return o||(o=t[e]=[]),o.push({callback:r,ctx:i}),n},off:function(e,r){var i=typeof e>"u";if(i)return t=Object.create(null),n;if(t[e]){var o=typeof r!="function";if(o)delete t[e];else for(var a=t[e],l=0;l<a.length;++l)a[l].callback===r&&a.splice(l,1)}return n},fire:function(e){var r=t[e];if(!r)return n;var i;arguments.length>1&&(i=Array.prototype.splice.call(arguments,1));for(var o=0;o<r.length;++o){var a=r[o];a.callback.apply(a.ctx,i)}return n}}}function YS(n){if(!n)throw new Error("Eventify cannot use falsy object as events subject");for(var t=["on","fire","off"],e=0;e<t.length;++e)if(n.hasOwnProperty(t[e]))throw new Error("Subject cannot be eventified, since it already has property '"+t[e]+"'")}var KS=JS,XS=qS;function JS(n){if(n=n||{},"uniqueLinkId"in n&&(console.warn("ngraph.graph: Starting from version 0.14 `uniqueLinkId` is deprecated.\nUse `multigraph` option instead\n",`
`,`Note: there is also change in default behavior: From now on each graph
is considered to be not a multigraph by default (each edge is unique).`),n.multigraph=n.uniqueLinkId),n.multigraph===void 0&&(n.multigraph=!1),typeof Map!="function")throw new Error("ngraph.graph requires `Map` to be defined. Please polyfill it before using ngraph");var t=new Map,e=new Map,r={},i=0,o=n.multigraph?T:A,a=[],l=Nt,h=Nt,u=Nt,d=Nt,g={version:20,addNode:v,addLink:N,removeLink:O,removeNode:b,getNode:_,getNodeCount:P,getLinkCount:M,getEdgeCount:M,getLinksCount:M,getNodesCount:P,getLinks:R,forEachNode:Ct,forEachLinkedNode:tt,forEachLink:Z,beginUpdate:u,endUpdate:d,clear:G,hasLink:$,hasNode:_,getLink:$};return XS(g),y(),g;function y(){var K=g.on;g.on=X;function X(){return g.beginUpdate=u=Lt,g.endUpdate=d=It,l=m,h=w,g.on=K,K.apply(g,arguments)}}function m(K,X){a.push({link:K,changeType:X})}function w(K,X){a.push({node:K,changeType:X})}function v(K,X){if(K===void 0)throw new Error("Invalid node identifier");u();var ot=_(K);return ot?(ot.data=X,h(ot,"update")):(ot=new QS(K,X),h(ot,"add")),t.set(K,ot),d(),ot}function _(K){return t.get(K)}function b(K){var X=_(K);if(!X)return!1;u();var ot=X.links;return ot&&(ot.forEach(V),X.links=null),t.delete(K),h(X,"remove"),d(),!0}function N(K,X,ot){u();var ht=_(K)||v(K),Ft=_(X)||v(X),ft=o(K,X,ot),Wt=e.has(ft.id);return e.set(ft.id,ft),Fd(ht,ft),K!==X&&Fd(Ft,ft),l(ft,Wt?"update":"add"),d(),ft}function A(K,X,ot){var ht=Fo(K,X),Ft=e.get(ht);return Ft?(Ft.data=ot,Ft):new Dd(K,X,ot,ht)}function T(K,X,ot){var ht=Fo(K,X),Ft=r.hasOwnProperty(ht);if(Ft||$(K,X)){Ft||(r[ht]=0);var ft="@"+ ++r[ht];ht=Fo(K+ft,X+ft)}return new Dd(K,X,ot,ht)}function P(){return t.size}function M(){return e.size}function R(K){var X=_(K);return X?X.links:null}function O(K,X){return X!==void 0&&(K=$(K,X)),V(K)}function V(K){if(!K||!e.get(K.id))return!1;u(),e.delete(K.id);var X=_(K.fromId),ot=_(K.toId);return X&&X.links.delete(K),ot&&ot.links.delete(K),l(K,"remove"),d(),!0}function $(K,X){if(!(K===void 0||X===void 0))return e.get(Fo(K,X))}function G(){u(),Ct(function(K){b(K.id)}),d()}function Z(K){if(typeof K=="function")for(var X=e.values(),ot=X.next();!ot.done;){if(K(ot.value))return!0;ot=X.next()}}function tt(K,X,ot){var ht=_(K);if(ht&&ht.links&&typeof X=="function")return ot?wt(ht.links,K,X):dt(ht.links,K,X)}function dt(K,X,ot){for(var ht,Ft=K.values(),ft=Ft.next();!ft.done;){var Wt=ft.value,vr=Wt.fromId===X?Wt.toId:Wt.fromId;if(ht=ot(t.get(vr),Wt),ht)return!0;ft=Ft.next()}}function wt(K,X,ot){for(var ht,Ft=K.values(),ft=Ft.next();!ft.done;){var Wt=ft.value;if(Wt.fromId===X&&(ht=ot(t.get(Wt.toId),Wt),ht))return!0;ft=Ft.next()}}function Nt(){}function Lt(){i+=1}function It(){i-=1,i===0&&a.length>0&&(g.fire("changed",a),a.length=0)}function Ct(K){if(typeof K!="function")throw new Error("Function is expected to iterate over graph nodes. You passed "+K);for(var X=t.values(),ot=X.next();!ot.done;){if(K(ot.value))return!0;ot=X.next()}}}function QS(n,t){this.id=n,this.links=null,this.data=t}function Fd(n,t){n.links?n.links.add(t):n.links=new Set([t])}function Dd(n,t,e,r){this.fromId=n,this.toId=t,this.data=e,this.id=r}function Fo(n,t){return n.toString()+"👉 "+t.toString()}const ds=hu(KS);function PM(n){const t=typeof n=="string"?JSON.parse(n):n;console.log("data",t);const e=ds({multigraph:!0}),r=t.nodes??[],i=t.links??[];return r.forEach(o=>{const a=o.id??null,l={commgraph_centrality:o.commgraph_centrality};if(a===null)throw new Error("nodeID not found in node"+JSON.stringify(o));e.addNode(a,l)}),i.forEach(o=>{const a=o.source??null,l=o.target??null;if(a===null||l===null)throw new Error("linkFrom or linkTo not found in link"+JSON.stringify(o));e.addLink(a,l,o)}),e}function AM(n){const t=[],e=[];return n.nodes.forEach(r=>{t.push({id:r.id})}),n.getAllLinks().forEach(r=>{r.channel.type=="PubSub"?e.push({source:r.fromId,target:r.toId,pub_topic:r.topic.id,topic_type:r.topic.messageType.name}):e.push({source:r.fromId,target:r.toId,service_name:r.topic.id,topic_type:r.topic.messageType.name})}),{nodes:t,links:e}}function ZS(n){const t=[],e=[];return n.allLayoutNodes.forEach(r=>{t.push({id:r.id})}),n.allLayoutConnections.forEach(r=>{r.getLinks().forEach(i=>{i.channel.type=="PubSub"?e.push({source:r.fromId,target:r.toId,pub_topic:i.topic.id}):e.push({source:r.fromId,target:r.toId,service_name:i.topic.id})})}),{nodes:t,links:e}}const jS={incoming:"outgoing",outgoing:"incoming",bidirectional:"bidirectional"};class NM{type;constructor(t){this.type=t}toString(){return this.type}}class tC{fromId;toId;weight;topic;constructor(t,e,r,i){this.fromId=t,this.toId=e,this.topic=r,this.weight=i}static getCombinedWeight(t){return t.reduce((e,r)=>e+r.weight,0)}}class eC{fromId;toId;connections=[];get topics(){return this.connections.map(t=>t.topic)}constructor(t,e,r){this.fromId=t,this.toId=e,this.connections=r}get combinedWeight(){return this.connections.reduce((t,e)=>t+e.weight,0)}}class fi{topic;fromId;toId;channel;direction;weight=1;graph;constructor(t,e,r,i,o,a,l=1){this.topic=t,this.fromId=e,this.toId=r,this.channel=i,this.direction=o,this.graph=a,this.weight=l}static copyFromLink(t){return new fi(t.topic,t.fromId,t.toId,t.channel,t.direction,t.graph,t.weight)}get fromNode(){return this.graph.nodesById.get(this.fromId)}get toNode(){return this.graph.nodesById.get(this.toId)}static mergeLinks(t){const e=[],r=new Map;return t.forEach(i=>{r.has(i.fromId)||r.set(i.fromId,new Map);const o=r.get(i.fromId);if(!o.has(i.toId))o.set(i.toId,fi.copyFromLink(i));else{const a=o.get(i.toId);a.weight+=i.weight}}),r.forEach(i=>{i.forEach(o=>{e.push(o)})}),e}static combineInAndOutLinks(t){const e=[],r=new Map;t.forEach(l=>{r.has(l.fromId)||r.set(l.fromId,new Map);const h=r.get(l.fromId);if(!h.has(l.toId))h.set(l.toId,fi.copyFromLink(l));else{const u=h.get(l.toId);u.weight+=l.weight}});const i=[];r.forEach(l=>{l.forEach(h=>{i.push(h)})});const o=new Map;i.forEach(l=>{o.has(l.fromId)||o.set(l.fromId,new Map),o.get(l.fromId).set(l.toId,fi.copyFromLink(l))});const a=.001;return i.forEach(l=>{const h=o.get(l.fromId)?.get(l.toId),u=o.get(l.toId)?.get(l.fromId);if(!(!h&&!u)){if(h&&u){const d=h.weight-u.weight;d>a?(h.weight=d,e.push(h)):d<-a&&(u.weight=-d,e.push(u)),o.get(h.fromId)?.delete(h.toId),o.get(h.toId)?.delete(h.fromId);return}if(!h&&u){e.push(u),o.get(u.fromId)?.delete(u.toId);return}if(!u&&h){e.push(h),o.get(h.fromId)?.delete(h.toId);return}}}),e}static filterLinksByWeight(t,e){return t.filter(r=>r.weight>=e)}}class nC{constructor(t,e){this.topic=t,this.channel=e}}class Bd{nodeIds=[];nodeIsInCommunity(t){return this.nodeIds.includes(t)}}class rC{communities=[];initDefaultCommunities(t){this.communities=[new Bd],this.communities[0].nodeIds=t}getCommunitiesOfNode(t){return t?this.communities.map((e,r)=>e.nodeIsInCommunity(t)?r:-1).filter(e=>e>=0):[]}setCommunitiesByList(t){this.communities=t.map(e=>{const r=new Bd;return r.nodeIds=e,r})}getAsIdLists(){return this.communities.map(t=>t.nodeIds)}get countOfCommunities(){return this.communities.length}}class iC{channel;outgoing=new Map;incoming=new Map;bidirectional=new Map;all=new Map;directions={incoming:this.incoming,outgoing:this.outgoing,bidirectional:this.bidirectional};constructor(t){this.channel=t}}class sC{channel;outgoing;incoming;bidirectional;all;directions;constructor(t){this.channel=t,this.outgoing=ds({multigraph:!0}),this.incoming=ds({multigraph:!0}),this.bidirectional=ds({multigraph:!0}),this.all=ds({multigraph:!0}),this.directions={incoming:this.incoming,outgoing:this.outgoing,bidirectional:this.bidirectional}}addNode(t){this.outgoing.addNode(t.id,t),this.incoming.addNode(t.id,t),this.bidirectional.addNode(t.id,t),this.all.addNode(t.id,t)}}class sa{nodes=[];nodesById;channelsByType;topicToNodeMapsByChannelType;graphsByChannelType;communities=new rC;hiddenTopics=[];constructor(t,e){this.nodesById=new Map,this.channelsByType=new Map,this.topicToNodeMapsByChannelType=new Map,this.graphsByChannelType=new Map,e.forEach(r=>{this.channelsByType.set(r.type,r),this.topicToNodeMapsByChannelType.set(r.type,new iC(r))}),this.addNodes(t)}addNodes(t){t=Array.isArray(t)?t:[t],t.forEach(e=>{e.graph=this,this.nodes.push(e),this.nodesById.set(e.id,e),e.topics.forEach(r=>{const i=r.channel.type,o=r.id,l=this.getTopicToNodeMapByChannelType(i)[r.direction];l.has(o)||l.set(o,[]),l.get(o).push(e)})}),this.communities.initDefaultCommunities(this.nodes.map(e=>e.id)),this._updateLinks()}get channels(){return Array.from(this.channelsByType.values())}_checkIfChannelTypeExists(t){if(!this.channelsByType.has(t))throw new Error(`Channel type ${t} not found`)}getTopicToNodeMapByChannelType(t){return this._checkIfChannelTypeExists(t),this.topicToNodeMapsByChannelType.get(t)}_updateLinks(){this.channels.forEach(t=>{this.graphsByChannelType.set(t.type,new sC(t))}),this.nodes.forEach(t=>{this.graphsByChannelType.forEach(e=>{e.addNode(t)}),t.topics.forEach(e=>{const r=e.channel.type,i=this.graphsByChannelType.get(r),o=this.getTopicToNodeMapByChannelType(r),a=i[e.direction];(o[jS[e.direction]].get(e.id)||[]).forEach(h=>{a.addLink(t.id,h.id,new nC(e,e.channel))})})})}static getNodeID(t){return typeof t=="string"?t:t.id}getNode(t){if(t!==void 0)return typeof t=="string"?this.nodesById.get(t):t}getChannels(t){return t===void 0?this.channels:typeof t=="string"?[this.channelsByType.get(t)]:Array.isArray(t)?t.map(e=>typeof e=="string"?this.channelsByType.get(e):e):[]}getSuccesscorsAccordingToDirection(t,e,r){const i=[],o=new Set,a=sa.getNodeID(t);return this.getChannels(r).forEach(h=>{this.graphsByChannelType.get(h.type).directions[e].forEachLinkedNode(a,(u,d)=>{this.hiddenTopics.some(g=>d.data.topic.id.match(g))||o.has(u.id)||(o.add(u.id),i.push(this.nodesById.get(u.id)))},!0)}),i}getSuccessors(t,e){return this.getSuccesscorsAccordingToDirection(t,"outgoing",e)}getPredecessors(t,e){return this.getSuccesscorsAccordingToDirection(t,"incoming",e)}getLinksAccordingToDirection(t,e,r,i){const o=[],a=sa.getNodeID(t);return this.getChannels(r).forEach(h=>{this.graphsByChannelType.get(h.type).directions[e].forEachLinkedNode(a,(u,d)=>{if(!this.hiddenTopics.some(g=>d.data.topic.id.match(g))){const g=this.getTopicWeight(h.type,d.data.topic.id);if(i&&g<i)return;o.push(new fi(d.data.topic,d.fromId,d.toId,h,e,this,g))}},!0)}),o}getOutgoingLinks(t,e,r){return this.getLinksAccordingToDirection(t,"outgoing",e,r)}getIncomingLinks(t,e,r){return this.getLinksAccordingToDirection(t,"incoming",e,r)}getAllLinks(t,e){return this.getAllLinksOfNodes(this.nodes,t,e)}getAllLinksOfNodes(t,e,r){const i=[],o=this.getChannels(e);return t.forEach(a=>{i.push(...this.getOutgoingLinks(a.id,o,r))}),i}getAllInternalLinksOfNodes(t,e,r){const i=[],o=this.getChannels(e);return this.getAllLinks(o,r).forEach(l=>{t.some(h=>h.id===l.fromId)&&t.some(h=>h.id===l.toId)&&i.push(l)}),i}getAllExternalLinksBetweenNodeGroups(t,e,r,i){const o=[],a=this.getChannels(r),l=this.getAllLinks(a,i),h=new Set(t.map(b=>b.id)),u=new Set(e.map(b=>b.id)),d=l.filter(b=>h.has(b.fromId)&&h.has(b.toId)),g=l.filter(b=>u.has(b.fromId)&&u.has(b.toId)),y=new Map,m=new Map;d.forEach(b=>{y.has(b.fromId)||y.set(b.fromId,new Map),y.get(b.fromId).set(b.toId,b)}),g.forEach(b=>{m.has(b.fromId)||m.set(b.fromId,new Map),m.get(b.fromId).set(b.toId,b)});const w=b=>y.has(b.fromId)&&y.get(b.fromId).has(b.toId),v=b=>m.has(b.fromId)&&m.get(b.fromId).has(b.toId),_=b=>(h.has(b.fromId)&&u.has(b.toId)||u.has(b.fromId)&&h.has(b.toId))&&!w(b)&&!v(b);return l.forEach(b=>{_(b)&&o.push(b)}),o}getConnectionsBetweenNodes(t,e){if(!t||!e)return;const r=this.getNode(t),i=this.getNode(e);if(!r||!i)return;const o=r.topics.filter(l=>l.direction==="outgoing").filter(l=>i.topics.filter(h=>h.direction=="incoming").some(h=>l.channel.type===h.channel.type&&l.id===h.id)),a=[];return o.forEach(l=>{const h=l.channel.type,m=(this.getTopicToNodeMapByChannelType(h)[l.direction].get(l.id)||[]).length;a.push(new tC(r.id,i.id,l,m))}),new eC(r.id,i.id,a)}getTopicUsageCount(t,e,r=!1){const i=this.getTopicToNodeMapByChannelType(t),o=i.outgoing.get(e),a=i.incoming.get(e),l=o.filter(u=>a.some(d=>d.id===u.id)),h=o.length*a.length;return r?h-l.length:h}getTopicWeight(t,e){const r=this.getTopicUsageCount(t,e);return Math.sqrt(1/Math.max(r,1))}setNodeScoringByList(t){for(const[e,r]of t){const i=this.getNode(e);i&&(i.score=r)}}getScoreExtent(){let t=Number.POSITIVE_INFINITY,e=Number.NEGATIVE_INFINITY;return this.nodes.forEach(r=>{t=Math.min(t,r.score),e=Math.max(e,r.score)}),[t,e]}}function wi(n,t){return n==null||t==null?NaN:n<t?-1:n>t?1:n>=t?0:NaN}function oC(n,t){return n==null||t==null?NaN:t<n?-1:t>n?1:t>=n?0:NaN}function op(n){let t,e,r;n.length!==2?(t=wi,e=(l,h)=>wi(n(l),h),r=(l,h)=>n(l)-h):(t=n===wi||n===oC?n:aC,e=n,r=n);function i(l,h,u=0,d=l.length){if(u<d){if(t(h,h)!==0)return d;do{const g=u+d>>>1;e(l[g],h)<0?u=g+1:d=g}while(u<d)}return u}function o(l,h,u=0,d=l.length){if(u<d){if(t(h,h)!==0)return d;do{const g=u+d>>>1;e(l[g],h)<=0?u=g+1:d=g}while(u<d)}return u}function a(l,h,u=0,d=l.length){const g=i(l,h,u,d-1);return g>u&&r(l[g-1],h)>-r(l[g],h)?g-1:g}return{left:i,center:a,right:o}}function aC(){return 0}function cC(n){return n===null?NaN:+n}function*lC(n,t){for(let e of n)e!=null&&(e=+e)>=e&&(yield e)}const uC=op(wi),hC=uC.right;op(cC).center;function fC(n,t){let e=0,r,i=0,o=0;for(let a of n)a!=null&&(a=+a)>=a&&(r=a-i,i+=r/++e,o+=r*(a-i));if(e>1)return o/(e-1)}function Vd(n,t){const e=fC(n);return e&&Math.sqrt(e)}function Br(n,t){let e,r;if(t===void 0)for(const i of n)i!=null&&(e===void 0?i>=i&&(e=r=i):(e>i&&(e=i),r<i&&(r=i)));else{let i=-1;for(let o of n)(o=t(o,++i,n))!=null&&(e===void 0?o>=o&&(e=r=o):(e>o&&(e=o),r<o&&(r=o)))}return[e,r]}function dC(n=wi){if(n===wi)return ap;if(typeof n!="function")throw new TypeError("compare is not a function");return(t,e)=>{const r=n(t,e);return r||r===0?r:(n(e,e)===0)-(n(t,t)===0)}}function ap(n,t){return(n==null||!(n>=n))-(t==null||!(t>=t))||(n<t?-1:n>t?1:0)}const gC=Math.sqrt(50),pC=Math.sqrt(10),mC=Math.sqrt(2);function oa(n,t,e){const r=(t-n)/Math.max(0,e),i=Math.floor(Math.log10(r)),o=r/Math.pow(10,i),a=o>=gC?10:o>=pC?5:o>=mC?2:1;let l,h,u;return i<0?(u=Math.pow(10,-i)/a,l=Math.round(n*u),h=Math.round(t*u),l/u<n&&++l,h/u>t&&--h,u=-u):(u=Math.pow(10,i)*a,l=Math.round(n/u),h=Math.round(t/u),l*u<n&&++l,h*u>t&&--h),h<l&&.5<=e&&e<2?oa(n,t,e*2):[l,h,u]}function Bl(n,t,e){if(t=+t,n=+n,e=+e,!(e>0))return[];if(n===t)return[n];const r=t<n,[i,o,a]=r?oa(t,n,e):oa(n,t,e);if(!(o>=i))return[];const l=o-i+1,h=new Array(l);if(r)if(a<0)for(let u=0;u<l;++u)h[u]=(o-u)/-a;else for(let u=0;u<l;++u)h[u]=(o-u)*a;else if(a<0)for(let u=0;u<l;++u)h[u]=(i+u)/-a;else for(let u=0;u<l;++u)h[u]=(i+u)*a;return h}function Vl(n,t,e){return t=+t,n=+n,e=+e,oa(n,t,e)[2]}function yC(n,t,e){t=+t,n=+n,e=+e;const r=t<n,i=r?Vl(t,n,e):Vl(n,t,e);return(r?-1:1)*(i<0?1/-i:i)}function Gl(n,t){let e;if(t===void 0)for(const r of n)r!=null&&(e<r||e===void 0&&r>=r)&&(e=r);else{let r=-1;for(let i of n)(i=t(i,++r,n))!=null&&(e<i||e===void 0&&i>=i)&&(e=i)}return e}function aa(n,t){let e;for(const r of n)r!=null&&(e>r||e===void 0&&r>=r)&&(e=r);return e}function cp(n,t,e=0,r=1/0,i){if(t=Math.floor(t),e=Math.floor(Math.max(0,e)),r=Math.floor(Math.min(n.length-1,r)),!(e<=t&&t<=r))return n;for(i=i===void 0?ap:dC(i);r>e;){if(r-e>600){const h=r-e+1,u=t-e+1,d=Math.log(h),g=.5*Math.exp(2*d/3),y=.5*Math.sqrt(d*g*(h-g)/h)*(u-h/2<0?-1:1),m=Math.max(e,Math.floor(t-u*g/h+y)),w=Math.min(r,Math.floor(t+(h-u)*g/h+y));cp(n,t,m,w,i)}const o=n[t];let a=e,l=r;for(us(n,e,t),i(n[r],o)>0&&us(n,e,r);a<l;){for(us(n,a,l),++a,--l;i(n[a],o)<0;)++a;for(;i(n[l],o)>0;)--l}i(n[e],o)===0?us(n,e,l):(++l,us(n,l,r)),l<=t&&(e=l+1),t<=l&&(r=l-1)}return n}function us(n,t,e){const r=n[t];n[t]=n[e],n[e]=r}function wC(n,t,e){if(n=Float64Array.from(lC(n)),!(!(r=n.length)||isNaN(t=+t))){if(t<=0||r<2)return aa(n);if(t>=1)return Gl(n);var r,i=(r-1)*t,o=Math.floor(i),a=Gl(cp(n,o).subarray(0,o+1)),l=aa(n.subarray(o+1));return a+(l-a)*(i-o)}}function ms(n,t){let e=0,r=0;if(t===void 0)for(let i of n)i!=null&&(i=+i)>=i&&(++e,r+=i);else{let i=-1;for(let o of n)(o=t(o,++i,n))!=null&&(o=+o)>=o&&(++e,r+=o)}if(e)return r/e}function Gd(n,t){return wC(n,.5)}var vC={value:()=>{}};function fu(){for(var n=0,t=arguments.length,e={},r;n<t;++n){if(!(r=arguments[n]+"")||r in e||/[\s.]/.test(r))throw new Error("illegal type: "+r);e[r]=[]}return new Yo(e)}function Yo(n){this._=n}function bC(n,t){return n.trim().split(/^|\s+/).map(function(e){var r="",i=e.indexOf(".");if(i>=0&&(r=e.slice(i+1),e=e.slice(0,i)),e&&!t.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:r}})}Yo.prototype=fu.prototype={constructor:Yo,on:function(n,t){var e=this._,r=bC(n+"",e),i,o=-1,a=r.length;if(arguments.length<2){for(;++o<a;)if((i=(n=r[o]).type)&&(i=_C(e[i],n.name)))return i;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++o<a;)if(i=(n=r[o]).type)e[i]=zd(e[i],n.name,t);else if(t==null)for(i in e)e[i]=zd(e[i],n.name,null);return this},copy:function(){var n={},t=this._;for(var e in t)n[e]=t[e].slice();return new Yo(n)},call:function(n,t){if((i=arguments.length-2)>0)for(var e=new Array(i),r=0,i,o;r<i;++r)e[r]=arguments[r+2];if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(o=this._[n],r=0,i=o.length;r<i;++r)o[r].value.apply(t,e)},apply:function(n,t,e){if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(var r=this._[n],i=0,o=r.length;i<o;++i)r[i].value.apply(t,e)}};function _C(n,t){for(var e=0,r=n.length,i;e<r;++e)if((i=n[e]).name===t)return i.value}function zd(n,t,e){for(var r=0,i=n.length;r<i;++r)if(n[r].name===t){n[r]=vC,n=n.slice(0,r).concat(n.slice(r+1));break}return e!=null&&n.push({name:t,value:e}),n}var zl="http://www.w3.org/1999/xhtml";const $d={svg:"http://www.w3.org/2000/svg",xhtml:zl,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Ea(n){var t=n+="",e=t.indexOf(":");return e>=0&&(t=n.slice(0,e))!=="xmlns"&&(n=n.slice(e+1)),$d.hasOwnProperty(t)?{space:$d[t],local:n}:n}function xC(n){return function(){var t=this.ownerDocument,e=this.namespaceURI;return e===zl&&t.documentElement.namespaceURI===zl?t.createElement(n):t.createElementNS(e,n)}}function SC(n){return function(){return this.ownerDocument.createElementNS(n.space,n.local)}}function lp(n){var t=Ea(n);return(t.local?SC:xC)(t)}function CC(){}function du(n){return n==null?CC:function(){return this.querySelector(n)}}function PC(n){typeof n!="function"&&(n=du(n));for(var t=this._groups,e=t.length,r=new Array(e),i=0;i<e;++i)for(var o=t[i],a=o.length,l=r[i]=new Array(a),h,u,d=0;d<a;++d)(h=o[d])&&(u=n.call(h,h.__data__,d,o))&&("__data__"in h&&(u.__data__=h.__data__),l[d]=u);return new Oe(r,this._parents)}function AC(n){return n==null?[]:Array.isArray(n)?n:Array.from(n)}function NC(){return[]}function up(n){return n==null?NC:function(){return this.querySelectorAll(n)}}function TC(n){return function(){return AC(n.apply(this,arguments))}}function EC(n){typeof n=="function"?n=TC(n):n=up(n);for(var t=this._groups,e=t.length,r=[],i=[],o=0;o<e;++o)for(var a=t[o],l=a.length,h,u=0;u<l;++u)(h=a[u])&&(r.push(n.call(h,h.__data__,u,a)),i.push(h));return new Oe(r,i)}function hp(n){return function(){return this.matches(n)}}function fp(n){return function(t){return t.matches(n)}}var IC=Array.prototype.find;function MC(n){return function(){return IC.call(this.children,n)}}function RC(){return this.firstElementChild}function LC(n){return this.select(n==null?RC:MC(typeof n=="function"?n:fp(n)))}var kC=Array.prototype.filter;function OC(){return Array.from(this.children)}function FC(n){return function(){return kC.call(this.children,n)}}function DC(n){return this.selectAll(n==null?OC:FC(typeof n=="function"?n:fp(n)))}function BC(n){typeof n!="function"&&(n=hp(n));for(var t=this._groups,e=t.length,r=new Array(e),i=0;i<e;++i)for(var o=t[i],a=o.length,l=r[i]=[],h,u=0;u<a;++u)(h=o[u])&&n.call(h,h.__data__,u,o)&&l.push(h);return new Oe(r,this._parents)}function dp(n){return new Array(n.length)}function VC(){return new Oe(this._enter||this._groups.map(dp),this._parents)}function ca(n,t){this.ownerDocument=n.ownerDocument,this.namespaceURI=n.namespaceURI,this._next=null,this._parent=n,this.__data__=t}ca.prototype={constructor:ca,appendChild:function(n){return this._parent.insertBefore(n,this._next)},insertBefore:function(n,t){return this._parent.insertBefore(n,t)},querySelector:function(n){return this._parent.querySelector(n)},querySelectorAll:function(n){return this._parent.querySelectorAll(n)}};function GC(n){return function(){return n}}function zC(n,t,e,r,i,o){for(var a=0,l,h=t.length,u=o.length;a<u;++a)(l=t[a])?(l.__data__=o[a],r[a]=l):e[a]=new ca(n,o[a]);for(;a<h;++a)(l=t[a])&&(i[a]=l)}function $C(n,t,e,r,i,o,a){var l,h,u=new Map,d=t.length,g=o.length,y=new Array(d),m;for(l=0;l<d;++l)(h=t[l])&&(y[l]=m=a.call(h,h.__data__,l,t)+"",u.has(m)?i[l]=h:u.set(m,h));for(l=0;l<g;++l)m=a.call(n,o[l],l,o)+"",(h=u.get(m))?(r[l]=h,h.__data__=o[l],u.delete(m)):e[l]=new ca(n,o[l]);for(l=0;l<d;++l)(h=t[l])&&u.get(y[l])===h&&(i[l]=h)}function WC(n){return n.__data__}function HC(n,t){if(!arguments.length)return Array.from(this,WC);var e=t?$C:zC,r=this._parents,i=this._groups;typeof n!="function"&&(n=GC(n));for(var o=i.length,a=new Array(o),l=new Array(o),h=new Array(o),u=0;u<o;++u){var d=r[u],g=i[u],y=g.length,m=qC(n.call(d,d&&d.__data__,u,r)),w=m.length,v=l[u]=new Array(w),_=a[u]=new Array(w),b=h[u]=new Array(y);e(d,g,v,_,b,m,t);for(var N=0,A=0,T,P;N<w;++N)if(T=v[N]){for(N>=A&&(A=N+1);!(P=_[A])&&++A<w;);T._next=P||null}}return a=new Oe(a,r),a._enter=l,a._exit=h,a}function qC(n){return typeof n=="object"&&"length"in n?n:Array.from(n)}function UC(){return new Oe(this._exit||this._groups.map(dp),this._parents)}function YC(n,t,e){var r=this.enter(),i=this,o=this.exit();return typeof n=="function"?(r=n(r),r&&(r=r.selection())):r=r.append(n+""),t!=null&&(i=t(i),i&&(i=i.selection())),e==null?o.remove():e(o),r&&i?r.merge(i).order():i}function KC(n){for(var t=n.selection?n.selection():n,e=this._groups,r=t._groups,i=e.length,o=r.length,a=Math.min(i,o),l=new Array(i),h=0;h<a;++h)for(var u=e[h],d=r[h],g=u.length,y=l[h]=new Array(g),m,w=0;w<g;++w)(m=u[w]||d[w])&&(y[w]=m);for(;h<i;++h)l[h]=e[h];return new Oe(l,this._parents)}function XC(){for(var n=this._groups,t=-1,e=n.length;++t<e;)for(var r=n[t],i=r.length-1,o=r[i],a;--i>=0;)(a=r[i])&&(o&&a.compareDocumentPosition(o)^4&&o.parentNode.insertBefore(a,o),o=a);return this}function JC(n){n||(n=QC);function t(g,y){return g&&y?n(g.__data__,y.__data__):!g-!y}for(var e=this._groups,r=e.length,i=new Array(r),o=0;o<r;++o){for(var a=e[o],l=a.length,h=i[o]=new Array(l),u,d=0;d<l;++d)(u=a[d])&&(h[d]=u);h.sort(t)}return new Oe(i,this._parents).order()}function QC(n,t){return n<t?-1:n>t?1:n>=t?0:NaN}function ZC(){var n=arguments[0];return arguments[0]=this,n.apply(null,arguments),this}function jC(){return Array.from(this)}function tP(){for(var n=this._groups,t=0,e=n.length;t<e;++t)for(var r=n[t],i=0,o=r.length;i<o;++i){var a=r[i];if(a)return a}return null}function eP(){let n=0;for(const t of this)++n;return n}function nP(){return!this.node()}function rP(n){for(var t=this._groups,e=0,r=t.length;e<r;++e)for(var i=t[e],o=0,a=i.length,l;o<a;++o)(l=i[o])&&n.call(l,l.__data__,o,i);return this}function iP(n){return function(){this.removeAttribute(n)}}function sP(n){return function(){this.removeAttributeNS(n.space,n.local)}}function oP(n,t){return function(){this.setAttribute(n,t)}}function aP(n,t){return function(){this.setAttributeNS(n.space,n.local,t)}}function cP(n,t){return function(){var e=t.apply(this,arguments);e==null?this.removeAttribute(n):this.setAttribute(n,e)}}function lP(n,t){return function(){var e=t.apply(this,arguments);e==null?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,e)}}function uP(n,t){var e=Ea(n);if(arguments.length<2){var r=this.node();return e.local?r.getAttributeNS(e.space,e.local):r.getAttribute(e)}return this.each((t==null?e.local?sP:iP:typeof t=="function"?e.local?lP:cP:e.local?aP:oP)(e,t))}function gp(n){return n.ownerDocument&&n.ownerDocument.defaultView||n.document&&n||n.defaultView}function hP(n){return function(){this.style.removeProperty(n)}}function fP(n,t,e){return function(){this.style.setProperty(n,t,e)}}function dP(n,t,e){return function(){var r=t.apply(this,arguments);r==null?this.style.removeProperty(n):this.style.setProperty(n,r,e)}}function gP(n,t,e){return arguments.length>1?this.each((t==null?hP:typeof t=="function"?dP:fP)(n,t,e??"")):Ai(this.node(),n)}function Ai(n,t){return n.style.getPropertyValue(t)||gp(n).getComputedStyle(n,null).getPropertyValue(t)}function pP(n){return function(){delete this[n]}}function mP(n,t){return function(){this[n]=t}}function yP(n,t){return function(){var e=t.apply(this,arguments);e==null?delete this[n]:this[n]=e}}function wP(n,t){return arguments.length>1?this.each((t==null?pP:typeof t=="function"?yP:mP)(n,t)):this.node()[n]}function pp(n){return n.trim().split(/^|\s+/)}function gu(n){return n.classList||new mp(n)}function mp(n){this._node=n,this._names=pp(n.getAttribute("class")||"")}mp.prototype={add:function(n){var t=this._names.indexOf(n);t<0&&(this._names.push(n),this._node.setAttribute("class",this._names.join(" ")))},remove:function(n){var t=this._names.indexOf(n);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(n){return this._names.indexOf(n)>=0}};function yp(n,t){for(var e=gu(n),r=-1,i=t.length;++r<i;)e.add(t[r])}function wp(n,t){for(var e=gu(n),r=-1,i=t.length;++r<i;)e.remove(t[r])}function vP(n){return function(){yp(this,n)}}function bP(n){return function(){wp(this,n)}}function _P(n,t){return function(){(t.apply(this,arguments)?yp:wp)(this,n)}}function xP(n,t){var e=pp(n+"");if(arguments.length<2){for(var r=gu(this.node()),i=-1,o=e.length;++i<o;)if(!r.contains(e[i]))return!1;return!0}return this.each((typeof t=="function"?_P:t?vP:bP)(e,t))}function SP(){this.textContent=""}function CP(n){return function(){this.textContent=n}}function PP(n){return function(){var t=n.apply(this,arguments);this.textContent=t??""}}function AP(n){return arguments.length?this.each(n==null?SP:(typeof n=="function"?PP:CP)(n)):this.node().textContent}function NP(){this.innerHTML=""}function TP(n){return function(){this.innerHTML=n}}function EP(n){return function(){var t=n.apply(this,arguments);this.innerHTML=t??""}}function IP(n){return arguments.length?this.each(n==null?NP:(typeof n=="function"?EP:TP)(n)):this.node().innerHTML}function MP(){this.nextSibling&&this.parentNode.appendChild(this)}function RP(){return this.each(MP)}function LP(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function kP(){return this.each(LP)}function OP(n){var t=typeof n=="function"?n:lp(n);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function FP(){return null}function DP(n,t){var e=typeof n=="function"?n:lp(n),r=t==null?FP:typeof t=="function"?t:du(t);return this.select(function(){return this.insertBefore(e.apply(this,arguments),r.apply(this,arguments)||null)})}function BP(){var n=this.parentNode;n&&n.removeChild(this)}function VP(){return this.each(BP)}function GP(){var n=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(n,this.nextSibling):n}function zP(){var n=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(n,this.nextSibling):n}function $P(n){return this.select(n?zP:GP)}function WP(n){return arguments.length?this.property("__data__",n):this.node().__data__}function HP(n){return function(t){n.call(this,t,this.__data__)}}function qP(n){return n.trim().split(/^|\s+/).map(function(t){var e="",r=t.indexOf(".");return r>=0&&(e=t.slice(r+1),t=t.slice(0,r)),{type:t,name:e}})}function UP(n){return function(){var t=this.__on;if(t){for(var e=0,r=-1,i=t.length,o;e<i;++e)o=t[e],(!n.type||o.type===n.type)&&o.name===n.name?this.removeEventListener(o.type,o.listener,o.options):t[++r]=o;++r?t.length=r:delete this.__on}}}function YP(n,t,e){return function(){var r=this.__on,i,o=HP(t);if(r){for(var a=0,l=r.length;a<l;++a)if((i=r[a]).type===n.type&&i.name===n.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=o,i.options=e),i.value=t;return}}this.addEventListener(n.type,o,e),i={type:n.type,name:n.name,value:t,listener:o,options:e},r?r.push(i):this.__on=[i]}}function KP(n,t,e){var r=qP(n+""),i,o=r.length,a;if(arguments.length<2){var l=this.node().__on;if(l){for(var h=0,u=l.length,d;h<u;++h)for(i=0,d=l[h];i<o;++i)if((a=r[i]).type===d.type&&a.name===d.name)return d.value}return}for(l=t?YP:UP,i=0;i<o;++i)this.each(l(r[i],t,e));return this}function vp(n,t,e){var r=gp(n),i=r.CustomEvent;typeof i=="function"?i=new i(t,e):(i=r.document.createEvent("Event"),e?(i.initEvent(t,e.bubbles,e.cancelable),i.detail=e.detail):i.initEvent(t,!1,!1)),n.dispatchEvent(i)}function XP(n,t){return function(){return vp(this,n,t)}}function JP(n,t){return function(){return vp(this,n,t.apply(this,arguments))}}function QP(n,t){return this.each((typeof t=="function"?JP:XP)(n,t))}function*ZP(){for(var n=this._groups,t=0,e=n.length;t<e;++t)for(var r=n[t],i=0,o=r.length,a;i<o;++i)(a=r[i])&&(yield a)}var bp=[null];function Oe(n,t){this._groups=n,this._parents=t}function Ls(){return new Oe([[document.documentElement]],bp)}function jP(){return this}Oe.prototype=Ls.prototype={constructor:Oe,select:PC,selectAll:EC,selectChild:LC,selectChildren:DC,filter:BC,data:HC,enter:VC,exit:UC,join:YC,merge:KC,selection:jP,order:XC,sort:JC,call:ZC,nodes:jC,node:tP,size:eP,empty:nP,each:rP,attr:uP,style:gP,property:wP,classed:xP,text:AP,html:IP,raise:RP,lower:kP,append:OP,insert:DP,remove:VP,clone:$P,datum:WP,on:KP,dispatch:QP,[Symbol.iterator]:ZP};function t2(n){return typeof n=="string"?new Oe([[document.querySelector(n)]],[document.documentElement]):new Oe([[n]],bp)}function Di(n,t,e){n.prototype=t.prototype=e,e.constructor=n}function ks(n,t){var e=Object.create(n.prototype);for(var r in t)e[r]=t[r];return e}function yr(){}var Vr=.7,Ni=1/Vr,vi="\\s*([+-]?\\d+)\\s*",Ns="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Sn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",e2=/^#([0-9a-f]{3,8})$/,n2=new RegExp(`^rgb\\(${vi},${vi},${vi}\\)$`),r2=new RegExp(`^rgb\\(${Sn},${Sn},${Sn}\\)$`),i2=new RegExp(`^rgba\\(${vi},${vi},${vi},${Ns}\\)$`),s2=new RegExp(`^rgba\\(${Sn},${Sn},${Sn},${Ns}\\)$`),o2=new RegExp(`^hsl\\(${Ns},${Sn},${Sn}\\)$`),a2=new RegExp(`^hsla\\(${Ns},${Sn},${Sn},${Ns}\\)$`),Wd={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Di(yr,cn,{copy(n){return Object.assign(new this.constructor,this,n)},displayable(){return this.rgb().displayable()},hex:Hd,formatHex:Hd,formatHex8:c2,formatHsl:l2,formatRgb:qd,toString:qd});function Hd(){return this.rgb().formatHex()}function c2(){return this.rgb().formatHex8()}function l2(){return _p(this).formatHsl()}function qd(){return this.rgb().formatRgb()}function cn(n){var t,e;return n=(n+"").trim().toLowerCase(),(t=e2.exec(n))?(e=t[1].length,t=parseInt(t[1],16),e===6?Ud(t):e===3?new re(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):e===8?Do(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):e===4?Do(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=n2.exec(n))?new re(t[1],t[2],t[3],1):(t=r2.exec(n))?new re(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=i2.exec(n))?Do(t[1],t[2],t[3],t[4]):(t=s2.exec(n))?Do(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=o2.exec(n))?Xd(t[1],t[2]/100,t[3]/100,1):(t=a2.exec(n))?Xd(t[1],t[2]/100,t[3]/100,t[4]):Wd.hasOwnProperty(n)?Ud(Wd[n]):n==="transparent"?new re(NaN,NaN,NaN,0):null}function Ud(n){return new re(n>>16&255,n>>8&255,n&255,1)}function Do(n,t,e,r){return r<=0&&(n=t=e=NaN),new re(n,t,e,r)}function pu(n){return n instanceof yr||(n=cn(n)),n?(n=n.rgb(),new re(n.r,n.g,n.b,n.opacity)):new re}function Gr(n,t,e,r){return arguments.length===1?pu(n):new re(n,t,e,r??1)}function re(n,t,e,r){this.r=+n,this.g=+t,this.b=+e,this.opacity=+r}Di(re,Gr,ks(yr,{brighter(n){return n=n==null?Ni:Math.pow(Ni,n),new re(this.r*n,this.g*n,this.b*n,this.opacity)},darker(n){return n=n==null?Vr:Math.pow(Vr,n),new re(this.r*n,this.g*n,this.b*n,this.opacity)},rgb(){return this},clamp(){return new re(Fr(this.r),Fr(this.g),Fr(this.b),la(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Yd,formatHex:Yd,formatHex8:u2,formatRgb:Kd,toString:Kd}));function Yd(){return`#${Lr(this.r)}${Lr(this.g)}${Lr(this.b)}`}function u2(){return`#${Lr(this.r)}${Lr(this.g)}${Lr(this.b)}${Lr((isNaN(this.opacity)?1:this.opacity)*255)}`}function Kd(){const n=la(this.opacity);return`${n===1?"rgb(":"rgba("}${Fr(this.r)}, ${Fr(this.g)}, ${Fr(this.b)}${n===1?")":`, ${n})`}`}function la(n){return isNaN(n)?1:Math.max(0,Math.min(1,n))}function Fr(n){return Math.max(0,Math.min(255,Math.round(n)||0))}function Lr(n){return n=Fr(n),(n<16?"0":"")+n.toString(16)}function Xd(n,t,e,r){return r<=0?n=t=e=NaN:e<=0||e>=1?n=t=NaN:t<=0&&(n=NaN),new on(n,t,e,r)}function _p(n){if(n instanceof on)return new on(n.h,n.s,n.l,n.opacity);if(n instanceof yr||(n=cn(n)),!n)return new on;if(n instanceof on)return n;n=n.rgb();var t=n.r/255,e=n.g/255,r=n.b/255,i=Math.min(t,e,r),o=Math.max(t,e,r),a=NaN,l=o-i,h=(o+i)/2;return l?(t===o?a=(e-r)/l+(e<r)*6:e===o?a=(r-t)/l+2:a=(t-e)/l+4,l/=h<.5?o+i:2-o-i,a*=60):l=h>0&&h<1?0:a,new on(a,l,h,n.opacity)}function $l(n,t,e,r){return arguments.length===1?_p(n):new on(n,t,e,r??1)}function on(n,t,e,r){this.h=+n,this.s=+t,this.l=+e,this.opacity=+r}Di(on,$l,ks(yr,{brighter(n){return n=n==null?Ni:Math.pow(Ni,n),new on(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?Vr:Math.pow(Vr,n),new on(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=this.h%360+(this.h<0)*360,t=isNaN(n)||isNaN(this.s)?0:this.s,e=this.l,r=e+(e<.5?e:1-e)*t,i=2*e-r;return new re(bl(n>=240?n-240:n+120,i,r),bl(n,i,r),bl(n<120?n+240:n-120,i,r),this.opacity)},clamp(){return new on(Jd(this.h),Bo(this.s),Bo(this.l),la(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const n=la(this.opacity);return`${n===1?"hsl(":"hsla("}${Jd(this.h)}, ${Bo(this.s)*100}%, ${Bo(this.l)*100}%${n===1?")":`, ${n})`}`}}));function Jd(n){return n=(n||0)%360,n<0?n+360:n}function Bo(n){return Math.max(0,Math.min(1,n||0))}function bl(n,t,e){return(n<60?t+(e-t)*n/60:n<180?e:n<240?t+(e-t)*(240-n)/60:t)*255}const xp=Math.PI/180,Sp=180/Math.PI,ua=18,Cp=.96422,Pp=1,Ap=.82521,Np=4/29,bi=6/29,Tp=3*bi*bi,h2=bi*bi*bi;function Ep(n){if(n instanceof Cn)return new Cn(n.l,n.a,n.b,n.opacity);if(n instanceof $n)return Mp(n);n instanceof re||(n=pu(n));var t=Cl(n.r),e=Cl(n.g),r=Cl(n.b),i=_l((.2225045*t+.7168786*e+.0606169*r)/Pp),o,a;return t===e&&e===r?o=a=i:(o=_l((.4360747*t+.3850649*e+.1430804*r)/Cp),a=_l((.0139322*t+.0971045*e+.7141733*r)/Ap)),new Cn(116*i-16,500*(o-i),200*(i-a),n.opacity)}function Ip(n,t,e,r){return arguments.length===1?Ep(n):new Cn(n,t,e,r??1)}function Cn(n,t,e,r){this.l=+n,this.a=+t,this.b=+e,this.opacity=+r}Di(Cn,Ip,ks(yr,{brighter(n){return new Cn(this.l+ua*(n??1),this.a,this.b,this.opacity)},darker(n){return new Cn(this.l-ua*(n??1),this.a,this.b,this.opacity)},rgb(){var n=(this.l+16)/116,t=isNaN(this.a)?n:n+this.a/500,e=isNaN(this.b)?n:n-this.b/200;return t=Cp*xl(t),n=Pp*xl(n),e=Ap*xl(e),new re(Sl(3.1338561*t-1.6168667*n-.4906146*e),Sl(-.9787684*t+1.9161415*n+.033454*e),Sl(.0719453*t-.2289914*n+1.4052427*e),this.opacity)}}));function _l(n){return n>h2?Math.pow(n,1/3):n/Tp+Np}function xl(n){return n>bi?n*n*n:Tp*(n-Np)}function Sl(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function Cl(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function f2(n){if(n instanceof $n)return new $n(n.h,n.c,n.l,n.opacity);if(n instanceof Cn||(n=Ep(n)),n.a===0&&n.b===0)return new $n(NaN,0<n.l&&n.l<100?0:NaN,n.l,n.opacity);var t=Math.atan2(n.b,n.a)*Sp;return new $n(t<0?t+360:t,Math.sqrt(n.a*n.a+n.b*n.b),n.l,n.opacity)}function d2(n,t,e,r){return arguments.length===1?f2(n):new $n(n,t,e,r??1)}function $n(n,t,e,r){this.h=+n,this.c=+t,this.l=+e,this.opacity=+r}function Mp(n){if(isNaN(n.h))return new Cn(n.l,0,0,n.opacity);var t=n.h*xp;return new Cn(n.l,Math.cos(t)*n.c,Math.sin(t)*n.c,n.opacity)}Di($n,d2,ks(yr,{brighter(n){return new $n(this.h,this.c,this.l+ua*(n??1),this.opacity)},darker(n){return new $n(this.h,this.c,this.l-ua*(n??1),this.opacity)},rgb(){return Mp(this).rgb()}}));var Rp=-.14861,mu=1.78277,yu=-.29227,Ia=-.90649,Ts=1.97294,Qd=Ts*Ia,Zd=Ts*mu,jd=mu*yu-Ia*Rp;function g2(n){if(n instanceof Dr)return new Dr(n.h,n.s,n.l,n.opacity);n instanceof re||(n=pu(n));var t=n.r/255,e=n.g/255,r=n.b/255,i=(jd*r+Qd*t-Zd*e)/(jd+Qd-Zd),o=r-i,a=(Ts*(e-i)-yu*o)/Ia,l=Math.sqrt(a*a+o*o)/(Ts*i*(1-i)),h=l?Math.atan2(a,o)*Sp-120:NaN;return new Dr(h<0?h+360:h,l,i,n.opacity)}function gr(n,t,e,r){return arguments.length===1?g2(n):new Dr(n,t,e,r??1)}function Dr(n,t,e,r){this.h=+n,this.s=+t,this.l=+e,this.opacity=+r}Di(Dr,gr,ks(yr,{brighter(n){return n=n==null?Ni:Math.pow(Ni,n),new Dr(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?Vr:Math.pow(Vr,n),new Dr(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=isNaN(this.h)?0:(this.h+120)*xp,t=+this.l,e=isNaN(this.s)?0:this.s*t*(1-t),r=Math.cos(n),i=Math.sin(n);return new re(255*(t+e*(Rp*r+mu*i)),255*(t+e*(yu*r+Ia*i)),255*(t+e*(Ts*r)),this.opacity)}}));function p2(n,t,e,r,i){var o=n*n,a=o*n;return((1-3*n+3*o-a)*t+(4-6*o+3*a)*e+(1+3*n+3*o-3*a)*r+a*i)/6}function m2(n){var t=n.length-1;return function(e){var r=e<=0?e=0:e>=1?(e=1,t-1):Math.floor(e*t),i=n[r],o=n[r+1],a=r>0?n[r-1]:2*i-o,l=r<t-1?n[r+2]:2*o-i;return p2((e-r/t)*t,a,i,o,l)}}const Ma=n=>()=>n;function Lp(n,t){return function(e){return n+e*t}}function y2(n,t,e){return n=Math.pow(n,e),t=Math.pow(t,e)-n,e=1/e,function(r){return Math.pow(n+r*t,e)}}function w2(n,t){var e=t-n;return e?Lp(n,e>180||e<-180?e-360*Math.round(e/360):e):Ma(isNaN(n)?t:n)}function v2(n){return(n=+n)==1?_i:function(t,e){return e-t?y2(t,e,n):Ma(isNaN(t)?e:t)}}function _i(n,t){var e=t-n;return e?Lp(n,e):Ma(isNaN(n)?t:n)}const ha=function n(t){var e=v2(t);function r(i,o){var a=e((i=Gr(i)).r,(o=Gr(o)).r),l=e(i.g,o.g),h=e(i.b,o.b),u=_i(i.opacity,o.opacity);return function(d){return i.r=a(d),i.g=l(d),i.b=h(d),i.opacity=u(d),i+""}}return r.gamma=n,r}(1);function b2(n){return function(t){var e=t.length,r=new Array(e),i=new Array(e),o=new Array(e),a,l;for(a=0;a<e;++a)l=Gr(t[a]),r[a]=l.r||0,i[a]=l.g||0,o[a]=l.b||0;return r=n(r),i=n(i),o=n(o),l.opacity=1,function(h){return l.r=r(h),l.g=i(h),l.b=o(h),l+""}}}var _2=b2(m2);function x2(n,t){t||(t=[]);var e=n?Math.min(t.length,n.length):0,r=t.slice(),i;return function(o){for(i=0;i<e;++i)r[i]=n[i]*(1-o)+t[i]*o;return r}}function S2(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function C2(n,t){var e=t?t.length:0,r=n?Math.min(e,n.length):0,i=new Array(r),o=new Array(e),a;for(a=0;a<r;++a)i[a]=Ra(n[a],t[a]);for(;a<e;++a)o[a]=t[a];return function(l){for(a=0;a<r;++a)o[a]=i[a](l);return o}}function P2(n,t){var e=new Date;return n=+n,t=+t,function(r){return e.setTime(n*(1-r)+t*r),e}}function sn(n,t){return n=+n,t=+t,function(e){return n*(1-e)+t*e}}function A2(n,t){var e={},r={},i;(n===null||typeof n!="object")&&(n={}),(t===null||typeof t!="object")&&(t={});for(i in t)i in n?e[i]=Ra(n[i],t[i]):r[i]=t[i];return function(o){for(i in e)r[i]=e[i](o);return r}}var Wl=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Pl=new RegExp(Wl.source,"g");function N2(n){return function(){return n}}function T2(n){return function(t){return n(t)+""}}function kp(n,t){var e=Wl.lastIndex=Pl.lastIndex=0,r,i,o,a=-1,l=[],h=[];for(n=n+"",t=t+"";(r=Wl.exec(n))&&(i=Pl.exec(t));)(o=i.index)>e&&(o=t.slice(e,o),l[a]?l[a]+=o:l[++a]=o),(r=r[0])===(i=i[0])?l[a]?l[a]+=i:l[++a]=i:(l[++a]=null,h.push({i:a,x:sn(r,i)})),e=Pl.lastIndex;return e<t.length&&(o=t.slice(e),l[a]?l[a]+=o:l[++a]=o),l.length<2?h[0]?T2(h[0].x):N2(t):(t=h.length,function(u){for(var d=0,g;d<t;++d)l[(g=h[d]).i]=g.x(u);return l.join("")})}function Ra(n,t){var e=typeof t,r;return t==null||e==="boolean"?Ma(t):(e==="number"?sn:e==="string"?(r=cn(t))?(t=r,ha):kp:t instanceof cn?ha:t instanceof Date?P2:S2(t)?x2:Array.isArray(t)?C2:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?A2:sn)(n,t)}function Op(n,t){return n=+n,t=+t,function(e){return Math.round(n*(1-e)+t*e)}}var tg=180/Math.PI,Hl={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Fp(n,t,e,r,i,o){var a,l,h;return(a=Math.sqrt(n*n+t*t))&&(n/=a,t/=a),(h=n*e+t*r)&&(e-=n*h,r-=t*h),(l=Math.sqrt(e*e+r*r))&&(e/=l,r/=l,h/=l),n*r<t*e&&(n=-n,t=-t,h=-h,a=-a),{translateX:i,translateY:o,rotate:Math.atan2(t,n)*tg,skewX:Math.atan(h)*tg,scaleX:a,scaleY:l}}var Vo;function E2(n){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(n+"");return t.isIdentity?Hl:Fp(t.a,t.b,t.c,t.d,t.e,t.f)}function I2(n){return n==null||(Vo||(Vo=document.createElementNS("http://www.w3.org/2000/svg","g")),Vo.setAttribute("transform",n),!(n=Vo.transform.baseVal.consolidate()))?Hl:(n=n.matrix,Fp(n.a,n.b,n.c,n.d,n.e,n.f))}function Dp(n,t,e,r){function i(u){return u.length?u.pop()+" ":""}function o(u,d,g,y,m,w){if(u!==g||d!==y){var v=m.push("translate(",null,t,null,e);w.push({i:v-4,x:sn(u,g)},{i:v-2,x:sn(d,y)})}else(g||y)&&m.push("translate("+g+t+y+e)}function a(u,d,g,y){u!==d?(u-d>180?d+=360:d-u>180&&(u+=360),y.push({i:g.push(i(g)+"rotate(",null,r)-2,x:sn(u,d)})):d&&g.push(i(g)+"rotate("+d+r)}function l(u,d,g,y){u!==d?y.push({i:g.push(i(g)+"skewX(",null,r)-2,x:sn(u,d)}):d&&g.push(i(g)+"skewX("+d+r)}function h(u,d,g,y,m,w){if(u!==g||d!==y){var v=m.push(i(m)+"scale(",null,",",null,")");w.push({i:v-4,x:sn(u,g)},{i:v-2,x:sn(d,y)})}else(g!==1||y!==1)&&m.push(i(m)+"scale("+g+","+y+")")}return function(u,d){var g=[],y=[];return u=n(u),d=n(d),o(u.translateX,u.translateY,d.translateX,d.translateY,g,y),a(u.rotate,d.rotate,g,y),l(u.skewX,d.skewX,g,y),h(u.scaleX,u.scaleY,d.scaleX,d.scaleY,g,y),u=d=null,function(m){for(var w=-1,v=y.length,_;++w<v;)g[(_=y[w]).i]=_.x(m);return g.join("")}}}var M2=Dp(E2,"px, ","px)","deg)"),R2=Dp(I2,", ",")",")");function Bp(n){return function t(e){e=+e;function r(i,o){var a=n((i=gr(i)).h,(o=gr(o)).h),l=_i(i.s,o.s),h=_i(i.l,o.l),u=_i(i.opacity,o.opacity);return function(d){return i.h=a(d),i.s=l(d),i.l=h(Math.pow(d,e)),i.opacity=u(d),i+""}}return r.gamma=t,r}(1)}Bp(w2);var Vp=Bp(_i),Ti=0,gs=0,hs=0,Gp=1e3,fa,ps,da=0,zr=0,La=0,Es=typeof performance=="object"&&performance.now?performance:Date,zp=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(n){setTimeout(n,17)};function wu(){return zr||(zp(L2),zr=Es.now()+La)}function L2(){zr=0}function ga(){this._call=this._time=this._next=null}ga.prototype=vu.prototype={constructor:ga,restart:function(n,t,e){if(typeof n!="function")throw new TypeError("callback is not a function");e=(e==null?wu():+e)+(t==null?0:+t),!this._next&&ps!==this&&(ps?ps._next=this:fa=this,ps=this),this._call=n,this._time=e,ql()},stop:function(){this._call&&(this._call=null,this._time=1/0,ql())}};function vu(n,t,e){var r=new ga;return r.restart(n,t,e),r}function k2(){wu(),++Ti;for(var n=fa,t;n;)(t=zr-n._time)>=0&&n._call.call(void 0,t),n=n._next;--Ti}function eg(){zr=(da=Es.now())+La,Ti=gs=0;try{k2()}finally{Ti=0,F2(),zr=0}}function O2(){var n=Es.now(),t=n-da;t>Gp&&(La-=t,da=n)}function F2(){for(var n,t=fa,e,r=1/0;t;)t._call?(r>t._time&&(r=t._time),n=t,t=t._next):(e=t._next,t._next=null,t=n?n._next=e:fa=e);ps=n,ql(r)}function ql(n){if(!Ti){gs&&(gs=clearTimeout(gs));var t=n-zr;t>24?(n<1/0&&(gs=setTimeout(eg,n-Es.now()-La)),hs&&(hs=clearInterval(hs))):(hs||(da=Es.now(),hs=setInterval(O2,Gp)),Ti=1,zp(eg))}}function ng(n,t,e){var r=new ga;return t=t==null?0:+t,r.restart(i=>{r.stop(),n(i+t)},t,e),r}var D2=fu("start","end","cancel","interrupt"),B2=[],$p=0,rg=1,Ul=2,Ko=3,ig=4,Yl=5,Xo=6;function ka(n,t,e,r,i,o){var a=n.__transition;if(!a)n.__transition={};else if(e in a)return;V2(n,e,{name:t,index:r,group:i,on:D2,tween:B2,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:$p})}function bu(n,t){var e=ln(n,t);if(e.state>$p)throw new Error("too late; already scheduled");return e}function Tn(n,t){var e=ln(n,t);if(e.state>Ko)throw new Error("too late; already running");return e}function ln(n,t){var e=n.__transition;if(!e||!(e=e[t]))throw new Error("transition not found");return e}function V2(n,t,e){var r=n.__transition,i;r[t]=e,e.timer=vu(o,0,e.time);function o(u){e.state=rg,e.timer.restart(a,e.delay,e.time),e.delay<=u&&a(u-e.delay)}function a(u){var d,g,y,m;if(e.state!==rg)return h();for(d in r)if(m=r[d],m.name===e.name){if(m.state===Ko)return ng(a);m.state===ig?(m.state=Xo,m.timer.stop(),m.on.call("interrupt",n,n.__data__,m.index,m.group),delete r[d]):+d<t&&(m.state=Xo,m.timer.stop(),m.on.call("cancel",n,n.__data__,m.index,m.group),delete r[d])}if(ng(function(){e.state===Ko&&(e.state=ig,e.timer.restart(l,e.delay,e.time),l(u))}),e.state=Ul,e.on.call("start",n,n.__data__,e.index,e.group),e.state===Ul){for(e.state=Ko,i=new Array(y=e.tween.length),d=0,g=-1;d<y;++d)(m=e.tween[d].value.call(n,n.__data__,e.index,e.group))&&(i[++g]=m);i.length=g+1}}function l(u){for(var d=u<e.duration?e.ease.call(null,u/e.duration):(e.timer.restart(h),e.state=Yl,1),g=-1,y=i.length;++g<y;)i[g].call(n,d);e.state===Yl&&(e.on.call("end",n,n.__data__,e.index,e.group),h())}function h(){e.state=Xo,e.timer.stop(),delete r[t];for(var u in r)return;delete n.__transition}}function G2(n,t){var e=n.__transition,r,i,o=!0,a;if(e){t=t==null?null:t+"";for(a in e){if((r=e[a]).name!==t){o=!1;continue}i=r.state>Ul&&r.state<Yl,r.state=Xo,r.timer.stop(),r.on.call(i?"interrupt":"cancel",n,n.__data__,r.index,r.group),delete e[a]}o&&delete n.__transition}}function z2(n){return this.each(function(){G2(this,n)})}function $2(n,t){var e,r;return function(){var i=Tn(this,n),o=i.tween;if(o!==e){r=e=o;for(var a=0,l=r.length;a<l;++a)if(r[a].name===t){r=r.slice(),r.splice(a,1);break}}i.tween=r}}function W2(n,t,e){var r,i;if(typeof e!="function")throw new Error;return function(){var o=Tn(this,n),a=o.tween;if(a!==r){i=(r=a).slice();for(var l={name:t,value:e},h=0,u=i.length;h<u;++h)if(i[h].name===t){i[h]=l;break}h===u&&i.push(l)}o.tween=i}}function H2(n,t){var e=this._id;if(n+="",arguments.length<2){for(var r=ln(this.node(),e).tween,i=0,o=r.length,a;i<o;++i)if((a=r[i]).name===n)return a.value;return null}return this.each((t==null?$2:W2)(e,n,t))}function _u(n,t,e){var r=n._id;return n.each(function(){var i=Tn(this,r);(i.value||(i.value={}))[t]=e.apply(this,arguments)}),function(i){return ln(i,r).value[t]}}function Wp(n,t){var e;return(typeof t=="number"?sn:t instanceof cn?ha:(e=cn(t))?(t=e,ha):kp)(n,t)}function q2(n){return function(){this.removeAttribute(n)}}function U2(n){return function(){this.removeAttributeNS(n.space,n.local)}}function Y2(n,t,e){var r,i=e+"",o;return function(){var a=this.getAttribute(n);return a===i?null:a===r?o:o=t(r=a,e)}}function K2(n,t,e){var r,i=e+"",o;return function(){var a=this.getAttributeNS(n.space,n.local);return a===i?null:a===r?o:o=t(r=a,e)}}function X2(n,t,e){var r,i,o;return function(){var a,l=e(this),h;return l==null?void this.removeAttribute(n):(a=this.getAttribute(n),h=l+"",a===h?null:a===r&&h===i?o:(i=h,o=t(r=a,l)))}}function J2(n,t,e){var r,i,o;return function(){var a,l=e(this),h;return l==null?void this.removeAttributeNS(n.space,n.local):(a=this.getAttributeNS(n.space,n.local),h=l+"",a===h?null:a===r&&h===i?o:(i=h,o=t(r=a,l)))}}function Q2(n,t){var e=Ea(n),r=e==="transform"?R2:Wp;return this.attrTween(n,typeof t=="function"?(e.local?J2:X2)(e,r,_u(this,"attr."+n,t)):t==null?(e.local?U2:q2)(e):(e.local?K2:Y2)(e,r,t))}function Z2(n,t){return function(e){this.setAttribute(n,t.call(this,e))}}function j2(n,t){return function(e){this.setAttributeNS(n.space,n.local,t.call(this,e))}}function tA(n,t){var e,r;function i(){var o=t.apply(this,arguments);return o!==r&&(e=(r=o)&&j2(n,o)),e}return i._value=t,i}function eA(n,t){var e,r;function i(){var o=t.apply(this,arguments);return o!==r&&(e=(r=o)&&Z2(n,o)),e}return i._value=t,i}function nA(n,t){var e="attr."+n;if(arguments.length<2)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;var r=Ea(n);return this.tween(e,(r.local?tA:eA)(r,t))}function rA(n,t){return function(){bu(this,n).delay=+t.apply(this,arguments)}}function iA(n,t){return t=+t,function(){bu(this,n).delay=t}}function sA(n){var t=this._id;return arguments.length?this.each((typeof n=="function"?rA:iA)(t,n)):ln(this.node(),t).delay}function oA(n,t){return function(){Tn(this,n).duration=+t.apply(this,arguments)}}function aA(n,t){return t=+t,function(){Tn(this,n).duration=t}}function cA(n){var t=this._id;return arguments.length?this.each((typeof n=="function"?oA:aA)(t,n)):ln(this.node(),t).duration}function lA(n,t){if(typeof t!="function")throw new Error;return function(){Tn(this,n).ease=t}}function uA(n){var t=this._id;return arguments.length?this.each(lA(t,n)):ln(this.node(),t).ease}function hA(n,t){return function(){var e=t.apply(this,arguments);if(typeof e!="function")throw new Error;Tn(this,n).ease=e}}function fA(n){if(typeof n!="function")throw new Error;return this.each(hA(this._id,n))}function dA(n){typeof n!="function"&&(n=hp(n));for(var t=this._groups,e=t.length,r=new Array(e),i=0;i<e;++i)for(var o=t[i],a=o.length,l=r[i]=[],h,u=0;u<a;++u)(h=o[u])&&n.call(h,h.__data__,u,o)&&l.push(h);return new Hn(r,this._parents,this._name,this._id)}function gA(n){if(n._id!==this._id)throw new Error;for(var t=this._groups,e=n._groups,r=t.length,i=e.length,o=Math.min(r,i),a=new Array(r),l=0;l<o;++l)for(var h=t[l],u=e[l],d=h.length,g=a[l]=new Array(d),y,m=0;m<d;++m)(y=h[m]||u[m])&&(g[m]=y);for(;l<r;++l)a[l]=t[l];return new Hn(a,this._parents,this._name,this._id)}function pA(n){return(n+"").trim().split(/^|\s+/).every(function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||t==="start"})}function mA(n,t,e){var r,i,o=pA(t)?bu:Tn;return function(){var a=o(this,n),l=a.on;l!==r&&(i=(r=l).copy()).on(t,e),a.on=i}}function yA(n,t){var e=this._id;return arguments.length<2?ln(this.node(),e).on.on(n):this.each(mA(e,n,t))}function wA(n){return function(){var t=this.parentNode;for(var e in this.__transition)if(+e!==n)return;t&&t.removeChild(this)}}function vA(){return this.on("end.remove",wA(this._id))}function bA(n){var t=this._name,e=this._id;typeof n!="function"&&(n=du(n));for(var r=this._groups,i=r.length,o=new Array(i),a=0;a<i;++a)for(var l=r[a],h=l.length,u=o[a]=new Array(h),d,g,y=0;y<h;++y)(d=l[y])&&(g=n.call(d,d.__data__,y,l))&&("__data__"in d&&(g.__data__=d.__data__),u[y]=g,ka(u[y],t,e,y,u,ln(d,e)));return new Hn(o,this._parents,t,e)}function _A(n){var t=this._name,e=this._id;typeof n!="function"&&(n=up(n));for(var r=this._groups,i=r.length,o=[],a=[],l=0;l<i;++l)for(var h=r[l],u=h.length,d,g=0;g<u;++g)if(d=h[g]){for(var y=n.call(d,d.__data__,g,h),m,w=ln(d,e),v=0,_=y.length;v<_;++v)(m=y[v])&&ka(m,t,e,v,y,w);o.push(y),a.push(d)}return new Hn(o,a,t,e)}var xA=Ls.prototype.constructor;function SA(){return new xA(this._groups,this._parents)}function CA(n,t){var e,r,i;return function(){var o=Ai(this,n),a=(this.style.removeProperty(n),Ai(this,n));return o===a?null:o===e&&a===r?i:i=t(e=o,r=a)}}function Hp(n){return function(){this.style.removeProperty(n)}}function PA(n,t,e){var r,i=e+"",o;return function(){var a=Ai(this,n);return a===i?null:a===r?o:o=t(r=a,e)}}function AA(n,t,e){var r,i,o;return function(){var a=Ai(this,n),l=e(this),h=l+"";return l==null&&(h=l=(this.style.removeProperty(n),Ai(this,n))),a===h?null:a===r&&h===i?o:(i=h,o=t(r=a,l))}}function NA(n,t){var e,r,i,o="style."+t,a="end."+o,l;return function(){var h=Tn(this,n),u=h.on,d=h.value[o]==null?l||(l=Hp(t)):void 0;(u!==e||i!==d)&&(r=(e=u).copy()).on(a,i=d),h.on=r}}function TA(n,t,e){var r=(n+="")=="transform"?M2:Wp;return t==null?this.styleTween(n,CA(n,r)).on("end.style."+n,Hp(n)):typeof t=="function"?this.styleTween(n,AA(n,r,_u(this,"style."+n,t))).each(NA(this._id,n)):this.styleTween(n,PA(n,r,t),e).on("end.style."+n,null)}function EA(n,t,e){return function(r){this.style.setProperty(n,t.call(this,r),e)}}function IA(n,t,e){var r,i;function o(){var a=t.apply(this,arguments);return a!==i&&(r=(i=a)&&EA(n,a,e)),r}return o._value=t,o}function MA(n,t,e){var r="style."+(n+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(t==null)return this.tween(r,null);if(typeof t!="function")throw new Error;return this.tween(r,IA(n,t,e??""))}function RA(n){return function(){this.textContent=n}}function LA(n){return function(){var t=n(this);this.textContent=t??""}}function kA(n){return this.tween("text",typeof n=="function"?LA(_u(this,"text",n)):RA(n==null?"":n+""))}function OA(n){return function(t){this.textContent=n.call(this,t)}}function FA(n){var t,e;function r(){var i=n.apply(this,arguments);return i!==e&&(t=(e=i)&&OA(i)),t}return r._value=n,r}function DA(n){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(n==null)return this.tween(t,null);if(typeof n!="function")throw new Error;return this.tween(t,FA(n))}function BA(){for(var n=this._name,t=this._id,e=qp(),r=this._groups,i=r.length,o=0;o<i;++o)for(var a=r[o],l=a.length,h,u=0;u<l;++u)if(h=a[u]){var d=ln(h,t);ka(h,n,e,u,a,{time:d.time+d.delay+d.duration,delay:0,duration:d.duration,ease:d.ease})}return new Hn(r,this._parents,n,e)}function VA(){var n,t,e=this,r=e._id,i=e.size();return new Promise(function(o,a){var l={value:a},h={value:function(){--i===0&&o()}};e.each(function(){var u=Tn(this,r),d=u.on;d!==n&&(t=(n=d).copy(),t._.cancel.push(l),t._.interrupt.push(l),t._.end.push(h)),u.on=t}),i===0&&o()})}var GA=0;function Hn(n,t,e,r){this._groups=n,this._parents=t,this._name=e,this._id=r}function qp(){return++GA}var Gn=Ls.prototype;Hn.prototype={constructor:Hn,select:bA,selectAll:_A,selectChild:Gn.selectChild,selectChildren:Gn.selectChildren,filter:dA,merge:gA,selection:SA,transition:BA,call:Gn.call,nodes:Gn.nodes,node:Gn.node,size:Gn.size,empty:Gn.empty,each:Gn.each,on:yA,attr:Q2,attrTween:nA,style:TA,styleTween:MA,text:kA,textTween:DA,remove:vA,tween:H2,delay:sA,duration:cA,ease:uA,easeVarying:fA,end:VA,[Symbol.iterator]:Gn[Symbol.iterator]};function TM(n){return--n*n*n+1}function zA(n){return((n*=2)<=1?n*n*n:(n-=2)*n*n+2)/2}var $A={time:null,delay:0,duration:250,ease:zA};function WA(n,t){for(var e;!(e=n.__transition)||!(e=e[t]);)if(!(n=n.parentNode))throw new Error(`transition ${t} not found`);return e}function HA(n){var t,e;n instanceof Hn?(t=n._id,n=n._name):(t=qp(),(e=$A).time=wu(),n=n==null?null:n+"");for(var r=this._groups,i=r.length,o=0;o<i;++o)for(var a=r[o],l=a.length,h,u=0;u<l;++u)(h=a[u])&&ka(h,n,t,u,a,e||WA(h,t));return new Hn(r,this._parents,n,t)}Ls.prototype.interrupt=z2;Ls.prototype.transition=HA;const Kl=Math.PI,Xl=2*Kl,Ir=1e-6,qA=Xl-Ir;function Up(n){this._+=n[0];for(let t=1,e=n.length;t<e;++t)this._+=arguments[t]+n[t]}function UA(n){let t=Math.floor(n);if(!(t>=0))throw new Error(`invalid digits: ${n}`);if(t>15)return Up;const e=10**t;return function(r){this._+=r[0];for(let i=1,o=r.length;i<o;++i)this._+=Math.round(arguments[i]*e)/e+r[i]}}let YA=class{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?Up:UA(t)}moveTo(t,e){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,e){this._append`L${this._x1=+t},${this._y1=+e}`}quadraticCurveTo(t,e,r,i){this._append`Q${+t},${+e},${this._x1=+r},${this._y1=+i}`}bezierCurveTo(t,e,r,i,o,a){this._append`C${+t},${+e},${+r},${+i},${this._x1=+o},${this._y1=+a}`}arcTo(t,e,r,i,o){if(t=+t,e=+e,r=+r,i=+i,o=+o,o<0)throw new Error(`negative radius: ${o}`);let a=this._x1,l=this._y1,h=r-t,u=i-e,d=a-t,g=l-e,y=d*d+g*g;if(this._x1===null)this._append`M${this._x1=t},${this._y1=e}`;else if(y>Ir)if(!(Math.abs(g*h-u*d)>Ir)||!o)this._append`L${this._x1=t},${this._y1=e}`;else{let m=r-a,w=i-l,v=h*h+u*u,_=m*m+w*w,b=Math.sqrt(v),N=Math.sqrt(y),A=o*Math.tan((Kl-Math.acos((v+y-_)/(2*b*N)))/2),T=A/N,P=A/b;Math.abs(T-1)>Ir&&this._append`L${t+T*d},${e+T*g}`,this._append`A${o},${o},0,0,${+(g*m>d*w)},${this._x1=t+P*h},${this._y1=e+P*u}`}}arc(t,e,r,i,o,a){if(t=+t,e=+e,r=+r,a=!!a,r<0)throw new Error(`negative radius: ${r}`);let l=r*Math.cos(i),h=r*Math.sin(i),u=t+l,d=e+h,g=1^a,y=a?i-o:o-i;this._x1===null?this._append`M${u},${d}`:(Math.abs(this._x1-u)>Ir||Math.abs(this._y1-d)>Ir)&&this._append`L${u},${d}`,r&&(y<0&&(y=y%Xl+Xl),y>qA?this._append`A${r},${r},0,1,${g},${t-l},${e-h}A${r},${r},0,1,${g},${this._x1=u},${this._y1=d}`:y>Ir&&this._append`A${r},${r},0,${+(y>=Kl)},${g},${this._x1=t+r*Math.cos(o)},${this._y1=e+r*Math.sin(o)}`)}rect(t,e,r,i){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}h${r=+r}v${+i}h${-r}Z`}toString(){return this._}};function KA(n){const t=+this._x.call(null,n),e=+this._y.call(null,n);return Yp(this.cover(t,e),t,e,n)}function Yp(n,t,e,r){if(isNaN(t)||isNaN(e))return n;var i,o=n._root,a={data:r},l=n._x0,h=n._y0,u=n._x1,d=n._y1,g,y,m,w,v,_,b,N;if(!o)return n._root=a,n;for(;o.length;)if((v=t>=(g=(l+u)/2))?l=g:u=g,(_=e>=(y=(h+d)/2))?h=y:d=y,i=o,!(o=o[b=_<<1|v]))return i[b]=a,n;if(m=+n._x.call(null,o.data),w=+n._y.call(null,o.data),t===m&&e===w)return a.next=o,i?i[b]=a:n._root=a,n;do i=i?i[b]=new Array(4):n._root=new Array(4),(v=t>=(g=(l+u)/2))?l=g:u=g,(_=e>=(y=(h+d)/2))?h=y:d=y;while((b=_<<1|v)===(N=(w>=y)<<1|m>=g));return i[N]=o,i[b]=a,n}function XA(n){var t,e,r=n.length,i,o,a=new Array(r),l=new Array(r),h=1/0,u=1/0,d=-1/0,g=-1/0;for(e=0;e<r;++e)isNaN(i=+this._x.call(null,t=n[e]))||isNaN(o=+this._y.call(null,t))||(a[e]=i,l[e]=o,i<h&&(h=i),i>d&&(d=i),o<u&&(u=o),o>g&&(g=o));if(h>d||u>g)return this;for(this.cover(h,u).cover(d,g),e=0;e<r;++e)Yp(this,a[e],l[e],n[e]);return this}function JA(n,t){if(isNaN(n=+n)||isNaN(t=+t))return this;var e=this._x0,r=this._y0,i=this._x1,o=this._y1;if(isNaN(e))i=(e=Math.floor(n))+1,o=(r=Math.floor(t))+1;else{for(var a=i-e||1,l=this._root,h,u;e>n||n>=i||r>t||t>=o;)switch(u=(t<r)<<1|n<e,h=new Array(4),h[u]=l,l=h,a*=2,u){case 0:i=e+a,o=r+a;break;case 1:e=i-a,o=r+a;break;case 2:i=e+a,r=o-a;break;case 3:e=i-a,r=o-a;break}this._root&&this._root.length&&(this._root=l)}return this._x0=e,this._y0=r,this._x1=i,this._y1=o,this}function QA(){var n=[];return this.visit(function(t){if(!t.length)do n.push(t.data);while(t=t.next)}),n}function ZA(n){return arguments.length?this.cover(+n[0][0],+n[0][1]).cover(+n[1][0],+n[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function de(n,t,e,r,i){this.node=n,this.x0=t,this.y0=e,this.x1=r,this.y1=i}function jA(n,t,e){var r,i=this._x0,o=this._y0,a,l,h,u,d=this._x1,g=this._y1,y=[],m=this._root,w,v;for(m&&y.push(new de(m,i,o,d,g)),e==null?e=1/0:(i=n-e,o=t-e,d=n+e,g=t+e,e*=e);w=y.pop();)if(!(!(m=w.node)||(a=w.x0)>d||(l=w.y0)>g||(h=w.x1)<i||(u=w.y1)<o))if(m.length){var _=(a+h)/2,b=(l+u)/2;y.push(new de(m[3],_,b,h,u),new de(m[2],a,b,_,u),new de(m[1],_,l,h,b),new de(m[0],a,l,_,b)),(v=(t>=b)<<1|n>=_)&&(w=y[y.length-1],y[y.length-1]=y[y.length-1-v],y[y.length-1-v]=w)}else{var N=n-+this._x.call(null,m.data),A=t-+this._y.call(null,m.data),T=N*N+A*A;if(T<e){var P=Math.sqrt(e=T);i=n-P,o=t-P,d=n+P,g=t+P,r=m.data}}return r}function tN(n){if(isNaN(d=+this._x.call(null,n))||isNaN(g=+this._y.call(null,n)))return this;var t,e=this._root,r,i,o,a=this._x0,l=this._y0,h=this._x1,u=this._y1,d,g,y,m,w,v,_,b;if(!e)return this;if(e.length)for(;;){if((w=d>=(y=(a+h)/2))?a=y:h=y,(v=g>=(m=(l+u)/2))?l=m:u=m,t=e,!(e=e[_=v<<1|w]))return this;if(!e.length)break;(t[_+1&3]||t[_+2&3]||t[_+3&3])&&(r=t,b=_)}for(;e.data!==n;)if(i=e,!(e=e.next))return this;return(o=e.next)&&delete e.next,i?(o?i.next=o:delete i.next,this):t?(o?t[_]=o:delete t[_],(e=t[0]||t[1]||t[2]||t[3])&&e===(t[3]||t[2]||t[1]||t[0])&&!e.length&&(r?r[b]=e:this._root=e),this):(this._root=o,this)}function eN(n){for(var t=0,e=n.length;t<e;++t)this.remove(n[t]);return this}function nN(){return this._root}function rN(){var n=0;return this.visit(function(t){if(!t.length)do++n;while(t=t.next)}),n}function iN(n){var t=[],e,r=this._root,i,o,a,l,h;for(r&&t.push(new de(r,this._x0,this._y0,this._x1,this._y1));e=t.pop();)if(!n(r=e.node,o=e.x0,a=e.y0,l=e.x1,h=e.y1)&&r.length){var u=(o+l)/2,d=(a+h)/2;(i=r[3])&&t.push(new de(i,u,d,l,h)),(i=r[2])&&t.push(new de(i,o,d,u,h)),(i=r[1])&&t.push(new de(i,u,a,l,d)),(i=r[0])&&t.push(new de(i,o,a,u,d))}return this}function sN(n){var t=[],e=[],r;for(this._root&&t.push(new de(this._root,this._x0,this._y0,this._x1,this._y1));r=t.pop();){var i=r.node;if(i.length){var o,a=r.x0,l=r.y0,h=r.x1,u=r.y1,d=(a+h)/2,g=(l+u)/2;(o=i[0])&&t.push(new de(o,a,l,d,g)),(o=i[1])&&t.push(new de(o,d,l,h,g)),(o=i[2])&&t.push(new de(o,a,g,d,u)),(o=i[3])&&t.push(new de(o,d,g,h,u))}e.push(r)}for(;r=e.pop();)n(r.node,r.x0,r.y0,r.x1,r.y1);return this}function oN(n){return n[0]}function aN(n){return arguments.length?(this._x=n,this):this._x}function cN(n){return n[1]}function lN(n){return arguments.length?(this._y=n,this):this._y}function xu(n,t,e){var r=new Su(t??oN,e??cN,NaN,NaN,NaN,NaN);return n==null?r:r.addAll(n)}function Su(n,t,e,r,i,o){this._x=n,this._y=t,this._x0=e,this._y0=r,this._x1=i,this._y1=o,this._root=void 0}function sg(n){for(var t={data:n.data},e=t;n=n.next;)e=e.next={data:n.data};return t}var pe=xu.prototype=Su.prototype;pe.copy=function(){var n=new Su(this._x,this._y,this._x0,this._y0,this._x1,this._y1),t=this._root,e,r;if(!t)return n;if(!t.length)return n._root=sg(t),n;for(e=[{source:t,target:n._root=new Array(4)}];t=e.pop();)for(var i=0;i<4;++i)(r=t.source[i])&&(r.length?e.push({source:r,target:t.target[i]=new Array(4)}):t.target[i]=sg(r));return n};pe.add=KA;pe.addAll=XA;pe.cover=JA;pe.data=QA;pe.extent=ZA;pe.find=jA;pe.remove=tN;pe.removeAll=eN;pe.root=nN;pe.size=rN;pe.visit=iN;pe.visitAfter=sN;pe.x=aN;pe.y=lN;function ge(n){return function(){return n}}function lr(n){return(n()-.5)*1e-6}function uN(n){return n.x+n.vx}function hN(n){return n.y+n.vy}function fN(n){var t,e,r,i=1,o=1;typeof n!="function"&&(n=ge(n==null?1:+n));function a(){for(var u,d=t.length,g,y,m,w,v,_,b=0;b<o;++b)for(g=xu(t,uN,hN).visitAfter(l),u=0;u<d;++u)y=t[u],v=e[y.index],_=v*v,m=y.x+y.vx,w=y.y+y.vy,g.visit(N);function N(A,T,P,M,R){var O=A.data,V=A.r,$=v+V;if(O){if(O.index>y.index){var G=m-O.x-O.vx,Z=w-O.y-O.vy,tt=G*G+Z*Z;tt<$*$&&(G===0&&(G=lr(r),tt+=G*G),Z===0&&(Z=lr(r),tt+=Z*Z),tt=($-(tt=Math.sqrt(tt)))/tt*i,y.vx+=(G*=tt)*($=(V*=V)/(_+V)),y.vy+=(Z*=tt)*$,O.vx-=G*($=1-$),O.vy-=Z*$)}return}return T>m+$||M<m-$||P>w+$||R<w-$}}function l(u){if(u.data)return u.r=e[u.data.index];for(var d=u.r=0;d<4;++d)u[d]&&u[d].r>u.r&&(u.r=u[d].r)}function h(){if(t){var u,d=t.length,g;for(e=new Array(d),u=0;u<d;++u)g=t[u],e[g.index]=+n(g,u,t)}}return a.initialize=function(u,d){t=u,r=d,h()},a.iterations=function(u){return arguments.length?(o=+u,a):o},a.strength=function(u){return arguments.length?(i=+u,a):i},a.radius=function(u){return arguments.length?(n=typeof u=="function"?u:ge(+u),h(),a):n},a}function dN(n){return n.index}function og(n,t){var e=n.get(t);if(!e)throw new Error("node not found: "+t);return e}function gN(n){var t=dN,e=g,r,i=ge(30),o,a,l,h,u,d=1;n==null&&(n=[]);function g(_){return 1/Math.min(l[_.source.index],l[_.target.index])}function y(_){for(var b=0,N=n.length;b<d;++b)for(var A=0,T,P,M,R,O,V,$;A<N;++A)T=n[A],P=T.source,M=T.target,R=M.x+M.vx-P.x-P.vx||lr(u),O=M.y+M.vy-P.y-P.vy||lr(u),V=Math.sqrt(R*R+O*O),V=(V-o[A])/V*_*r[A],R*=V,O*=V,M.vx-=R*($=h[A]),M.vy-=O*$,P.vx+=R*($=1-$),P.vy+=O*$}function m(){if(a){var _,b=a.length,N=n.length,A=new Map(a.map((P,M)=>[t(P,M,a),P])),T;for(_=0,l=new Array(b);_<N;++_)T=n[_],T.index=_,typeof T.source!="object"&&(T.source=og(A,T.source)),typeof T.target!="object"&&(T.target=og(A,T.target)),l[T.source.index]=(l[T.source.index]||0)+1,l[T.target.index]=(l[T.target.index]||0)+1;for(_=0,h=new Array(N);_<N;++_)T=n[_],h[_]=l[T.source.index]/(l[T.source.index]+l[T.target.index]);r=new Array(N),w(),o=new Array(N),v()}}function w(){if(a)for(var _=0,b=n.length;_<b;++_)r[_]=+e(n[_],_,n)}function v(){if(a)for(var _=0,b=n.length;_<b;++_)o[_]=+i(n[_],_,n)}return y.initialize=function(_,b){a=_,u=b,m()},y.links=function(_){return arguments.length?(n=_,m(),y):n},y.id=function(_){return arguments.length?(t=_,y):t},y.iterations=function(_){return arguments.length?(d=+_,y):d},y.strength=function(_){return arguments.length?(e=typeof _=="function"?_:ge(+_),w(),y):e},y.distance=function(_){return arguments.length?(i=typeof _=="function"?_:ge(+_),v(),y):i},y}const pN=1664525,mN=1013904223,ag=4294967296;function yN(){let n=1;return()=>(n=(pN*n+mN)%ag)/ag}function wN(n){return n.x}function vN(n){return n.y}var bN=10,_N=Math.PI*(3-Math.sqrt(5));function xN(n){var t,e=1,r=.001,i=1-Math.pow(r,1/300),o=0,a=.6,l=new Map,h=vu(g),u=fu("tick","end"),d=yN();n==null&&(n=[]);function g(){y(),u.call("tick",t),e<r&&(h.stop(),u.call("end",t))}function y(v){var _,b=n.length,N;v===void 0&&(v=1);for(var A=0;A<v;++A)for(e+=(o-e)*i,l.forEach(function(T){T(e)}),_=0;_<b;++_)N=n[_],N.fx==null?N.x+=N.vx*=a:(N.x=N.fx,N.vx=0),N.fy==null?N.y+=N.vy*=a:(N.y=N.fy,N.vy=0);return t}function m(){for(var v=0,_=n.length,b;v<_;++v){if(b=n[v],b.index=v,b.fx!=null&&(b.x=b.fx),b.fy!=null&&(b.y=b.fy),isNaN(b.x)||isNaN(b.y)){var N=bN*Math.sqrt(.5+v),A=v*_N;b.x=N*Math.cos(A),b.y=N*Math.sin(A)}(isNaN(b.vx)||isNaN(b.vy))&&(b.vx=b.vy=0)}}function w(v){return v.initialize&&v.initialize(n,d),v}return m(),t={tick:y,restart:function(){return h.restart(g),t},stop:function(){return h.stop(),t},nodes:function(v){return arguments.length?(n=v,m(),l.forEach(w),t):n},alpha:function(v){return arguments.length?(e=+v,t):e},alphaMin:function(v){return arguments.length?(r=+v,t):r},alphaDecay:function(v){return arguments.length?(i=+v,t):+i},alphaTarget:function(v){return arguments.length?(o=+v,t):o},velocityDecay:function(v){return arguments.length?(a=1-v,t):1-a},randomSource:function(v){return arguments.length?(d=v,l.forEach(w),t):d},force:function(v,_){return arguments.length>1?(_==null?l.delete(v):l.set(v,w(_)),t):l.get(v)},find:function(v,_,b){var N=0,A=n.length,T,P,M,R,O;for(b==null?b=1/0:b*=b,N=0;N<A;++N)R=n[N],T=v-R.x,P=_-R.y,M=T*T+P*P,M<b&&(O=R,b=M);return O},on:function(v,_){return arguments.length>1?(u.on(v,_),t):u.on(v)}}}function SN(){var n,t,e,r,i=ge(-30),o,a=1,l=1/0,h=.81;function u(m){var w,v=n.length,_=xu(n,wN,vN).visitAfter(g);for(r=m,w=0;w<v;++w)t=n[w],_.visit(y)}function d(){if(n){var m,w=n.length,v;for(o=new Array(w),m=0;m<w;++m)v=n[m],o[v.index]=+i(v,m,n)}}function g(m){var w=0,v,_,b=0,N,A,T;if(m.length){for(N=A=T=0;T<4;++T)(v=m[T])&&(_=Math.abs(v.value))&&(w+=v.value,b+=_,N+=_*v.x,A+=_*v.y);m.x=N/b,m.y=A/b}else{v=m,v.x=v.data.x,v.y=v.data.y;do w+=o[v.data.index];while(v=v.next)}m.value=w}function y(m,w,v,_){if(!m.value)return!0;var b=m.x-t.x,N=m.y-t.y,A=_-w,T=b*b+N*N;if(A*A/h<T)return T<l&&(b===0&&(b=lr(e),T+=b*b),N===0&&(N=lr(e),T+=N*N),T<a&&(T=Math.sqrt(a*T)),t.vx+=b*m.value*r/T,t.vy+=N*m.value*r/T),!0;if(m.length||T>=l)return;(m.data!==t||m.next)&&(b===0&&(b=lr(e),T+=b*b),N===0&&(N=lr(e),T+=N*N),T<a&&(T=Math.sqrt(a*T)));do m.data!==t&&(A=o[m.data.index]*r/T,t.vx+=b*A,t.vy+=N*A);while(m=m.next)}return u.initialize=function(m,w){n=m,e=w,d()},u.strength=function(m){return arguments.length?(i=typeof m=="function"?m:ge(+m),d(),u):i},u.distanceMin=function(m){return arguments.length?(a=m*m,u):Math.sqrt(a)},u.distanceMax=function(m){return arguments.length?(l=m*m,u):Math.sqrt(l)},u.theta=function(m){return arguments.length?(h=m*m,u):Math.sqrt(h)},u}function CN(n){var t=ge(.1),e,r,i;typeof n!="function"&&(n=ge(n==null?0:+n));function o(l){for(var h=0,u=e.length,d;h<u;++h)d=e[h],d.vx+=(i[h]-d.x)*r[h]*l}function a(){if(e){var l,h=e.length;for(r=new Array(h),i=new Array(h),l=0;l<h;++l)r[l]=isNaN(i[l]=+n(e[l],l,e))?0:+t(e[l],l,e)}}return o.initialize=function(l){e=l,a()},o.strength=function(l){return arguments.length?(t=typeof l=="function"?l:ge(+l),a(),o):t},o.x=function(l){return arguments.length?(n=typeof l=="function"?l:ge(+l),a(),o):n},o}function PN(n){var t=ge(.1),e,r,i;typeof n!="function"&&(n=ge(n==null?0:+n));function o(l){for(var h=0,u=e.length,d;h<u;++h)d=e[h],d.vy+=(i[h]-d.y)*r[h]*l}function a(){if(e){var l,h=e.length;for(r=new Array(h),i=new Array(h),l=0;l<h;++l)r[l]=isNaN(i[l]=+n(e[l],l,e))?0:+t(e[l],l,e)}}return o.initialize=function(l){e=l,a()},o.strength=function(l){return arguments.length?(t=typeof l=="function"?l:ge(+l),a(),o):t},o.y=function(l){return arguments.length?(n=typeof l=="function"?l:ge(+l),a(),o):n},o}function AN(n){return Math.abs(n=Math.round(n))>=1e21?n.toLocaleString("en").replace(/,/g,""):n.toString(10)}function pa(n,t){if((e=(n=t?n.toExponential(t-1):n.toExponential()).indexOf("e"))<0)return null;var e,r=n.slice(0,e);return[r.length>1?r[0]+r.slice(2):r,+n.slice(e+1)]}function Ei(n){return n=pa(Math.abs(n)),n?n[1]:NaN}function NN(n,t){return function(e,r){for(var i=e.length,o=[],a=0,l=n[0],h=0;i>0&&l>0&&(h+l+1>r&&(l=Math.max(1,r-h)),o.push(e.substring(i-=l,i+l)),!((h+=l+1)>r));)l=n[a=(a+1)%n.length];return o.reverse().join(t)}}function TN(n){return function(t){return t.replace(/[0-9]/g,function(e){return n[+e]})}}var EN=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Is(n){if(!(t=EN.exec(n)))throw new Error("invalid format: "+n);var t;return new Cu({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}Is.prototype=Cu.prototype;function Cu(n){this.fill=n.fill===void 0?" ":n.fill+"",this.align=n.align===void 0?">":n.align+"",this.sign=n.sign===void 0?"-":n.sign+"",this.symbol=n.symbol===void 0?"":n.symbol+"",this.zero=!!n.zero,this.width=n.width===void 0?void 0:+n.width,this.comma=!!n.comma,this.precision=n.precision===void 0?void 0:+n.precision,this.trim=!!n.trim,this.type=n.type===void 0?"":n.type+""}Cu.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function IN(n){t:for(var t=n.length,e=1,r=-1,i;e<t;++e)switch(n[e]){case".":r=i=e;break;case"0":r===0&&(r=e),i=e;break;default:if(!+n[e])break t;r>0&&(r=0);break}return r>0?n.slice(0,r)+n.slice(i+1):n}var Kp;function MN(n,t){var e=pa(n,t);if(!e)return n+"";var r=e[0],i=e[1],o=i-(Kp=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,a=r.length;return o===a?r:o>a?r+new Array(o-a+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+pa(n,Math.max(0,t+o-1))[0]}function cg(n,t){var e=pa(n,t);if(!e)return n+"";var r=e[0],i=e[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}const lg={"%":(n,t)=>(n*100).toFixed(t),b:n=>Math.round(n).toString(2),c:n=>n+"",d:AN,e:(n,t)=>n.toExponential(t),f:(n,t)=>n.toFixed(t),g:(n,t)=>n.toPrecision(t),o:n=>Math.round(n).toString(8),p:(n,t)=>cg(n*100,t),r:cg,s:MN,X:n=>Math.round(n).toString(16).toUpperCase(),x:n=>Math.round(n).toString(16)};function ug(n){return n}var hg=Array.prototype.map,fg=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function RN(n){var t=n.grouping===void 0||n.thousands===void 0?ug:NN(hg.call(n.grouping,Number),n.thousands+""),e=n.currency===void 0?"":n.currency[0]+"",r=n.currency===void 0?"":n.currency[1]+"",i=n.decimal===void 0?".":n.decimal+"",o=n.numerals===void 0?ug:TN(hg.call(n.numerals,String)),a=n.percent===void 0?"%":n.percent+"",l=n.minus===void 0?"−":n.minus+"",h=n.nan===void 0?"NaN":n.nan+"";function u(g){g=Is(g);var y=g.fill,m=g.align,w=g.sign,v=g.symbol,_=g.zero,b=g.width,N=g.comma,A=g.precision,T=g.trim,P=g.type;P==="n"?(N=!0,P="g"):lg[P]||(A===void 0&&(A=12),T=!0,P="g"),(_||y==="0"&&m==="=")&&(_=!0,y="0",m="=");var M=v==="$"?e:v==="#"&&/[boxX]/.test(P)?"0"+P.toLowerCase():"",R=v==="$"?r:/[%p]/.test(P)?a:"",O=lg[P],V=/[defgprs%]/.test(P);A=A===void 0?6:/[gprs]/.test(P)?Math.max(1,Math.min(21,A)):Math.max(0,Math.min(20,A));function $(G){var Z=M,tt=R,dt,wt,Nt;if(P==="c")tt=O(G)+tt,G="";else{G=+G;var Lt=G<0||1/G<0;if(G=isNaN(G)?h:O(Math.abs(G),A),T&&(G=IN(G)),Lt&&+G==0&&w!=="+"&&(Lt=!1),Z=(Lt?w==="("?w:l:w==="-"||w==="("?"":w)+Z,tt=(P==="s"?fg[8+Kp/3]:"")+tt+(Lt&&w==="("?")":""),V){for(dt=-1,wt=G.length;++dt<wt;)if(Nt=G.charCodeAt(dt),48>Nt||Nt>57){tt=(Nt===46?i+G.slice(dt+1):G.slice(dt))+tt,G=G.slice(0,dt);break}}}N&&!_&&(G=t(G,1/0));var It=Z.length+G.length+tt.length,Ct=It<b?new Array(b-It+1).join(y):"";switch(N&&_&&(G=t(Ct+G,Ct.length?b-tt.length:1/0),Ct=""),m){case"<":G=Z+G+tt+Ct;break;case"=":G=Z+Ct+G+tt;break;case"^":G=Ct.slice(0,It=Ct.length>>1)+Z+G+tt+Ct.slice(It);break;default:G=Ct+Z+G+tt;break}return o(G)}return $.toString=function(){return g+""},$}function d(g,y){var m=u((g=Is(g),g.type="f",g)),w=Math.max(-8,Math.min(8,Math.floor(Ei(y)/3)))*3,v=Math.pow(10,-w),_=fg[8+w/3];return function(b){return m(v*b)+_}}return{format:u,formatPrefix:d}}var Go,Pu,Xp;LN({thousands:",",grouping:[3],currency:["$",""]});function LN(n){return Go=RN(n),Pu=Go.format,Xp=Go.formatPrefix,Go}function kN(n){return Math.max(0,-Ei(Math.abs(n)))}function ON(n,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Ei(t)/3)))*3-Ei(Math.abs(n)))}function FN(n,t){return n=Math.abs(n),t=Math.abs(t)-n,Math.max(0,Ei(t)-Ei(n))+1}function Jp(n,t){switch(arguments.length){case 0:break;case 1:this.range(n);break;default:this.range(t).domain(n);break}return this}function DN(n,t){switch(arguments.length){case 0:break;case 1:{typeof n=="function"?this.interpolator(n):this.range(n);break}default:{this.domain(n),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}function BN(n){return function(){return n}}function VN(n){return+n}var dg=[0,1];function ur(n){return n}function Jl(n,t){return(t-=n=+n)?function(e){return(e-n)/t}:BN(isNaN(t)?NaN:.5)}function GN(n,t){var e;return n>t&&(e=n,n=t,t=e),function(r){return Math.max(n,Math.min(t,r))}}function zN(n,t,e){var r=n[0],i=n[1],o=t[0],a=t[1];return i<r?(r=Jl(i,r),o=e(a,o)):(r=Jl(r,i),o=e(o,a)),function(l){return o(r(l))}}function $N(n,t,e){var r=Math.min(n.length,t.length)-1,i=new Array(r),o=new Array(r),a=-1;for(n[r]<n[0]&&(n=n.slice().reverse(),t=t.slice().reverse());++a<r;)i[a]=Jl(n[a],n[a+1]),o[a]=e(t[a],t[a+1]);return function(l){var h=hC(n,l,1,r)-1;return o[h](i[h](l))}}function Qp(n,t){return t.domain(n.domain()).range(n.range()).interpolate(n.interpolate()).clamp(n.clamp()).unknown(n.unknown())}function Zp(){var n=dg,t=dg,e=Ra,r,i,o,a=ur,l,h,u;function d(){var y=Math.min(n.length,t.length);return a!==ur&&(a=GN(n[0],n[y-1])),l=y>2?$N:zN,h=u=null,g}function g(y){return y==null||isNaN(y=+y)?o:(h||(h=l(n.map(r),t,e)))(r(a(y)))}return g.invert=function(y){return a(i((u||(u=l(t,n.map(r),sn)))(y)))},g.domain=function(y){return arguments.length?(n=Array.from(y,VN),d()):n.slice()},g.range=function(y){return arguments.length?(t=Array.from(y),d()):t.slice()},g.rangeRound=function(y){return t=Array.from(y),e=Op,d()},g.clamp=function(y){return arguments.length?(a=y?!0:ur,d()):a!==ur},g.interpolate=function(y){return arguments.length?(e=y,d()):e},g.unknown=function(y){return arguments.length?(o=y,g):o},function(y,m){return r=y,i=m,d()}}function WN(){return Zp()(ur,ur)}function HN(n,t,e,r){var i=yC(n,t,e),o;switch(r=Is(r??",f"),r.type){case"s":{var a=Math.max(Math.abs(n),Math.abs(t));return r.precision==null&&!isNaN(o=ON(i,a))&&(r.precision=o),Xp(r,a)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(o=FN(i,Math.max(Math.abs(n),Math.abs(t))))&&(r.precision=o-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(o=kN(i))&&(r.precision=o-(r.type==="%")*2);break}}return Pu(r)}function jp(n){var t=n.domain;return n.ticks=function(e){var r=t();return Bl(r[0],r[r.length-1],e??10)},n.tickFormat=function(e,r){var i=t();return HN(i[0],i[i.length-1],e??10,r)},n.nice=function(e){e==null&&(e=10);var r=t(),i=0,o=r.length-1,a=r[i],l=r[o],h,u,d=10;for(l<a&&(u=a,a=l,l=u,u=i,i=o,o=u);d-- >0;){if(u=Vl(a,l,e),u===h)return r[i]=a,r[o]=l,t(r);if(u>0)a=Math.floor(a/u)*u,l=Math.ceil(l/u)*u;else if(u<0)a=Math.ceil(a*u)/u,l=Math.floor(l*u)/u;else break;h=u}return n},n}function Au(){var n=WN();return n.copy=function(){return Qp(n,Au())},Jp.apply(n,arguments),jp(n)}function qN(n,t){n=n.slice();var e=0,r=n.length-1,i=n[e],o=n[r],a;return o<i&&(a=e,e=r,r=a,a=i,i=o,o=a),n[e]=t.floor(i),n[r]=t.ceil(o),n}function gg(n){return Math.log(n)}function pg(n){return Math.exp(n)}function UN(n){return-Math.log(-n)}function YN(n){return-Math.exp(-n)}function KN(n){return isFinite(n)?+("1e"+n):n<0?0:n}function XN(n){return n===10?KN:n===Math.E?Math.exp:t=>Math.pow(n,t)}function JN(n){return n===Math.E?Math.log:n===10&&Math.log10||n===2&&Math.log2||(n=Math.log(n),t=>Math.log(t)/n)}function mg(n){return(t,e)=>-n(-t,e)}function QN(n){const t=n(gg,pg),e=t.domain;let r=10,i,o;function a(){return i=JN(r),o=XN(r),e()[0]<0?(i=mg(i),o=mg(o),n(UN,YN)):n(gg,pg),t}return t.base=function(l){return arguments.length?(r=+l,a()):r},t.domain=function(l){return arguments.length?(e(l),a()):e()},t.ticks=l=>{const h=e();let u=h[0],d=h[h.length-1];const g=d<u;g&&([u,d]=[d,u]);let y=i(u),m=i(d),w,v;const _=l==null?10:+l;let b=[];if(!(r%1)&&m-y<_){if(y=Math.floor(y),m=Math.ceil(m),u>0){for(;y<=m;++y)for(w=1;w<r;++w)if(v=y<0?w/o(-y):w*o(y),!(v<u)){if(v>d)break;b.push(v)}}else for(;y<=m;++y)for(w=r-1;w>=1;--w)if(v=y>0?w/o(-y):w*o(y),!(v<u)){if(v>d)break;b.push(v)}b.length*2<_&&(b=Bl(u,d,_))}else b=Bl(y,m,Math.min(m-y,_)).map(o);return g?b.reverse():b},t.tickFormat=(l,h)=>{if(l==null&&(l=10),h==null&&(h=r===10?"s":","),typeof h!="function"&&(!(r%1)&&(h=Is(h)).precision==null&&(h.trim=!0),h=Pu(h)),l===1/0)return h;const u=Math.max(1,r*l/t.ticks().length);return d=>{let g=d/o(Math.round(i(d)));return g*r<r-.5&&(g*=r),g<=u?h(d):""}},t.nice=()=>e(qN(e(),{floor:l=>o(Math.floor(i(l))),ceil:l=>o(Math.ceil(i(l)))})),t}function t0(){const n=QN(Zp()).domain([1,10]);return n.copy=()=>Qp(n,t0()).base(n.base()),Jp.apply(n,arguments),n}function ZN(){var n=0,t=1,e,r,i,o,a=ur,l=!1,h;function u(g){return g==null||isNaN(g=+g)?h:a(i===0?.5:(g=(o(g)-e)*i,l?Math.max(0,Math.min(1,g)):g))}u.domain=function(g){return arguments.length?([n,t]=g,e=o(n=+n),r=o(t=+t),i=e===r?0:1/(r-e),u):[n,t]},u.clamp=function(g){return arguments.length?(l=!!g,u):l},u.interpolator=function(g){return arguments.length?(a=g,u):a};function d(g){return function(y){var m,w;return arguments.length?([m,w]=y,a=g(m,w),u):[a(0),a(1)]}}return u.range=d(Ra),u.rangeRound=d(Op),u.unknown=function(g){return arguments.length?(h=g,u):h},function(g){return o=g,e=g(n),r=g(t),i=e===r?0:1/(r-e),u}}function jN(n,t){return t.domain(n.domain()).interpolator(n.interpolator()).clamp(n.clamp()).unknown(n.unknown())}function e0(){var n=jp(ZN()(ur));return n.copy=function(){return jN(n,e0())},DN.apply(n,arguments)}function Ce(n){for(var t=n.length/6|0,e=new Array(t),r=0;r<t;)e[r]="#"+n.slice(r*6,++r*6);return e}const En=n=>_2(n[n.length-1]);var tT=new Array(3).concat("fc8d59ffffbf91cf60","d7191cfdae61a6d96a1a9641","d7191cfdae61ffffbfa6d96a1a9641","d73027fc8d59fee08bd9ef8b91cf601a9850","d73027fc8d59fee08bffffbfd9ef8b91cf601a9850","d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850","d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850","a50026d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850006837","a50026d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850006837").map(Ce);const Jo=En(tT);var eT=new Array(3).concat("fee8c8fdbb84e34a33","fef0d9fdcc8afc8d59d7301f","fef0d9fdcc8afc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301fb300007f0000").map(Ce);const nT=En(eT);var rT=new Array(3).concat("edf8b17fcdbb2c7fb8","ffffcca1dab441b6c4225ea8","ffffcca1dab441b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea8253494081d58").map(Ce);const iT=En(rT);var sT=new Array(3).concat("f7fcb9addd8e31a354","ffffccc2e69978c679238443","ffffccc2e69978c67931a354006837","ffffccd9f0a3addd8e78c67931a354006837","ffffccd9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443006837004529").map(Ce);const oT=En(sT);var aT=new Array(3).concat("ffeda0feb24cf03b20","ffffb2fecc5cfd8d3ce31a1c","ffffb2fecc5cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cbd0026800026").map(Ce);const cT=En(aT);var lT=new Array(3).concat("deebf79ecae13182bd","eff3ffbdd7e76baed62171b5","eff3ffbdd7e76baed63182bd08519c","eff3ffc6dbef9ecae16baed63182bd08519c","eff3ffc6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b508519c08306b").map(Ce);const uT=En(lT);var hT=new Array(3).concat("e5f5e0a1d99b31a354","edf8e9bae4b374c476238b45","edf8e9bae4b374c47631a354006d2c","edf8e9c7e9c0a1d99b74c47631a354006d2c","edf8e9c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45006d2c00441b").map(Ce);const fT=En(hT);var dT=new Array(3).concat("efedf5bcbddc756bb1","f2f0f7cbc9e29e9ac86a51a3","f2f0f7cbc9e29e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a354278f3f007d").map(Ce);const gT=En(dT);var pT=new Array(3).concat("fee0d2fc9272de2d26","fee5d9fcae91fb6a4acb181d","fee5d9fcae91fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181da50f1567000d").map(Ce);const mT=En(pT);var yT=new Array(3).concat("fee6cefdae6be6550d","feeddefdbe85fd8d3cd94701","feeddefdbe85fd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d94801a636037f2704").map(Ce);const wT=En(yT);function vT(n){return n=Math.max(0,Math.min(1,n)),"rgb("+Math.max(0,Math.min(255,Math.round(-4.54-n*(35.34-n*(2381.73-n*(6402.7-n*(7024.72-n*2710.57)))))))+", "+Math.max(0,Math.min(255,Math.round(32.49+n*(170.73+n*(52.82-n*(131.46-n*(176.58-n*67.37)))))))+", "+Math.max(0,Math.min(255,Math.round(81.24+n*(442.36-n*(2482.43-n*(6167.24-n*(6614.94-n*2475.67)))))))+")"}var bT=Vp(gr(-100,.75,.35),gr(80,1.5,.8)),_T=Vp(gr(260,.75,.35),gr(80,1.5,.8)),zo=gr();function xT(n){(n<0||n>1)&&(n-=Math.floor(n));var t=Math.abs(n-.5);return zo.h=360*n-100,zo.s=1.5-1.5*t,zo.l=.8-.9*t,zo+""}var $o=Gr(),ST=Math.PI/3,CT=Math.PI*2/3;function PT(n){var t;return n=(.5-n)*Math.PI,$o.r=255*(t=Math.sin(n))*t,$o.g=255*(t=Math.sin(n+ST))*t,$o.b=255*(t=Math.sin(n+CT))*t,$o+""}function AT(n){return n=Math.max(0,Math.min(1,n)),"rgb("+Math.max(0,Math.min(255,Math.round(34.61+n*(1172.33-n*(10793.56-n*(33300.12-n*(38394.49-n*14825.05)))))))+", "+Math.max(0,Math.min(255,Math.round(23.31+n*(557.33+n*(1225.33-n*(3574.96-n*(1073.77+n*707.56)))))))+", "+Math.max(0,Math.min(255,Math.round(27.2+n*(3211.1-n*(15327.97-n*(27814-n*(22569.18-n*6838.66)))))))+")"}function Oa(n){var t=n.length;return function(e){return n[Math.max(0,Math.min(t-1,Math.floor(e*t)))]}}const NT=Oa(Ce("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725"));var TT=Oa(Ce("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf")),ET=Oa(Ce("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4")),IT=Oa(Ce("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"));function oi(n){return function(){return n}}function MT(n){let t=3;return n.digits=function(e){if(!arguments.length)return t;if(e==null)t=null;else{const r=Math.floor(e);if(!(r>=0))throw new RangeError(`invalid digits: ${e}`);t=r}return n},()=>new YA(t)}function RT(n){return typeof n=="object"&&"length"in n?n:Array.from(n)}function n0(n){this._context=n}n0.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(n,t){switch(n=+n,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(n,t):this._context.moveTo(n,t);break;case 1:this._point=2;default:this._context.lineTo(n,t);break}}};function Nu(n){return new n0(n)}function LT(n){return n[0]}function kT(n){return n[1]}function r0(n,t){var e=oi(!0),r=null,i=Nu,o=null,a=MT(l);n=typeof n=="function"?n:n===void 0?LT:oi(n),t=typeof t=="function"?t:t===void 0?kT:oi(t);function l(h){var u,d=(h=RT(h)).length,g,y=!1,m;for(r==null&&(o=i(m=a())),u=0;u<=d;++u)!(u<d&&e(g=h[u],u,h))===y&&((y=!y)?o.lineStart():o.lineEnd()),y&&o.point(+n(g,u,h),+t(g,u,h));if(m)return o=null,m+""||null}return l.x=function(h){return arguments.length?(n=typeof h=="function"?h:oi(+h),l):n},l.y=function(h){return arguments.length?(t=typeof h=="function"?h:oi(+h),l):t},l.defined=function(h){return arguments.length?(e=typeof h=="function"?h:oi(!!h),l):e},l.curve=function(h){return arguments.length?(i=h,r!=null&&(o=i(r)),l):i},l.context=function(h){return arguments.length?(h==null?r=o=null:o=i(r=h),l):r},l}function yg(n,t,e){n._context.bezierCurveTo((2*n._x0+n._x1)/3,(2*n._y0+n._y1)/3,(n._x0+2*n._x1)/3,(n._y0+2*n._y1)/3,(n._x0+4*n._x1+t)/6,(n._y0+4*n._y1+e)/6)}function i0(n){this._context=n}i0.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:yg(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(n,t){switch(n=+n,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(n,t):this._context.moveTo(n,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:yg(this,n,t);break}this._x0=this._x1,this._x1=n,this._y0=this._y1,this._y1=t}};function OT(n){return new i0(n)}function s0(n){this._context=n}s0.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var n=this._x,t=this._y,e=n.length;if(e)if(this._line?this._context.lineTo(n[0],t[0]):this._context.moveTo(n[0],t[0]),e===2)this._context.lineTo(n[1],t[1]);else for(var r=wg(n),i=wg(t),o=0,a=1;a<e;++o,++a)this._context.bezierCurveTo(r[0][o],i[0][o],r[1][o],i[1][o],n[a],t[a]);(this._line||this._line!==0&&e===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(n,t){this._x.push(+n),this._y.push(+t)}};function wg(n){var t,e=n.length-1,r,i=new Array(e),o=new Array(e),a=new Array(e);for(i[0]=0,o[0]=2,a[0]=n[0]+2*n[1],t=1;t<e-1;++t)i[t]=1,o[t]=4,a[t]=4*n[t]+2*n[t+1];for(i[e-1]=2,o[e-1]=7,a[e-1]=8*n[e-1]+n[e],t=1;t<e;++t)r=i[t]/o[t-1],o[t]-=r,a[t]-=r*a[t-1];for(i[e-1]=a[e-1]/o[e-1],t=e-2;t>=0;--t)i[t]=(a[t]-i[t+1])/o[t];for(o[e-1]=(n[e]+i[e-1])/2,t=0;t<e-1;++t)o[t]=2*n[t+1]-i[t+1];return[i,o]}function FT(n){return new s0(n)}function di(n,t,e){this.k=n,this.x=t,this.y=e}di.prototype={constructor:di,scale:function(n){return n===1?this:new di(this.k*n,this.x,this.y)},translate:function(n,t){return n===0&t===0?this:new di(this.k,this.x+this.k*n,this.y+this.k*t)},apply:function(n){return[n[0]*this.k+this.x,n[1]*this.k+this.y]},applyX:function(n){return n*this.k+this.x},applyY:function(n){return n*this.k+this.y},invert:function(n){return[(n[0]-this.x)/this.k,(n[1]-this.y)/this.k]},invertX:function(n){return(n-this.x)/this.k},invertY:function(n){return(n-this.y)/this.k},rescaleX:function(n){return n.copy().domain(n.range().map(this.invertX,this).map(n.invert,n))},rescaleY:function(n){return n.copy().domain(n.range().map(this.invertY,this).map(n.invert,n))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var IM=new di(1,0,0);di.prototype;class Fe{getMetricDefinitions(){return this.constructor.displayedMetrics}async calculate(){}graph;layoutWidth;layoutHeight;get shorterSide(){return Math.min(this.layoutWidth,this.layoutHeight)}get longerSide(){return Math.max(this.layoutWidth,this.layoutHeight)}get widthToHeightRatio(){return this.layoutWidth/this.layoutHeight}get heightToWidthRatio(){return this.layoutHeight/this.layoutWidth}get aspectRatioByNodes(){return this.layoutWidth>this.layoutHeight?this.heightToWidthRatio:this.widthToHeightRatio}getMetric(t){return this[t]}constructor(t){this.graph=t;const e=Br(this.graph.allLeafLayoutNodes,o=>o.x),r=Br(this.graph.allLeafLayoutNodes,o=>o.y),i=Gl(this.graph.allLeafLayoutNodes,o=>o.radius)||0;this.layoutWidth=e[1]-e[0]+2*i,this.layoutHeight=r[1]-r[0]+2*i}}Ot(Fe,"displayedMetrics",[]);const gi=Zg("api",{state:()=>({generatorApiUrl:Dl("generatorApiUrl","http://localhost:5000"),maxParallelApiCalls:Dl("maxParallelApiCalls",5),activeApiCalls:0}),getters:{},actions:{}}),Mr=class Mr{static enqueueRequest(t,e=!1){return new Promise((r,i)=>{this.metricRequestQueue[e?"unshift":"push"](async()=>{try{const o=await t();return r(o),o}catch(o){throw i(o),o}}),this.isProcessingQueue||this.processQueue()})}static async processQueue(){for(this.isProcessingQueue=!0;this.metricRequestQueue.length>0;){const t=gi(),e=t.maxParallelApiCalls;if(t.activeApiCalls>=e){await new Promise(i=>setTimeout(i,100));continue}const r=this.metricRequestQueue.shift();r&&(t.activeApiCalls++,r().finally(()=>{t.activeApiCalls--}))}this.isProcessingQueue=!1}static fetchMetrics(t,e,r=!0){return this.enqueueRequest(async()=>{const i=t.getLaidOutApiData(),a=`${gi().generatorApiUrl}/metrics/calculate/${e}`,l=new URLSearchParams;l.append("async",r?"true":"false");const h=`${a}?${l.toString()}`;return console.log("Submitting metrics calculation job",h),fetch(h,{method:"POST",body:JSON.stringify(i),headers:{"Content-Type":"application/json"}}).then(u=>u.json()).then(u=>r?u:{key:u.key,value:u.value,optimum:u.type==="lower-better"?"lowerIsBetter":"higherIsBetter",label:u.key.replace(/_/g," "),description:u.error||void 0}).catch(u=>{throw console.error("Error submitting metrics calculation job:",u),u})})}static checkJobStatus(t){return this.enqueueRequest(async()=>{const r=`${gi().generatorApiUrl}/metrics/jobs/${t}`;return fetch(r).then(i=>i.json()).then(i=>i)},!0)}static async pollJobUntilDone(t,e=12e4,r=1e3){const i=Date.now(),o=async()=>{const a=Date.now()-i,l=await Mr.checkJobStatus(t);if(l.status==="completed"||l.status==="failed")return l;if(a>=e)throw new Error(`Job polling timed out after ${a}ms`);return new Promise(h=>{setTimeout(()=>h(o()),r)})};return o()}static async fetchMetricsWithPolling(t,e,r=5){let i=0,o;for(;i<r;)try{if(o=await Mr.fetchMetrics(t,e,!0),!o||!o.job_id)throw new Error("Invalid job status or missing job ID");break}catch(a){if(i++,console.error(`Error submitting metrics job (attempt ${i}/${r}):`,a),i>=r)return{key:e,value:Number.NaN,optimum:"lowerIsBetter",label:e.replace(/_/g," "),description:`Failed to submit job: ${a instanceof Error?a.message:"Unknown error"}`};const l=500*Math.pow(1.5,i);await new Promise(h=>setTimeout(h,l))}if(!o||!o.job_id)return{key:e,value:Number.NaN,optimum:"lowerIsBetter",label:e.replace(/_/g," "),description:"Failed to get valid job status after retries"};try{const a=await Mr.pollJobUntilDone(o.job_id);if(a.status==="failed")return{key:e,value:Number.NaN,optimum:"lowerIsBetter",label:e.replace(/_/g," "),description:a.error||"Metric calculation failed"};if(a.results&&a.results.length>0){const l=a.results[0];return l.error?{key:l.key,value:Number.NaN,optimum:l.type==="lower-better"?"lowerIsBetter":"higherIsBetter",label:l.key.replace(/_/g," "),description:l.error}:{key:l.key,value:l.value,optimum:l.type==="lower-better"?"lowerIsBetter":"higherIsBetter",label:l.key.replace(/_/g," "),description:void 0}}return{key:e,value:Number.NaN,optimum:"lowerIsBetter",label:e.replace(/_/g," "),description:"No metrics results available"}}catch(a){return{key:e,value:Number.NaN,optimum:"lowerIsBetter",label:e.replace(/_/g," "),description:`Error polling job: ${a instanceof Error?a.message:"Unknown error"}`}}}static getAvailableMetrics(){return this.enqueueRequest(async()=>{const e=`${gi().generatorApiUrl}/metrics/methods`;return console.log("Fetching available metrics",e),fetch(e).then(r=>r.json())})}};Ot(Mr,"metricRequestQueue",[]),Ot(Mr,"isProcessingQueue",!1);let xe=Mr;class o0 extends Fe{pathEfficiencyRatio=0;constructor(t){super(t),console.log("Initializing path length ratio calculator")}async calculate(){try{const t=await xe.fetchMetricsWithPolling(this.graph,"pathEfficiency");console.log("Path efficiency ratio:",t),this.pathEfficiencyRatio=t.value}catch(t){console.error("Error fetching path efficiency metric:",t),this.pathEfficiencyRatio=0}}}Ot(o0,"displayedMetrics",[{key:"pathEfficiencyRatio",optimum:"higherIsBetter",label:"Path Efficiency Ratio",abbreviation:"PER",description:"The ratio between actual path lengths and direct distances. A ratio closer to 1 means paths are more direct and efficient.",normalizing:"none"}]);class a0 extends Fe{pathEfficiencyRatioNormalized=0;constructor(t){super(t),console.log("Initializing path length ratio calculator")}async calculate(){try{const t=await xe.fetchMetricsWithPolling(this.graph,"pathEfficiencyNormalized");console.log("Normalized path efficiency ratio:",t),this.pathEfficiencyRatioNormalized=t.value}catch(t){console.error("Error fetching path efficiency metric:",t),this.pathEfficiencyRatioNormalized=0}}}Ot(a0,"displayedMetrics",[{key:"pathEfficiencyRatioNormalized",optimum:"higherIsBetter",label:"Normalized Path Efficiency Ratio",abbreviation:"PERN",description:"The normalized ratio between actual path lengths and direct distances. A value closer to 1 means paths are more direct and efficient.",normalizing:"none"}]);var DT=/,?([a-z]),?/gi,vg=parseFloat,Ut=Math,sr=Ut.PI,dn=Ut.min,gn=Ut.max,bg=Ut.pow,hr=Ut.abs,BT=/([a-z])[\s,]*((-?\d*\.?\d*(?:e[-+]?\d+)?[\s]*,?[\s]*)+)/ig,VT=/(-?\d*\.?\d*(?:e[-+]?\d+)?)[\s]*,?[\s]*/ig,ma=Array.isArray||function(n){return n instanceof Array};function Tu(n,t){return Object.prototype.hasOwnProperty.call(n,t)}function ys(n){if(typeof n=="function"||Object(n)!==n)return n;var t=new n.constructor;for(var e in n)Tu(n,e)&&(t[e]=ys(n[e]));return t}function GT(n,t){for(var e=0,r=n.length;e<r;e++)if(n[e]===t)return n.push(n.splice(e,1)[0])}function zT(n){function t(){var e=Array.prototype.slice.call(arguments,0),r=e.join("␀"),i=t.cache=t.cache||{},o=t.count=t.count||[];return Tu(i,r)?(GT(o,r),i[r]):(o.length>=1e3&&delete i[o.shift()],o.push(r),i[r]=n(...arguments),i[r])}return t}function $T(n){if(!n)return null;var t=Ii(n);if(t.arr)return ys(t.arr);var e={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},r=[];return ma(n)&&ma(n[0])&&(r=ys(n)),r.length||String(n).replace(BT,function(i,o,a){var l=[],h=o.toLowerCase();for(a.replace(VT,function(u,d){d&&l.push(+d)}),h=="m"&&l.length>2&&(r.push([o,...l.splice(0,2)]),h="l",o=o=="m"?"l":"L");l.length>=e[h]&&(r.push([o,...l.splice(0,e[h])]),!!e[h]););}),r.toString=Ii.toString,t.arr=ys(r),r}function Ii(n){var t=Ii.ps=Ii.ps||{};return t[n]?t[n].sleep=100:t[n]={sleep:100},setTimeout(function(){for(var e in t)Tu(t,e)&&e!=n&&(t[e].sleep--,!t[e].sleep&&delete t[e])}),t[n]}function Ql(n,t,e,r){return arguments.length===1&&(t=n.y,e=n.width,r=n.height,n=n.x),{x:n,y:t,width:e,height:r,x2:n+e,y2:t+r}}function c0(){return this.join(",").replace(DT,"$1")}function ya(n){var t=ys(n);return t.toString=c0,t}function _g(n,t,e,r,i,o,a,l,h){var u=1-h,d=bg(u,3),g=bg(u,2),y=h*h,m=y*h,w=d*n+g*3*h*e+u*3*h*h*i+m*a,v=d*t+g*3*h*r+u*3*h*h*o+m*l;return{x:wa(w),y:wa(v)}}function xg(n){var t=KT(...n);return Ql(t.x0,t.y0,t.x1-t.x0,t.y1-t.y0)}function or(n,t,e){return t>=n.x&&t<=n.x+n.width&&e>=n.y&&e<=n.y+n.height}function WT(n,t){return n=Ql(n),t=Ql(t),or(t,n.x,n.y)||or(t,n.x2,n.y)||or(t,n.x,n.y2)||or(t,n.x2,n.y2)||or(n,t.x,t.y)||or(n,t.x2,t.y)||or(n,t.x,t.y2)||or(n,t.x2,t.y2)||(n.x<t.x2&&n.x>t.x||t.x<n.x2&&t.x>n.x)&&(n.y<t.y2&&n.y>t.y||t.y<n.y2&&t.y>n.y)}function Sg(n,t,e,r,i){var o=-3*t+9*e-9*r+3*i,a=n*o+6*t-12*e+6*r;return n*a-3*t+3*e}function Cg(n,t,e,r,i,o,a,l,h){h==null&&(h=1),h=h>1?1:h<0?0:h;for(var u=h/2,d=12,g=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],y=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],m=0,w=0;w<d;w++){var v=u*g[w]+u,_=Sg(v,n,e,i,a),b=Sg(v,t,r,o,l),N=_*_+b*b;m+=y[w]*Ut.sqrt(N)}return u*m}function HT(n,t,e,r,i,o,a,l){if(!(gn(n,e)<dn(i,a)||dn(n,e)>gn(i,a)||gn(t,r)<dn(o,l)||dn(t,r)>gn(o,l))){var h=(n*r-t*e)*(i-a)-(n-e)*(i*l-o*a),u=(n*r-t*e)*(o-l)-(t-r)*(i*l-o*a),d=(n-e)*(o-l)-(t-r)*(i-a);if(d){var g=wa(h/d),y=wa(u/d),m=+g.toFixed(2),w=+y.toFixed(2);if(!(m<+dn(n,e).toFixed(2)||m>+gn(n,e).toFixed(2)||m<+dn(i,a).toFixed(2)||m>+gn(i,a).toFixed(2)||w<+dn(t,r).toFixed(2)||w>+gn(t,r).toFixed(2)||w<+dn(o,l).toFixed(2)||w>+gn(o,l).toFixed(2)))return{x:g,y}}}}function wa(n){return Math.round(n*1e11)/1e11}function qT(n,t,e){var r=xg(n),i=xg(t);if(!WT(r,i))return[];for(var o=Cg(...n),a=Cg(...t),l=Pg(n)?1:~~(o/5)||1,h=Pg(t)?1:~~(a/5)||1,u=[],d=[],g={},y=[],m=0;m<l+1;m++){var w=_g(...n,m/l);u.push({x:w.x,y:w.y,t:m/l})}for(m=0;m<h+1;m++)w=_g(...t,m/h),d.push({x:w.x,y:w.y,t:m/h});for(m=0;m<l;m++)for(var v=0;v<h;v++){var _=u[m],b=u[m+1],N=d[v],A=d[v+1],T=hr(b.x-_.x)<.01?"y":"x",P=hr(A.x-N.x)<.01?"y":"x",M=HT(_.x,_.y,b.x,b.y,N.x,N.y,A.x,A.y),R;if(M){if(R=M.x.toFixed(9)+"#"+M.y.toFixed(9),g[R])continue;g[R]=!0;var O=_.t+hr((M[T]-_[T])/(b[T]-_[T]))*(b.t-_.t),V=N.t+hr((M[P]-N[P])/(A[P]-N[P]))*(A.t-N.t);O>=0&&O<=1&&V>=0&&V<=1&&y.push({x:M.x,y:M.y,t1:O,t2:V})}}return y}function UT(n,t,e){n=Ng(n),t=Ng(t);for(var r,i,o,a,l,h,u,d,g,y,m=[],w=0,v=n.length;w<v;w++){var _=n[w];if(_[0]=="M")r=l=_[1],i=h=_[2];else{_[0]=="C"?(g=[r,i,..._.slice(1)],r=g[6],i=g[7]):(g=[r,i,r,i,l,h,l,h],r=l,i=h);for(var b=0,N=t.length;b<N;b++){var A=t[b];if(A[0]=="M")o=u=A[1],a=d=A[2];else{A[0]=="C"?(y=[o,a,...A.slice(1)],o=y[6],a=y[7]):(y=[o,a,o,a,u,d,u,d],o=u,a=d);var T=qT(g,y);{for(var P=0,M=T.length;P<M;P++)T[P].segment1=w,T[P].segment2=b,T[P].bez1=g,T[P].bez2=y;m=m.concat(T)}}}}}return m}function YT(n){var t=Ii(n);if(t.abs)return ya(t.abs);if((!ma(n)||!ma(n&&n[0]))&&(n=$T(n)),!n||!n.length)return[["M",0,0]];var e=[],r=0,i=0,o=0,a=0,l=0,h;n[0][0]=="M"&&(r=+n[0][1],i=+n[0][2],o=r,a=i,l++,e[0]=["M",r,i]);for(var u,d,g=l,y=n.length;g<y;g++){if(e.push(u=[]),d=n[g],h=d[0],h!=h.toUpperCase())switch(u[0]=h.toUpperCase(),u[0]){case"A":u[1]=d[1],u[2]=d[2],u[3]=d[3],u[4]=d[4],u[5]=d[5],u[6]=+d[6]+r,u[7]=+d[7]+i;break;case"V":u[1]=+d[1]+i;break;case"H":u[1]=+d[1]+r;break;case"M":o=+d[1]+r,a=+d[2]+i;default:for(var m=1,w=d.length;m<w;m++)u[m]=+d[m]+(m%2?r:i)}else for(var v=0,_=d.length;v<_;v++)u[v]=d[v];switch(h=h.toUpperCase(),u[0]){case"Z":r=+o,i=+a;break;case"H":r=u[1];break;case"V":i=u[1];break;case"M":o=u[u.length-2],a=u[u.length-1];default:r=u[u.length-2],i=u[u.length-1]}}return e.toString=c0,t.abs=ya(e),e}function Pg(n){return n[0]===n[2]&&n[1]===n[3]&&n[4]===n[6]&&n[5]===n[7]}function Wo(n,t,e,r){return[n,t,e,r,e,r]}function Ag(n,t,e,r,i,o){var a=.3333333333333333,l=2/3;return[a*n+l*e,a*t+l*r,a*i+l*e,a*o+l*r,i,o]}function l0(n,t,e,r,i,o,a,l,h,u){var d=sr*120/180,g=sr/180*(+i||0),y=[],m,w=zT(function(vr,De,me){var Xa=vr*Ut.cos(me)-De*Ut.sin(me),Hr=vr*Ut.sin(me)+De*Ut.cos(me);return{x:Xa,y:Hr}});if(u)R=u[0],O=u[1],P=u[2],M=u[3];else{m=w(n,t,-g),n=m.x,t=m.y,m=w(l,h,-g),l=m.x,h=m.y;var v=(n-l)/2,_=(t-h)/2,b=v*v/(e*e)+_*_/(r*r);b>1&&(b=Ut.sqrt(b),e=b*e,r=b*r);var N=e*e,A=r*r,T=(o==a?-1:1)*Ut.sqrt(hr((N*A-N*_*_-A*v*v)/(N*_*_+A*v*v))),P=T*e*_/r+(n+l)/2,M=T*-r*v/e+(t+h)/2,R=Ut.asin(((t-M)/r).toFixed(9)),O=Ut.asin(((h-M)/r).toFixed(9));R=n<P?sr-R:R,O=l<P?sr-O:O,R<0&&(R=sr*2+R),O<0&&(O=sr*2+O),a&&R>O&&(R=R-sr*2),!a&&O>R&&(O=O-sr*2)}var V=O-R;if(hr(V)>d){var $=O,G=l,Z=h;O=R+d*(a&&O>R?1:-1),l=P+e*Ut.cos(O),h=M+r*Ut.sin(O),y=l0(l,h,e,r,i,0,a,G,Z,[O,$,P,M])}V=O-R;var tt=Ut.cos(R),dt=Ut.sin(R),wt=Ut.cos(O),Nt=Ut.sin(O),Lt=Ut.tan(V/4),It=4/3*e*Lt,Ct=4/3*r*Lt,K=[n,t],X=[n+It*dt,t-Ct*tt],ot=[l+It*Nt,h-Ct*wt],ht=[l,h];if(X[0]=2*K[0]-X[0],X[1]=2*K[1]-X[1],u)return[X,ot,ht].concat(y);y=[X,ot,ht].concat(y).join().split(",");for(var Ft=[],ft=0,Wt=y.length;ft<Wt;ft++)Ft[ft]=ft%2?w(y[ft-1],y[ft],g).y:w(y[ft],y[ft+1],g).x;return Ft}function KT(n,t,e,r,i,o,a,l){for(var h=[],u=[[],[]],d,g,y,m,w,v,_,b,N=0;N<2;++N){if(N==0?(g=6*n-12*e+6*i,d=-3*n+9*e-9*i+3*a,y=3*e-3*n):(g=6*t-12*r+6*o,d=-3*t+9*r-9*o+3*l,y=3*r-3*t),hr(d)<1e-12){if(hr(g)<1e-12)continue;m=-y/g,0<m&&m<1&&h.push(m);continue}_=g*g-4*y*d,b=Ut.sqrt(_),!(_<0)&&(w=(-g+b)/(2*d),0<w&&w<1&&h.push(w),v=(-g-b)/(2*d),0<v&&v<1&&h.push(v))}for(var A=h.length,T=A,P;A--;)m=h[A],P=1-m,u[0][A]=P*P*P*n+3*P*P*m*e+3*P*m*m*i+m*m*m*a,u[1][A]=P*P*P*t+3*P*P*m*r+3*P*m*m*o+m*m*m*l;return u[0][T]=n,u[1][T]=t,u[0][T+1]=a,u[1][T+1]=l,u[0].length=u[1].length=T+2,{x0:dn(...u[0]),y0:dn(...u[1]),x1:gn(...u[0]),y1:gn(...u[1])}}function Ng(n){var t=Ii(n);if(t.curve)return ya(t.curve);for(var e=YT(n),r={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},i=function(m,w,v){var _,b;if(!m)return["C",w.x,w.y,w.x,w.y,w.x,w.y];switch(!(m[0]in{T:1,Q:1})&&(w.qx=w.qy=null),m[0]){case"M":w.X=m[1],w.Y=m[2];break;case"A":m=["C",...l0(w.x,w.y,...m.slice(1))];break;case"S":v=="C"||v=="S"?(_=w.x*2-w.bx,b=w.y*2-w.by):(_=w.x,b=w.y),m=["C",_,b,...m.slice(1)];break;case"T":v=="Q"||v=="T"?(w.qx=w.x*2-w.qx,w.qy=w.y*2-w.qy):(w.qx=w.x,w.qy=w.y),m=["C",...Ag(w.x,w.y,w.qx,w.qy,m[1],m[2])];break;case"Q":w.qx=m[1],w.qy=m[2],m=["C",...Ag(w.x,w.y,m[1],m[2],m[3],m[4])];break;case"L":m=["C",...Wo(w.x,w.y,m[1],m[2])];break;case"H":m=["C",...Wo(w.x,w.y,m[1],w.y)];break;case"V":m=["C",...Wo(w.x,w.y,w.x,m[1])];break;case"Z":m=["C",...Wo(w.x,w.y,w.X,w.Y)];break}return m},o=function(m,w){if(m[w].length>7){m[w].shift();for(var v=m[w];v.length;)a[w]="A",m.splice(w++,0,["C",...v.splice(0,6)]);m.splice(w,1),d=e.length}},a=[],l="",h="",u=0,d=e.length;u<d;u++){e[u]&&(l=e[u][0]),l!="C"&&(a[u]=l,u&&(h=a[u-1])),e[u]=i(e[u],r,h),a[u]!="A"&&l=="C"&&(a[u]="C"),o(e,u);var g=e[u],y=g.length;r.x=g[y-2],r.y=g[y-1],r.bx=vg(g[y-4])||r.x,r.by=vg(g[y-3])||r.y}return t.curve=ya(e),e}class u0 extends Fe{edgeCrossings;constructor(t){super(t),console.log("Calculating edge crossings"),this.edgeCrossings=0}async calculate(){try{const t=await xe.fetchMetricsWithPolling(this.graph,"edgeCrossings");console.log("Edge crossings:",t),this.edgeCrossings=t.value}catch(t){console.error("Error fetching edge crossings metric:",t),this.edgeCrossings=0}}async calculateEdgeCrossings(){const t=this.graph.allLayoutConnections,e=100;let r=0;for(let i=0;i<t.length;i++){const o=t[i];for(let a=i+1;a<t.length;a++){const l=t[a],h=this.getIntersections(o.connection2d,l.connection2d);this.edgeCrossings+=h.length,r++,r>e&&(await new Promise(u=>setTimeout(u,0)),r=0)}}}getIntersections(t,e,r=!0){if(!t||!e)return[];const i=t.getSvgPath(),o=e.getSvgPath(),a=UT(i,o),l=Array.from(a);if(a.length>0&&r){let h=function(d){return d<u||d>1-u};l.splice(0,l.length);const u=1e-4;a.forEach(d=>{const g=d.t1,y=d.t2;h(g)||h(y)||l.push(d)})}return l}}Ot(u0,"displayedMetrics",[{key:"edgeCrossings",optimum:"lowerIsBetter",label:"Edge Crossings",abbreviation:"EC",description:"The total count of edge crossings in the graph. Lower values indicate cleaner layouts with fewer visual intersections.",normalizing:"none"}]);const Fa=!0,XT=!1,Qo={CW:-1,CCW:1,NOT_ORIENTABLE:0},Me=2*Math.PI;var xt;(function(n){n[n.INSIDE=1]="INSIDE",n[n.OUTSIDE=0]="OUTSIDE",n[n.BOUNDARY=2]="BOUNDARY"})(xt||(xt={}));var zn;(function(n){n[n.SAME=1]="SAME",n[n.OPPOSITE=2]="OPPOSITE"})(zn||(zn={}));const Eu=0,va=1,xi=2,h0=Object.freeze(Object.defineProperty({__proto__:null,CCW:XT,CW:Fa,END_VERTEX:xi,get Inclusion(){return xt},NOT_VERTEX:Eu,ORIENTATION:Qo,get Overlap(){return zn},START_VERTEX:va,TAU:Me},Symbol.toStringTag,{value:"Module"}));let qn=1e-6;function Zo(){return qn}function Bt(n){return n<qn&&n>-qn}function Et(n,t){return n-t<qn&&n-t>-qn}function Bi(n,t){return n-t>qn}function Nn(n,t){return n-t>-qn}function Se(n,t){return n-t<-qn}function rn(n,t){return n-t<qn}function Vi(n,t){let e=[],[r,i,o]=n.standard,[a,l,h]=t.standard,u=r*l-i*a,d=o*l-i*h,g=r*h-o*a;if(!Bt(u)){let y,m;i===0?(y=o/r,m=g/u):l===0?(y=h/a,m=g/u):r===0?(y=d/u,m=o/i):a===0?(y=d/u,m=h/l):(y=d/u,m=g/u),e.push(new D(y,m))}return e}function $r(n,t){let e=[],r=t.pc.projectionOn(n),i=t.pc.distanceTo(r)[0];if(Et(i,t.r))e.push(r);else if(Se(i,t.r)){let o=Math.sqrt(t.r*t.r-i*i),a,l;a=n.norm.rotate90CW().multiply(o),l=r.translate(a),e.push(l),a=n.norm.rotate90CCW().multiply(o),l=r.translate(a),e.push(l)}return e}function Da(n,t){let e=[];for(let r of t.toSegments()){let i=Os(r,n);for(let o of i)w0(o,e)||e.push(o)}return e}function Ba(n,t){let e=[];if(Da(n,t.box).length===0)return e;let r=new Q(t.pc,t.r),i=$r(n,r);for(let o of i)t.contains(o)&&e.push(o);return e}function Os(n,t){let e=[];if(n.start.on(t)&&e.push(n.start),n.end.on(t)&&!n.isZeroLength()&&e.push(n.end),e.length>0||n.isZeroLength()||n.start.leftTo(t)&&n.end.leftTo(t)||!n.start.leftTo(t)&&!n.end.leftTo(t))return e;let r=new et(n.start,n.end);return Vi(r,t)}function Gi(n,t){let e=[];if(!n.box.intersect(t.box))return e;if(n.isZeroLength())return n.start.on(t)&&e.push(n.start),e;if(t.isZeroLength())return t.start.on(n)&&e.push(t.start),e;let r=new et(n.start,n.end),i=new et(t.start,t.end);if(r.incidentTo(i))n.start.on(t)&&e.push(n.start),n.end.on(t)&&e.push(n.end),t.start.on(n)&&!t.start.equalTo(n.start)&&!t.start.equalTo(n.end)&&e.push(t.start),t.end.on(n)&&!t.end.equalTo(n.start)&&!t.end.equalTo(n.end)&&e.push(t.end);else{let o=Vi(r,i);o.length>0&&Tg(o[0],n)&&Tg(o[0],t)&&e.push(o[0])}return e}function Tg(n,t){const e=t.box;return rn(n.x,e.xmax)&&Nn(n.x,e.xmin)&&rn(n.y,e.ymax)&&Nn(n.y,e.ymin)}function Va(n,t){let e=[];if(!n.box.intersect(t.box))return e;if(n.isZeroLength()){let[o,a]=n.start.distanceTo(t.pc);return Et(o,t.r)&&e.push(n.start),e}let r=new et(n.start,n.end),i=$r(r,t);for(let o of i)o.on(n)&&e.push(o);return e}function Wr(n,t){let e=[];if(!n.box.intersect(t.box))return e;if(n.isZeroLength())return n.start.on(t)&&e.push(n.start),e;let r=new et(n.start,n.end),i=new Q(t.pc,t.r),o=$r(r,i);for(let a of o)a.on(n)&&a.on(t)&&e.push(a);return e}function JT(n,t){let e=[];for(let r of t.toSegments()){let i=Gi(r,n);for(let o of i)e.push(o)}return e}function f0(n,t){let e=[];if(!n.box.intersect(t.box))return e;let r=new W(n.pc,t.pc),i=n.r,o=t.r;if(Bt(i)||Bt(o))return e;if(Bt(r.x)&&Bt(r.y)&&Et(i,o))return e.push(n.pc.translate(-i,0)),e;let a=n.pc.distanceTo(t.pc)[0];if(Bi(a,i+o)||Se(a,Math.abs(i-o)))return e;r.x/=a,r.y/=a;let l;if(Et(a,i+o)||Et(a,Math.abs(i-o)))return l=n.pc.translate(i*r.x,i*r.y),e.push(l),e;let h=i*i/(2*a)-o*o/(2*a)+a/2,u=n.pc.translate(h*r.x,h*r.y),d=Math.sqrt(i*i-h*h);return l=u.translate(r.rotate90CW().multiply(d)),e.push(l),l=u.translate(r.rotate90CCW().multiply(d)),e.push(l),e}function QT(n,t){let e=[];for(let r of t.toSegments()){let i=Va(r,n);for(let o of i)e.push(o)}return e}function d0(n,t){let e=[];if(!n.box.intersect(t.box))return e;if(n.pc.equalTo(t.pc)&&Et(n.r,t.r)){let a;return a=n.start,a.on(t)&&e.push(a),a=n.end,a.on(t)&&e.push(a),a=t.start,a.on(n)&&e.push(a),a=t.end,a.on(n)&&e.push(a),e}let r=new Q(n.pc,n.r),i=new Q(t.pc,t.r),o=r.intersect(i);for(let a of o)a.on(n)&&a.on(t)&&e.push(a);return e}function Iu(n,t){let e=[];if(!n.box.intersect(t.box))return e;if(t.pc.equalTo(n.pc)&&Et(t.r,n.r))return e.push(n.start),e.push(n.end),e;let r=t,i=new Q(n.pc,n.r),o=f0(r,i);for(let a of o)a.on(n)&&e.push(a);return e}function ZT(n,t){let e=[];for(let r of t.toSegments()){let i=Wr(r,n);for(let o of i)e.push(o)}return e}function g0(n,t){if(n.isSegment())return Gi(n.shape,t);if(n.isArc())return Wr(t,n.shape);throw new Error("unimplemented")}function p0(n,t){if(n.isSegment())return Wr(n.shape,t);if(n.isArc())return d0(n.shape,t);throw new Error("unimplemented")}function m0(n,t){if(n.isSegment())return Os(n.shape,t);if(n.isArc())return Ba(t,n.shape);throw new Error("unimplemented")}function jT(n,t){if(n.isSegment())return Va(n.shape,t);if(n.isArc())return Iu(n.shape,t);throw new Error("unimplemented")}function Mu(n,t){let e=[];for(let r of t.edges)for(let i of g0(r,n))e.push(i);return e}function Ru(n,t){let e=[];for(let r of t.edges)for(let i of p0(r,n))e.push(i);return e}function Fs(n,t){let e=[];if(t.isEmpty())return e;for(let r of t.edges)for(let i of m0(r,n))w0(i,e)||e.push(i);return n.sortPoints(e)}function y0(n,t){let e=[];if(t.isEmpty())return e;for(let r of t.edges)for(let i of jT(r,n))e.push(i);return e}function tE(n,t){if(n.isSegment())return g0(t,n.shape);if(n.isArc())return p0(t,n.shape);throw new Error("unimplemented")}function eE(n,t){let e=[];if(t.isEmpty()||!n.shape.box.intersect(t.box))return e;let r=t.edges.search(n.shape.box);for(let i of r)e=[...e,...tE(n,i)];return e}function nE(n,t){if(n.isEmpty()||t.isEmpty())return[];if(!n.box.intersect(t.box))return[];const e=[];for(let r of n.edges)e.push(...eE(r,t));return e}function rE(n,t){return n instanceof et?Fs(n,t):n instanceof U?Mu(n,t):n instanceof ut?Ru(n,t):[]}function w0(n,t){return t.some(e=>e.equalTo(n))}function pr(n){return new et(n.start,n.norm)}function v0(n,t){return Os(t,pr(n)).filter(e=>n.contains(e))}function b0(n,t){return Ba(pr(n),t).filter(e=>n.contains(e))}function _0(n,t){return $r(pr(n),t).filter(e=>n.contains(e))}function iE(n,t){return Da(pr(n),t).filter(e=>n.contains(e))}function x0(n,t){return Vi(pr(n),t).filter(e=>n.contains(e))}function sE(n,t){return Vi(pr(n),pr(t)).filter(e=>n.contains(e)).filter(e=>t.contains(e))}function S0(n,t){return Fs(pr(n),t).filter(e=>n.contains(e))}const ae={get ILLEGAL_PARAMETERS(){return new ReferenceError("Illegal Parameters")},get ZERO_DIVISION(){return new Error("Zero division")},get UNRESOLVED_BOUNDARY_CONFLICT(){return new Error("Unresolved boundary conflict in boolean operation")},get INFINITE_LOOP(){return new Error("Infinite loop")},get CANNOT_INVOKE_ABSTRACT_METHOD(){return new Error("Abstract method cannot be invoked")},get OPERATION_IS_NOT_SUPPORTED(){return new Error("Operation is not supported")}},ai=(n,t,e,r)=>n*r-t*e;class Jt{static fromTransform(t,e,r,i){return new Jt(+i*Math.cos(r),+i*Math.sin(r),-i*Math.sin(r),+i*Math.cos(r),t,e)}constructor(t=1,e=0,r=0,i=1,o=0,a=0){this.a=NaN,this.b=NaN,this.c=NaN,this.d=NaN,this.tx=NaN,this.ty=NaN,this._inverse=null,this.a=t,this.b=e,this.c=r,this.d=i,this.tx=o,this.ty=a}clone(){return new Jt(this.a,this.b,this.c,this.d,this.tx,this.ty)}get inverse(){var t;const e=(t=this._inverse)!==null&&t!==void 0?t:this._inverse=this.invert();return e._inverse=this,e}invert(){return this.clone().invertMut()}invertMut(){this._inverse=null;const t=this.a,e=this.c,r=this.tx,i=this.b,o=this.d,a=this.ty,l=0,h=0,u=1,d=this.determinant(),g=ai(o,a,h,u)/d,y=-ai(e,r,h,u)/d,m=ai(e,r,o,a)/d,w=-ai(i,a,l,u)/d,v=ai(t,r,l,u)/d,_=-ai(t,r,i,a)/d;return this.a=g,this.b=w,this.c=y,this.d=v,this.tx=m,this.ty=_,this}determinant(){const t=this.a,e=this.c,r=this.tx,i=this.b,o=this.d,a=this.ty,l=0,h=0,u=1;return t*(o*u-a*h)-e*(i*u-a*l)+r*(i*h-o*l)}transform(t,e){return[t*this.a+e*this.c+this.tx,t*this.b+e*this.d+this.ty]}transformMut(t){return t.x=t.x*this.a+t.y*this.c+this.tx,t.y=t.x*this.b+t.y*this.d+this.ty,t}multiply(t){return this.clone().multiplyMut(t)}multiplyMut(t){const e=this.a,r=this.b,i=this.c,o=this.d,a=this.tx,l=this.ty;return this.a=e*t.a+i*t.b,this.b=r*t.a+o*t.b,this.c=e*t.c+i*t.d,this.d=r*t.c+o*t.d,this.tx=e*t.tx+i*t.ty+a,this.ty=r*t.tx+o*t.ty+l,this._inverse=null,this}translate(t,e){let r,i;if(t&&typeof t=="object"&&!isNaN(t.x)&&!isNaN(t.y))r=t.x,i=t.y;else if(typeof t=="number"&&typeof e=="number")r=t,i=e;else throw ae.ILLEGAL_PARAMETERS;return this.clone().multiplyMut(new Jt(1,0,0,1,r,i))}rotate(t,e=0,r=0){const i=Math.cos(t),o=Math.sin(t);return this.translate(e,r).multiply(new Jt(i,o,-o,i,0,0)).translate(-e,-r)}scale(t,e){return this.multiply(new Jt(t,0,0,e,0,0))}equalTo(t){return!(!Et(this.tx,t.tx)||!Et(this.ty,t.ty)||!Et(this.a,t.a)||!Et(this.b,t.b)||!Et(this.c,t.c)||!Et(this.d,t.d))}isIdentity(){return this.a===1&&this.b===0&&this.c===0&&this.d===1&&this.tx===0&&this.ty===0}}Jt.EMPTY=Object.freeze(new Jt(0,0,0,0,0,0));Jt.IDENTITY=Object.freeze(new Jt(1,0,0,1,0,0));const Lu={x:NaN,y:NaN};Lu.x=0;Lu.y=0;var Qt;(function(n){n[n.Segment=0]="Segment",n[n.Arc=1]="Arc",n[n.Bezier=2]="Bezier",n[n.Quadratic=3]="Quadratic",n[n.Box=4]="Box",n[n.Circle=5]="Circle",n[n.Path=6]="Path",n[n.Ray=7]="Ray",n[n.Line=8]="Line",n[n.Multiline=9]="Multiline",n[n.Point=10]="Point",n[n.Polygon=11]="Polygon",n[n.Vector=12]="Vector"})(Qt||(Qt={}));const oE=Qt.Quadratic;class Ke{constructor(){}translate(t,e){return this.transform(Jt.IDENTITY.translate(t,e))}rotate(t,e=Lu){return this.transform(Jt.IDENTITY.rotate(t,e.x,e.y))}scale(t,e){return this.transform(Jt.IDENTITY.scale(t,e??t))}transform(t){throw ae.CANNOT_INVOKE_ABSTRACT_METHOD}toJSON(){return Object.assign({},this,{name:this.name})}}class D extends Ke{constructor(t,e){super(),this.x=NaN,this.y=NaN,this.x=0,this.y=0;const r=+(t!==void 0)+ +(e!==void 0);if(r!==0){if(r===1&&t instanceof Array){this.x=t[0],this.y=t[1];return}if(r===1){let{x:i,y:o}=t;this.x=i,this.y=o;return}if(r===2){this.x=t,this.y=e;return}throw ae.ILLEGAL_PARAMETERS}}clone(){return new D(this.x,this.y)}get tag(){return Qt.Point}get name(){return"point"}get box(){return new At(this.x,this.y,this.x,this.y)}get center(){return this}isEmpty(){return this.x===0&&this.y===0}get vertices(){return[this]}contains(t){return this.equalTo(t)}equalTo(t){return Et(this.x,t.x)&&Et(this.y,t.y)}lessThan(t){return!!(Se(this.y,t.y)||Et(this.y,t.y)&&Se(this.x,t.x))}transform(t){return new D(t.transform(this.x,this.y))}projectionOn(t){if(this.equalTo(t.pt))return this.clone();let e=new W(this,t.pt);if(Bt(e.cross(t.norm)))return t.pt.clone();let r=e.dot(t.norm),i=t.norm.multiply(r);return this.translate(i)}leftTo(t){let e=new W(t.pt,this);return Bi(e.dot(t.norm),0)}snapToGrid(t=1,e){const r=t,i=e===void 0?t:e;return new D(Math.round(this.x/r)*r,Math.round(this.y/i)*i)}distanceTo(t){if(t instanceof D){let e=t.x-this.x,r=t.y-this.y;return[Math.sqrt(e*e+r*r),new U(this,t)]}if(t instanceof et)return Pn(this,t);if(t instanceof Q)return Ye(this,t);if(t instanceof U)return bn(this,t);if(t instanceof ut)return Wn(this,t);if(t instanceof Tt)return E0(this,t);throw new Error("unimplemented")}on(t){return t instanceof D?this.equalTo(t):t.contains(this)}}D.EMPTY=Object.freeze(new D(0,0));class U extends Ke{constructor(t,e,r,i){super(),this.start=D.EMPTY,this.end=D.EMPTY;const o=+(t!==void 0)+ +(e!==void 0)+ +(r!==void 0)+ +(i!==void 0);if(o!==0){if(o===1&&Array.isArray(t)){let a=t;this.start=new D(a[0],a[1]),this.end=new D(a[2],a[3]);return}if(o===1&&t.name==="segment"){let{start:a,end:l}=t;this.start=new D(a.x,a.y),this.end=new D(l.x,l.y);return}if(o===1&&t instanceof D){this.start=t.clone();return}if(o===2&&t instanceof D&&e instanceof D){this.start=t.clone(),this.end=e.clone();return}if(o===4){this.start=new D(t,e),this.end=new D(r,i);return}throw ae.ILLEGAL_PARAMETERS}}clone(){return new U(this.start,this.end)}get tag(){return Qt.Segment}get name(){return"segment"}get box(){return new At(Math.min(this.start.x,this.end.x),Math.min(this.start.y,this.end.y),Math.max(this.start.x,this.end.x),Math.max(this.start.y,this.end.y))}get center(){return new D((this.start.x+this.end.x)/2,(this.start.y+this.end.y)/2)}get vertices(){return[this.start,this.end]}get length(){return this.start.distanceTo(this.end)[0]}get slope(){return new W(this.start,this.end).slope}get vector(){return new W(this.start,this.end)}equalTo(t){return this.start.equalTo(t.start)&&this.end.equalTo(t.end)}contains(t){return Bt(this.distanceToPoint(t))}intersect(t){if(t instanceof D)return this.contains(t)?[t]:[];if(t instanceof et)return Os(this,t);if(t instanceof ne)return v0(t,this);if(t instanceof U)return Gi(this,t);if(t instanceof Q)return Va(this,t);if(t instanceof At)return JT(this,t);if(t instanceof ut)return Wr(this,t);if(t instanceof Tt)return Mu(this,t);throw new Error("unreachable")}distanceTo(t){if(t instanceof D){let[e,r]=Ds(this,t);return[e,r]}if(t instanceof Q){let[e,r]=P0(this,t);return[e,r]}if(t instanceof et){let[e,r]=C0(this,t);return[e,r]}if(t instanceof U){let[e,r]=ku(this,t);return[e,r]}if(t instanceof ut){let[e,r]=Ga(this,t);return[e,r]}if(t instanceof Tt){let[e,r]=Bs(this,t);return[e,r]}if(t instanceof Mi){let[e,r]=za(this,t);return[e,r]}}tangentInStart(){return new W(this.start,this.end).normalize()}tangentInEnd(){return new W(this.end,this.start).normalize()}reverse(){return new U(this.end,this.start)}split(t){return this.start.equalTo(t)?[null,this.clone()]:this.end.equalTo(t)?[this.clone(),null]:[new U(this.start,t),new U(t,this.end)]}splitAtLength(t){if(Bt(t))return[null,this.clone()];if(Et(t,this.length))return[this.clone(),null];const e=this.pointAtLength(t);return[new U(this.start,e),new U(e,this.end)]}middle(){return this.center}pointAtLength(t){if(t<=0)return this.start;if(t>=this.length)return this.end;const e=t/this.length;return new D((this.end.x-this.start.x)*e+this.start.x,(this.end.y-this.start.y)*e+this.start.y)}distanceToPoint(t){const[e]=bn(t,this);return e}definiteIntegral(t=0){const e=this.end.x-this.start.x,r=this.start.y-t,i=this.end.y-t;return e*(r+i)/2}transform(t){return new U(this.start.transform(t),this.end.transform(t))}isZeroLength(){return this.start.equalTo(this.end)}sortPoints(t){return new et(this.start,this.end).sortPoints(t)}}U.EMPTY=Object.freeze(new U(D.EMPTY,D.EMPTY));class At extends Ke{constructor(t=1/0,e=1/0,r=-1/0,i=-1/0){super(),this.xmin=NaN,this.ymin=NaN,this.xmax=NaN,this.ymax=NaN,this.xmin=t,this.ymin=e,this.xmax=r,this.ymax=i}clone(){return new At(this.xmin,this.ymin,this.xmax,this.ymax)}get tag(){return Qt.Box}get name(){return"box"}get box(){return this}get center(){return new D((this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)}get width(){return Math.abs(this.xmax-this.xmin)}get height(){return Math.abs(this.ymax-this.ymin)}contains(t){return t.x>=this.xmin&&t.x<=this.xmax&&t.y>=this.ymin&&t.y<=this.ymax}intersect(t){return!(this.xmax<t.xmin||this.xmin>t.xmax||this.ymax<t.ymin||this.ymin>t.ymax)}merge(t){return new At(Math.min(this.xmin,t.xmin),Math.min(this.ymin,t.ymin),Math.max(this.xmax,t.xmax),Math.max(this.ymax,t.ymax))}equalTo(t){return this.low.equalTo(t.low)&&this.high.equalTo(t.high)}toPoints(){return[new D(this.xmin,this.ymin),new D(this.xmax,this.ymin),new D(this.xmax,this.ymax),new D(this.xmin,this.ymax)]}toSegments(){const t=this.toPoints();return[new U(t[0],t[1]),new U(t[1],t[2]),new U(t[2],t[3]),new U(t[3],t[0])]}rotate(t,e=D.EMPTY){throw ae.OPERATION_IS_NOT_SUPPORTED}transform(t=Jt.IDENTITY){return this.toPoints().map(e=>e.transform(t)).reduce((e,r)=>e.merge(r.box),At.VOID)}get low(){return new D(this.xmin,this.ymin)}get high(){return new D(this.xmax,this.ymax)}get max(){return this.clone()}lessThan(t){return!!(this.low.lessThan(t.low)||this.low.equalTo(t.low)&&this.high.lessThan(t.high))}output(){return this.clone()}static comparableMax(t,e){return t.merge(e)}static comparableLessThan(t,e){return t.lessThan(e)}}At.EMPTY=Object.freeze(new At(0,0,0,0));At.VOID=Object.freeze(new At(1/0,1/0,-1/0,-1/0));class ba{constructor(t,e){this.low=t,this.high=e}clone(){return new ba(this.low,this.high)}get max(){return this.clone()}lessThan(t){return this.low<t.low||this.low==t.low&&this.high<t.high}equalTo(t){return this.low==t.low&&this.high==t.high}intersect(t){return!this.not_intersect(t)}not_intersect(t){return this.high<t.low||t.high<this.low}merge(t){return new ba(this.low===void 0?t.low:Math.min(this.low,t.low),this.high===void 0?t.high:Math.max(this.high,t.high))}output(){return[this.low,this.high]}static comparableMax(t,e){return t.merge(e)}static comparableLessThan(t,e){return t<e}}var lt;(function(n){n[n.RED=0]="RED",n[n.BLACK=1]="BLACK"})(lt||(lt={}));let Er=class{constructor(t=void 0,e=void 0,r=null,i=null,o=null,a=lt.BLACK){this.left=r,this.right=i,this.parent=o,this.color=a,this.item={key:t,value:e},t&&t instanceof Array&&t.length==2&&!Number.isNaN(t[0])&&!Number.isNaN(t[1])&&(this.item.key=new ba(Math.min(t[0],t[1]),Math.max(t[0],t[1]))),this.max=this.item.key?this.item.key.max:void 0}isNil(){return this.item.key===void 0&&this.item.value===void 0&&this.left===null&&this.right===null&&this.color===lt.BLACK}_value_less_than(t){return this.item.value&&t.item.value&&this.item.value.lessThan?this.item.value.lessThan(t.item.value):this.item.value<t.item.value}lessThan(t){return this.item.value===this.item.key&&t.item.value===t.item.key?this.item.key.lessThan(t.item.key):this.item.key.lessThan(t.item.key)||this.item.key.equalTo(t.item.key)&&this._value_less_than(t)}_value_equal(t){return this.item.value&&t.item.value&&this.item.value.equalTo?this.item.value.equalTo(t.item.value):this.item.value==t.item.value}equalTo(t){return this.item.value===this.item.key&&t.item.value===t.item.key?this.item.key.equalTo(t.item.key):this.item.key.equalTo(t.item.key)&&this._value_equal(t)}intersect(t){return this.item.key.intersect(t.item.key)}copy_data(t){this.item.key=t.item.key,this.item.value=t.item.value}update_max(){if(this.max=this.item.key?this.item.key.max:void 0,this.right&&this.right.max){const t=this.item.key.constructor.comparableMax;this.max=t(this.max,this.right.max)}if(this.left&&this.left.max){const t=this.item.key.constructor.comparableMax;this.max=t(this.max,this.left.max)}}not_intersect_left_subtree(t){const e=this.item.key.constructor.comparableLessThan;let r=this.left.max.high!==void 0?this.left.max.high:this.left.max;return e(r,t.item.key.low)}not_intersect_right_subtree(t){const e=this.item.key.constructor.comparableLessThan;let r=this.right.max.low!==void 0?this.right.max.low:this.right.item.key.low;return e(t.item.key.high,r)}};class Ms{constructor(){this.root=null,this.nil_node=new Er}get size(){let t=0;return this.tree_walk(this.root,()=>t++),t}get keys(){let t=[];return this.tree_walk(this.root,e=>t.push(e.item.key.output?e.item.key.output():e.item.key)),t}get values(){let t=[];return this.tree_walk(this.root,e=>t.push(e.item.value)),t}get items(){let t=[];return this.tree_walk(this.root,e=>t.push({key:e.item.key.output?e.item.key.output():e.item.key,value:e.item.value})),t}isEmpty(){return this.root==null||this.root==this.nil_node}clear(){this.root=null}insert(t,e=t){if(t===void 0)return;let r=new Er(t,e,this.nil_node,this.nil_node,null,lt.RED);return this.tree_insert(r),this.recalc_max(r),r}exist(t,e=t){let r=new Er(t,e);return!!this.tree_search(this.root,r)}remove(t,e=t){let r=new Er(t,e),i=this.tree_search(this.root,r);return i&&this.tree_delete(i),i}search(t,e=(r,i)=>r===i?i.output():r){let r=new Er(t),i=[];return this.tree_search_interval(this.root,r,i),i.map(o=>e(o.item.value,o.item.key))}intersect_any(t){let e=new Er(t);return this.tree_find_any_interval(this.root,e)}forEach(t){this.tree_walk(this.root,e=>t(e.item.key,e.item.value))}map(t){const e=new Ms;return this.tree_walk(this.root,r=>e.insert(r.item.key,t(r.item.value,r.item.key))),e}*iterate(t,e=(r,i)=>r===i?i.output():r){let r;for(t?r=this.tree_search_nearest_forward(this.root,new Er(t)):this.root&&(r=this.local_minimum(this.root));r;)yield e(r.item.value,r.item.key),r=this.tree_successor(r)}recalc_max(t){let e=t;for(;e.parent!=null;)e.parent.update_max(),e=e.parent}tree_insert(t){let e=this.root,r=null;if(this.root==null||this.root==this.nil_node)this.root=t;else{for(;e!=this.nil_node;)r=e,t.lessThan(e)?e=e.left:e=e.right;t.parent=r,t.lessThan(r)?r.left=t:r.right=t}this.insert_fixup(t)}insert_fixup(t){let e,r;for(e=t;e!=this.root&&e.parent.color==lt.RED;)e.parent==e.parent.parent.left?(r=e.parent.parent.right,r.color==lt.RED?(e.parent.color=lt.BLACK,r.color=lt.BLACK,e.parent.parent.color=lt.RED,e=e.parent.parent):(e==e.parent.right&&(e=e.parent,this.rotate_left(e)),e.parent.color=lt.BLACK,e.parent.parent.color=lt.RED,this.rotate_right(e.parent.parent))):(r=e.parent.parent.left,r.color==lt.RED?(e.parent.color=lt.BLACK,r.color=lt.BLACK,e.parent.parent.color=lt.RED,e=e.parent.parent):(e==e.parent.left&&(e=e.parent,this.rotate_right(e)),e.parent.color=lt.BLACK,e.parent.parent.color=lt.RED,this.rotate_left(e.parent.parent)));this.root.color=lt.BLACK}tree_delete(t){let e,r;t.left==this.nil_node||t.right==this.nil_node?e=t:e=this.tree_successor(t),e.left!=this.nil_node?r=e.left:r=e.right,r.parent=e.parent,e==this.root?this.root=r:(e==e.parent.left?e.parent.left=r:e.parent.right=r,e.parent.update_max()),this.recalc_max(r),e!=t&&(t.copy_data(e),t.update_max(),this.recalc_max(t)),e.color==lt.BLACK&&this.delete_fixup(r)}delete_fixup(t){let e=t,r;for(;e!=this.root&&e.parent!=null&&e.color==lt.BLACK;)e==e.parent.left?(r=e.parent.right,r.color==lt.RED&&(r.color=lt.BLACK,e.parent.color=lt.RED,this.rotate_left(e.parent),r=e.parent.right),r.left.color==lt.BLACK&&r.right.color==lt.BLACK?(r.color=lt.RED,e=e.parent):(r.right.color==lt.BLACK&&(r.color=lt.RED,r.left.color=lt.BLACK,this.rotate_right(r),r=e.parent.right),r.color=e.parent.color,e.parent.color=lt.BLACK,r.right.color=lt.BLACK,this.rotate_left(e.parent),e=this.root)):(r=e.parent.left,r.color==lt.RED&&(r.color=lt.BLACK,e.parent.color=lt.RED,this.rotate_right(e.parent),r=e.parent.left),r.left.color==lt.BLACK&&r.right.color==lt.BLACK?(r.color=lt.RED,e=e.parent):(r.left.color==lt.BLACK&&(r.color=lt.RED,r.right.color=lt.BLACK,this.rotate_left(r),r=e.parent.left),r.color=e.parent.color,e.parent.color=lt.BLACK,r.left.color=lt.BLACK,this.rotate_right(e.parent),e=this.root));e.color=lt.BLACK}tree_search(t,e){if(!(t==null||t==this.nil_node))return e.equalTo(t)?t:e.lessThan(t)?this.tree_search(t.left,e):this.tree_search(t.right,e)}tree_search_nearest_forward(t,e){let r,i=t;for(;i&&i!=this.nil_node;)i.lessThan(e)?i.intersect(e)?(r=i,i=i.left):i=i.right:((!r||i.lessThan(r))&&(r=i),i=i.left);return r||null}tree_search_interval(t,e,r){t!=null&&t!=this.nil_node&&(t.left!=this.nil_node&&!t.not_intersect_left_subtree(e)&&this.tree_search_interval(t.left,e,r),t.intersect(e)&&r.push(t),t.right!=this.nil_node&&!t.not_intersect_right_subtree(e)&&this.tree_search_interval(t.right,e,r))}tree_find_any_interval(t,e){let r=!1;return t!=null&&t!=this.nil_node&&(t.left!=this.nil_node&&!t.not_intersect_left_subtree(e)&&(r=this.tree_find_any_interval(t.left,e)),r||(r=t.intersect(e)),!r&&t.right!=this.nil_node&&!t.not_intersect_right_subtree(e)&&(r=this.tree_find_any_interval(t.right,e))),r}local_minimum(t){let e=t;for(;e.left!=null&&e.left!=this.nil_node;)e=e.left;return e}local_maximum(t){let e=t;for(;e.right!=null&&e.right!=this.nil_node;)e=e.right;return e}tree_successor(t){let e,r,i;if(t.right!=this.nil_node)e=this.local_minimum(t.right);else{for(r=t,i=t.parent;i!=null&&i.right==r;)r=i,i=i.parent;e=i}return e}rotate_left(t){let e=t.right;t.right=e.left,e.left!=this.nil_node&&(e.left.parent=t),e.parent=t.parent,t==this.root?this.root=e:t==t.parent.left?t.parent.left=e:t.parent.right=e,e.left=t,t.parent=e,t!=null&&t!=this.nil_node&&t.update_max(),e=t.parent,e!=null&&e!=this.nil_node&&e.update_max()}rotate_right(t){let e=t.left;t.left=e.right,e.right!=this.nil_node&&(e.right.parent=t),e.parent=t.parent,t==this.root?this.root=e:t==t.parent.left?t.parent.left=e:t.parent.right=e,e.right=t,t.parent=e,t!=null&&t!=this.nil_node&&t.update_max(),e=t.parent,e!=null&&e!=this.nil_node&&e.update_max()}tree_walk(t,e){t!=null&&t!=this.nil_node&&(this.tree_walk(t.left,e),e(t),this.tree_walk(t.right,e))}testRedBlackProperty(){let t=!0;return this.tree_walk(this.root,function(e){e.color==lt.RED&&(e.left.color==lt.BLACK&&e.right.color==lt.BLACK||(t=!1))}),t}testBlackHeightProperty(t){let e=0,r=0,i=0;if(t.color==lt.BLACK&&e++,t.left!=this.nil_node?r=this.testBlackHeightProperty(t.left):r=1,t.right!=this.nil_node?i=this.testBlackHeightProperty(t.right):i=1,r!=i)throw new Error("Red-black height property violated");return e+=r,e}}class Mi{constructor(t){this.set=new Set(t),this.index=new Ms,this.set.forEach(e=>this.index.insert(e))}[Symbol.iterator](){return this.set[Symbol.iterator]()}get size(){return this.set.size}has(t){return this.set.has(t)}forEach(t){this.set.forEach(t)}add(t){const e=this.set.size;return this.set.add(t),this.set.size>e&&this.index.insert(t.box,t),this}delete(t){const e=this.set.delete(t);return e&&this.index.remove(t.box,t),e}clear(){this.set.clear(),this.index=new Ms}search(t){return this.index.search(t)}hit(t){const e=new At(t.x-1,t.y-1,t.x+1,t.y+1);return this.index.search(e).filter(r=>t.on(r))}}function ws(n){return n[1]=n[1].reverse(),n}function Ue(n,t){return n.distanceTo(t)}function Pn(n,t){let e=n.projectionOn(t);return[new W(n,e).length,new U(n,e)]}function Ye(n,t){let[e,r]=n.distanceTo(t.center);if(Bt(e))return[t.r,new U(n,t.toArc().start)];{let i=Math.abs(e-t.r),o=new W(t.pc,n).normalize().multiply(t.r),a=t.pc.translate(o);return[i,new U(n,a)]}}function bn(n,t){if(t.start.equalTo(t.end))return Ue(n,t.start);let e=new W(t.start,t.end),r=new W(t.start,n),i=new W(t.end,n),o=e.dot(r),a=-e.dot(i),l,h;if(Nn(o,0)&&Nn(a,0)){let u=t.tangentInStart();return l=Math.abs(u.cross(r)),h=t.start.translate(u.multiply(u.dot(r))),[l,new U(n,h)]}else return o<0?n.distanceTo(t.start):n.distanceTo(t.end)}function Wn(n,t){let e=new Q(t.pc,t.r),r=[],i,o;return[i,o]=Ye(n,e),o.end.on(t)&&r.push(Ye(n,e)),r.push(Ue(n,t.start)),r.push(Ue(n,t.end)),wr(r),r[0]}function Ds(n,t){const e=bn(t,n);return e[1]=e[1].reverse(),e}function C0(n,t){let e=n.intersect(t);if(e.length>0)return[0,new U(e[0],e[0])];let r=[];return r.push(Pn(n.start,t)),r.push(Pn(n.end,t)),wr(r),r[0]}function ku(n,t){let e=Gi(n,t);if(e.length>0)return[0,new U(e[0],e[0])];let r=[],i,o;return[i,o]=bn(t.start,n),r.push([i,o.reverse()]),[i,o]=bn(t.end,n),r.push([i,o.reverse()]),r.push(bn(n.start,t)),r.push(bn(n.end,t)),wr(r),r[0]}function P0(n,t){let e=n.intersect(t);if(e.length>0)return[0,new U(e[0],e[0])];let r=new et(n.start,n.end),[i,o]=Pn(t.center,r);if(Nn(i,t.r)&&o.end.on(n))return Ye(o.end,t);{let[a,l]=Ye(n.start,t),[h,u]=Ye(n.end,t);return Se(a,h)?[a,l]:[h,u]}}function Ga(n,t){let e=n.intersect(t);if(e.length>0)return[0,new U(e[0],e[0])];let r=new et(n.start,n.end),i=new Q(t.pc,t.r),[o,a]=Pn(i.center,r);if(Nn(o,i.r)&&a.end.on(n)){let[d,g]=Ye(a.end,i);if(g.end.on(t))return[d,g]}let l=[];l.push(Wn(n.start,t)),l.push(Wn(n.end,t));let h,u;return[h,u]=bn(t.start,n),l.push([h,u.reverse()]),[h,u]=bn(t.end,n),l.push([h,u.reverse()]),wr(l),l[0]}function Ou(n,t){let e=n.intersect(t);if(e.length>0)return[0,new U(e[0],e[0])];if(n.center.equalTo(t.center)){let r=n.toArc(),i=t.toArc();return Ue(r.start,i.start)}else{let r=new et(n.center,t.center),i=r.intersect(n),o=r.intersect(t),a=[];return a.push(Ue(i[0],o[0])),a.push(Ue(i[0],o[1])),a.push(Ue(i[1],o[0])),a.push(Ue(i[1],o[1])),wr(a),a[0]}}function A0(n,t){let e=n.intersect(t);if(e.length>0)return[0,new U(e[0],e[0])];let[r,i]=Pn(n.center,t),[o,a]=Ye(i.end,n);return a=a.reverse(),[o,a]}function aE(n,t){return ws(Wn(t,n))}function cE(n,t){return ws(Ga(t,n))}function N0(n,t){let e=t.intersect(n);if(e.length>0)return[0,new U(e[0],e[0])];let r=new Q(n.center,n.r),[i,o]=Pn(r.center,t);if(Nn(i,r.r)){let[a,l]=Ye(o.end,r);if(l.end.on(n))return[a,l]}else{let a=[];return a.push(Pn(n.start,t)),a.push(Pn(n.end,t)),wr(a),a[0]}}function T0(n,t){let e=n.intersect(t);if(e.length>0)return[0,new U(e[0],e[0])];let r=new Q(n.center,n.r),[i,o]=Ou(r,t);if(o.start.on(n))return[i,o];{let a=[];return a.push(Ye(n.start,t)),a.push(Ye(n.end,t)),wr(a),a[0]}}function lE(n,t){let e=n.intersect(t);if(e.length>0)return[0,new U(e[0],e[0])];let r=new Q(n.center,n.r),i=new Q(t.center,t.r),[o,a]=Ou(r,i);if(a.start.on(n)&&a.end.on(t))return[o,a];{let l=[],h,u;return[h,u]=Wn(n.start,t),u.end.on(t)&&l.push([h,u]),[h,u]=Wn(n.end,t),u.end.on(t)&&l.push([h,u]),[h,u]=Wn(t.start,n),u.end.on(n)&&l.push([h,u.reverse()]),[h,u]=Wn(t.end,n),u.end.on(n)&&l.push([h,u.reverse()]),[h,u]=Ue(n.start,t.start),l.push([h,u]),[h,u]=Ue(n.start,t.end),l.push([h,u]),[h,u]=Ue(n.end,t.start),l.push([h,u]),[h,u]=Ue(n.end,t.end),l.push([h,u]),wr(l),l[0]}}function E0(n,t){let e=[Number.POSITIVE_INFINITY,new U];for(let r of t.edges){let[i,o]=r.shape instanceof U?bn(n,r.shape):Wn(n,r.shape);Se(i,e[0])&&(e=[i,o])}return e}function Bs(n,t){let e=[Number.POSITIVE_INFINITY,new U];for(let r of t.edges){let[i,o]=n.distanceTo(r.shape);Se(i,e[0])&&(e=[i,o])}return e}function Eg(n,t){let e=Math.max(Math.max(n.xmin-t.xmax,0),Math.max(t.xmin-n.xmax,0)),r=Math.max(Math.max(n.ymin-t.ymax,0),Math.max(t.ymin-n.ymax,0)),i=e*e+r*r,o=n.merge(t),a=o.xmax-o.xmin,l=o.ymax-o.ymin,h=a*a+l*l;return[i,h]}function I0(n,t,e,r){let i,o;for(let u of t)[i,o]=Eg(n.box,u.item.key),u.item.value instanceof Le?r.insert([i,o],u.item.value.shape):r.insert([i,o],u.item.value),Se(o,e)&&(e=o);if(t.length===0)return e;let a=t.map(u=>u.left.isNil()?void 0:u.left).filter(u=>u!==void 0),l=t.map(u=>u.right.isNil()?void 0:u.right).filter(u=>u!==void 0),h=[...a,...l].filter(u=>{let[d,g]=Eg(n.box,u.max);return rn(d,e)});return e=I0(n,h,e,r),e}function uE(n,t,e){let r=new Ms,i=[t.index.root],o=e<Number.POSITIVE_INFINITY?e*e:Number.POSITIVE_INFINITY;return o=I0(n,i,o,r),r}function Zl(n,t,e){let r,i;if(t!=null&&!t.isNil()){if([r,i]=Zl(n,t.left,e),i)return[r,i];if(Se(r[0],Math.sqrt(t.item.key.low)))return[r,!0];let[o,a]=hE(n,t.item.value);return Se(o,r[0])&&(r=[o,a]),[r,i]=Zl(n,t.right,r),[r,i]}return[e,!1]}function za(n,t,e=Number.POSITIVE_INFINITY){let r=[e,new U],i=!1;if(t instanceof Mi){let o=uE(n,t,e);[r,i]=Zl(n,o.root,r)}return r}function wr(n){n.sort((t,e)=>Se(t[0],e[0])?-1:Bi(t[0],e[0])?1:0)}function hE(n,t){return n.distanceTo(t)}class W extends Ke{constructor(t,e){super(),this.x=NaN,this.y=NaN,this.x=0,this.y=0;const r=+(t!==void 0)+ +(e!==void 0);if(r!==0){if(r===1&&t instanceof Array&&t.length===2&&typeof t[0]=="number"&&typeof t[1]=="number"){this.x=t[0],this.y=t[1];return}if(r===1&&t instanceof Object&&t.name==="vector"){let{x:i,y:o}=t;this.x=i,this.y=o;return}if(r===1&&typeof t=="number"){this.x=Math.cos(t),this.y=Math.sin(t);return}if(r===2){if(typeof t=="number"&&typeof e=="number"){this.x=t,this.y=e;return}if(t instanceof D&&e instanceof D){this.x=e.x-t.x,this.y=e.y-t.y;return}}throw ae.ILLEGAL_PARAMETERS}}clone(){return new W(this.x,this.y)}contains(t){throw new Error("unimplemented")}get tag(){return Qt.Vector}get name(){return"vector"}get center(){return new D(this.x/2,this.y/2)}get box(){return new At(Math.min(0,this.x),Math.min(0,this.y),Math.max(0,this.x),Math.max(0,this.y))}get slope(){let t=Math.atan2(this.y,this.x);return t<0&&(t=Me+t),t}get length(){return Math.sqrt(this.dot(this))}equalTo(t){return Et(this.x,t.x)&&Et(this.y,t.y)}multiply(t){return new W(t*this.x,t*this.y)}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}normalize(){if(!Bt(this.length))return new W(this.x/this.length,this.y/this.length);throw ae.ZERO_DIVISION}rotate(t,e=D.EMPTY){if(e.x===0&&e.y===0)return this.transform(new Jt().rotate(t));throw ae.OPERATION_IS_NOT_SUPPORTED}transform(t){return new W(t.transform(this.x,this.y))}rotate90CW(){return new W(-this.y,this.x)}rotate90CCW(){return new W(this.y,-this.x)}invert(){return new W(-this.x,-this.y)}add(t){return new W(this.x+t.x,this.y+t.y)}subtract(t){return new W(this.x-t.x,this.y-t.y)}angleTo(t){let e=this.normalize(),r=t.normalize(),i=Math.atan2(e.cross(r),e.dot(r));return i<0&&(i+=Me),i}projectionOn(t){let e=t.normalize(),r=this.dot(e);return e.multiply(r)}}W.EMPTY=Object.freeze(new W(0,0));const fs=(n,t)=>new W(n,t);class et extends Ke{constructor(...t){if(super(),this.pt=new D,this.norm=new W(0,1),t.length!==0){if(t.length===1&&t[0]instanceof Object&&t[0].name==="line"){let{pt:e,norm:r}=t[0];this.pt=new D(e),this.norm=new W(r);return}if(t.length===2){let e=t[0],r=t[1];if(e instanceof D&&r instanceof D){this.pt=e,this.norm=et.points2norm(e,r),this.norm.dot(fs(this.pt.x,this.pt.y))>=0&&this.norm.invert();return}if(e instanceof D&&r instanceof W){if(Bt(r.x)&&Bt(r.y))throw ae.ILLEGAL_PARAMETERS;this.pt=e.clone(),this.norm=r.clone(),this.norm=this.norm.normalize(),this.norm.dot(fs(this.pt.x,this.pt.y))>=0&&this.norm.invert();return}if(e instanceof W&&r instanceof D){if(Bt(e.x)&&Bt(e.y))throw ae.ILLEGAL_PARAMETERS;this.pt=r.clone(),this.norm=e.clone(),this.norm=this.norm.normalize(),this.norm.dot(fs(this.pt.x,this.pt.y))>=0&&this.norm.invert();return}}throw ae.ILLEGAL_PARAMETERS}}clone(){return new et(this.pt,this.norm)}get tag(){return Qt.Line}get center(){return this.pt}get start(){}get end(){}get length(){return Number.POSITIVE_INFINITY}get box(){return new At(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY)}get middle(){}get slope(){return new W(this.norm.y,-this.norm.x).slope}get standard(){const t=this.norm.x,e=this.norm.y,r=this.norm.dot(fs(this.pt.x,this.pt.y));return[t,e,r]}parallelTo(t){return Bt(this.norm.cross(t.norm))}incidentTo(t){return this.parallelTo(t)&&this.pt.on(t)}contains(t){if(this.pt.equalTo(t))return!0;let e=new W(this.pt,t);return Bt(this.norm.dot(e))}coord(t){return fs(t.x,t.y).cross(this.norm)}intersect(t){if(t instanceof D)return this.contains(t)?[t]:[];if(t instanceof et)return Vi(this,t);if(t instanceof ne)return x0(t,this);if(t instanceof Q)return $r(this,t);if(t instanceof At)return Da(this,t);if(t instanceof U)return Os(t,this);if(t instanceof ut)return Ba(this,t);if(t instanceof Tt)return Fs(this,t)}distanceTo(t){if(t instanceof D){let[e,r]=Pn(t,this);return r=r.reverse(),[e,r]}if(t instanceof Q){let[e,r]=A0(t,this);return r=r.reverse(),[e,r]}if(t instanceof U){let[e,r]=C0(t,this);return[e,r.reverse()]}if(t instanceof ut){let[e,r]=N0(t,this);return[e,r.reverse()]}if(t instanceof Tt){let[e,r]=Bs(this,t);return[e,r]}}split(t){if(t instanceof D)return[new ne(t,this.norm.invert()),new ne(t,this.norm)];{let e=new ke([this]),r=this.sortPoints(t);return e.split(r),e.toShapes()}}rotate(t,e=new D){return new et(this.pt.rotate(t,e),this.norm.rotate(t))}transform(t){return new et(this.pt.transform(t),this.norm.clone())}sortPoints(t){return t.slice().sort((e,r)=>this.coord(e)<this.coord(r)?-1:this.coord(e)>this.coord(r)?1:0)}get name(){return"line"}static points2norm(t,e){if(t.equalTo(e))throw ae.ILLEGAL_PARAMETERS;return new W(t,e).normalize().rotate90CW()}}class ne extends Ke{constructor(t,e){super(),this.pt=t??D.EMPTY,this.norm=e??new W(0,1)}clone(){return new ne(this.pt,this.norm)}get tag(){return Qt.Ray}get name(){return"ray"}get center(){return this.pt}get slope(){return new W(this.norm.y,-this.norm.x).slope}get box(){let t=this.slope;return new At(t>Math.PI/2&&t<3*Math.PI/2?Number.NEGATIVE_INFINITY:this.pt.x,t>=0&&t<=Math.PI?this.pt.y:Number.NEGATIVE_INFINITY,t>=Math.PI/2&&t<=3*Math.PI/2?this.pt.x:Number.POSITIVE_INFINITY,t>=Math.PI&&t<=2*Math.PI||t===0?this.pt.y:Number.POSITIVE_INFINITY)}get start(){return this.pt}get end(){}get length(){return Number.POSITIVE_INFINITY}coord(t){return new W(t.x,t.y).cross(this.norm)}contains(t){if(this.pt.equalTo(t))return!0;const e=new W(this.pt,t);return Bt(this.norm.dot(e))&&Nn(e.cross(this.norm),0)}split(t){return this.contains(t)?this.pt.equalTo(t)?[this]:[new U(this.pt,t),new ne(t,this.norm)]:[]}intersect(t){if(t instanceof D)return this.contains(t)?[t]:[];if(t instanceof U)return v0(this,t);if(t instanceof ut)return b0(this,t);if(t instanceof et)return x0(this,t);if(t instanceof ne)return sE(this,t);if(t instanceof Q)return _0(this,t);if(t instanceof At)return iE(this,t);if(t instanceof Tt)return S0(this,t);throw new Error("unimplemented")}rotate(t,e=D.EMPTY){return new ne(this.pt.rotate(t,e),this.norm.rotate(t))}transform(t){return new ne(this.pt.transform(t),this.norm.clone())}}function vs(n,t){let e=new ne(t),r=new et(e.pt,e.norm);const i=new At(e.box.xmin-Zo(),e.box.ymin-Zo(),e.box.xmax,e.box.ymax+Zo());if(!n.box.intersect(i))return xt.OUTSIDE;let o=n.edges.search(i);if(o.length==0)return xt.OUTSIDE;for(let u of o)if(u.shape.contains(t))return xt.BOUNDARY;let a=[];for(let u of o)for(let d of e.intersect(u.shape)){if(d.equalTo(t))return xt.BOUNDARY;a.push({pt:d,edge:u})}a.sort((u,d)=>Se(u.pt.x,d.pt.x)?-1:Bi(u.pt.x,d.pt.x)?1:0);let l=0;for(let u=0;u<a.length;u++){let d=a[u];if(d.pt.equalTo(d.edge.shape.start)){if(u>0&&d.pt.equalTo(a[u-1].pt)&&d.edge.prev===a[u-1].edge)continue;let g=d.edge.prev;for(;Bt(g.length);)g=g.prev;let y=g.shape.tangentInEnd(),m=d.pt.translate(y),w=d.edge.shape.tangentInStart(),v=d.pt.translate(w),_=m.leftTo(r),b=v.leftTo(r);(_&&!b||!_&&b)&&l++}else if(d.pt.equalTo(d.edge.shape.end)){if(u>0&&d.pt.equalTo(a[u-1].pt)&&d.edge.next===a[u-1].edge)continue;let g=d.edge.next;for(;Bt(g.length);)g=g.next;let y=g.shape.tangentInStart(),m=d.pt.translate(y),w=d.edge.shape.tangentInEnd(),v=d.pt.translate(w),_=m.leftTo(r),b=v.leftTo(r);(_&&!b||!_&&b)&&l++}else if(d.edge.shape instanceof U)l++;else{let g=d.edge.shape.box;Et(d.pt.y,g.ymin)||Et(d.pt.y,g.ymax)||l++}}return l%2==1?xt.INSIDE:xt.OUTSIDE}const fE=RegExp("T.F..FFF.|T.F...F.."),dE=RegExp("T........|.T.......|...T.....|....T...."),gE=RegExp("FT.......|F..T.....|F...T...."),pE=RegExp("T.F..F..."),mE=RegExp("T.F..F...|.TF..F...|..FT.F...|..F.TF...");class zi{constructor(){this.m=new Array(9).fill(void 0)}get I2I(){return this.m[0]}set I2I(t){this.m[0]=t}get I2B(){return this.m[1]}set I2B(t){this.m[1]=t}get I2E(){return this.m[2]}set I2E(t){this.m[2]=t}get B2I(){return this.m[3]}set B2I(t){this.m[3]=t}get B2B(){return this.m[4]}set B2B(t){this.m[4]=t}get B2E(){return this.m[5]}set B2E(t){this.m[5]=t}get E2I(){return this.m[6]}set E2I(t){this.m[6]=t}get E2B(){return this.m[7]}set E2B(t){this.m[7]=t}get E2E(){return this.m[8]}set E2E(t){this.m[8]=t}toString(){return this.m.reduce((t,e)=>e?e.length>0?t+"T":t+"F":t+"*","")}equal(){return fE.test(this.toString())}intersect(){return dE.test(this.toString())}touch(){return gE.test(this.toString())}inside(){return pE.test(this.toString())}covered(){return mE.test(this.toString())}}class Fu{constructor(t,e){this.first=t,this.last=e||this.first}[Symbol.iterator](){let t;return{next:()=>(t=t?t.next:this.first,{value:t,done:t===void 0})}}get size(){let t=0;for(let e of this)t++;return t}toArray(t=void 0,e=void 0){let r=[],i=t||this.first,o=e||this.last,a=i;if(a===void 0)return r;do r.push(a),a=a.next;while(a!==o.next);return r}append(t){return this.isEmpty()?this.first=t:(t.prev=this.last,this.last.next=t),this.last=t,this.last.next=void 0,this.first.prev=void 0,this}insert(t,e){if(this.isEmpty())this.first=t,this.last=t;else if(e==null)t.next=this.first,this.first.prev=t,this.first=t;else{let r=e.next;e.next=t,r&&(r.prev=t),t.prev=e,t.next=r,this.last===e&&(this.last=t)}return this.last.next=void 0,this.first.prev=void 0,this}remove(t){return t===this.first&&t===this.last?(this.first=void 0,this.last=void 0):(t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),t===this.first&&(this.first=t.next),t===this.last&&(this.last=t.prev)),this}isEmpty(){return this.first===void 0}static testInfiniteLoop(t){let e=t,r=t;do{if(e!=t&&e===r)throw ae.INFINITE_LOOP;e=e.next,r=r.next.next}while(e!=t)}}function Ri(n,t,e){let r=e.length,i=n.shape.split(t);if(i.length===0)return;let o=0;i[0]===null?o=0:i[1]===null?o=n.shape.length:o=i[0].length;let a=Eu;Et(o,0)&&(a|=va),Et(o,n.shape.length)&&(a|=xi);let l;o===1/0?l=i[0].coord(t):l=a&xi&&n.next.arc_length===0?0:n.arc_length+o,e.push({id:r,pt:t,arc_length:l,edge_before:n,edge_after:void 0,face:n.face,faceId:-1,is_vertex:a})}function Rs(n){n.int_points1_sorted=bs(n.int_points1),n.int_points2_sorted=bs(n.int_points2)}function bs(n){let t=new Map,e=0;for(let i of n)t.has(i.face)||(t.set(i.face,e),e++);for(let i of n)i.faceId=t.get(i.face);return n.slice().sort(yE)}function yE(n,t){return n.faceId<t.faceId?-1:n.faceId>t.faceId?1:n.arc_length<t.arc_length?-1:n.arc_length>t.arc_length?1:0}function Al(n,t){return t.slice().sort((e,r)=>n.coord(e.pt)<n.coord(r.pt)?-1:n.coord(e.pt)>n.coord(r.pt)?1:0)}function Du(n){if(n.int_points1.length<2)return;let t=!1,e,r,i,o;for(let a=0;a<n.int_points1_sorted.length;a++)if(n.int_points1_sorted[a].id!==-1){e=n.int_points1_sorted[a],r=n.int_points2[e.id];for(let l=a+1;l<n.int_points1_sorted.length&&(i=n.int_points1_sorted[l],!!Et(i.arc_length,e.arc_length));l++)i.id!==-1&&(o=n.int_points2[i.id],o.id!==-1&&i.edge_before===e.edge_before&&i.edge_after===e.edge_after&&o.edge_before===r.edge_before&&o.edge_after===r.edge_after&&(i.id=-1,o.id=-1,t=!0))}r=n.int_points2_sorted[0],e=n.int_points1[r.id];for(let a=1;a<n.int_points2_sorted.length;a++){let l=n.int_points2_sorted[a];if(l.id==-1)continue;if(r.id==-1||!Et(l.arc_length,r.arc_length)){r=l,e=n.int_points1[r.id];continue}let h=n.int_points1[l.id];h.edge_before===e.edge_before&&h.edge_after===e.edge_after&&l.edge_before===r.edge_before&&l.edge_after===r.edge_after&&(h.id=-1,l.id=-1,t=!0)}t&&(n.int_points1=n.int_points1.filter(a=>a.id>=0),n.int_points2=n.int_points2.filter(a=>a.id>=0),n.int_points1.forEach((a,l)=>a.id=l),n.int_points2.forEach((a,l)=>a.id=l))}function jl(n){for(let t of n)t.edge_before.bvStart=void 0,t.edge_before.bvEnd=void 0,t.edge_before.bv=void 0,t.edge_before.overlap=void 0,t.edge_after.bvStart=void 0,t.edge_after.bvEnd=void 0,t.edge_after.bv=void 0,t.edge_after.overlap=void 0;for(let t of n)t.edge_before.bvEnd=xt.BOUNDARY,t.edge_after.bvStart=xt.BOUNDARY}function tu(n,t){for(let e of n)e.edge_before.setInclusion(t),e.edge_after.setInclusion(t)}function wE(n){let t,e,r,i=n.int_points1.length;for(let o=0;o<i;o++){let a=n.int_points1_sorted[o];a.face!==t&&(e=o,t=a.face);let l=o,h=Li(n.int_points1_sorted,o,t),u;l+h<i&&n.int_points1_sorted[l+h].face===t?u=l+h:u=e;let d=Li(n.int_points1_sorted,u,t);r=null;for(let b=u;b<u+d;b++){let N=n.int_points1_sorted[b];if(N.face===t&&n.int_points2[N.id].face===n.int_points2[a.id].face){r=N;break}}if(r===null)continue;let g=a.edge_after,y=r.edge_before;if(!(g.bv===xt.BOUNDARY&&y.bv===xt.BOUNDARY)||g!==y)continue;let m=n.int_points2[a.id],w=n.int_points2[r.id],v=m.edge_after,_=w.edge_before;v.bv===xt.BOUNDARY&&_.bv===xt.BOUNDARY&&v===_||(m=n.int_points2[r.id],w=n.int_points2[a.id],v=m.edge_after,_=w.edge_before),v.bv===xt.BOUNDARY&&_.bv===xt.BOUNDARY&&v===_&&g.setOverlap(v)}}function Li(n,t,e){let r,i,o=1;if(n.length==1)return 1;r=n[t];for(let a=t+1;a<n.length&&!(r.face!=e||(i=n[a],!(i.pt.equalTo(r.pt)&&i.edge_before===r.edge_before&&i.edge_after===r.edge_after)));a++)o++;return o}function ki(n,t){if(t){for(let e of t){let r=e.edge_before;if(e.is_vertex=Eu,r.shape.start&&r.shape.start.equalTo(e.pt)&&(e.is_vertex|=va),r.shape.end&&r.shape.end.equalTo(e.pt)&&(e.is_vertex|=xi),e.is_vertex&va){e.edge_before=r.prev,e.is_vertex=xi;continue}if(e.is_vertex&xi)continue;let i=n.addVertex(e.pt,r);e.edge_before=i}for(let e of t)e.edge_after=e.edge_before.next}}function Ig(n,t,e){let r=n.edge_before,i=t.edge_after;r.next=e,e.prev=r,e.next=i,i.prev=e}const{Inclusion:bt,Overlap:Mg}=h0,{START_VERTEX:Rg,END_VERTEX:Lg}=h0;var _e;(function(n){n[n.UNION=1]="UNION",n[n.INTERSECT=2]="INTERSECT",n[n.SUBTRACT=3]="SUBTRACT"})(_e||(_e={}));function kg(n,t){const e=t.clone().reverse();return $a(n,e,_e.SUBTRACT,!0)[0]}function vE(n,t){return $a(n,t,_e.INTERSECT,!0)[0]}function bE(n,t){let[e,r]=$a(n,t,_e.INTERSECT,!1),i=[];for(let a of e.faces)i=[...i,...[...a.edges].map(l=>l.shape)];let o=[];for(let a of r.faces)o=[...o,...[...a.edges].map(l=>l.shape)];return[i,o]}function Og(n,t){const[e]=$a(n,t,_e.SUBTRACT,!1);let r=[];for(let i of e.faces)r=[...r,...[...i.edges].map(o=>o.shape)];return r}function _E(n,t){let e=n.clone(),r=t.clone(),i=M0(e,r);Rs(i),ki(e,i.int_points1_sorted),ki(r,i.int_points2_sorted),Du(i),Rs(i);let o=i.int_points1_sorted.map(l=>l.pt),a=i.int_points2_sorted.map(l=>l.pt);return[o,a]}function xE(n,t,e,r){let i=Fg(n,e.int_points1),o=Fg(t,e.int_points2);for(Dg(i,t),Dg(o,n),jl(e.int_points1),jl(e.int_points2),tu(e.int_points1,t),tu(e.int_points2,n);CE(n,t,e.int_points1,e.int_points1_sorted,e.int_points2,e););wE(e),Bg(n,r,e.int_points1_sorted,!0),Bg(t,r,e.int_points2_sorted,!1),zg(n,i,r,!0),zg(t,o,r,!1)}function SE(n,t,e,r){PE(n,t,r,e.int_points2),AE(n,t,e),Vg(n,e.int_points1),Vg(t,e.int_points2),Gg(n,e.int_points1,e.int_points2),Gg(n,e.int_points2,e.int_points1)}function $a(n,t,e,r){let i=n.clone(),o=t.clone(),a=M0(i,o);return Rs(a),ki(i,a.int_points1_sorted),ki(o,a.int_points2_sorted),Du(a),Rs(a),xE(i,o,a,e),r&&SE(i,o,a,e),[i,o]}function M0(n,t){let e={int_points1:[],int_points2:[],int_points1_sorted:[],int_points2_sorted:[]};for(let r of n.edges){let i=t.edges.search(r.box);for(let o of i){let a=r.shape.intersect(o.shape);for(let l of a)Ri(r,l,e.int_points1),Ri(o,l,e.int_points2)}}return e}function Fg(n,t){let e=[];for(let r of n.faces)t.find(i=>i.face===r)||e.push(r);return e}function Dg(n,t){for(let e of n)e.first.bv=e.first.bvStart=e.first.bvEnd=void 0,e.first.setInclusion(t)}function CE(n,t,e,r,i,o){let a,l,h,u=r.length,d=!1;for(let g=0;g<u;g++){let y=r[g];y.face!==a&&(l=g,a=y.face);let m=g,w=Li(r,g,a),v;m+w<u&&r[m+w].face===a?v=m+w:v=l;let _=Li(r,v,a);h=null;for(let A=v;A<v+_;A++){let T=r[A];if(T.face===a&&i[T.id].face===i[y.id].face){h=T;break}}if(h===null)continue;let b=y.edge_after,N=h.edge_before;if(b.bv===bt.BOUNDARY&&N.bv!=bt.BOUNDARY){b.bv=N.bv;continue}if(b.bv!=bt.BOUNDARY&&N.bv===bt.BOUNDARY){N.bv=b.bv;continue}if(b.bv===bt.BOUNDARY&&N.bv===bt.BOUNDARY&&b!=N||b.bv===bt.INSIDE&&N.bv===bt.OUTSIDE||b.bv===bt.OUTSIDE&&N.bv===bt.INSIDE){let A=b.next;for(;A!=N;)A.bvStart=void 0,A.bvEnd=void 0,A.bv=void 0,A.setInclusion(t),A=A.next}if(b.bv===bt.BOUNDARY&&N.bv===bt.BOUNDARY&&b!=N){let A=b.next,T;for(;A!=N;){if(A.bv!=bt.BOUNDARY){if(T===void 0)T=A.bv;else if(A.bv!=T)throw ae.UNRESOLVED_BOUNDARY_CONFLICT}A=A.next}T!=null&&(b.bv=T,N.bv=T);continue}if(b.bv===bt.INSIDE&&N.bv===bt.OUTSIDE||b.bv===bt.OUTSIDE&&N.bv===bt.INSIDE){let A=b;for(;A!=N;){if(A.bvStart===b.bv&&A.bvEnd===N.bv){let[T,P]=A.shape.distanceTo(t);if(T<10*Zo()){Ri(A,P.start,e);let M=e[e.length-1];if(M.is_vertex&Rg)M.edge_after=A,M.edge_before=A.prev,A.bvStart=bt.BOUNDARY,A.bv=void 0,A.setInclusion(t);else if(M.is_vertex&Lg)M.edge_after=A.next,A.bvEnd=bt.BOUNDARY,A.bv=void 0,A.setInclusion(t);else{let V=t.addVertex(M.pt,A);M.edge_before=V,M.edge_after=V.next,V.setInclusion(t),V.next.bvStart=bt.BOUNDARY,V.next.bvEnd=void 0,V.next.bv=void 0,V.next.setInclusion(t)}let R=t.findEdgeByPoint(P.end);Ri(R,P.end,i);let O=i[i.length-1];if(O.is_vertex&Rg)O.edge_after=R,O.edge_before=R.prev;else if(O.is_vertex&Lg)O.edge_after=R.next;else{let V=i.find(G=>G.edge_after===R),$=t.addVertex(O.pt,R);O.edge_before=$,O.edge_after=$.next,V&&(V.edge_after=$),$.bvStart=void 0,$.bvEnd=bt.BOUNDARY,$.bv=void 0,$.setInclusion(n),$.next.bvStart=bt.BOUNDARY,$.next.bvEnd=void 0,$.next.bv=void 0,$.next.setInclusion(n)}Rs(o),d=!0;break}}A=A.next}if(d)break;throw ae.UNRESOLVED_BOUNDARY_CONFLICT}}return d}function Bg(n,t,e,r){if(!e)return;let i,o,a,l;for(let h=0;h<e.length;h++){if(a=e[h],a.face!==i&&(o=h,i=a.face),i.isEmpty())continue;let u=h,d=Li(e,h,i),g;u+d<e.length&&e[u+d].face===a.face?g=u+d:g=o,l=e[g];let y=g,m=Li(e,y,i),w=a.edge_after,v=l.edge_before;if(w.bv===bt.INSIDE&&v.bv===bt.INSIDE&&t===_e.UNION||w.bv===bt.OUTSIDE&&v.bv===bt.OUTSIDE&&t===_e.INTERSECT||(w.bv===bt.OUTSIDE||v.bv===bt.OUTSIDE)&&t===_e.SUBTRACT&&!r||(w.bv===bt.INSIDE||v.bv===bt.INSIDE)&&t===_e.SUBTRACT&&r||w.bv===bt.BOUNDARY&&v.bv===bt.BOUNDARY&&w.overlap&Mg.SAME&&r||w.bv===bt.BOUNDARY&&v.bv===bt.BOUNDARY&&w.overlap&Mg.OPPOSITE){n.removeChain(i,w,v);for(let _=u;_<u+d;_++)e[_].edge_after=void 0;for(let _=y;_<y+m;_++)e[_].edge_before=void 0}h+=d-1}}function PE(n,t,e,r){for(let i of t.faces){for(let o of i)n.edges.add(o);r.find(o=>o.face===i)===void 0&&n.addFace(i.first,i.last)}}function AE(n,t,e){if(e.int_points1.length!==0)for(let r=0;r<e.int_points1.length;r++){let i=e.int_points1[r],o=e.int_points2[r];if(i.edge_before!==void 0&&i.edge_after===void 0&&o.edge_before===void 0&&o.edge_after!==void 0&&(i.edge_before.next=o.edge_after,o.edge_after.prev=i.edge_before,i.edge_after=o.edge_after,o.edge_before=i.edge_before),o.edge_before!==void 0&&o.edge_after===void 0&&i.edge_before===void 0&&i.edge_after!==void 0&&(o.edge_before.next=i.edge_after,i.edge_after.prev=o.edge_before,o.edge_after=i.edge_after,i.edge_before=o.edge_before),i.edge_before!==void 0&&i.edge_after===void 0)for(let a of e.int_points1_sorted)a!==i&&a.edge_before===void 0&&a.edge_after!==void 0&&a.pt.equalTo(i.pt)&&(i.edge_before.next=a.edge_after,a.edge_after.prev=i.edge_before,i.edge_after=a.edge_after,a.edge_before=i.edge_before);if(o.edge_before!==void 0&&o.edge_after===void 0)for(let a of e.int_points2_sorted)a!==o&&a.edge_before===void 0&&a.edge_after!==void 0&&a.pt.equalTo(o.pt)&&(o.edge_before.next=a.edge_after,a.edge_after.prev=o.edge_before,o.edge_after=a.edge_after,a.edge_before=o.edge_before)}}function Vg(n,t){for(let e of t)n.faces.delete(e.face),e.face=void 0,e.edge_before&&(e.edge_before.face=void 0),e.edge_after&&(e.edge_after.face=void 0)}function Gg(n,t,e){for(let r of t){if(r.edge_before===void 0||r.edge_after===void 0||r.face||r.edge_after.face||r.edge_before.face)continue;let i=r.edge_after,o=r.edge_before;Fu.testInfiniteLoop(i);let a=n.addFace(i,o);for(let l of t)l.edge_before&&l.edge_after&&l.edge_before.face===a&&l.edge_after.face===a&&(l.face=a);for(let l of e)l.edge_before&&l.edge_after&&l.edge_before.face===a&&l.edge_after.face===a&&(l.face=a)}}function zg(n,t,e,r){for(let i of t){let o=i.first.bv;(e===_e.UNION&&o===bt.INSIDE||e===_e.SUBTRACT&&o===bt.INSIDE&&r||e===_e.SUBTRACT&&o===bt.OUTSIDE&&!r||e===_e.INTERSECT&&o===bt.OUTSIDE)&&n.deleteFace(i)}}class ke extends Fu{constructor(t){if(super(),t instanceof Array){let e=t;if(e.length==0)return;if(!e.every(i=>i instanceof U||i instanceof ut||i instanceof ne||i instanceof et))throw new Error("invalid shapes");for(let i of e){let o=new Le(i);this.append(o)}}}get edges(){return[...this]}get box(){return this.edges.reduce((t,e)=>t=t.merge(e.box),new At)}get vertices(){let t=this.edges.map(e=>e.start);return t.push(this.last.end),t}clone(){return new ke(this.toShapes())}addVertex(t,e){let r=e.shape.split(t);if(r[0]===null)return e.prev;if(r[1]===null)return e;let i=new Le(r[0]),o=e.prev;return this.insert(i,o),e.shape=r[1],i}split(t){for(let e of t){let r=this.findEdgeByPoint(e);this.addVertex(e,r)}return this}findEdgeByPoint(t){let e;for(let r of this)if(r.shape.contains(t)){e=r;break}return e}translate(t){return new ke(this.edges.map(e=>e.shape.translate(t)))}rotate(t=0,e=new D){return new ke(this.edges.map(r=>r.shape.rotate(t,e)))}transform(t=new Jt){return new ke(this.edges.map(e=>e.shape.transform(t)))}toShapes(){return this.edges.map(t=>t.shape.clone())}toJSON(){return this.edges.map(t=>t.toJSON())}}ke.EMPTY=Object.freeze(new ke([]));function NE(n,t){return EE(n,t).covered()}function TE(n,t){return NE(t,n)}function EE(n,t){if(n instanceof et&&t instanceof et)return IE(n,t);if(n instanceof et&&t instanceof Q)return ME(n,t);if(n instanceof et&&t instanceof At)return RE(n,t);if(n instanceof et&&t instanceof Tt)return LE(n,t);if((n instanceof U||n instanceof ut)&&t instanceof Tt)return $g(n,t);if((n instanceof U||n instanceof ut)&&(t instanceof Q||t instanceof At))return $g(n,new Tt(t));if(n instanceof Tt&&t instanceof Tt)return Ho(n,t);if((n instanceof Q||n instanceof At)&&(t instanceof Q||t instanceof At))return Ho(new Tt(n),new Tt(t));if((n instanceof Q||n instanceof At)&&t instanceof Tt)return Ho(new Tt(n),t);if(n instanceof Tt&&(t instanceof Q||t instanceof At))return Ho(n,new Tt(t))}function IE(n,t){let e=new zi,r=Vi(n,t);return r.length===0?n.contains(t.pt)&&t.contains(n.pt)?(e.I2I=[n],e.I2E=[],e.E2I=[]):(e.I2I=[],e.I2E=[n],e.E2I=[t]):(e.I2I=r,e.I2E=n.split(r),e.E2I=t.split(r)),e}function ME(n,t){let e=new zi,r=$r(n,t);if(r.length===0)e.I2I=[],e.I2B=[],e.I2E=[n],e.E2I=[t];else if(r.length===1)e.I2I=[],e.I2B=r,e.I2E=n.split(r),e.E2I=[t];else{let i=new ke([n]),o=n.sortPoints(r);i.split(o);let a=i.toShapes();e.I2I=[a[1]],e.I2B=o,e.I2E=[a[0],a[2]],e.E2I=new Tt([t.toArc()]).cut(i)}return e}function RE(n,t){let e=new zi,r=Da(n,t);if(r.length===0)e.I2I=[],e.I2B=[],e.I2E=[n],e.E2I=[t];else if(r.length===1)e.I2I=[],e.I2B=r,e.I2E=n.split(r),e.E2I=[t];else{let i=new ke([n]),o=n.sortPoints(r);i.split(o);let a=i.toShapes();t.toSegments().some(l=>l.contains(r[0])&&l.contains(r[1]))?(e.I2I=[],e.I2B=[a[1]],e.I2E=[a[0],a[2]],e.E2I=[t]):(e.I2I=[a[1]],e.I2B=o,e.I2E=[a[0],a[2]],e.E2I=new Tt(t.toSegments()).cut(i))}return e}function LE(n,t){let e=new zi,r=Fs(n,t),i=new ke([n]),o=r.length>0?r.slice():n.sortPoints(r);return i.split(o),[...i].forEach(a=>a.setInclusion(t)),e.I2I=[...i].filter(a=>a.bv===xt.INSIDE).map(a=>a.shape),e.I2B=[...i].slice(1).map(a=>a.bv===xt.BOUNDARY?a.shape:a.shape.start),e.I2E=[...i].filter(a=>a.bv===xt.OUTSIDE).map(a=>a.shape),e.E2I=t.cut(i),e}function $g(n,t){let e=new zi,r=rE(n,t),i=r.length>0?r.slice():n.sortPoints(r),o=new ke([n]);o.split(i),[...o].forEach(a=>a.setInclusion(t)),e.I2I=[...o].filter(a=>a.bv===xt.INSIDE).map(a=>a.shape),e.I2B=[...o].slice(1).map(a=>a.bv===xt.BOUNDARY?a.shape:a.shape.start),e.I2E=[...o].filter(a=>a.bv===xt.OUTSIDE).map(a=>a.shape),e.B2I=[],e.B2B=[],e.B2E=[];for(let a of[n.start,n.end])switch(vs(t,a)){case xt.INSIDE:e.B2I.push(a);break;case xt.BOUNDARY:e.B2B.push(a);break;case xt.OUTSIDE:e.B2E.push(a);break}return e}function Ho(n,t){let e=new zi,[r]=_E(n,t),i=vE(n,t),o=kg(n,t),a=kg(t,n),[l,h]=bE(n,t),u=Og(n,t),d=Og(t,n);return e.I2I=i.isEmpty()?[]:[i],e.I2B=h,e.I2E=o.isEmpty()?[]:[o],e.B2I=l,e.B2B=r,e.B2E=u,e.E2I=a.isEmpty()?[]:[a],e.E2B=d,e}const kE=n=>Array.isArray(n)&&n.length===2&&typeof n[0]=="number"&&typeof n[1]=="number",Wg=n=>Array.isArray(n)&&(n.length===0||n[0]instanceof D||kE(n[0]));class Tt extends Ke{constructor(t){if(super(),this.faces=new Mi,this.edges=new Mi,Array.isArray(t)){if(t.length!==0)if(Wg(t))this.faces.add(new Re(this,t));else if(t[0].tag<=oE)this.faces.add(new Re(this,t));else for(let e of t)if(Array.isArray(e)&&Wg(e[0]))for(let r of e)this.faces.add(new Re(this,r));else this.faces.add(new Re(this,e))}else t instanceof At?this.faces.add(new Re(this,t)):t instanceof Q?this.faces.add(new Re(this,t)):t instanceof vn&&this.faces.add(new Re(this,t))}get tag(){return Qt.Polygon}get name(){return"polygon"}get parts(){return Array.from(this.edges).map(t=>t.shape)}get box(){return[...this.faces].reduce((t,e)=>t.merge(e.box),At.VOID)}get center(){return this.box.center}get vertices(){return[...this.edges].map(t=>t.start)}clone(){const t=new Tt;for(let e of this.faces)t.addFace(e.shapes);return t}isEmpty(){return this.edges.size===0}isValid(){for(let t of this.faces)if(!t.isSimple(this.edges))return!1;return!0}area(){const t=[...this.faces].reduce((e,r)=>e+r.signedArea(),0);return Math.abs(t)}addFace(t,e){let r=new Re(this,t,e);return this.faces.add(r),r}deleteFace(t){for(let e of t)this.edges.delete(e);return this.faces.delete(t)}recreateFaces(){this.faces.clear();for(let r of this.edges)r.face=null;let t,e=!0;for(;e;){e=!1;for(let r of this.edges)if(r.face===null){t=r,e=!0;break}if(e){let r=t;do r=r.next;while(r.next!==t);this.addFace(t,r)}}}removeChain(t,e,r){if(r.next===e){this.deleteFace(t);return}for(let i=e;i!==r.next;i=i.next)if(t.remove(i),this.edges.delete(i),t.isEmpty()){this.deleteFace(t);break}}addVertex(t,e){let r=e.shape.split(t);if(r[0]===null)return e.prev;if(r[1]===null)return e;let i=new Le(r[0]),o=e.prev;return e.face.insert(i,o),this.edges.delete(e),this.edges.add(i),e.shape=r[1],this.edges.add(e),i}removeEndVertex(t){const e=t.next;e!==t&&(t.face.mergeWithNextEdge(t),this.edges.delete(e))}cut(t){let e=[this.clone()];for(const r of t){if(r.setInclusion(this)!==xt.INSIDE)continue;const i=r.shape.start,o=r.shape.end,a=[];for(const l of e)if(l.findEdgeByPoint(i)===void 0)a.push(l);else{const[h,u]=l.cutFace(i,o);a.push(h,u)}e=a}return e}cutFace(t,e){let r=this.findEdgeByPoint(t),i=this.findEdgeByPoint(e);if(r.face!==i.face)return[];let o=this.addVertex(t,r);i=this.findEdgeByPoint(e);let a=this.addVertex(e,i),l=o.face,h=new Le(new U(o.end,a.end)),u=new Le(new U(a.end,o.end));o.next.prev=u,u.next=o.next,o.next=h,h.prev=o,a.next.prev=h,h.next=a.next,a.next=u,u.prev=a,this.edges.add(h),this.edges.add(u);let d=this.addFace(h,o),g=this.addFace(u,a);return this.faces.delete(l),[d.toPolygon(),g.toPolygon()]}cutWithLine(t){let e=this.clone(),r=new ke([t]),i={int_points1:[],int_points2:[],int_points1_sorted:[],int_points2_sorted:[]};for(let l of e.edges){let h=m0(l,t);for(let u of h)Ri(r.first,u,i.int_points1),Ri(l,u,i.int_points2)}if(i.int_points1.length===0)return e;i.int_points1_sorted=Al(t,i.int_points1),i.int_points2_sorted=bs(i.int_points2),ki(r,i.int_points1_sorted),ki(e,i.int_points2_sorted),Du(i),i.int_points1_sorted=Al(t,i.int_points1),i.int_points2_sorted=bs(i.int_points2),jl(i.int_points1),tu(i.int_points1,e);for(let l of i.int_points1_sorted)l.edge_before.bv===l.edge_after.bv&&(i.int_points2[l.id]=-1,l.id=-1);if(i.int_points1=i.int_points1.filter(l=>l.id>=0),i.int_points2=i.int_points2.filter(l=>l.id>=0),i.int_points1.length===0)return e;i.int_points1_sorted=Al(t,i.int_points1),i.int_points2_sorted=bs(i.int_points2);let o=i.int_points1[0],a;for(let l of i.int_points1_sorted)l.edge_before.bv===xt.INSIDE&&(a=new Le(new U(o.pt,l.pt)),Ig(i.int_points2[o.id],i.int_points2[l.id],a),e.edges.add(a),a=new Le(new U(l.pt,o.pt)),Ig(i.int_points2[l.id],i.int_points2[o.id],a),e.edges.add(a)),o=l;return e.recreateFaces(),e}findEdgeByPoint(t){let e;for(let r of this.faces)if(e=r.findEdgeByPoint(t),e!==void 0)break;return e}splitToIslands(){if(this.isEmpty())return[];let t=this.toArray();t.sort((i,o)=>o.area()-i.area());let e=[...t[0].faces][0].orientation(),r=t.filter(i=>[...i.faces][0].orientation()===e);for(let i of t){let o=[...i.faces][0];if(o.orientation()!==e){for(let a of r)if(o.shapes.every(l=>a.contains(l))){a.addFace(o.shapes);break}}}return r}reverse(){for(let t of this.faces)t.reverse();return this}contains(t){if(t instanceof D){let e=vs(this,t);return e===xt.INSIDE||e===xt.BOUNDARY}else return TE(this,t)}distanceTo(t){if(t instanceof D){let[e,r]=E0(t,this);return r=r.reverse(),[e,r]}if(t instanceof Q||t instanceof et||t instanceof U||t instanceof ut){let[e,r]=Bs(t,this);return r=r.reverse(),[e,r]}if(t instanceof Tt){let e=[Number.POSITIVE_INFINITY,U.EMPTY];for(let r of this.edges){let i=e[0];const[o,a]=za(r.shape,t.edges,i);Se(o,i)&&(e=[o,a])}return e}throw new Error("unimplemented")}intersect(t){if(t instanceof D)return this.contains(t)?[t]:[];if(t instanceof et)return Fs(t,this);if(t instanceof ne)return S0(t,this);if(t instanceof Q)return y0(t,this);if(t instanceof U)return Mu(t,this);if(t instanceof ut)return Ru(t,this);if(t instanceof Tt)return nE(t,this);throw new Error("unimplemented")}translate(t,e){const r=new W(t,e),i=new Tt;for(let o of this.faces)i.addFace(o.shapes.map(a=>a.translate(r)));return i}rotate(t=0,e=new D){let r=new Tt;for(let i of this.faces)r.addFace(i.shapes.map(o=>o.rotate(t,e)));return r}scale(t,e){const r=new Tt;for(let i of this.faces)r.addFace(i.shapes.map(o=>o.scale(t,e)));return r}transform(t=Jt.IDENTITY){const e=new Tt;for(let r of this.faces)e.addFace(r.shapes.map(i=>i.transform(t)));return e}toJSON(){return{name:this.name,faces:[...this.faces].map(t=>t.toJSON())}}toArray(){return[...this.faces].map(t=>t.toPolygon())}}Tt.EMPTY=Object.freeze(new Tt([]));class Q extends Ke{constructor(t,e,r){var i,o,a;if(super(),this.pc=D.EMPTY,this.r=NaN,this.r=1,t instanceof Q)this.pc=new D(t.pc),this.r=t.r;else if(t instanceof D)this.pc=t,this.r=(i=e)!==null&&i!==void 0?i:1;else if(typeof t=="object"&&t!==null)this.pc=new D(t),this.r=(o=e)!==null&&o!==void 0?o:1;else if(typeof t=="number")this.pc=new D(t,e),this.r=(a=r)!==null&&a!==void 0?a:1;else throw ae.ILLEGAL_PARAMETERS}clone(){return new Q(this.pc.clone(),this.r)}get tag(){return Qt.Circle}get name(){return"circle"}get box(){return new At(this.pc.x-this.r,this.pc.y-this.r,this.pc.x+this.r,this.pc.y+this.r)}get center(){return this.pc}contains(t){if(t instanceof D)return rn(t.distanceTo(this.center)[0],this.r);if(t instanceof U)return rn(t.start.distanceTo(this.center)[0],this.r)&&rn(t.end.distanceTo(this.center)[0],this.r);if(t instanceof ut)return this.intersect(t).length===0&&rn(t.start.distanceTo(this.center)[0],this.r)&&rn(t.end.distanceTo(this.center)[0],this.r);if(t instanceof Q)return this.intersect(t).length===0&&rn(t.r,this.r)&&rn(t.center.distanceTo(this.center)[0],this.r);throw new Error("unimplemented")}toArc(t=!0){return new ut(this.center,this.r,Math.PI,-Math.PI,t)}scale(t,e){if(e!==void 0&&t!==e)throw ae.OPERATION_IS_NOT_SUPPORTED;return new Q(this.pc,this.r*t)}transform(t=new Jt){return new Q(this.pc.transform(t),this.r)}intersect(t){if(t instanceof D)return this.contains(t)?[t]:[];if(t instanceof et)return $r(t,this);if(t instanceof ne)return _0(t,this);if(t instanceof U)return Va(t,this);if(t instanceof Q)return f0(t,this);if(t instanceof At)return QT(this,t);if(t instanceof ut)return Iu(t,this);if(t instanceof Tt)return y0(this,t);throw new Error("unimplemented")}distanceTo(t){if(t instanceof D)return ws(Ye(t,this));if(t instanceof Q)return Ou(this,t);if(t instanceof et)return A0(this,t);if(t instanceof U)return ws(P0(t,this));if(t instanceof ut)return ws(T0(t,this));if(t instanceof Tt)return Bs(this,t);if(t instanceof Mi)return za(this,t);throw new Error("unimplemented")}}Q.EMPTY=Object.freeze(new Q(D.EMPTY,0));class ut extends Ke{constructor(t,e,r,i,o){if(super(),this.pc=D.EMPTY,this.r=NaN,this.startAngle=NaN,this.endAngle=NaN,this._start=null,this._end=null,this.r=1,this.startAngle=0,this.endAngle=Me,this.clockwise=Fa,t!==void 0)if(t instanceof Object&&t.name==="arc"){const{pc:a,r:l,startAngle:h,endAngle:u,clockwise:d}=t;this.pc=new D(a.x,a.y),this.r=l,this.startAngle=h,this.endAngle=u,this.clockwise=d}else t!==void 0&&(this.pc=t),e!==void 0&&(this.r=e),r!==void 0&&(this.startAngle=r),i!==void 0&&(this.endAngle=i),o!==void 0&&(this.clockwise=o)}clone(){return new ut(this.pc.clone(),this.r,this.startAngle,this.endAngle,this.clockwise)}get tag(){return Qt.Arc}get box(){let e=this.breakToFunctional().reduce((r,i)=>r.merge(i.start.box),new At);return e=e.merge(this.end.box),e}get center(){return this.pc}get sweep(){if(Et(this.startAngle,this.endAngle))return 0;if(Et(Math.abs(this.startAngle-this.endAngle),Me))return Me;let t;return this.clockwise?t=this.endAngle>this.startAngle?this.endAngle-this.startAngle:this.endAngle-this.startAngle+Me:t=this.startAngle>this.endAngle?this.startAngle-this.endAngle:this.startAngle-this.endAngle+Me,t>Me&&(t-=Me),t<0&&(t+=Me),t}get start(){var t;return(t=this._start)!==null&&t!==void 0?t:this._start=new D(this.pc.x+this.r,this.pc.y).rotate(this.startAngle,this.pc)}set start(t){this._start=t}get end(){var t;return(t=this._end)!==null&&t!==void 0?t:this._end=new D(this.pc.x+this.r,this.pc.y).rotate(this.endAngle,this.pc)}set end(t){this._end=t}get vertices(){return[this.start,this.end]}get length(){return Math.abs(this.sweep*this.r)}contains(t){if(!Et(this.pc.distanceTo(t)[0],this.r))return!1;if(t.equalTo(this.start))return!0;let e=new W(this.pc,t).slope,r=new ut(this.pc,this.r,this.startAngle,e,this.clockwise);return rn(r.length,this.length)}split(t){if(this.start.equalTo(t))return[null,this.clone()];if(this.end.equalTo(t))return[this.clone(),null];let e=new W(this.pc,t).slope;return[new ut(this.pc,this.r,this.startAngle,e,this.clockwise),new ut(this.pc,this.r,e,this.endAngle,this.clockwise)]}splitAtLength(t){if(Bt(t))return[null,this.clone()];if(Et(t,this.length))return[this.clone(),null];const e=this.startAngle+(this.clockwise?1:-1)*this.sweep*(t/this.length);return[new ut(this.pc,this.r,this.startAngle,e,this.clockwise),new ut(this.pc,this.r,e,this.endAngle,this.clockwise)]}middle(){let t=this.clockwise?this.startAngle+this.sweep/2:this.startAngle-this.sweep/2;return new ut(this.pc,this.r,this.startAngle,t,this.clockwise).end}pointAtLength(t){if(t>this.length||t<0)return null;if(t===0)return this.start;if(t===this.length)return this.end;let e=t/this.length,r=this.clockwise?this.startAngle+this.sweep*e:this.startAngle-this.sweep*e;return new ut(this.pc,this.r,this.startAngle,r,this.clockwise).end}chordHeight(){return(1-Math.cos(Math.abs(this.sweep/2)))*this.r}intersect(t){if(t instanceof D)return this.contains(t)?[t]:[];if(t instanceof et)return Ba(t,this);if(t instanceof ne)return b0(t,this);if(t instanceof Q)return Iu(this,t);if(t instanceof U)return Wr(t,this);if(t instanceof At)return ZT(this,t);if(t instanceof ut)return d0(this,t);if(t instanceof Tt)return Ru(this,t);throw new Error("unimplemented")}distanceTo(t){if(t instanceof D)return aE(this,t);if(t instanceof Q)return T0(this,t);if(t instanceof et)return N0(this,t);if(t instanceof U)return cE(this,t);if(t instanceof ut)return lE(this,t);if(t instanceof Tt)return Bs(this,t);if(t instanceof Mi)return za(this,t)}breakToFunctional(){let t=[],e=[0,Math.PI/2,Me/2,3*Math.PI/2],r=[this.pc.translate(this.r,0),this.pc.translate(0,this.r),this.pc.translate(-this.r,0),this.pc.translate(0,-this.r)],i=[];for(let o=0;o<4;o++)r[o].on(this)&&i.push(new ut(this.pc,this.r,this.startAngle,e[o],this.clockwise));if(i.length===0)t.push(this.clone());else{i.sort((l,h)=>l.length-h.length);for(let l=0;l<i.length;l++){let h=t.length>0?t[t.length-1]:void 0,u;h?u=new ut(this.pc,this.r,h.endAngle,i[l].endAngle,this.clockwise):u=new ut(this.pc,this.r,this.startAngle,i[l].endAngle,this.clockwise),Bt(u.length)||t.push(u.clone())}let o=t.length>0?t[t.length-1]:void 0,a;o?a=new ut(this.pc,this.r,o.endAngle,this.endAngle,this.clockwise):a=new ut(this.pc,this.r,this.startAngle,this.endAngle,this.clockwise),!Bt(a.length)&&!Et(a.sweep,2*Math.PI)&&t.push(a.clone())}return t}tangentInStart(){let t=new W(this.pc,this.start),e=this.clockwise?Math.PI/2:-Math.PI/2;return t.rotate(e).normalize()}tangentInEnd(){let t=new W(this.pc,this.end),e=this.clockwise?-Math.PI/2:Math.PI/2;return t.rotate(e).normalize()}reverse(){return new ut(this.pc,this.r,this.endAngle,this.startAngle,!this.clockwise)}transform(t=new Jt){let e=this.start.transform(t),r=this.end.transform(t),i=this.pc.transform(t),o=this.clockwise;return t.a*t.d<0&&(o=!o),ut.arcSE(i,e,r,o)}static arcSE(t,e,r,i){let o=new W(t,e).slope,a=new W(t,r).slope;Et(o,a)&&(a+=Me,i=!0);let l=new W(t,e).length;return new ut(t,l,o,a,i)}definiteIntegral(t=0){return this.breakToFunctional().reduce((i,o)=>i+o.circularSegmentDefiniteIntegral(t),0)}circularSegmentDefiniteIntegral(t){let e=new et(this.start,this.end),r=this.pc.leftTo(e),o=new U(this.start,this.end).definiteIntegral(t),a=this.circularSegmentArea();return r?o-a:o+a}circularSegmentArea(){return .5*this.r*this.r*(this.sweep-Math.sin(this.sweep))}sortPoints(t){return t.slice().sort((e,r)=>{let i=new W(this.pc,e).slope,o=new W(this.pc,r).slope;return i<o?-1:i>o?1:0})}get name(){return"arc"}}ut.EMPTY=Object.freeze(new ut(D.EMPTY,0,0,0,Fa));function R0(n,t,e){return n*(1-e)+t*e}const L0={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(n,t=20){if(!this.adaptive||!n||isNaN(n))return t;let e=Math.ceil(n/this.maxLength);return e<this.minSegments?e=this.minSegments:e>this.maxSegments&&(e=this.maxSegments),e}};function _a(n,t){let e=0,r=n.length/4,i=e+Math.floor((r-e)/2);for(;;){const o=n[i*4+3];t>o?e=i:r=i;const a=e+Math.floor((r-e)/2);if(a===i)break;i=a}return i}function k0(n){let t=n[0],e=n[0],r=n[1],i=n[1];for(let o=0;o<n.length;o+=4){const a=n[o+0],l=n[o+1];a>e&&(e=a),a<t&&(t=a),l>i&&(i=l),l<r&&(r=l)}return new At(t,r,e,i)}const O0={curveLength(n,t,e,r,i,o){const a=n-2*e+i,l=t-2*r+o,h=2*e-2*n,u=2*r-2*t,d=4*(a*a+l*l),g=4*(a*h+l*u),y=h*h+u*u,m=2*Math.sqrt(d+g+y),w=Math.sqrt(d),v=2*d*w,_=2*Math.sqrt(y),b=g/w;return(v*m+w*g*(m-_)+(4*y*d-g*g)*Math.log((2*w+b+m)/(b+_)))/(4*v)},generateLUT(n,t,e,r,i,o){const a=[],l=L0._segmentsCount(O0.curveLength(n,t,e,r,i,o));let h=0,u=0,d=0,g=n,y=t,m=0;a.push(n,t,h,m);for(let w=1;w<=l;++w){const v=w/l;u=n+(e-n)*v,d=t+(r-t)*v;const _=u+(e+(i-e)*v-u)*v,b=d+(r+(o-r)*v-d)*v,N=_-g,A=b-y;m+=Math.sqrt(N*N+A*A),a.push(_,b,v,m),g=_,y=b}return a}},F0={curveLength(n,t,e,r,i,o,a,l){let u=0,d=0,g=0,y=0,m=0,w=0,v=0,_=0,b=0,N=0,A=0,T=n,P=t;for(let M=1;M<=10;++M)d=M/10,g=d*d,y=g*d,m=1-d,w=m*m,v=w*m,_=v*n+3*w*d*e+3*m*g*i+y*a,b=v*t+3*w*d*r+3*m*g*o+y*l,N=T-_,A=P-b,T=_,P=b,u+=Math.sqrt(N*N+A*A);return u},generateLUT(n,t,e,r,i,o,a,l){const h=[],u=L0._segmentsCount(F0.curveLength(n,t,e,r,i,o,a,l));let d=0,g=0,y=0,m=0,w=0,v=n,_=t,b=0;h.push(n,t,d,b);for(let N=1,A=0;N<=u;++N){A=N/u,d=1-A,g=d*d,y=g*d,m=A*A,w=m*A;const T=y*n+3*g*A*e+3*d*m*i+w*a,P=y*t+3*g*A*r+3*d*m*o+w*l,M=T-v,R=P-_;b+=Math.sqrt(M*M+R*R),h.push(T,P,A,b),v=T,_=P}return h}},ci=Object.freeze([]);class pn extends Ke{constructor(t,e,r,i){super(),t instanceof pn?(this.start=t.start,this.end=t.end,this.control1=t.control1,this.control2=t.control2):(this.start=t,this.end=i,this.control1=e,this.control2=r),this._lut=ci,this._vertices=ci,this._segments=ci}clone(){return new pn(this.start,this.control1,this.control2,this.end)}get tag(){return Qt.Bezier}get lut(){return this._lut===ci&&(this._lut=F0.generateLUT(this.start.x,this.start.y,this.control1.x,this.control1.y,this.control2.x,this.control2.y,this.end.x,this.end.y)),this._lut}get vertices(){if(this._vertices===ci){const t=this.lut;this._vertices=[];for(let e=0;e<t.length;e+=4){const r=t[e+0],i=t[e+1];this._vertices.push(new D(r,i))}}return this._vertices}get segments(){if(this._segments===ci){let t=this.vertices[0];this._segments=this.vertices.slice(1).reduce((e,r)=>(e.push(new U(t,r)),t=r,e),[])}return this._segments}get length(){return this.lut[this.lut.length-1]}get box(){return k0(this.lut)}get center(){return this.pointAtLength(this.length/2)}equalTo(t){return this.start.equalTo(t.start)&&this.end.equalTo(t.end)&&this.control1.equalTo(t.control1)&&this.control2.equalTo(t.control2)}contains(t){return this.segments.some(e=>e.contains(t))}intersect(t){if(t instanceof D)return this.contains(t)?[t]:[];const e=OE(t);return this.segments.map(i=>e(i,t)).flat()}distanceTo(t){const e=FE(t);return this.segments.reduce((r,i)=>{const o=e(i,t);return o[0]<r[0]?o:r},[1/0,U.EMPTY])}reverse(){return new pn(this.end,this.control2,this.control1,this.start)}split(t){throw new Error("unimplemented")}splitAtLength(t){if(Bt(t))return[null,this.clone()];if(Et(t,this.length)||Bi(t,this.length))return[this.clone(),null];const e=this.lut,r=_a(e,t),i=e[r*4+2],o=e[r*4+3],a=e[(r+1)*4+2],l=e[(r+1)*4+3],h=(t-o)/(l-o),u=R0(i,a,h);return this.splitAtT(u)}splitAtT(t){if(Bt(t))return[null,this.clone()];if(Nn(t,1))return[this.clone(),null];const e=this.start,r=this.control1,i=this.control2,o=this.end,a=li(e,r,t),l=li(r,i,t),h=li(i,o,t),u=li(a,l,t),d=li(l,h,t),g=li(u,d,t);return[new pn(e,a,u,g),new pn(g,d,h,o)]}middle(){return this.pointAtLength(this.length/2)}pointAtLength(t){if(t===0)return this.start;const e=this.segments;if(e.length===0)return D.EMPTY;const r=this.lut,i=_a(r,t),o=r[i*4+3],a=t-o;return e[i].pointAtLength(a)}distanceToPoint(t){return this.segments.reduce((e,r)=>{const i=Ds(r,t);return i[0]<e[0]?i:e},[1/0,U.EMPTY])}transform(t=new Jt){return new pn(this.start.transform(t),this.control1.transform(t),this.control2.transform(t),this.end.transform(t))}isZeroLength(){return this.start.equalTo(this.end)&&this.start.equalTo(this.control1)&&this.start.equalTo(this.control2)}get name(){return"bezier"}}pn.EMPTY=Object.seal((()=>{const n=new pn(D.EMPTY,D.EMPTY,D.EMPTY,D.EMPTY);return n.vertices,n.segments,n.lut,n})());function li(n,t,e){return e<=0?n:e>=1?t:new D((t.x-n.x)*e+n.x,(t.y-n.y)*e+n.y)}function OE(n){if(n instanceof U)return Gi;if(n instanceof ut)return Wr;throw new Error("unimplemented")}function FE(n){if(n instanceof D)return Ds;if(n instanceof U)return ku;if(n instanceof ut)return Ga;throw new Error("unimplemented")}const ui=Object.freeze([]);class mn extends Ke{constructor(t,e,r){super(),t instanceof mn?(this.start=t.start,this.end=t.end,this.control1=t.control1):(this.start=t,this.end=r,this.control1=e),this._lut=ui,this._vertices=ui,this._segments=ui}clone(){return new mn(this.start,this.control1,this.end)}get tag(){return Qt.Quadratic}get lut(){return this._lut===ui&&(this._lut=O0.generateLUT(this.start.x,this.start.y,this.control1.x,this.control1.y,this.end.x,this.end.y)),this._lut}get vertices(){if(this._vertices===ui){const t=this.lut;this._vertices=[];for(let e=0;e<t.length;e+=4){const r=t[e+0],i=t[e+1];this._vertices.push(new D(r,i))}}return this._vertices}get segments(){if(this._segments===ui){let t=this.vertices[0];this._segments=this.vertices.slice(1).reduce((e,r)=>(e.push(new U(t,r)),t=r,e),[])}return this._segments}get length(){return this.lut[this.lut.length-1]}get box(){return k0(this.lut)}get center(){return this.pointAtLength(this.length/2)}equalTo(t){return this.start.equalTo(t.start)&&this.end.equalTo(t.end)&&this.control1.equalTo(t.control1)}contains(t){return this.segments.some(e=>e.contains(t))}intersect(t){if(t instanceof D)return this.contains(t)?[t]:[];const e=DE(t);return this.segments.map(i=>e(i,t)).flat()}distanceTo(t){const e=BE(t);return this.segments.reduce((r,i)=>{const o=e(i,t);return o[0]<r[0]?o:r},[1/0,U.EMPTY])}reverse(){return new mn(this.end,this.control1,this.start)}split(t){throw new Error("unimplemented")}splitAtLength(t){if(Bt(t))return[null,this.clone()];if(Et(t,this.length)||Bi(t,this.length))return[this.clone(),null];const e=this.lut,r=_a(e,t),i=e[r*4+2],o=e[r*4+3],a=e[(r+1)*4+2],l=e[(r+1)*4+3],h=(t-o)/(l-o),u=R0(i,a,h);return this.splitAtT(u)}splitAtT(t){if(Bt(t))return[null,this.clone()];if(Nn(t,1))return[this.clone(),null];const e=this.start,r=this.control1,i=this.end,o=Nl(e,r,t),a=Nl(r,i,t),l=Nl(o,a,t);return[new mn(e,o,l),new mn(l,a,i)]}middle(){return this.pointAtLength(this.length/2)}pointAtLength(t){if(t===0)return this.start;const e=this.segments;if(e.length===0)return D.EMPTY;const r=this.lut,i=_a(r,t),o=r[i*4+3],a=t-o;return e[i].pointAtLength(a)}distanceToPoint(t){return this.segments.reduce((e,r)=>{const i=Ds(r,t);return i[0]<e[0]?i:e},[1/0,U.EMPTY])}transform(t){return new mn(this.start.transform(t),this.control1.transform(t),this.end.transform(t))}isZeroLength(){return this.start.equalTo(this.end)&&this.start.equalTo(this.control1)}get name(){return"bezier"}}mn.EMPTY=Object.seal(new mn(D.EMPTY,D.EMPTY,D.EMPTY));function Nl(n,t,e){return e<=0?n:e>=1?t:new D((t.x-n.x)*e+n.x,(t.y-n.y)*e+n.y)}function DE(n){if(n instanceof U)return Gi;if(n instanceof ut)return Wr;throw new Error("unimplemented")}function BE(n){if(n instanceof D)return Ds;if(n instanceof U)return ku;if(n instanceof ut)return Ga;throw new Error("unimplemented")}class Le{constructor(t){this.shape=t,this.next=void 0,this.prev=void 0,this.face=void 0,this.arc_length=0,this.bvStart=void 0,this.bvEnd=void 0,this.bv=void 0,this.overlap=void 0}get start(){return this.shape.start}get end(){return this.shape.end}get length(){return this.shape.length}get box(){return this.shape.box}isSegment(){return this.shape instanceof U}isArc(){return this.shape instanceof ut}middle(){return this.shape.middle()}pointAtLength(t){return this.shape.pointAtLength(t)}contains(t){return this.shape.contains(t)}setInclusion(t){if(this.bv!==void 0)return this.bv;if(this.shape instanceof et||this.shape instanceof ne)return this.bv=xt.OUTSIDE,this.bv;if(this.bvStart===void 0&&(this.bvStart=vs(t,this.start)),this.bvEnd===void 0&&(this.bvEnd=vs(t,this.end)),this.bvStart===xt.OUTSIDE||this.bvEnd==xt.OUTSIDE)this.bv=xt.OUTSIDE;else if(this.bvStart===xt.INSIDE||this.bvEnd==xt.INSIDE)this.bv=xt.INSIDE;else{let e=vs(t,this.middle());this.bv=e}return this.bv}setOverlap(t){let e,r=this.shape,i=t.shape;r instanceof U&&i instanceof U?r.start.equalTo(i.start)&&r.end.equalTo(i.end)?e=zn.SAME:r.start.equalTo(i.end)&&r.end.equalTo(i.start)&&(e=zn.OPPOSITE):(r instanceof ut&&i instanceof ut||r instanceof U&&i instanceof ut||r instanceof ut&&i instanceof U)&&(r.start.equalTo(i.start)&&r.end.equalTo(i.end)&&r.middle().equalTo(i.middle())?e=zn.SAME:r.start.equalTo(i.end)&&r.end.equalTo(i.start)&&r.middle().equalTo(i.middle())&&(e=zn.OPPOSITE)),this.overlap===void 0&&(this.overlap=e),t.overlap===void 0&&(t.overlap=e)}toJSON(){return this.shape.toJSON()}}Le.EMPTY=Object.freeze(new Le(U.EMPTY));class VE extends Fu{constructor(t,e){super(t,e),this.setCircularLinks()}setCircularLinks(){this.isEmpty()||(this.last.next=this.first,this.first.prev=this.last)}[Symbol.iterator](){let t;return{next:()=>{let e=t||this.first,r=this.first?t?t===this.first:!1:!0;return t=e?e.next:void 0,{value:e,done:r}}}}append(t){return super.append(t),this.setCircularLinks(),this}insert(t,e){return super.insert(t,e),this.setCircularLinks(),this}remove(t){return super.remove(t),this}}class Re extends VE{constructor(t,e,r){if(super(),this._box=void 0,this._orientation=void 0,!(!e&&!r)){if(e!==void 0&&r===void 0){if(e instanceof Array){const i=e;if(i.length===0)return;if(i.every(o=>o instanceof D)){let o=Re.points2segments(i);this.shapes2face(t.edges,o)}else if(i.every(o=>o instanceof Array&&o.length===2)){const o=i.map(l=>new D(l[0],l[1])),a=Re.points2segments(o);this.shapes2face(t.edges,a)}else if(i[0]instanceof U||i[0]instanceof ut||i[0]instanceof pn||i[0]instanceof mn)this.shapes2face(t.edges,i);else if(i.every(o=>o.name==="segment"||o.name==="arc")){let o=[];for(let a of i)a.name==="segment"?o.push(new U(a)):o.push(new ut(a));this.shapes2face(t.edges,o)}}else if(e instanceof Re){const i=e;this.first=i.first,this.last=i.last;for(const o of i)t.edges.add(o)}else if(e instanceof Q)this.shapes2face(t.edges,[e.toArc(Fa)]);else if(e instanceof At){const i=e;this.shapes2face(t.edges,[new U(new D(i.xmin,i.ymin),new D(i.xmax,i.ymin)),new U(new D(i.xmax,i.ymin),new D(i.xmax,i.ymax)),new U(new D(i.xmax,i.ymax),new D(i.xmin,i.ymax)),new U(new D(i.xmin,i.ymax),new D(i.xmin,i.ymin))])}else if(e instanceof vn){const i=e;this.shapes2face(t.edges,i.parts)}}e instanceof Le&&r instanceof Le&&(this.first=e,this.last=r,this.last.next=this.first,this.first.prev=this.last,this.setArcLength())}}get edges(){return this.toArray()}get shapes(){return this.edges.map(t=>t.shape.clone())}get box(){if(this._box===void 0){let t=At.VOID;for(let e of this)t=t.merge(e.box);this._box=t}return this._box}get perimeter(){return this.last.arc_length+this.last.length}pointAtLength(t){if(t>this.perimeter||t<0)return null;let e=null;for(let r of this)if(t>=r.arc_length&&(r===this.last||t<r.next.arc_length)){e=r.pointAtLength(t-r.arc_length);break}return e}static points2segments(t){let e=[];for(let r=0;r<t.length;r++)t[r].equalTo(t[(r+1)%t.length])||e.push(new U(t[r],t[(r+1)%t.length]));return e}shapes2face(t,e){for(let r of e){let i=new Le(r);this.append(i),t.add(i)}}append(t){return super.append(t),this.setOneEdgeArcLength(t),t.face=this,this}insert(t,e){return super.insert(t,e),this.setOneEdgeArcLength(t),t.face=this,this}remove(t){return super.remove(t),this.setArcLength(),this}mergeWithNextEdge(t){return t.shape.end.x=t.next.shape.end.x,t.shape.end.y=t.next.shape.end.y,this.remove(t.next),this}reverse(){let t=[],e=this.last;do e.shape=e.shape.reverse(),t.push(e),e=e.prev;while(e!==this.last);this.first=void 0,this.last=void 0;for(let r of t)this.first===void 0?(r.prev=r,r.next=r,this.first=r,this.last=r):(r.prev=this.last,this.last.next=r,this.last=r,this.last.next=this.first,this.first.prev=this.last),this.setOneEdgeArcLength(r);this._orientation!==void 0&&(this._orientation=void 0,this._orientation=this.orientation())}setArcLength(){for(let t of this)this.setOneEdgeArcLength(t),t.face=this}setOneEdgeArcLength(t){t===this.first?t.arc_length=0:t.arc_length=t.prev.arc_length+t.prev.length}area(){return Math.abs(this.signedArea())}signedArea(){let t=0,e=this.box.ymin;for(let r of this)t+=r.shape.definiteIntegral(e);return t}orientation(){if(this._orientation===void 0){let t=this.signedArea();Bt(t)?this._orientation=Qo.NOT_ORIENTABLE:Se(t,0)?this._orientation=Qo.CW:this._orientation=Qo.CCW}return this._orientation}isSimple(t){return Re.getSelfIntersections(this,t,!0).length===0}static getSelfIntersections(t,e,r=!1){let i=[];for(let o of t){let a=e.search(o.box);for(let l of a){if(o===l||l.face!==t||o.shape instanceof U&&l.shape instanceof U&&(o.next===l||o.prev===l))continue;let h=o.shape.intersect(l.shape);for(let u of h)if(!(u.equalTo(o.start)&&u.equalTo(l.end)&&l===o.prev)&&!(u.equalTo(o.end)&&u.equalTo(l.start)&&l===o.next)&&(i.push(u),r))break;if(i.length>0&&r)break}if(i.length>0&&r)break}return i}findEdgeByPoint(t){let e;for(let r of this)if(!t.equalTo(r.shape.start)&&(t.equalTo(r.shape.end)||r.shape.contains(t))){e=r;break}return e}toPolygon(){return new Tt(this.shapes)}toJSON(){return this.edges.map(t=>t.toJSON())}}class vn extends Ke{static fromPoints(t){const e=[];for(let r=0;r<t.length-1;r++)e.push(new U(t[r],t[r+1]));return new vn(e)}constructor(t){super(),this.parts=t,this._length=NaN,this._box=null;let e=t[0];for(let r=1;r<t.length;r++){const i=t[r];i.start.equalTo(e.end)&&(i.start=e.end),e=i}}get tag(){return Qt.Path}get name(){return"path"}get box(){var t;return(t=this._box)!==null&&t!==void 0?t:this._box=this.parts.reduce((e,r)=>e=e.merge(r.box),At.EMPTY)}clone(){return new vn(this.parts)}get length(){return Number.isNaN(this._length)&&(this._length=this.parts.reduce((t,e)=>t+e.length,0)),this._length}get center(){return this.box.center}contains(t){return t instanceof D?this.parts.some(e=>e.contains(t)):!1}transform(t){return new vn(this.parts.map(e=>e.transform(t)))}pointAtLength(t){if(this.parts.length===0)return D.EMPTY;if(t===0)return this.parts[0].start;let e=0;for(let i=0;i<this.parts.length;i++){const o=this.parts[i];if(e+=o.length,e>=t){const a=t-(e-o.length);return o.pointAtLength(a)}}const r=this.parts[this.parts.length-1];return r.pointAtLength(r.length)}slice(t,e){if(this.parts.length===0)return this.clone();let r=0,i=[],o=!1;for(let a=0;a<this.parts.length;a++){const l=this.parts[a];let h=!1;if(r+=l.length,r>=t&&!o){const u=t-(r-l.length),[d,g]=l.splitAtLength(u);if(g!==null)if(r>=e){const y=e-(r-l.length),[m]=g.splitAtLength(y-u);return m!==null&&i.push(m),new vn(i)}else i.push(g);o=!0,h=!0}if(r>=e){const u=e-(r-l.length),[d]=l.splitAtLength(u);d!==null&&i.push(d);break}o&&!h&&i.push(l)}return new vn(i)}}vn.EMPTY=Object.freeze((()=>{const n=new vn([]);return n.length,n.box,n})());class yn{static getClosestShapeToPoint(t,e,r=i=>i){if(t.length===0)return;let i=t[0],o=Math.sqrt((r(t[0]).x-e.x)**2+(r(t[0]).y-e.y)**2);for(let a=1;a<t.length;a++){const l=Math.sqrt((r(t[a]).x-e.x)**2+(r(t[a]).y-e.y)**2);l<o&&(i=t[a],o=l)}return i}static getFurthestShapeToPoint(t,e,r=i=>i){if(t.length===0)return;let i=t[0],o=Math.sqrt((r(t[0]).x-e.x)**2+(r(t[0]).y-e.y)**2);for(let a=1;a<t.length;a++){const l=Math.sqrt((r(t[a]).x-e.x)**2+(r(t[a]).y-e.y)**2);l>o&&(i=t[a],o=l)}return i}}function nn(n){return n*180/Math.PI}function ar(n){return n*Math.PI/180}class F extends yn{static radToDeg(t){return t*180/Math.PI}static degToRad(t){return t*Math.PI/180}static normalizeRad(t,e=!1){return t<0&&(t+=Math.floor(-t/(2*Math.PI)+1)*2*Math.PI),t=t%(2*Math.PI),!e&&t>Math.PI?t-2*Math.PI:t}static forwardRadBetweenAngles(t,e){let r=e-t;for(;r<0;)r+=2*Math.PI;return r}static putRadBetween(t,e,r,i="closer",o=.001){if(Math.abs(e-r)<o)return e;e=F.normalizeRad(e),r=F.normalizeRad(r),t=F.normalizeRad(t),F.forwardRadBetweenAngles(e,r);const a=F.forwardRadBetweenAngles(t,e);F.forwardRadBetweenAngles(e,t);const l=F.forwardRadBetweenAngles(t,r);if(a<l){if(i=="closer")return a<Math.abs(l-2*Math.PI)?e:r;if(i=="clockwise")return e;if(i=="counter-clockwise")return r}return t}static radToVector(t){return new W(Math.cos(t),Math.sin(t))}static radOfPoint(t,e){const r=e??{x:0,y:0};return Math.atan2(t.y-r.y,t.x-r.x)}static degOfPoint(t,e){return nn(F.radOfPoint(t,e))}static radBetweenPoints(t,e,r){const i=r??{x:0,y:0},o=Math.atan2(e.y-i.y,e.x-i.x)-Math.atan2(t.y-i.y,t.x-i.x);return F.normalizeRad(o,!1)}static radIsBetween(t,e,r){t=F.normalizeRad(t),e=F.normalizeRad(e),r=F.normalizeRad(r);const i=F.forwardRadBetweenAngles(e,r),o=F.forwardRadBetweenAngles(e,t),a=F.forwardRadBetweenAngles(t,r);return o<=i&&a<=i}static degBetweenPoints(t,e,r){return nn(F.radBetweenPoints(t,e,r))}static forwardRadBetweenPoints(t,e,r){const i=F.radBetweenPoints(t,e,r);return i<0?i+2*Math.PI:i}static forwardDegBetweenPoints(t,e,r){return nn(F.forwardRadBetweenPoints(t,e,r))}static getEnclosingAngle(t,e,r){const i=F.normalizeRad(F.radBetweenPoints(t,r,e),!0);return i>Math.PI?Math.PI*2-i:i}static rad1ComesAfterRad2(t,e,r){return!(F.forwardRadBetweenAngles(r,t)<F.forwardRadBetweenAngles(r,e))}static rad1ComesBeforeRad2(t,e,r){return!F.rad1ComesAfterRad2(t,e,r)}static positionOnCircleAtRad(t,e,r){const i=r??{x:0,y:0},o=i.x+e*Math.cos(t),a=i.y+e*Math.sin(t);return new D(o,a)}static positionOnCircleAtDeg(t,e,r){const i=ar(t);return F.positionOnCircleAtRad(i,e,r)}static straightDistance(t,e){return Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2)}static radialDistance(t,e,r,i=!0){if(i)return Math.abs(t-e)%(2*Math.PI)*r;const o=e-t;return(o<0?o+2*Math.PI:o)%(2*Math.PI)*r}static getTangentsFromPointToCircle(t,e){try{const r=t.distanceTo(e.center)[0];if(r<e.r)return[];const i=r/2,o=new U(t,e.center).middle(),l=new Q(o,i).intersect(e);if(l.length<2)throw new Error("No intersection points found.");return[new U(t,l[0]),new U(t,l[1])]}catch{return[]}}static getInnerTangentsBetweenCircles(t,e){if(t.intersect(e).length==2)return[];if(t.intersect(e).length==1)return[];const r=t,i=e,o=r.center,a=i.center;r.r;const l=i.r,h=new et(o,a),u=new D((o.x+a.x)/2,(o.y+a.y)/2),d=new Q(u,o.distanceTo(a)[0]/2),g=yn.getClosestShapeToPoint(r.intersect(h),u),y=new Q(g,l),m=yn.getClosestShapeToPoint(y.intersect(h),a),w=o.distanceTo(m)[0],_=new Q(o,w).intersect(d),b=_[0],N=_[1],A=new U(o,b),T=new U(o,N),P=A.intersect(r)[0],M=T.intersect(r)[0],R=new et(a,A.vector.rotate90CW()),O=new et(a,T.vector.rotate90CW()),V=R.intersect(i),$=yn.getClosestShapeToPoint(V,o),G=O.intersect(i),Z=yn.getClosestShapeToPoint(G,o);return[new U(P,$),new U(M,Z)]}static getCircleFromThreePoints(t,e,r){const i=Math.max(t.distanceTo(e)[0],t.distanceTo(r)[0],e.distanceTo(r)[0]),o=new Q(t,i),a=new Q(e,i),l=new Q(r,i),h=o.intersect(a),u=a.intersect(l);if(h.length<2||u.length<2)throw new Error("No intersection points found.");const d=new et(h[0],h[1]),g=new et(u[0],u[1]),y=d.intersect(g);if(y.length<1)throw new Error("No intersection points found.");const m=y[0],w=m.distanceTo(t)[0];return new Q(m,w)}static getCircleFromCoincidentPointAndTangentAnchor(t,e){const r=st.getMidPointBetweenPointAndAnchor(t,e);if(!r)return;const i=new U(t,r),o=new et(t,i.vector),a=new et(e.anchorPoint,e.direction),l=o.intersect(a);if(l.length<1)return;const h=l[0],u=h.distanceTo(t)[0];return new Q(h,u)}static getConnectingCirclesForAnchorAndCircle(t,e,r){const i=t.anchorPoint,o=t.direction,a=e.r,l=new et(i,o),u=new Q(i,a).intersect(l);if(u.length<2)throw new Error("Insufficient intersection points found.");const d=[];for(const g of u){new et(e.center,g);const y=new D((e.center.x+g.x)/2,(e.center.y+g.y)/2),w=new et(y,new W(e.center,g)).intersect(l);if(w.length<1)throw new Error("No intersection found between lines.");const v=w[0],_=Math.abs(v.distanceTo(e.center)[0]-a),b=new Q(v,_),N=e.intersect(new et(e.center,v)),A=yn.getClosestShapeToPoint(N,v);if(!A)throw new Error("No fitting intersection found.");const T=t.getDirectionRegardingCircle(b),P=F.radOfPoint(A,b.center),M=st.getAnchorOnCircle(b,P,T);d.push({fixedAnchor:t,connectingAnchor:M,circle:b,direction:T})}if(d.length<2)throw new Error("Not enough circles found.");return d}static getArcFromConnectingCircle(t,e,r=!1){const i=t.direction;return new An(e,r?t.connectingAnchor.anchorPoint:t.fixedAnchor.anchorPoint,r?t.fixedAnchor.anchorPoint:t.connectingAnchor.anchorPoint,t.circle.r,t.circle.r).direction(i)}static getMinimumEnclosingCircle(t){console.log("Finding minimum enclosing circle for",t);function e(i,o){if(i.length===0||o.length===3)switch(o.length){case 0:return new Q(new D(0,0),0);case 1:return new Q(o[0],0);case 2:const h=new D((o[0].x+o[1].x)/2,(o[0].y+o[1].y)/2);return new Q(h,o[0].distanceTo(o[1])[0]/2);case 3:return F.getCircleFromThreePoints(o[0],o[1],o[2])}const a=e(i.slice(1),Array.from(o));if(a.contains(i[0]))return a;const l=Array.from(o);return l.push(i[0]),e(i.slice(1),l)}const r=Array.from(t).sort(()=>Math.random()-.5);return e(r,[])}}class st{tag="Anchor";anchorPoint;direction;_data;get x(){return this.anchorPoint.x}get y(){return this.anchorPoint.y}get dx(){return this.direction.x}get dy(){return this.direction.y}constructor(t,e){this.anchorPoint=t,e instanceof D?this.direction=new W(t,e):this.direction=e,this.direction=this.direction.length>0?this.direction.normalize():this.direction}getPointInDirection(t){return this.anchorPoint.translate(this.direction.multiply(t))}getPointAwayFromReference(t,e){const r=e??this.anchorPoint,i=this.getPointInDirection(t),o=this.getPointInDirection(-t);return r===this.anchorPoint||i.distanceTo(r)[0]>o.distanceTo(r)[0]?i:o}getPointTowardsReference(t,e){const r=e??this.anchorPoint,i=this.getPointInDirection(t),o=this.getPointInDirection(-t);return r===this.anchorPoint||i.distanceTo(r)[0]<o.distanceTo(r)[0]?i:o}move(t){const e=this.clone();return e.anchorPoint=e.getPointInDirection(t),e}rotate(t){const e=this.clone();return e.direction=e.direction.rotate(t),e}rotate90CW(){return this.rotate(Math.PI/2)}rotate90CCW(){return this.rotate(-Math.PI/2)}rotate180(){return this.rotate(Math.PI)}clone(){return new st(this.anchorPoint.clone(),this.direction.clone())}cloneReversed(){return new st(this.anchorPoint.clone(),this.direction.clone().multiply(-1))}getLine(){return new et(this.anchorPoint,this.direction.rotate90CW())}getRay(t=!1){return t?new ne(this.anchorPoint,this.direction.multiply(-1).rotate90CW()):new ne(this.anchorPoint,this.direction.rotate90CW())}isSimilarTo(t,e=1e-4){if(t===void 0)return!1;const r=this.anchorPoint,i=t.anchorPoint;if(r.distanceTo(i)[0]>e)return!1;const o=this.direction,a=t.direction;return Math.abs(o.slope-a.slope)<e}getDirectionRegardingCircle(t){const e=this.getPointInDirection(t.r/2);return F.radBetweenPoints(this.anchorPoint,e,t.center)>0?"clockwise":"counter-clockwise"}static mean(t,e,r=!1){const i=t.filter(u=>u!==void 0);if(i.length===0)return;if(e===void 0){let u=new W(0,0);return i.forEach(d=>{d!==void 0&&(u=u.add(d.direction))}),r?new st(i[0].anchorPoint,u):new st(new D(0,0),u)}const o=i.map(u=>F.radOfPoint(u.anchorPoint,e.center)),a=o.reduce((u,d)=>u+d,0)/o.length,l=F.positionOnCircleAtRad(a,e.r,e.center),h=new st(l,new W(l,e.center));return e.contains(i[0].getPointInDirection(e.r))?h:h.cloneReversed()}static getMidPointBetweenPointAndAnchor(t,e){const r=t.distanceTo(e.anchorPoint)[0],i=new Q(t,r),o=new Q(e.anchorPoint,r),a=i.intersect(o);if(a.length!=2)return;const l=new et(a[0],a[1]),h=e.getLine().intersect(l);if(!(h.length<1))return h[0]}static getAnchorOnCircle(t,e,r){const i=F.positionOnCircleAtRad(e,t.r,t.center),o=new W(i,t.center).rotate90CW(),a=new st(i,o);return r==a.getDirectionRegardingCircle(t)?a:a.cloneReversed()}}class GE{stroke="white";strokeWidth=1;strokeOpacity=1}var xa={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */xa.exports;(function(n,t){(function(){var e,r="4.17.21",i=200,o="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",a="Expected a function",l="Invalid `variable` option passed into `_.template`",h="__lodash_hash_undefined__",u=500,d="__lodash_placeholder__",g=1,y=2,m=4,w=1,v=2,_=1,b=2,N=4,A=8,T=16,P=32,M=64,R=128,O=256,V=512,$=30,G="...",Z=800,tt=16,dt=1,wt=2,Nt=3,Lt=1/0,It=9007199254740991,Ct=17976931348623157e292,K=NaN,X=4294967295,ot=X-1,ht=X>>>1,Ft=[["ary",R],["bind",_],["bindKey",b],["curry",A],["curryRight",T],["flip",V],["partial",P],["partialRight",M],["rearg",O]],ft="[object Arguments]",Wt="[object Array]",vr="[object AsyncFunction]",De="[object Boolean]",me="[object Date]",Xa="[object DOMException]",Hr="[object Error]",$s="[object Function]",Uu="[object GeneratorFunction]",Je="[object Map]",Wi="[object Number]",Z0="[object Null]",In="[object Object]",Yu="[object Promise]",j0="[object Proxy]",Hi="[object RegExp]",Qe="[object Set]",qi="[object String]",Ws="[object Symbol]",tm="[object Undefined]",Ui="[object WeakMap]",em="[object WeakSet]",Yi="[object ArrayBuffer]",qr="[object DataView]",Ja="[object Float32Array]",Qa="[object Float64Array]",Za="[object Int8Array]",ja="[object Int16Array]",tc="[object Int32Array]",ec="[object Uint8Array]",nc="[object Uint8ClampedArray]",rc="[object Uint16Array]",ic="[object Uint32Array]",nm=/\b__p \+= '';/g,rm=/\b(__p \+=) '' \+/g,im=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Ku=/&(?:amp|lt|gt|quot|#39);/g,Xu=/[&<>"']/g,sm=RegExp(Ku.source),om=RegExp(Xu.source),am=/<%-([\s\S]+?)%>/g,cm=/<%([\s\S]+?)%>/g,Ju=/<%=([\s\S]+?)%>/g,lm=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,um=/^\w*$/,hm=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,sc=/[\\^$.*+?()[\]{}|]/g,fm=RegExp(sc.source),oc=/^\s+/,dm=/\s/,gm=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,pm=/\{\n\/\* \[wrapped with (.+)\] \*/,mm=/,? & /,ym=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,wm=/[()=,{}\[\]\/\s]/,vm=/\\(\\)?/g,bm=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Qu=/\w*$/,_m=/^[-+]0x[0-9a-f]+$/i,xm=/^0b[01]+$/i,Sm=/^\[object .+?Constructor\]$/,Cm=/^0o[0-7]+$/i,Pm=/^(?:0|[1-9]\d*)$/,Am=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Hs=/($^)/,Nm=/['\n\r\u2028\u2029\\]/g,qs="\\ud800-\\udfff",Tm="\\u0300-\\u036f",Em="\\ufe20-\\ufe2f",Im="\\u20d0-\\u20ff",Zu=Tm+Em+Im,ju="\\u2700-\\u27bf",th="a-z\\xdf-\\xf6\\xf8-\\xff",Mm="\\xac\\xb1\\xd7\\xf7",Rm="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Lm="\\u2000-\\u206f",km=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",eh="A-Z\\xc0-\\xd6\\xd8-\\xde",nh="\\ufe0e\\ufe0f",rh=Mm+Rm+Lm+km,ac="['’]",Om="["+qs+"]",ih="["+rh+"]",Us="["+Zu+"]",sh="\\d+",Fm="["+ju+"]",oh="["+th+"]",ah="[^"+qs+rh+sh+ju+th+eh+"]",cc="\\ud83c[\\udffb-\\udfff]",Dm="(?:"+Us+"|"+cc+")",ch="[^"+qs+"]",lc="(?:\\ud83c[\\udde6-\\uddff]){2}",uc="[\\ud800-\\udbff][\\udc00-\\udfff]",Ur="["+eh+"]",lh="\\u200d",uh="(?:"+oh+"|"+ah+")",Bm="(?:"+Ur+"|"+ah+")",hh="(?:"+ac+"(?:d|ll|m|re|s|t|ve))?",fh="(?:"+ac+"(?:D|LL|M|RE|S|T|VE))?",dh=Dm+"?",gh="["+nh+"]?",Vm="(?:"+lh+"(?:"+[ch,lc,uc].join("|")+")"+gh+dh+")*",Gm="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",zm="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",ph=gh+dh+Vm,$m="(?:"+[Fm,lc,uc].join("|")+")"+ph,Wm="(?:"+[ch+Us+"?",Us,lc,uc,Om].join("|")+")",Hm=RegExp(ac,"g"),qm=RegExp(Us,"g"),hc=RegExp(cc+"(?="+cc+")|"+Wm+ph,"g"),Um=RegExp([Ur+"?"+oh+"+"+hh+"(?="+[ih,Ur,"$"].join("|")+")",Bm+"+"+fh+"(?="+[ih,Ur+uh,"$"].join("|")+")",Ur+"?"+uh+"+"+hh,Ur+"+"+fh,zm,Gm,sh,$m].join("|"),"g"),Ym=RegExp("["+lh+qs+Zu+nh+"]"),Km=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Xm=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Jm=-1,Gt={};Gt[Ja]=Gt[Qa]=Gt[Za]=Gt[ja]=Gt[tc]=Gt[ec]=Gt[nc]=Gt[rc]=Gt[ic]=!0,Gt[ft]=Gt[Wt]=Gt[Yi]=Gt[De]=Gt[qr]=Gt[me]=Gt[Hr]=Gt[$s]=Gt[Je]=Gt[Wi]=Gt[In]=Gt[Hi]=Gt[Qe]=Gt[qi]=Gt[Ui]=!1;var Vt={};Vt[ft]=Vt[Wt]=Vt[Yi]=Vt[qr]=Vt[De]=Vt[me]=Vt[Ja]=Vt[Qa]=Vt[Za]=Vt[ja]=Vt[tc]=Vt[Je]=Vt[Wi]=Vt[In]=Vt[Hi]=Vt[Qe]=Vt[qi]=Vt[Ws]=Vt[ec]=Vt[nc]=Vt[rc]=Vt[ic]=!0,Vt[Hr]=Vt[$s]=Vt[Ui]=!1;var Qm={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},Zm={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},jm={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},ty={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},ey=parseFloat,ny=parseInt,mh=typeof ls=="object"&&ls&&ls.Object===Object&&ls,ry=typeof self=="object"&&self&&self.Object===Object&&self,se=mh||ry||Function("return this")(),fc=t&&!t.nodeType&&t,br=fc&&!0&&n&&!n.nodeType&&n,yh=br&&br.exports===fc,dc=yh&&mh.process,Be=function(){try{var L=br&&br.require&&br.require("util").types;return L||dc&&dc.binding&&dc.binding("util")}catch{}}(),wh=Be&&Be.isArrayBuffer,vh=Be&&Be.isDate,bh=Be&&Be.isMap,_h=Be&&Be.isRegExp,xh=Be&&Be.isSet,Sh=Be&&Be.isTypedArray;function Pe(L,z,B){switch(B.length){case 0:return L.call(z);case 1:return L.call(z,B[0]);case 2:return L.call(z,B[0],B[1]);case 3:return L.call(z,B[0],B[1],B[2])}return L.apply(z,B)}function iy(L,z,B,j){for(var gt=-1,Mt=L==null?0:L.length;++gt<Mt;){var Zt=L[gt];z(j,Zt,B(Zt),L)}return j}function Ve(L,z){for(var B=-1,j=L==null?0:L.length;++B<j&&z(L[B],B,L)!==!1;);return L}function sy(L,z){for(var B=L==null?0:L.length;B--&&z(L[B],B,L)!==!1;);return L}function Ch(L,z){for(var B=-1,j=L==null?0:L.length;++B<j;)if(!z(L[B],B,L))return!1;return!0}function Jn(L,z){for(var B=-1,j=L==null?0:L.length,gt=0,Mt=[];++B<j;){var Zt=L[B];z(Zt,B,L)&&(Mt[gt++]=Zt)}return Mt}function Ys(L,z){var B=L==null?0:L.length;return!!B&&Yr(L,z,0)>-1}function gc(L,z,B){for(var j=-1,gt=L==null?0:L.length;++j<gt;)if(B(z,L[j]))return!0;return!1}function $t(L,z){for(var B=-1,j=L==null?0:L.length,gt=Array(j);++B<j;)gt[B]=z(L[B],B,L);return gt}function Qn(L,z){for(var B=-1,j=z.length,gt=L.length;++B<j;)L[gt+B]=z[B];return L}function pc(L,z,B,j){var gt=-1,Mt=L==null?0:L.length;for(j&&Mt&&(B=L[++gt]);++gt<Mt;)B=z(B,L[gt],gt,L);return B}function oy(L,z,B,j){var gt=L==null?0:L.length;for(j&&gt&&(B=L[--gt]);gt--;)B=z(B,L[gt],gt,L);return B}function mc(L,z){for(var B=-1,j=L==null?0:L.length;++B<j;)if(z(L[B],B,L))return!0;return!1}var ay=yc("length");function cy(L){return L.split("")}function ly(L){return L.match(ym)||[]}function Ph(L,z,B){var j;return B(L,function(gt,Mt,Zt){if(z(gt,Mt,Zt))return j=Mt,!1}),j}function Ks(L,z,B,j){for(var gt=L.length,Mt=B+(j?1:-1);j?Mt--:++Mt<gt;)if(z(L[Mt],Mt,L))return Mt;return-1}function Yr(L,z,B){return z===z?_y(L,z,B):Ks(L,Ah,B)}function uy(L,z,B,j){for(var gt=B-1,Mt=L.length;++gt<Mt;)if(j(L[gt],z))return gt;return-1}function Ah(L){return L!==L}function Nh(L,z){var B=L==null?0:L.length;return B?vc(L,z)/B:K}function yc(L){return function(z){return z==null?e:z[L]}}function wc(L){return function(z){return L==null?e:L[z]}}function Th(L,z,B,j,gt){return gt(L,function(Mt,Zt,Dt){B=j?(j=!1,Mt):z(B,Mt,Zt,Dt)}),B}function hy(L,z){var B=L.length;for(L.sort(z);B--;)L[B]=L[B].value;return L}function vc(L,z){for(var B,j=-1,gt=L.length;++j<gt;){var Mt=z(L[j]);Mt!==e&&(B=B===e?Mt:B+Mt)}return B}function bc(L,z){for(var B=-1,j=Array(L);++B<L;)j[B]=z(B);return j}function fy(L,z){return $t(z,function(B){return[B,L[B]]})}function Eh(L){return L&&L.slice(0,Lh(L)+1).replace(oc,"")}function Ae(L){return function(z){return L(z)}}function _c(L,z){return $t(z,function(B){return L[B]})}function Ki(L,z){return L.has(z)}function Ih(L,z){for(var B=-1,j=L.length;++B<j&&Yr(z,L[B],0)>-1;);return B}function Mh(L,z){for(var B=L.length;B--&&Yr(z,L[B],0)>-1;);return B}function dy(L,z){for(var B=L.length,j=0;B--;)L[B]===z&&++j;return j}var gy=wc(Qm),py=wc(Zm);function my(L){return"\\"+ty[L]}function yy(L,z){return L==null?e:L[z]}function Kr(L){return Ym.test(L)}function wy(L){return Km.test(L)}function vy(L){for(var z,B=[];!(z=L.next()).done;)B.push(z.value);return B}function xc(L){var z=-1,B=Array(L.size);return L.forEach(function(j,gt){B[++z]=[gt,j]}),B}function Rh(L,z){return function(B){return L(z(B))}}function Zn(L,z){for(var B=-1,j=L.length,gt=0,Mt=[];++B<j;){var Zt=L[B];(Zt===z||Zt===d)&&(L[B]=d,Mt[gt++]=B)}return Mt}function Xs(L){var z=-1,B=Array(L.size);return L.forEach(function(j){B[++z]=j}),B}function by(L){var z=-1,B=Array(L.size);return L.forEach(function(j){B[++z]=[j,j]}),B}function _y(L,z,B){for(var j=B-1,gt=L.length;++j<gt;)if(L[j]===z)return j;return-1}function xy(L,z,B){for(var j=B+1;j--;)if(L[j]===z)return j;return j}function Xr(L){return Kr(L)?Cy(L):ay(L)}function Ze(L){return Kr(L)?Py(L):cy(L)}function Lh(L){for(var z=L.length;z--&&dm.test(L.charAt(z)););return z}var Sy=wc(jm);function Cy(L){for(var z=hc.lastIndex=0;hc.test(L);)++z;return z}function Py(L){return L.match(hc)||[]}function Ay(L){return L.match(Um)||[]}var Ny=function L(z){z=z==null?se:Jr.defaults(se.Object(),z,Jr.pick(se,Xm));var B=z.Array,j=z.Date,gt=z.Error,Mt=z.Function,Zt=z.Math,Dt=z.Object,Sc=z.RegExp,Ty=z.String,Ge=z.TypeError,Js=B.prototype,Ey=Mt.prototype,Qr=Dt.prototype,Qs=z["__core-js_shared__"],Zs=Ey.toString,kt=Qr.hasOwnProperty,Iy=0,kh=function(){var s=/[^.]+$/.exec(Qs&&Qs.keys&&Qs.keys.IE_PROTO||"");return s?"Symbol(src)_1."+s:""}(),js=Qr.toString,My=Zs.call(Dt),Ry=se._,Ly=Sc("^"+Zs.call(kt).replace(sc,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),to=yh?z.Buffer:e,jn=z.Symbol,eo=z.Uint8Array,Oh=to?to.allocUnsafe:e,no=Rh(Dt.getPrototypeOf,Dt),Fh=Dt.create,Dh=Qr.propertyIsEnumerable,ro=Js.splice,Bh=jn?jn.isConcatSpreadable:e,Xi=jn?jn.iterator:e,_r=jn?jn.toStringTag:e,io=function(){try{var s=Ar(Dt,"defineProperty");return s({},"",{}),s}catch{}}(),ky=z.clearTimeout!==se.clearTimeout&&z.clearTimeout,Oy=j&&j.now!==se.Date.now&&j.now,Fy=z.setTimeout!==se.setTimeout&&z.setTimeout,so=Zt.ceil,oo=Zt.floor,Cc=Dt.getOwnPropertySymbols,Dy=to?to.isBuffer:e,Vh=z.isFinite,By=Js.join,Vy=Rh(Dt.keys,Dt),jt=Zt.max,ce=Zt.min,Gy=j.now,zy=z.parseInt,Gh=Zt.random,$y=Js.reverse,Pc=Ar(z,"DataView"),Ji=Ar(z,"Map"),Ac=Ar(z,"Promise"),Zr=Ar(z,"Set"),Qi=Ar(z,"WeakMap"),Zi=Ar(Dt,"create"),ao=Qi&&new Qi,jr={},Wy=Nr(Pc),Hy=Nr(Ji),qy=Nr(Ac),Uy=Nr(Zr),Yy=Nr(Qi),co=jn?jn.prototype:e,ji=co?co.valueOf:e,zh=co?co.toString:e;function S(s){if(qt(s)&&!pt(s)&&!(s instanceof St)){if(s instanceof ze)return s;if(kt.call(s,"__wrapped__"))return Wf(s)}return new ze(s)}var ti=function(){function s(){}return function(c){if(!Ht(c))return{};if(Fh)return Fh(c);s.prototype=c;var f=new s;return s.prototype=e,f}}();function lo(){}function ze(s,c){this.__wrapped__=s,this.__actions__=[],this.__chain__=!!c,this.__index__=0,this.__values__=e}S.templateSettings={escape:am,evaluate:cm,interpolate:Ju,variable:"",imports:{_:S}},S.prototype=lo.prototype,S.prototype.constructor=S,ze.prototype=ti(lo.prototype),ze.prototype.constructor=ze;function St(s){this.__wrapped__=s,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=X,this.__views__=[]}function Ky(){var s=new St(this.__wrapped__);return s.__actions__=ye(this.__actions__),s.__dir__=this.__dir__,s.__filtered__=this.__filtered__,s.__iteratees__=ye(this.__iteratees__),s.__takeCount__=this.__takeCount__,s.__views__=ye(this.__views__),s}function Xy(){if(this.__filtered__){var s=new St(this);s.__dir__=-1,s.__filtered__=!0}else s=this.clone(),s.__dir__*=-1;return s}function Jy(){var s=this.__wrapped__.value(),c=this.__dir__,f=pt(s),p=c<0,x=f?s.length:0,C=cv(0,x,this.__views__),E=C.start,I=C.end,k=I-E,H=p?I:E-1,q=this.__iteratees__,Y=q.length,J=0,nt=ce(k,this.__takeCount__);if(!f||!p&&x==k&&nt==k)return ff(s,this.__actions__);var at=[];t:for(;k--&&J<nt;){H+=c;for(var yt=-1,ct=s[H];++yt<Y;){var _t=q[yt],Pt=_t.iteratee,Ee=_t.type,fe=Pt(ct);if(Ee==wt)ct=fe;else if(!fe){if(Ee==dt)continue t;break t}}at[J++]=ct}return at}St.prototype=ti(lo.prototype),St.prototype.constructor=St;function xr(s){var c=-1,f=s==null?0:s.length;for(this.clear();++c<f;){var p=s[c];this.set(p[0],p[1])}}function Qy(){this.__data__=Zi?Zi(null):{},this.size=0}function Zy(s){var c=this.has(s)&&delete this.__data__[s];return this.size-=c?1:0,c}function jy(s){var c=this.__data__;if(Zi){var f=c[s];return f===h?e:f}return kt.call(c,s)?c[s]:e}function tw(s){var c=this.__data__;return Zi?c[s]!==e:kt.call(c,s)}function ew(s,c){var f=this.__data__;return this.size+=this.has(s)?0:1,f[s]=Zi&&c===e?h:c,this}xr.prototype.clear=Qy,xr.prototype.delete=Zy,xr.prototype.get=jy,xr.prototype.has=tw,xr.prototype.set=ew;function Mn(s){var c=-1,f=s==null?0:s.length;for(this.clear();++c<f;){var p=s[c];this.set(p[0],p[1])}}function nw(){this.__data__=[],this.size=0}function rw(s){var c=this.__data__,f=uo(c,s);if(f<0)return!1;var p=c.length-1;return f==p?c.pop():ro.call(c,f,1),--this.size,!0}function iw(s){var c=this.__data__,f=uo(c,s);return f<0?e:c[f][1]}function sw(s){return uo(this.__data__,s)>-1}function ow(s,c){var f=this.__data__,p=uo(f,s);return p<0?(++this.size,f.push([s,c])):f[p][1]=c,this}Mn.prototype.clear=nw,Mn.prototype.delete=rw,Mn.prototype.get=iw,Mn.prototype.has=sw,Mn.prototype.set=ow;function Rn(s){var c=-1,f=s==null?0:s.length;for(this.clear();++c<f;){var p=s[c];this.set(p[0],p[1])}}function aw(){this.size=0,this.__data__={hash:new xr,map:new(Ji||Mn),string:new xr}}function cw(s){var c=So(this,s).delete(s);return this.size-=c?1:0,c}function lw(s){return So(this,s).get(s)}function uw(s){return So(this,s).has(s)}function hw(s,c){var f=So(this,s),p=f.size;return f.set(s,c),this.size+=f.size==p?0:1,this}Rn.prototype.clear=aw,Rn.prototype.delete=cw,Rn.prototype.get=lw,Rn.prototype.has=uw,Rn.prototype.set=hw;function Sr(s){var c=-1,f=s==null?0:s.length;for(this.__data__=new Rn;++c<f;)this.add(s[c])}function fw(s){return this.__data__.set(s,h),this}function dw(s){return this.__data__.has(s)}Sr.prototype.add=Sr.prototype.push=fw,Sr.prototype.has=dw;function je(s){var c=this.__data__=new Mn(s);this.size=c.size}function gw(){this.__data__=new Mn,this.size=0}function pw(s){var c=this.__data__,f=c.delete(s);return this.size=c.size,f}function mw(s){return this.__data__.get(s)}function yw(s){return this.__data__.has(s)}function ww(s,c){var f=this.__data__;if(f instanceof Mn){var p=f.__data__;if(!Ji||p.length<i-1)return p.push([s,c]),this.size=++f.size,this;f=this.__data__=new Rn(p)}return f.set(s,c),this.size=f.size,this}je.prototype.clear=gw,je.prototype.delete=pw,je.prototype.get=mw,je.prototype.has=yw,je.prototype.set=ww;function $h(s,c){var f=pt(s),p=!f&&Tr(s),x=!f&&!p&&ir(s),C=!f&&!p&&!x&&ii(s),E=f||p||x||C,I=E?bc(s.length,Ty):[],k=I.length;for(var H in s)(c||kt.call(s,H))&&!(E&&(H=="length"||x&&(H=="offset"||H=="parent")||C&&(H=="buffer"||H=="byteLength"||H=="byteOffset")||Fn(H,k)))&&I.push(H);return I}function Wh(s){var c=s.length;return c?s[Dc(0,c-1)]:e}function vw(s,c){return Co(ye(s),Cr(c,0,s.length))}function bw(s){return Co(ye(s))}function Nc(s,c,f){(f!==e&&!tn(s[c],f)||f===e&&!(c in s))&&Ln(s,c,f)}function ts(s,c,f){var p=s[c];(!(kt.call(s,c)&&tn(p,f))||f===e&&!(c in s))&&Ln(s,c,f)}function uo(s,c){for(var f=s.length;f--;)if(tn(s[f][0],c))return f;return-1}function _w(s,c,f,p){return tr(s,function(x,C,E){c(p,x,f(x),E)}),p}function Hh(s,c){return s&&hn(c,ee(c),s)}function xw(s,c){return s&&hn(c,ve(c),s)}function Ln(s,c,f){c=="__proto__"&&io?io(s,c,{configurable:!0,enumerable:!0,value:f,writable:!0}):s[c]=f}function Tc(s,c){for(var f=-1,p=c.length,x=B(p),C=s==null;++f<p;)x[f]=C?e:cl(s,c[f]);return x}function Cr(s,c,f){return s===s&&(f!==e&&(s=s<=f?s:f),c!==e&&(s=s>=c?s:c)),s}function $e(s,c,f,p,x,C){var E,I=c&g,k=c&y,H=c&m;if(f&&(E=x?f(s,p,x,C):f(s)),E!==e)return E;if(!Ht(s))return s;var q=pt(s);if(q){if(E=uv(s),!I)return ye(s,E)}else{var Y=le(s),J=Y==$s||Y==Uu;if(ir(s))return pf(s,I);if(Y==In||Y==ft||J&&!x){if(E=k||J?{}:kf(s),!I)return k?jw(s,xw(E,s)):Zw(s,Hh(E,s))}else{if(!Vt[Y])return x?s:{};E=hv(s,Y,I)}}C||(C=new je);var nt=C.get(s);if(nt)return nt;C.set(s,E),ld(s)?s.forEach(function(ct){E.add($e(ct,c,f,ct,s,C))}):ad(s)&&s.forEach(function(ct,_t){E.set(_t,$e(ct,c,f,_t,s,C))});var at=H?k?Kc:Yc:k?ve:ee,yt=q?e:at(s);return Ve(yt||s,function(ct,_t){yt&&(_t=ct,ct=s[_t]),ts(E,_t,$e(ct,c,f,_t,s,C))}),E}function Sw(s){var c=ee(s);return function(f){return qh(f,s,c)}}function qh(s,c,f){var p=f.length;if(s==null)return!p;for(s=Dt(s);p--;){var x=f[p],C=c[x],E=s[x];if(E===e&&!(x in s)||!C(E))return!1}return!0}function Uh(s,c,f){if(typeof s!="function")throw new Ge(a);return as(function(){s.apply(e,f)},c)}function es(s,c,f,p){var x=-1,C=Ys,E=!0,I=s.length,k=[],H=c.length;if(!I)return k;f&&(c=$t(c,Ae(f))),p?(C=gc,E=!1):c.length>=i&&(C=Ki,E=!1,c=new Sr(c));t:for(;++x<I;){var q=s[x],Y=f==null?q:f(q);if(q=p||q!==0?q:0,E&&Y===Y){for(var J=H;J--;)if(c[J]===Y)continue t;k.push(q)}else C(c,Y,p)||k.push(q)}return k}var tr=bf(un),Yh=bf(Ic,!0);function Cw(s,c){var f=!0;return tr(s,function(p,x,C){return f=!!c(p,x,C),f}),f}function ho(s,c,f){for(var p=-1,x=s.length;++p<x;){var C=s[p],E=c(C);if(E!=null&&(I===e?E===E&&!Te(E):f(E,I)))var I=E,k=C}return k}function Pw(s,c,f,p){var x=s.length;for(f=mt(f),f<0&&(f=-f>x?0:x+f),p=p===e||p>x?x:mt(p),p<0&&(p+=x),p=f>p?0:hd(p);f<p;)s[f++]=c;return s}function Kh(s,c){var f=[];return tr(s,function(p,x,C){c(p,x,C)&&f.push(p)}),f}function oe(s,c,f,p,x){var C=-1,E=s.length;for(f||(f=dv),x||(x=[]);++C<E;){var I=s[C];c>0&&f(I)?c>1?oe(I,c-1,f,p,x):Qn(x,I):p||(x[x.length]=I)}return x}var Ec=_f(),Xh=_f(!0);function un(s,c){return s&&Ec(s,c,ee)}function Ic(s,c){return s&&Xh(s,c,ee)}function fo(s,c){return Jn(c,function(f){return Dn(s[f])})}function Pr(s,c){c=nr(c,s);for(var f=0,p=c.length;s!=null&&f<p;)s=s[fn(c[f++])];return f&&f==p?s:e}function Jh(s,c,f){var p=c(s);return pt(s)?p:Qn(p,f(s))}function ue(s){return s==null?s===e?tm:Z0:_r&&_r in Dt(s)?av(s):bv(s)}function Mc(s,c){return s>c}function Aw(s,c){return s!=null&&kt.call(s,c)}function Nw(s,c){return s!=null&&c in Dt(s)}function Tw(s,c,f){return s>=ce(c,f)&&s<jt(c,f)}function Rc(s,c,f){for(var p=f?gc:Ys,x=s[0].length,C=s.length,E=C,I=B(C),k=1/0,H=[];E--;){var q=s[E];E&&c&&(q=$t(q,Ae(c))),k=ce(q.length,k),I[E]=!f&&(c||x>=120&&q.length>=120)?new Sr(E&&q):e}q=s[0];var Y=-1,J=I[0];t:for(;++Y<x&&H.length<k;){var nt=q[Y],at=c?c(nt):nt;if(nt=f||nt!==0?nt:0,!(J?Ki(J,at):p(H,at,f))){for(E=C;--E;){var yt=I[E];if(!(yt?Ki(yt,at):p(s[E],at,f)))continue t}J&&J.push(at),H.push(nt)}}return H}function Ew(s,c,f,p){return un(s,function(x,C,E){c(p,f(x),C,E)}),p}function ns(s,c,f){c=nr(c,s),s=Bf(s,c);var p=s==null?s:s[fn(He(c))];return p==null?e:Pe(p,s,f)}function Qh(s){return qt(s)&&ue(s)==ft}function Iw(s){return qt(s)&&ue(s)==Yi}function Mw(s){return qt(s)&&ue(s)==me}function rs(s,c,f,p,x){return s===c?!0:s==null||c==null||!qt(s)&&!qt(c)?s!==s&&c!==c:Rw(s,c,f,p,rs,x)}function Rw(s,c,f,p,x,C){var E=pt(s),I=pt(c),k=E?Wt:le(s),H=I?Wt:le(c);k=k==ft?In:k,H=H==ft?In:H;var q=k==In,Y=H==In,J=k==H;if(J&&ir(s)){if(!ir(c))return!1;E=!0,q=!1}if(J&&!q)return C||(C=new je),E||ii(s)?Mf(s,c,f,p,x,C):sv(s,c,k,f,p,x,C);if(!(f&w)){var nt=q&&kt.call(s,"__wrapped__"),at=Y&&kt.call(c,"__wrapped__");if(nt||at){var yt=nt?s.value():s,ct=at?c.value():c;return C||(C=new je),x(yt,ct,f,p,C)}}return J?(C||(C=new je),ov(s,c,f,p,x,C)):!1}function Lw(s){return qt(s)&&le(s)==Je}function Lc(s,c,f,p){var x=f.length,C=x,E=!p;if(s==null)return!C;for(s=Dt(s);x--;){var I=f[x];if(E&&I[2]?I[1]!==s[I[0]]:!(I[0]in s))return!1}for(;++x<C;){I=f[x];var k=I[0],H=s[k],q=I[1];if(E&&I[2]){if(H===e&&!(k in s))return!1}else{var Y=new je;if(p)var J=p(H,q,k,s,c,Y);if(!(J===e?rs(q,H,w|v,p,Y):J))return!1}}return!0}function Zh(s){if(!Ht(s)||pv(s))return!1;var c=Dn(s)?Ly:Sm;return c.test(Nr(s))}function kw(s){return qt(s)&&ue(s)==Hi}function Ow(s){return qt(s)&&le(s)==Qe}function Fw(s){return qt(s)&&Io(s.length)&&!!Gt[ue(s)]}function jh(s){return typeof s=="function"?s:s==null?be:typeof s=="object"?pt(s)?nf(s[0],s[1]):ef(s):xd(s)}function kc(s){if(!os(s))return Vy(s);var c=[];for(var f in Dt(s))kt.call(s,f)&&f!="constructor"&&c.push(f);return c}function Dw(s){if(!Ht(s))return vv(s);var c=os(s),f=[];for(var p in s)p=="constructor"&&(c||!kt.call(s,p))||f.push(p);return f}function Oc(s,c){return s<c}function tf(s,c){var f=-1,p=we(s)?B(s.length):[];return tr(s,function(x,C,E){p[++f]=c(x,C,E)}),p}function ef(s){var c=Jc(s);return c.length==1&&c[0][2]?Ff(c[0][0],c[0][1]):function(f){return f===s||Lc(f,s,c)}}function nf(s,c){return Zc(s)&&Of(c)?Ff(fn(s),c):function(f){var p=cl(f,s);return p===e&&p===c?ll(f,s):rs(c,p,w|v)}}function go(s,c,f,p,x){s!==c&&Ec(c,function(C,E){if(x||(x=new je),Ht(C))Bw(s,c,E,f,go,p,x);else{var I=p?p(tl(s,E),C,E+"",s,c,x):e;I===e&&(I=C),Nc(s,E,I)}},ve)}function Bw(s,c,f,p,x,C,E){var I=tl(s,f),k=tl(c,f),H=E.get(k);if(H){Nc(s,f,H);return}var q=C?C(I,k,f+"",s,c,E):e,Y=q===e;if(Y){var J=pt(k),nt=!J&&ir(k),at=!J&&!nt&&ii(k);q=k,J||nt||at?pt(I)?q=I:Yt(I)?q=ye(I):nt?(Y=!1,q=pf(k,!0)):at?(Y=!1,q=mf(k,!0)):q=[]:cs(k)||Tr(k)?(q=I,Tr(I)?q=fd(I):(!Ht(I)||Dn(I))&&(q=kf(k))):Y=!1}Y&&(E.set(k,q),x(q,k,p,C,E),E.delete(k)),Nc(s,f,q)}function rf(s,c){var f=s.length;if(f)return c+=c<0?f:0,Fn(c,f)?s[c]:e}function sf(s,c,f){c.length?c=$t(c,function(C){return pt(C)?function(E){return Pr(E,C.length===1?C[0]:C)}:C}):c=[be];var p=-1;c=$t(c,Ae(it()));var x=tf(s,function(C,E,I){var k=$t(c,function(H){return H(C)});return{criteria:k,index:++p,value:C}});return hy(x,function(C,E){return Qw(C,E,f)})}function Vw(s,c){return of(s,c,function(f,p){return ll(s,p)})}function of(s,c,f){for(var p=-1,x=c.length,C={};++p<x;){var E=c[p],I=Pr(s,E);f(I,E)&&is(C,nr(E,s),I)}return C}function Gw(s){return function(c){return Pr(c,s)}}function Fc(s,c,f,p){var x=p?uy:Yr,C=-1,E=c.length,I=s;for(s===c&&(c=ye(c)),f&&(I=$t(s,Ae(f)));++C<E;)for(var k=0,H=c[C],q=f?f(H):H;(k=x(I,q,k,p))>-1;)I!==s&&ro.call(I,k,1),ro.call(s,k,1);return s}function af(s,c){for(var f=s?c.length:0,p=f-1;f--;){var x=c[f];if(f==p||x!==C){var C=x;Fn(x)?ro.call(s,x,1):Gc(s,x)}}return s}function Dc(s,c){return s+oo(Gh()*(c-s+1))}function zw(s,c,f,p){for(var x=-1,C=jt(so((c-s)/(f||1)),0),E=B(C);C--;)E[p?C:++x]=s,s+=f;return E}function Bc(s,c){var f="";if(!s||c<1||c>It)return f;do c%2&&(f+=s),c=oo(c/2),c&&(s+=s);while(c);return f}function vt(s,c){return el(Df(s,c,be),s+"")}function $w(s){return Wh(si(s))}function Ww(s,c){var f=si(s);return Co(f,Cr(c,0,f.length))}function is(s,c,f,p){if(!Ht(s))return s;c=nr(c,s);for(var x=-1,C=c.length,E=C-1,I=s;I!=null&&++x<C;){var k=fn(c[x]),H=f;if(k==="__proto__"||k==="constructor"||k==="prototype")return s;if(x!=E){var q=I[k];H=p?p(q,k,I):e,H===e&&(H=Ht(q)?q:Fn(c[x+1])?[]:{})}ts(I,k,H),I=I[k]}return s}var cf=ao?function(s,c){return ao.set(s,c),s}:be,Hw=io?function(s,c){return io(s,"toString",{configurable:!0,enumerable:!1,value:hl(c),writable:!0})}:be;function qw(s){return Co(si(s))}function We(s,c,f){var p=-1,x=s.length;c<0&&(c=-c>x?0:x+c),f=f>x?x:f,f<0&&(f+=x),x=c>f?0:f-c>>>0,c>>>=0;for(var C=B(x);++p<x;)C[p]=s[p+c];return C}function Uw(s,c){var f;return tr(s,function(p,x,C){return f=c(p,x,C),!f}),!!f}function po(s,c,f){var p=0,x=s==null?p:s.length;if(typeof c=="number"&&c===c&&x<=ht){for(;p<x;){var C=p+x>>>1,E=s[C];E!==null&&!Te(E)&&(f?E<=c:E<c)?p=C+1:x=C}return x}return Vc(s,c,be,f)}function Vc(s,c,f,p){var x=0,C=s==null?0:s.length;if(C===0)return 0;c=f(c);for(var E=c!==c,I=c===null,k=Te(c),H=c===e;x<C;){var q=oo((x+C)/2),Y=f(s[q]),J=Y!==e,nt=Y===null,at=Y===Y,yt=Te(Y);if(E)var ct=p||at;else H?ct=at&&(p||J):I?ct=at&&J&&(p||!nt):k?ct=at&&J&&!nt&&(p||!yt):nt||yt?ct=!1:ct=p?Y<=c:Y<c;ct?x=q+1:C=q}return ce(C,ot)}function lf(s,c){for(var f=-1,p=s.length,x=0,C=[];++f<p;){var E=s[f],I=c?c(E):E;if(!f||!tn(I,k)){var k=I;C[x++]=E===0?0:E}}return C}function uf(s){return typeof s=="number"?s:Te(s)?K:+s}function Ne(s){if(typeof s=="string")return s;if(pt(s))return $t(s,Ne)+"";if(Te(s))return zh?zh.call(s):"";var c=s+"";return c=="0"&&1/s==-Lt?"-0":c}function er(s,c,f){var p=-1,x=Ys,C=s.length,E=!0,I=[],k=I;if(f)E=!1,x=gc;else if(C>=i){var H=c?null:rv(s);if(H)return Xs(H);E=!1,x=Ki,k=new Sr}else k=c?[]:I;t:for(;++p<C;){var q=s[p],Y=c?c(q):q;if(q=f||q!==0?q:0,E&&Y===Y){for(var J=k.length;J--;)if(k[J]===Y)continue t;c&&k.push(Y),I.push(q)}else x(k,Y,f)||(k!==I&&k.push(Y),I.push(q))}return I}function Gc(s,c){return c=nr(c,s),s=Bf(s,c),s==null||delete s[fn(He(c))]}function hf(s,c,f,p){return is(s,c,f(Pr(s,c)),p)}function mo(s,c,f,p){for(var x=s.length,C=p?x:-1;(p?C--:++C<x)&&c(s[C],C,s););return f?We(s,p?0:C,p?C+1:x):We(s,p?C+1:0,p?x:C)}function ff(s,c){var f=s;return f instanceof St&&(f=f.value()),pc(c,function(p,x){return x.func.apply(x.thisArg,Qn([p],x.args))},f)}function zc(s,c,f){var p=s.length;if(p<2)return p?er(s[0]):[];for(var x=-1,C=B(p);++x<p;)for(var E=s[x],I=-1;++I<p;)I!=x&&(C[x]=es(C[x]||E,s[I],c,f));return er(oe(C,1),c,f)}function df(s,c,f){for(var p=-1,x=s.length,C=c.length,E={};++p<x;){var I=p<C?c[p]:e;f(E,s[p],I)}return E}function $c(s){return Yt(s)?s:[]}function Wc(s){return typeof s=="function"?s:be}function nr(s,c){return pt(s)?s:Zc(s,c)?[s]:$f(Rt(s))}var Yw=vt;function rr(s,c,f){var p=s.length;return f=f===e?p:f,!c&&f>=p?s:We(s,c,f)}var gf=ky||function(s){return se.clearTimeout(s)};function pf(s,c){if(c)return s.slice();var f=s.length,p=Oh?Oh(f):new s.constructor(f);return s.copy(p),p}function Hc(s){var c=new s.constructor(s.byteLength);return new eo(c).set(new eo(s)),c}function Kw(s,c){var f=c?Hc(s.buffer):s.buffer;return new s.constructor(f,s.byteOffset,s.byteLength)}function Xw(s){var c=new s.constructor(s.source,Qu.exec(s));return c.lastIndex=s.lastIndex,c}function Jw(s){return ji?Dt(ji.call(s)):{}}function mf(s,c){var f=c?Hc(s.buffer):s.buffer;return new s.constructor(f,s.byteOffset,s.length)}function yf(s,c){if(s!==c){var f=s!==e,p=s===null,x=s===s,C=Te(s),E=c!==e,I=c===null,k=c===c,H=Te(c);if(!I&&!H&&!C&&s>c||C&&E&&k&&!I&&!H||p&&E&&k||!f&&k||!x)return 1;if(!p&&!C&&!H&&s<c||H&&f&&x&&!p&&!C||I&&f&&x||!E&&x||!k)return-1}return 0}function Qw(s,c,f){for(var p=-1,x=s.criteria,C=c.criteria,E=x.length,I=f.length;++p<E;){var k=yf(x[p],C[p]);if(k){if(p>=I)return k;var H=f[p];return k*(H=="desc"?-1:1)}}return s.index-c.index}function wf(s,c,f,p){for(var x=-1,C=s.length,E=f.length,I=-1,k=c.length,H=jt(C-E,0),q=B(k+H),Y=!p;++I<k;)q[I]=c[I];for(;++x<E;)(Y||x<C)&&(q[f[x]]=s[x]);for(;H--;)q[I++]=s[x++];return q}function vf(s,c,f,p){for(var x=-1,C=s.length,E=-1,I=f.length,k=-1,H=c.length,q=jt(C-I,0),Y=B(q+H),J=!p;++x<q;)Y[x]=s[x];for(var nt=x;++k<H;)Y[nt+k]=c[k];for(;++E<I;)(J||x<C)&&(Y[nt+f[E]]=s[x++]);return Y}function ye(s,c){var f=-1,p=s.length;for(c||(c=B(p));++f<p;)c[f]=s[f];return c}function hn(s,c,f,p){var x=!f;f||(f={});for(var C=-1,E=c.length;++C<E;){var I=c[C],k=p?p(f[I],s[I],I,f,s):e;k===e&&(k=s[I]),x?Ln(f,I,k):ts(f,I,k)}return f}function Zw(s,c){return hn(s,Qc(s),c)}function jw(s,c){return hn(s,Rf(s),c)}function yo(s,c){return function(f,p){var x=pt(f)?iy:_w,C=c?c():{};return x(f,s,it(p,2),C)}}function ei(s){return vt(function(c,f){var p=-1,x=f.length,C=x>1?f[x-1]:e,E=x>2?f[2]:e;for(C=s.length>3&&typeof C=="function"?(x--,C):e,E&&he(f[0],f[1],E)&&(C=x<3?e:C,x=1),c=Dt(c);++p<x;){var I=f[p];I&&s(c,I,p,C)}return c})}function bf(s,c){return function(f,p){if(f==null)return f;if(!we(f))return s(f,p);for(var x=f.length,C=c?x:-1,E=Dt(f);(c?C--:++C<x)&&p(E[C],C,E)!==!1;);return f}}function _f(s){return function(c,f,p){for(var x=-1,C=Dt(c),E=p(c),I=E.length;I--;){var k=E[s?I:++x];if(f(C[k],k,C)===!1)break}return c}}function tv(s,c,f){var p=c&_,x=ss(s);function C(){var E=this&&this!==se&&this instanceof C?x:s;return E.apply(p?f:this,arguments)}return C}function xf(s){return function(c){c=Rt(c);var f=Kr(c)?Ze(c):e,p=f?f[0]:c.charAt(0),x=f?rr(f,1).join(""):c.slice(1);return p[s]()+x}}function ni(s){return function(c){return pc(bd(vd(c).replace(Hm,"")),s,"")}}function ss(s){return function(){var c=arguments;switch(c.length){case 0:return new s;case 1:return new s(c[0]);case 2:return new s(c[0],c[1]);case 3:return new s(c[0],c[1],c[2]);case 4:return new s(c[0],c[1],c[2],c[3]);case 5:return new s(c[0],c[1],c[2],c[3],c[4]);case 6:return new s(c[0],c[1],c[2],c[3],c[4],c[5]);case 7:return new s(c[0],c[1],c[2],c[3],c[4],c[5],c[6])}var f=ti(s.prototype),p=s.apply(f,c);return Ht(p)?p:f}}function ev(s,c,f){var p=ss(s);function x(){for(var C=arguments.length,E=B(C),I=C,k=ri(x);I--;)E[I]=arguments[I];var H=C<3&&E[0]!==k&&E[C-1]!==k?[]:Zn(E,k);if(C-=H.length,C<f)return Nf(s,c,wo,x.placeholder,e,E,H,e,e,f-C);var q=this&&this!==se&&this instanceof x?p:s;return Pe(q,this,E)}return x}function Sf(s){return function(c,f,p){var x=Dt(c);if(!we(c)){var C=it(f,3);c=ee(c),f=function(I){return C(x[I],I,x)}}var E=s(c,f,p);return E>-1?x[C?c[E]:E]:e}}function Cf(s){return On(function(c){var f=c.length,p=f,x=ze.prototype.thru;for(s&&c.reverse();p--;){var C=c[p];if(typeof C!="function")throw new Ge(a);if(x&&!E&&xo(C)=="wrapper")var E=new ze([],!0)}for(p=E?p:f;++p<f;){C=c[p];var I=xo(C),k=I=="wrapper"?Xc(C):e;k&&jc(k[0])&&k[1]==(R|A|P|O)&&!k[4].length&&k[9]==1?E=E[xo(k[0])].apply(E,k[3]):E=C.length==1&&jc(C)?E[I]():E.thru(C)}return function(){var H=arguments,q=H[0];if(E&&H.length==1&&pt(q))return E.plant(q).value();for(var Y=0,J=f?c[Y].apply(this,H):q;++Y<f;)J=c[Y].call(this,J);return J}})}function wo(s,c,f,p,x,C,E,I,k,H){var q=c&R,Y=c&_,J=c&b,nt=c&(A|T),at=c&V,yt=J?e:ss(s);function ct(){for(var _t=arguments.length,Pt=B(_t),Ee=_t;Ee--;)Pt[Ee]=arguments[Ee];if(nt)var fe=ri(ct),Ie=dy(Pt,fe);if(p&&(Pt=wf(Pt,p,x,nt)),C&&(Pt=vf(Pt,C,E,nt)),_t-=Ie,nt&&_t<H){var Kt=Zn(Pt,fe);return Nf(s,c,wo,ct.placeholder,f,Pt,Kt,I,k,H-_t)}var en=Y?f:this,Vn=J?en[s]:s;return _t=Pt.length,I?Pt=_v(Pt,I):at&&_t>1&&Pt.reverse(),q&&k<_t&&(Pt.length=k),this&&this!==se&&this instanceof ct&&(Vn=yt||ss(Vn)),Vn.apply(en,Pt)}return ct}function Pf(s,c){return function(f,p){return Ew(f,s,c(p),{})}}function vo(s,c){return function(f,p){var x;if(f===e&&p===e)return c;if(f!==e&&(x=f),p!==e){if(x===e)return p;typeof f=="string"||typeof p=="string"?(f=Ne(f),p=Ne(p)):(f=uf(f),p=uf(p)),x=s(f,p)}return x}}function qc(s){return On(function(c){return c=$t(c,Ae(it())),vt(function(f){var p=this;return s(c,function(x){return Pe(x,p,f)})})})}function bo(s,c){c=c===e?" ":Ne(c);var f=c.length;if(f<2)return f?Bc(c,s):c;var p=Bc(c,so(s/Xr(c)));return Kr(c)?rr(Ze(p),0,s).join(""):p.slice(0,s)}function nv(s,c,f,p){var x=c&_,C=ss(s);function E(){for(var I=-1,k=arguments.length,H=-1,q=p.length,Y=B(q+k),J=this&&this!==se&&this instanceof E?C:s;++H<q;)Y[H]=p[H];for(;k--;)Y[H++]=arguments[++I];return Pe(J,x?f:this,Y)}return E}function Af(s){return function(c,f,p){return p&&typeof p!="number"&&he(c,f,p)&&(f=p=e),c=Bn(c),f===e?(f=c,c=0):f=Bn(f),p=p===e?c<f?1:-1:Bn(p),zw(c,f,p,s)}}function _o(s){return function(c,f){return typeof c=="string"&&typeof f=="string"||(c=qe(c),f=qe(f)),s(c,f)}}function Nf(s,c,f,p,x,C,E,I,k,H){var q=c&A,Y=q?E:e,J=q?e:E,nt=q?C:e,at=q?e:C;c|=q?P:M,c&=~(q?M:P),c&N||(c&=~(_|b));var yt=[s,c,x,nt,Y,at,J,I,k,H],ct=f.apply(e,yt);return jc(s)&&Vf(ct,yt),ct.placeholder=p,Gf(ct,s,c)}function Uc(s){var c=Zt[s];return function(f,p){if(f=qe(f),p=p==null?0:ce(mt(p),292),p&&Vh(f)){var x=(Rt(f)+"e").split("e"),C=c(x[0]+"e"+(+x[1]+p));return x=(Rt(C)+"e").split("e"),+(x[0]+"e"+(+x[1]-p))}return c(f)}}var rv=Zr&&1/Xs(new Zr([,-0]))[1]==Lt?function(s){return new Zr(s)}:gl;function Tf(s){return function(c){var f=le(c);return f==Je?xc(c):f==Qe?by(c):fy(c,s(c))}}function kn(s,c,f,p,x,C,E,I){var k=c&b;if(!k&&typeof s!="function")throw new Ge(a);var H=p?p.length:0;if(H||(c&=~(P|M),p=x=e),E=E===e?E:jt(mt(E),0),I=I===e?I:mt(I),H-=x?x.length:0,c&M){var q=p,Y=x;p=x=e}var J=k?e:Xc(s),nt=[s,c,f,p,x,q,Y,C,E,I];if(J&&wv(nt,J),s=nt[0],c=nt[1],f=nt[2],p=nt[3],x=nt[4],I=nt[9]=nt[9]===e?k?0:s.length:jt(nt[9]-H,0),!I&&c&(A|T)&&(c&=~(A|T)),!c||c==_)var at=tv(s,c,f);else c==A||c==T?at=ev(s,c,I):(c==P||c==(_|P))&&!x.length?at=nv(s,c,f,p):at=wo.apply(e,nt);var yt=J?cf:Vf;return Gf(yt(at,nt),s,c)}function Ef(s,c,f,p){return s===e||tn(s,Qr[f])&&!kt.call(p,f)?c:s}function If(s,c,f,p,x,C){return Ht(s)&&Ht(c)&&(C.set(c,s),go(s,c,e,If,C),C.delete(c)),s}function iv(s){return cs(s)?e:s}function Mf(s,c,f,p,x,C){var E=f&w,I=s.length,k=c.length;if(I!=k&&!(E&&k>I))return!1;var H=C.get(s),q=C.get(c);if(H&&q)return H==c&&q==s;var Y=-1,J=!0,nt=f&v?new Sr:e;for(C.set(s,c),C.set(c,s);++Y<I;){var at=s[Y],yt=c[Y];if(p)var ct=E?p(yt,at,Y,c,s,C):p(at,yt,Y,s,c,C);if(ct!==e){if(ct)continue;J=!1;break}if(nt){if(!mc(c,function(_t,Pt){if(!Ki(nt,Pt)&&(at===_t||x(at,_t,f,p,C)))return nt.push(Pt)})){J=!1;break}}else if(!(at===yt||x(at,yt,f,p,C))){J=!1;break}}return C.delete(s),C.delete(c),J}function sv(s,c,f,p,x,C,E){switch(f){case qr:if(s.byteLength!=c.byteLength||s.byteOffset!=c.byteOffset)return!1;s=s.buffer,c=c.buffer;case Yi:return!(s.byteLength!=c.byteLength||!C(new eo(s),new eo(c)));case De:case me:case Wi:return tn(+s,+c);case Hr:return s.name==c.name&&s.message==c.message;case Hi:case qi:return s==c+"";case Je:var I=xc;case Qe:var k=p&w;if(I||(I=Xs),s.size!=c.size&&!k)return!1;var H=E.get(s);if(H)return H==c;p|=v,E.set(s,c);var q=Mf(I(s),I(c),p,x,C,E);return E.delete(s),q;case Ws:if(ji)return ji.call(s)==ji.call(c)}return!1}function ov(s,c,f,p,x,C){var E=f&w,I=Yc(s),k=I.length,H=Yc(c),q=H.length;if(k!=q&&!E)return!1;for(var Y=k;Y--;){var J=I[Y];if(!(E?J in c:kt.call(c,J)))return!1}var nt=C.get(s),at=C.get(c);if(nt&&at)return nt==c&&at==s;var yt=!0;C.set(s,c),C.set(c,s);for(var ct=E;++Y<k;){J=I[Y];var _t=s[J],Pt=c[J];if(p)var Ee=E?p(Pt,_t,J,c,s,C):p(_t,Pt,J,s,c,C);if(!(Ee===e?_t===Pt||x(_t,Pt,f,p,C):Ee)){yt=!1;break}ct||(ct=J=="constructor")}if(yt&&!ct){var fe=s.constructor,Ie=c.constructor;fe!=Ie&&"constructor"in s&&"constructor"in c&&!(typeof fe=="function"&&fe instanceof fe&&typeof Ie=="function"&&Ie instanceof Ie)&&(yt=!1)}return C.delete(s),C.delete(c),yt}function On(s){return el(Df(s,e,Uf),s+"")}function Yc(s){return Jh(s,ee,Qc)}function Kc(s){return Jh(s,ve,Rf)}var Xc=ao?function(s){return ao.get(s)}:gl;function xo(s){for(var c=s.name+"",f=jr[c],p=kt.call(jr,c)?f.length:0;p--;){var x=f[p],C=x.func;if(C==null||C==s)return x.name}return c}function ri(s){var c=kt.call(S,"placeholder")?S:s;return c.placeholder}function it(){var s=S.iteratee||fl;return s=s===fl?jh:s,arguments.length?s(arguments[0],arguments[1]):s}function So(s,c){var f=s.__data__;return gv(c)?f[typeof c=="string"?"string":"hash"]:f.map}function Jc(s){for(var c=ee(s),f=c.length;f--;){var p=c[f],x=s[p];c[f]=[p,x,Of(x)]}return c}function Ar(s,c){var f=yy(s,c);return Zh(f)?f:e}function av(s){var c=kt.call(s,_r),f=s[_r];try{s[_r]=e;var p=!0}catch{}var x=js.call(s);return p&&(c?s[_r]=f:delete s[_r]),x}var Qc=Cc?function(s){return s==null?[]:(s=Dt(s),Jn(Cc(s),function(c){return Dh.call(s,c)}))}:pl,Rf=Cc?function(s){for(var c=[];s;)Qn(c,Qc(s)),s=no(s);return c}:pl,le=ue;(Pc&&le(new Pc(new ArrayBuffer(1)))!=qr||Ji&&le(new Ji)!=Je||Ac&&le(Ac.resolve())!=Yu||Zr&&le(new Zr)!=Qe||Qi&&le(new Qi)!=Ui)&&(le=function(s){var c=ue(s),f=c==In?s.constructor:e,p=f?Nr(f):"";if(p)switch(p){case Wy:return qr;case Hy:return Je;case qy:return Yu;case Uy:return Qe;case Yy:return Ui}return c});function cv(s,c,f){for(var p=-1,x=f.length;++p<x;){var C=f[p],E=C.size;switch(C.type){case"drop":s+=E;break;case"dropRight":c-=E;break;case"take":c=ce(c,s+E);break;case"takeRight":s=jt(s,c-E);break}}return{start:s,end:c}}function lv(s){var c=s.match(pm);return c?c[1].split(mm):[]}function Lf(s,c,f){c=nr(c,s);for(var p=-1,x=c.length,C=!1;++p<x;){var E=fn(c[p]);if(!(C=s!=null&&f(s,E)))break;s=s[E]}return C||++p!=x?C:(x=s==null?0:s.length,!!x&&Io(x)&&Fn(E,x)&&(pt(s)||Tr(s)))}function uv(s){var c=s.length,f=new s.constructor(c);return c&&typeof s[0]=="string"&&kt.call(s,"index")&&(f.index=s.index,f.input=s.input),f}function kf(s){return typeof s.constructor=="function"&&!os(s)?ti(no(s)):{}}function hv(s,c,f){var p=s.constructor;switch(c){case Yi:return Hc(s);case De:case me:return new p(+s);case qr:return Kw(s,f);case Ja:case Qa:case Za:case ja:case tc:case ec:case nc:case rc:case ic:return mf(s,f);case Je:return new p;case Wi:case qi:return new p(s);case Hi:return Xw(s);case Qe:return new p;case Ws:return Jw(s)}}function fv(s,c){var f=c.length;if(!f)return s;var p=f-1;return c[p]=(f>1?"& ":"")+c[p],c=c.join(f>2?", ":" "),s.replace(gm,`{
/* [wrapped with `+c+`] */
`)}function dv(s){return pt(s)||Tr(s)||!!(Bh&&s&&s[Bh])}function Fn(s,c){var f=typeof s;return c=c??It,!!c&&(f=="number"||f!="symbol"&&Pm.test(s))&&s>-1&&s%1==0&&s<c}function he(s,c,f){if(!Ht(f))return!1;var p=typeof c;return(p=="number"?we(f)&&Fn(c,f.length):p=="string"&&c in f)?tn(f[c],s):!1}function Zc(s,c){if(pt(s))return!1;var f=typeof s;return f=="number"||f=="symbol"||f=="boolean"||s==null||Te(s)?!0:um.test(s)||!lm.test(s)||c!=null&&s in Dt(c)}function gv(s){var c=typeof s;return c=="string"||c=="number"||c=="symbol"||c=="boolean"?s!=="__proto__":s===null}function jc(s){var c=xo(s),f=S[c];if(typeof f!="function"||!(c in St.prototype))return!1;if(s===f)return!0;var p=Xc(f);return!!p&&s===p[0]}function pv(s){return!!kh&&kh in s}var mv=Qs?Dn:ml;function os(s){var c=s&&s.constructor,f=typeof c=="function"&&c.prototype||Qr;return s===f}function Of(s){return s===s&&!Ht(s)}function Ff(s,c){return function(f){return f==null?!1:f[s]===c&&(c!==e||s in Dt(f))}}function yv(s){var c=To(s,function(p){return f.size===u&&f.clear(),p}),f=c.cache;return c}function wv(s,c){var f=s[1],p=c[1],x=f|p,C=x<(_|b|R),E=p==R&&f==A||p==R&&f==O&&s[7].length<=c[8]||p==(R|O)&&c[7].length<=c[8]&&f==A;if(!(C||E))return s;p&_&&(s[2]=c[2],x|=f&_?0:N);var I=c[3];if(I){var k=s[3];s[3]=k?wf(k,I,c[4]):I,s[4]=k?Zn(s[3],d):c[4]}return I=c[5],I&&(k=s[5],s[5]=k?vf(k,I,c[6]):I,s[6]=k?Zn(s[5],d):c[6]),I=c[7],I&&(s[7]=I),p&R&&(s[8]=s[8]==null?c[8]:ce(s[8],c[8])),s[9]==null&&(s[9]=c[9]),s[0]=c[0],s[1]=x,s}function vv(s){var c=[];if(s!=null)for(var f in Dt(s))c.push(f);return c}function bv(s){return js.call(s)}function Df(s,c,f){return c=jt(c===e?s.length-1:c,0),function(){for(var p=arguments,x=-1,C=jt(p.length-c,0),E=B(C);++x<C;)E[x]=p[c+x];x=-1;for(var I=B(c+1);++x<c;)I[x]=p[x];return I[c]=f(E),Pe(s,this,I)}}function Bf(s,c){return c.length<2?s:Pr(s,We(c,0,-1))}function _v(s,c){for(var f=s.length,p=ce(c.length,f),x=ye(s);p--;){var C=c[p];s[p]=Fn(C,f)?x[C]:e}return s}function tl(s,c){if(!(c==="constructor"&&typeof s[c]=="function")&&c!="__proto__")return s[c]}var Vf=zf(cf),as=Fy||function(s,c){return se.setTimeout(s,c)},el=zf(Hw);function Gf(s,c,f){var p=c+"";return el(s,fv(p,xv(lv(p),f)))}function zf(s){var c=0,f=0;return function(){var p=Gy(),x=tt-(p-f);if(f=p,x>0){if(++c>=Z)return arguments[0]}else c=0;return s.apply(e,arguments)}}function Co(s,c){var f=-1,p=s.length,x=p-1;for(c=c===e?p:c;++f<c;){var C=Dc(f,x),E=s[C];s[C]=s[f],s[f]=E}return s.length=c,s}var $f=yv(function(s){var c=[];return s.charCodeAt(0)===46&&c.push(""),s.replace(hm,function(f,p,x,C){c.push(x?C.replace(vm,"$1"):p||f)}),c});function fn(s){if(typeof s=="string"||Te(s))return s;var c=s+"";return c=="0"&&1/s==-Lt?"-0":c}function Nr(s){if(s!=null){try{return Zs.call(s)}catch{}try{return s+""}catch{}}return""}function xv(s,c){return Ve(Ft,function(f){var p="_."+f[0];c&f[1]&&!Ys(s,p)&&s.push(p)}),s.sort()}function Wf(s){if(s instanceof St)return s.clone();var c=new ze(s.__wrapped__,s.__chain__);return c.__actions__=ye(s.__actions__),c.__index__=s.__index__,c.__values__=s.__values__,c}function Sv(s,c,f){(f?he(s,c,f):c===e)?c=1:c=jt(mt(c),0);var p=s==null?0:s.length;if(!p||c<1)return[];for(var x=0,C=0,E=B(so(p/c));x<p;)E[C++]=We(s,x,x+=c);return E}function Cv(s){for(var c=-1,f=s==null?0:s.length,p=0,x=[];++c<f;){var C=s[c];C&&(x[p++]=C)}return x}function Pv(){var s=arguments.length;if(!s)return[];for(var c=B(s-1),f=arguments[0],p=s;p--;)c[p-1]=arguments[p];return Qn(pt(f)?ye(f):[f],oe(c,1))}var Av=vt(function(s,c){return Yt(s)?es(s,oe(c,1,Yt,!0)):[]}),Nv=vt(function(s,c){var f=He(c);return Yt(f)&&(f=e),Yt(s)?es(s,oe(c,1,Yt,!0),it(f,2)):[]}),Tv=vt(function(s,c){var f=He(c);return Yt(f)&&(f=e),Yt(s)?es(s,oe(c,1,Yt,!0),e,f):[]});function Ev(s,c,f){var p=s==null?0:s.length;return p?(c=f||c===e?1:mt(c),We(s,c<0?0:c,p)):[]}function Iv(s,c,f){var p=s==null?0:s.length;return p?(c=f||c===e?1:mt(c),c=p-c,We(s,0,c<0?0:c)):[]}function Mv(s,c){return s&&s.length?mo(s,it(c,3),!0,!0):[]}function Rv(s,c){return s&&s.length?mo(s,it(c,3),!0):[]}function Lv(s,c,f,p){var x=s==null?0:s.length;return x?(f&&typeof f!="number"&&he(s,c,f)&&(f=0,p=x),Pw(s,c,f,p)):[]}function Hf(s,c,f){var p=s==null?0:s.length;if(!p)return-1;var x=f==null?0:mt(f);return x<0&&(x=jt(p+x,0)),Ks(s,it(c,3),x)}function qf(s,c,f){var p=s==null?0:s.length;if(!p)return-1;var x=p-1;return f!==e&&(x=mt(f),x=f<0?jt(p+x,0):ce(x,p-1)),Ks(s,it(c,3),x,!0)}function Uf(s){var c=s==null?0:s.length;return c?oe(s,1):[]}function kv(s){var c=s==null?0:s.length;return c?oe(s,Lt):[]}function Ov(s,c){var f=s==null?0:s.length;return f?(c=c===e?1:mt(c),oe(s,c)):[]}function Fv(s){for(var c=-1,f=s==null?0:s.length,p={};++c<f;){var x=s[c];p[x[0]]=x[1]}return p}function Yf(s){return s&&s.length?s[0]:e}function Dv(s,c,f){var p=s==null?0:s.length;if(!p)return-1;var x=f==null?0:mt(f);return x<0&&(x=jt(p+x,0)),Yr(s,c,x)}function Bv(s){var c=s==null?0:s.length;return c?We(s,0,-1):[]}var Vv=vt(function(s){var c=$t(s,$c);return c.length&&c[0]===s[0]?Rc(c):[]}),Gv=vt(function(s){var c=He(s),f=$t(s,$c);return c===He(f)?c=e:f.pop(),f.length&&f[0]===s[0]?Rc(f,it(c,2)):[]}),zv=vt(function(s){var c=He(s),f=$t(s,$c);return c=typeof c=="function"?c:e,c&&f.pop(),f.length&&f[0]===s[0]?Rc(f,e,c):[]});function $v(s,c){return s==null?"":By.call(s,c)}function He(s){var c=s==null?0:s.length;return c?s[c-1]:e}function Wv(s,c,f){var p=s==null?0:s.length;if(!p)return-1;var x=p;return f!==e&&(x=mt(f),x=x<0?jt(p+x,0):ce(x,p-1)),c===c?xy(s,c,x):Ks(s,Ah,x,!0)}function Hv(s,c){return s&&s.length?rf(s,mt(c)):e}var qv=vt(Kf);function Kf(s,c){return s&&s.length&&c&&c.length?Fc(s,c):s}function Uv(s,c,f){return s&&s.length&&c&&c.length?Fc(s,c,it(f,2)):s}function Yv(s,c,f){return s&&s.length&&c&&c.length?Fc(s,c,e,f):s}var Kv=On(function(s,c){var f=s==null?0:s.length,p=Tc(s,c);return af(s,$t(c,function(x){return Fn(x,f)?+x:x}).sort(yf)),p});function Xv(s,c){var f=[];if(!(s&&s.length))return f;var p=-1,x=[],C=s.length;for(c=it(c,3);++p<C;){var E=s[p];c(E,p,s)&&(f.push(E),x.push(p))}return af(s,x),f}function nl(s){return s==null?s:$y.call(s)}function Jv(s,c,f){var p=s==null?0:s.length;return p?(f&&typeof f!="number"&&he(s,c,f)?(c=0,f=p):(c=c==null?0:mt(c),f=f===e?p:mt(f)),We(s,c,f)):[]}function Qv(s,c){return po(s,c)}function Zv(s,c,f){return Vc(s,c,it(f,2))}function jv(s,c){var f=s==null?0:s.length;if(f){var p=po(s,c);if(p<f&&tn(s[p],c))return p}return-1}function t1(s,c){return po(s,c,!0)}function e1(s,c,f){return Vc(s,c,it(f,2),!0)}function n1(s,c){var f=s==null?0:s.length;if(f){var p=po(s,c,!0)-1;if(tn(s[p],c))return p}return-1}function r1(s){return s&&s.length?lf(s):[]}function i1(s,c){return s&&s.length?lf(s,it(c,2)):[]}function s1(s){var c=s==null?0:s.length;return c?We(s,1,c):[]}function o1(s,c,f){return s&&s.length?(c=f||c===e?1:mt(c),We(s,0,c<0?0:c)):[]}function a1(s,c,f){var p=s==null?0:s.length;return p?(c=f||c===e?1:mt(c),c=p-c,We(s,c<0?0:c,p)):[]}function c1(s,c){return s&&s.length?mo(s,it(c,3),!1,!0):[]}function l1(s,c){return s&&s.length?mo(s,it(c,3)):[]}var u1=vt(function(s){return er(oe(s,1,Yt,!0))}),h1=vt(function(s){var c=He(s);return Yt(c)&&(c=e),er(oe(s,1,Yt,!0),it(c,2))}),f1=vt(function(s){var c=He(s);return c=typeof c=="function"?c:e,er(oe(s,1,Yt,!0),e,c)});function d1(s){return s&&s.length?er(s):[]}function g1(s,c){return s&&s.length?er(s,it(c,2)):[]}function p1(s,c){return c=typeof c=="function"?c:e,s&&s.length?er(s,e,c):[]}function rl(s){if(!(s&&s.length))return[];var c=0;return s=Jn(s,function(f){if(Yt(f))return c=jt(f.length,c),!0}),bc(c,function(f){return $t(s,yc(f))})}function Xf(s,c){if(!(s&&s.length))return[];var f=rl(s);return c==null?f:$t(f,function(p){return Pe(c,e,p)})}var m1=vt(function(s,c){return Yt(s)?es(s,c):[]}),y1=vt(function(s){return zc(Jn(s,Yt))}),w1=vt(function(s){var c=He(s);return Yt(c)&&(c=e),zc(Jn(s,Yt),it(c,2))}),v1=vt(function(s){var c=He(s);return c=typeof c=="function"?c:e,zc(Jn(s,Yt),e,c)}),b1=vt(rl);function _1(s,c){return df(s||[],c||[],ts)}function x1(s,c){return df(s||[],c||[],is)}var S1=vt(function(s){var c=s.length,f=c>1?s[c-1]:e;return f=typeof f=="function"?(s.pop(),f):e,Xf(s,f)});function Jf(s){var c=S(s);return c.__chain__=!0,c}function C1(s,c){return c(s),s}function Po(s,c){return c(s)}var P1=On(function(s){var c=s.length,f=c?s[0]:0,p=this.__wrapped__,x=function(C){return Tc(C,s)};return c>1||this.__actions__.length||!(p instanceof St)||!Fn(f)?this.thru(x):(p=p.slice(f,+f+(c?1:0)),p.__actions__.push({func:Po,args:[x],thisArg:e}),new ze(p,this.__chain__).thru(function(C){return c&&!C.length&&C.push(e),C}))});function A1(){return Jf(this)}function N1(){return new ze(this.value(),this.__chain__)}function T1(){this.__values__===e&&(this.__values__=ud(this.value()));var s=this.__index__>=this.__values__.length,c=s?e:this.__values__[this.__index__++];return{done:s,value:c}}function E1(){return this}function I1(s){for(var c,f=this;f instanceof lo;){var p=Wf(f);p.__index__=0,p.__values__=e,c?x.__wrapped__=p:c=p;var x=p;f=f.__wrapped__}return x.__wrapped__=s,c}function M1(){var s=this.__wrapped__;if(s instanceof St){var c=s;return this.__actions__.length&&(c=new St(this)),c=c.reverse(),c.__actions__.push({func:Po,args:[nl],thisArg:e}),new ze(c,this.__chain__)}return this.thru(nl)}function R1(){return ff(this.__wrapped__,this.__actions__)}var L1=yo(function(s,c,f){kt.call(s,f)?++s[f]:Ln(s,f,1)});function k1(s,c,f){var p=pt(s)?Ch:Cw;return f&&he(s,c,f)&&(c=e),p(s,it(c,3))}function O1(s,c){var f=pt(s)?Jn:Kh;return f(s,it(c,3))}var F1=Sf(Hf),D1=Sf(qf);function B1(s,c){return oe(Ao(s,c),1)}function V1(s,c){return oe(Ao(s,c),Lt)}function G1(s,c,f){return f=f===e?1:mt(f),oe(Ao(s,c),f)}function Qf(s,c){var f=pt(s)?Ve:tr;return f(s,it(c,3))}function Zf(s,c){var f=pt(s)?sy:Yh;return f(s,it(c,3))}var z1=yo(function(s,c,f){kt.call(s,f)?s[f].push(c):Ln(s,f,[c])});function $1(s,c,f,p){s=we(s)?s:si(s),f=f&&!p?mt(f):0;var x=s.length;return f<0&&(f=jt(x+f,0)),Mo(s)?f<=x&&s.indexOf(c,f)>-1:!!x&&Yr(s,c,f)>-1}var W1=vt(function(s,c,f){var p=-1,x=typeof c=="function",C=we(s)?B(s.length):[];return tr(s,function(E){C[++p]=x?Pe(c,E,f):ns(E,c,f)}),C}),H1=yo(function(s,c,f){Ln(s,f,c)});function Ao(s,c){var f=pt(s)?$t:tf;return f(s,it(c,3))}function q1(s,c,f,p){return s==null?[]:(pt(c)||(c=c==null?[]:[c]),f=p?e:f,pt(f)||(f=f==null?[]:[f]),sf(s,c,f))}var U1=yo(function(s,c,f){s[f?0:1].push(c)},function(){return[[],[]]});function Y1(s,c,f){var p=pt(s)?pc:Th,x=arguments.length<3;return p(s,it(c,4),f,x,tr)}function K1(s,c,f){var p=pt(s)?oy:Th,x=arguments.length<3;return p(s,it(c,4),f,x,Yh)}function X1(s,c){var f=pt(s)?Jn:Kh;return f(s,Eo(it(c,3)))}function J1(s){var c=pt(s)?Wh:$w;return c(s)}function Q1(s,c,f){(f?he(s,c,f):c===e)?c=1:c=mt(c);var p=pt(s)?vw:Ww;return p(s,c)}function Z1(s){var c=pt(s)?bw:qw;return c(s)}function j1(s){if(s==null)return 0;if(we(s))return Mo(s)?Xr(s):s.length;var c=le(s);return c==Je||c==Qe?s.size:kc(s).length}function tb(s,c,f){var p=pt(s)?mc:Uw;return f&&he(s,c,f)&&(c=e),p(s,it(c,3))}var eb=vt(function(s,c){if(s==null)return[];var f=c.length;return f>1&&he(s,c[0],c[1])?c=[]:f>2&&he(c[0],c[1],c[2])&&(c=[c[0]]),sf(s,oe(c,1),[])}),No=Oy||function(){return se.Date.now()};function nb(s,c){if(typeof c!="function")throw new Ge(a);return s=mt(s),function(){if(--s<1)return c.apply(this,arguments)}}function jf(s,c,f){return c=f?e:c,c=s&&c==null?s.length:c,kn(s,R,e,e,e,e,c)}function td(s,c){var f;if(typeof c!="function")throw new Ge(a);return s=mt(s),function(){return--s>0&&(f=c.apply(this,arguments)),s<=1&&(c=e),f}}var il=vt(function(s,c,f){var p=_;if(f.length){var x=Zn(f,ri(il));p|=P}return kn(s,p,c,f,x)}),ed=vt(function(s,c,f){var p=_|b;if(f.length){var x=Zn(f,ri(ed));p|=P}return kn(c,p,s,f,x)});function nd(s,c,f){c=f?e:c;var p=kn(s,A,e,e,e,e,e,c);return p.placeholder=nd.placeholder,p}function rd(s,c,f){c=f?e:c;var p=kn(s,T,e,e,e,e,e,c);return p.placeholder=rd.placeholder,p}function id(s,c,f){var p,x,C,E,I,k,H=0,q=!1,Y=!1,J=!0;if(typeof s!="function")throw new Ge(a);c=qe(c)||0,Ht(f)&&(q=!!f.leading,Y="maxWait"in f,C=Y?jt(qe(f.maxWait)||0,c):C,J="trailing"in f?!!f.trailing:J);function nt(Kt){var en=p,Vn=x;return p=x=e,H=Kt,E=s.apply(Vn,en),E}function at(Kt){return H=Kt,I=as(_t,c),q?nt(Kt):E}function yt(Kt){var en=Kt-k,Vn=Kt-H,Sd=c-en;return Y?ce(Sd,C-Vn):Sd}function ct(Kt){var en=Kt-k,Vn=Kt-H;return k===e||en>=c||en<0||Y&&Vn>=C}function _t(){var Kt=No();if(ct(Kt))return Pt(Kt);I=as(_t,yt(Kt))}function Pt(Kt){return I=e,J&&p?nt(Kt):(p=x=e,E)}function Ee(){I!==e&&gf(I),H=0,p=k=x=I=e}function fe(){return I===e?E:Pt(No())}function Ie(){var Kt=No(),en=ct(Kt);if(p=arguments,x=this,k=Kt,en){if(I===e)return at(k);if(Y)return gf(I),I=as(_t,c),nt(k)}return I===e&&(I=as(_t,c)),E}return Ie.cancel=Ee,Ie.flush=fe,Ie}var rb=vt(function(s,c){return Uh(s,1,c)}),ib=vt(function(s,c,f){return Uh(s,qe(c)||0,f)});function sb(s){return kn(s,V)}function To(s,c){if(typeof s!="function"||c!=null&&typeof c!="function")throw new Ge(a);var f=function(){var p=arguments,x=c?c.apply(this,p):p[0],C=f.cache;if(C.has(x))return C.get(x);var E=s.apply(this,p);return f.cache=C.set(x,E)||C,E};return f.cache=new(To.Cache||Rn),f}To.Cache=Rn;function Eo(s){if(typeof s!="function")throw new Ge(a);return function(){var c=arguments;switch(c.length){case 0:return!s.call(this);case 1:return!s.call(this,c[0]);case 2:return!s.call(this,c[0],c[1]);case 3:return!s.call(this,c[0],c[1],c[2])}return!s.apply(this,c)}}function ob(s){return td(2,s)}var ab=Yw(function(s,c){c=c.length==1&&pt(c[0])?$t(c[0],Ae(it())):$t(oe(c,1),Ae(it()));var f=c.length;return vt(function(p){for(var x=-1,C=ce(p.length,f);++x<C;)p[x]=c[x].call(this,p[x]);return Pe(s,this,p)})}),sl=vt(function(s,c){var f=Zn(c,ri(sl));return kn(s,P,e,c,f)}),sd=vt(function(s,c){var f=Zn(c,ri(sd));return kn(s,M,e,c,f)}),cb=On(function(s,c){return kn(s,O,e,e,e,c)});function lb(s,c){if(typeof s!="function")throw new Ge(a);return c=c===e?c:mt(c),vt(s,c)}function ub(s,c){if(typeof s!="function")throw new Ge(a);return c=c==null?0:jt(mt(c),0),vt(function(f){var p=f[c],x=rr(f,0,c);return p&&Qn(x,p),Pe(s,this,x)})}function hb(s,c,f){var p=!0,x=!0;if(typeof s!="function")throw new Ge(a);return Ht(f)&&(p="leading"in f?!!f.leading:p,x="trailing"in f?!!f.trailing:x),id(s,c,{leading:p,maxWait:c,trailing:x})}function fb(s){return jf(s,1)}function db(s,c){return sl(Wc(c),s)}function gb(){if(!arguments.length)return[];var s=arguments[0];return pt(s)?s:[s]}function pb(s){return $e(s,m)}function mb(s,c){return c=typeof c=="function"?c:e,$e(s,m,c)}function yb(s){return $e(s,g|m)}function wb(s,c){return c=typeof c=="function"?c:e,$e(s,g|m,c)}function vb(s,c){return c==null||qh(s,c,ee(c))}function tn(s,c){return s===c||s!==s&&c!==c}var bb=_o(Mc),_b=_o(function(s,c){return s>=c}),Tr=Qh(function(){return arguments}())?Qh:function(s){return qt(s)&&kt.call(s,"callee")&&!Dh.call(s,"callee")},pt=B.isArray,xb=wh?Ae(wh):Iw;function we(s){return s!=null&&Io(s.length)&&!Dn(s)}function Yt(s){return qt(s)&&we(s)}function Sb(s){return s===!0||s===!1||qt(s)&&ue(s)==De}var ir=Dy||ml,Cb=vh?Ae(vh):Mw;function Pb(s){return qt(s)&&s.nodeType===1&&!cs(s)}function Ab(s){if(s==null)return!0;if(we(s)&&(pt(s)||typeof s=="string"||typeof s.splice=="function"||ir(s)||ii(s)||Tr(s)))return!s.length;var c=le(s);if(c==Je||c==Qe)return!s.size;if(os(s))return!kc(s).length;for(var f in s)if(kt.call(s,f))return!1;return!0}function Nb(s,c){return rs(s,c)}function Tb(s,c,f){f=typeof f=="function"?f:e;var p=f?f(s,c):e;return p===e?rs(s,c,e,f):!!p}function ol(s){if(!qt(s))return!1;var c=ue(s);return c==Hr||c==Xa||typeof s.message=="string"&&typeof s.name=="string"&&!cs(s)}function Eb(s){return typeof s=="number"&&Vh(s)}function Dn(s){if(!Ht(s))return!1;var c=ue(s);return c==$s||c==Uu||c==vr||c==j0}function od(s){return typeof s=="number"&&s==mt(s)}function Io(s){return typeof s=="number"&&s>-1&&s%1==0&&s<=It}function Ht(s){var c=typeof s;return s!=null&&(c=="object"||c=="function")}function qt(s){return s!=null&&typeof s=="object"}var ad=bh?Ae(bh):Lw;function Ib(s,c){return s===c||Lc(s,c,Jc(c))}function Mb(s,c,f){return f=typeof f=="function"?f:e,Lc(s,c,Jc(c),f)}function Rb(s){return cd(s)&&s!=+s}function Lb(s){if(mv(s))throw new gt(o);return Zh(s)}function kb(s){return s===null}function Ob(s){return s==null}function cd(s){return typeof s=="number"||qt(s)&&ue(s)==Wi}function cs(s){if(!qt(s)||ue(s)!=In)return!1;var c=no(s);if(c===null)return!0;var f=kt.call(c,"constructor")&&c.constructor;return typeof f=="function"&&f instanceof f&&Zs.call(f)==My}var al=_h?Ae(_h):kw;function Fb(s){return od(s)&&s>=-It&&s<=It}var ld=xh?Ae(xh):Ow;function Mo(s){return typeof s=="string"||!pt(s)&&qt(s)&&ue(s)==qi}function Te(s){return typeof s=="symbol"||qt(s)&&ue(s)==Ws}var ii=Sh?Ae(Sh):Fw;function Db(s){return s===e}function Bb(s){return qt(s)&&le(s)==Ui}function Vb(s){return qt(s)&&ue(s)==em}var Gb=_o(Oc),zb=_o(function(s,c){return s<=c});function ud(s){if(!s)return[];if(we(s))return Mo(s)?Ze(s):ye(s);if(Xi&&s[Xi])return vy(s[Xi]());var c=le(s),f=c==Je?xc:c==Qe?Xs:si;return f(s)}function Bn(s){if(!s)return s===0?s:0;if(s=qe(s),s===Lt||s===-Lt){var c=s<0?-1:1;return c*Ct}return s===s?s:0}function mt(s){var c=Bn(s),f=c%1;return c===c?f?c-f:c:0}function hd(s){return s?Cr(mt(s),0,X):0}function qe(s){if(typeof s=="number")return s;if(Te(s))return K;if(Ht(s)){var c=typeof s.valueOf=="function"?s.valueOf():s;s=Ht(c)?c+"":c}if(typeof s!="string")return s===0?s:+s;s=Eh(s);var f=xm.test(s);return f||Cm.test(s)?ny(s.slice(2),f?2:8):_m.test(s)?K:+s}function fd(s){return hn(s,ve(s))}function $b(s){return s?Cr(mt(s),-It,It):s===0?s:0}function Rt(s){return s==null?"":Ne(s)}var Wb=ei(function(s,c){if(os(c)||we(c)){hn(c,ee(c),s);return}for(var f in c)kt.call(c,f)&&ts(s,f,c[f])}),dd=ei(function(s,c){hn(c,ve(c),s)}),Ro=ei(function(s,c,f,p){hn(c,ve(c),s,p)}),Hb=ei(function(s,c,f,p){hn(c,ee(c),s,p)}),qb=On(Tc);function Ub(s,c){var f=ti(s);return c==null?f:Hh(f,c)}var Yb=vt(function(s,c){s=Dt(s);var f=-1,p=c.length,x=p>2?c[2]:e;for(x&&he(c[0],c[1],x)&&(p=1);++f<p;)for(var C=c[f],E=ve(C),I=-1,k=E.length;++I<k;){var H=E[I],q=s[H];(q===e||tn(q,Qr[H])&&!kt.call(s,H))&&(s[H]=C[H])}return s}),Kb=vt(function(s){return s.push(e,If),Pe(gd,e,s)});function Xb(s,c){return Ph(s,it(c,3),un)}function Jb(s,c){return Ph(s,it(c,3),Ic)}function Qb(s,c){return s==null?s:Ec(s,it(c,3),ve)}function Zb(s,c){return s==null?s:Xh(s,it(c,3),ve)}function jb(s,c){return s&&un(s,it(c,3))}function t_(s,c){return s&&Ic(s,it(c,3))}function e_(s){return s==null?[]:fo(s,ee(s))}function n_(s){return s==null?[]:fo(s,ve(s))}function cl(s,c,f){var p=s==null?e:Pr(s,c);return p===e?f:p}function r_(s,c){return s!=null&&Lf(s,c,Aw)}function ll(s,c){return s!=null&&Lf(s,c,Nw)}var i_=Pf(function(s,c,f){c!=null&&typeof c.toString!="function"&&(c=js.call(c)),s[c]=f},hl(be)),s_=Pf(function(s,c,f){c!=null&&typeof c.toString!="function"&&(c=js.call(c)),kt.call(s,c)?s[c].push(f):s[c]=[f]},it),o_=vt(ns);function ee(s){return we(s)?$h(s):kc(s)}function ve(s){return we(s)?$h(s,!0):Dw(s)}function a_(s,c){var f={};return c=it(c,3),un(s,function(p,x,C){Ln(f,c(p,x,C),p)}),f}function c_(s,c){var f={};return c=it(c,3),un(s,function(p,x,C){Ln(f,x,c(p,x,C))}),f}var l_=ei(function(s,c,f){go(s,c,f)}),gd=ei(function(s,c,f,p){go(s,c,f,p)}),u_=On(function(s,c){var f={};if(s==null)return f;var p=!1;c=$t(c,function(C){return C=nr(C,s),p||(p=C.length>1),C}),hn(s,Kc(s),f),p&&(f=$e(f,g|y|m,iv));for(var x=c.length;x--;)Gc(f,c[x]);return f});function h_(s,c){return pd(s,Eo(it(c)))}var f_=On(function(s,c){return s==null?{}:Vw(s,c)});function pd(s,c){if(s==null)return{};var f=$t(Kc(s),function(p){return[p]});return c=it(c),of(s,f,function(p,x){return c(p,x[0])})}function d_(s,c,f){c=nr(c,s);var p=-1,x=c.length;for(x||(x=1,s=e);++p<x;){var C=s==null?e:s[fn(c[p])];C===e&&(p=x,C=f),s=Dn(C)?C.call(s):C}return s}function g_(s,c,f){return s==null?s:is(s,c,f)}function p_(s,c,f,p){return p=typeof p=="function"?p:e,s==null?s:is(s,c,f,p)}var md=Tf(ee),yd=Tf(ve);function m_(s,c,f){var p=pt(s),x=p||ir(s)||ii(s);if(c=it(c,4),f==null){var C=s&&s.constructor;x?f=p?new C:[]:Ht(s)?f=Dn(C)?ti(no(s)):{}:f={}}return(x?Ve:un)(s,function(E,I,k){return c(f,E,I,k)}),f}function y_(s,c){return s==null?!0:Gc(s,c)}function w_(s,c,f){return s==null?s:hf(s,c,Wc(f))}function v_(s,c,f,p){return p=typeof p=="function"?p:e,s==null?s:hf(s,c,Wc(f),p)}function si(s){return s==null?[]:_c(s,ee(s))}function b_(s){return s==null?[]:_c(s,ve(s))}function __(s,c,f){return f===e&&(f=c,c=e),f!==e&&(f=qe(f),f=f===f?f:0),c!==e&&(c=qe(c),c=c===c?c:0),Cr(qe(s),c,f)}function x_(s,c,f){return c=Bn(c),f===e?(f=c,c=0):f=Bn(f),s=qe(s),Tw(s,c,f)}function S_(s,c,f){if(f&&typeof f!="boolean"&&he(s,c,f)&&(c=f=e),f===e&&(typeof c=="boolean"?(f=c,c=e):typeof s=="boolean"&&(f=s,s=e)),s===e&&c===e?(s=0,c=1):(s=Bn(s),c===e?(c=s,s=0):c=Bn(c)),s>c){var p=s;s=c,c=p}if(f||s%1||c%1){var x=Gh();return ce(s+x*(c-s+ey("1e-"+((x+"").length-1))),c)}return Dc(s,c)}var C_=ni(function(s,c,f){return c=c.toLowerCase(),s+(f?wd(c):c)});function wd(s){return ul(Rt(s).toLowerCase())}function vd(s){return s=Rt(s),s&&s.replace(Am,gy).replace(qm,"")}function P_(s,c,f){s=Rt(s),c=Ne(c);var p=s.length;f=f===e?p:Cr(mt(f),0,p);var x=f;return f-=c.length,f>=0&&s.slice(f,x)==c}function A_(s){return s=Rt(s),s&&om.test(s)?s.replace(Xu,py):s}function N_(s){return s=Rt(s),s&&fm.test(s)?s.replace(sc,"\\$&"):s}var T_=ni(function(s,c,f){return s+(f?"-":"")+c.toLowerCase()}),E_=ni(function(s,c,f){return s+(f?" ":"")+c.toLowerCase()}),I_=xf("toLowerCase");function M_(s,c,f){s=Rt(s),c=mt(c);var p=c?Xr(s):0;if(!c||p>=c)return s;var x=(c-p)/2;return bo(oo(x),f)+s+bo(so(x),f)}function R_(s,c,f){s=Rt(s),c=mt(c);var p=c?Xr(s):0;return c&&p<c?s+bo(c-p,f):s}function L_(s,c,f){s=Rt(s),c=mt(c);var p=c?Xr(s):0;return c&&p<c?bo(c-p,f)+s:s}function k_(s,c,f){return f||c==null?c=0:c&&(c=+c),zy(Rt(s).replace(oc,""),c||0)}function O_(s,c,f){return(f?he(s,c,f):c===e)?c=1:c=mt(c),Bc(Rt(s),c)}function F_(){var s=arguments,c=Rt(s[0]);return s.length<3?c:c.replace(s[1],s[2])}var D_=ni(function(s,c,f){return s+(f?"_":"")+c.toLowerCase()});function B_(s,c,f){return f&&typeof f!="number"&&he(s,c,f)&&(c=f=e),f=f===e?X:f>>>0,f?(s=Rt(s),s&&(typeof c=="string"||c!=null&&!al(c))&&(c=Ne(c),!c&&Kr(s))?rr(Ze(s),0,f):s.split(c,f)):[]}var V_=ni(function(s,c,f){return s+(f?" ":"")+ul(c)});function G_(s,c,f){return s=Rt(s),f=f==null?0:Cr(mt(f),0,s.length),c=Ne(c),s.slice(f,f+c.length)==c}function z_(s,c,f){var p=S.templateSettings;f&&he(s,c,f)&&(c=e),s=Rt(s),c=Ro({},c,p,Ef);var x=Ro({},c.imports,p.imports,Ef),C=ee(x),E=_c(x,C),I,k,H=0,q=c.interpolate||Hs,Y="__p += '",J=Sc((c.escape||Hs).source+"|"+q.source+"|"+(q===Ju?bm:Hs).source+"|"+(c.evaluate||Hs).source+"|$","g"),nt="//# sourceURL="+(kt.call(c,"sourceURL")?(c.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Jm+"]")+`
`;s.replace(J,function(ct,_t,Pt,Ee,fe,Ie){return Pt||(Pt=Ee),Y+=s.slice(H,Ie).replace(Nm,my),_t&&(I=!0,Y+=`' +
__e(`+_t+`) +
'`),fe&&(k=!0,Y+=`';
`+fe+`;
__p += '`),Pt&&(Y+=`' +
((__t = (`+Pt+`)) == null ? '' : __t) +
'`),H=Ie+ct.length,ct}),Y+=`';
`;var at=kt.call(c,"variable")&&c.variable;if(!at)Y=`with (obj) {
`+Y+`
}
`;else if(wm.test(at))throw new gt(l);Y=(k?Y.replace(nm,""):Y).replace(rm,"$1").replace(im,"$1;"),Y="function("+(at||"obj")+`) {
`+(at?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(I?", __e = _.escape":"")+(k?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+Y+`return __p
}`;var yt=_d(function(){return Mt(C,nt+"return "+Y).apply(e,E)});if(yt.source=Y,ol(yt))throw yt;return yt}function $_(s){return Rt(s).toLowerCase()}function W_(s){return Rt(s).toUpperCase()}function H_(s,c,f){if(s=Rt(s),s&&(f||c===e))return Eh(s);if(!s||!(c=Ne(c)))return s;var p=Ze(s),x=Ze(c),C=Ih(p,x),E=Mh(p,x)+1;return rr(p,C,E).join("")}function q_(s,c,f){if(s=Rt(s),s&&(f||c===e))return s.slice(0,Lh(s)+1);if(!s||!(c=Ne(c)))return s;var p=Ze(s),x=Mh(p,Ze(c))+1;return rr(p,0,x).join("")}function U_(s,c,f){if(s=Rt(s),s&&(f||c===e))return s.replace(oc,"");if(!s||!(c=Ne(c)))return s;var p=Ze(s),x=Ih(p,Ze(c));return rr(p,x).join("")}function Y_(s,c){var f=$,p=G;if(Ht(c)){var x="separator"in c?c.separator:x;f="length"in c?mt(c.length):f,p="omission"in c?Ne(c.omission):p}s=Rt(s);var C=s.length;if(Kr(s)){var E=Ze(s);C=E.length}if(f>=C)return s;var I=f-Xr(p);if(I<1)return p;var k=E?rr(E,0,I).join(""):s.slice(0,I);if(x===e)return k+p;if(E&&(I+=k.length-I),al(x)){if(s.slice(I).search(x)){var H,q=k;for(x.global||(x=Sc(x.source,Rt(Qu.exec(x))+"g")),x.lastIndex=0;H=x.exec(q);)var Y=H.index;k=k.slice(0,Y===e?I:Y)}}else if(s.indexOf(Ne(x),I)!=I){var J=k.lastIndexOf(x);J>-1&&(k=k.slice(0,J))}return k+p}function K_(s){return s=Rt(s),s&&sm.test(s)?s.replace(Ku,Sy):s}var X_=ni(function(s,c,f){return s+(f?" ":"")+c.toUpperCase()}),ul=xf("toUpperCase");function bd(s,c,f){return s=Rt(s),c=f?e:c,c===e?wy(s)?Ay(s):ly(s):s.match(c)||[]}var _d=vt(function(s,c){try{return Pe(s,e,c)}catch(f){return ol(f)?f:new gt(f)}}),J_=On(function(s,c){return Ve(c,function(f){f=fn(f),Ln(s,f,il(s[f],s))}),s});function Q_(s){var c=s==null?0:s.length,f=it();return s=c?$t(s,function(p){if(typeof p[1]!="function")throw new Ge(a);return[f(p[0]),p[1]]}):[],vt(function(p){for(var x=-1;++x<c;){var C=s[x];if(Pe(C[0],this,p))return Pe(C[1],this,p)}})}function Z_(s){return Sw($e(s,g))}function hl(s){return function(){return s}}function j_(s,c){return s==null||s!==s?c:s}var tx=Cf(),ex=Cf(!0);function be(s){return s}function fl(s){return jh(typeof s=="function"?s:$e(s,g))}function nx(s){return ef($e(s,g))}function rx(s,c){return nf(s,$e(c,g))}var ix=vt(function(s,c){return function(f){return ns(f,s,c)}}),sx=vt(function(s,c){return function(f){return ns(s,f,c)}});function dl(s,c,f){var p=ee(c),x=fo(c,p);f==null&&!(Ht(c)&&(x.length||!p.length))&&(f=c,c=s,s=this,x=fo(c,ee(c)));var C=!(Ht(f)&&"chain"in f)||!!f.chain,E=Dn(s);return Ve(x,function(I){var k=c[I];s[I]=k,E&&(s.prototype[I]=function(){var H=this.__chain__;if(C||H){var q=s(this.__wrapped__),Y=q.__actions__=ye(this.__actions__);return Y.push({func:k,args:arguments,thisArg:s}),q.__chain__=H,q}return k.apply(s,Qn([this.value()],arguments))})}),s}function ox(){return se._===this&&(se._=Ry),this}function gl(){}function ax(s){return s=mt(s),vt(function(c){return rf(c,s)})}var cx=qc($t),lx=qc(Ch),ux=qc(mc);function xd(s){return Zc(s)?yc(fn(s)):Gw(s)}function hx(s){return function(c){return s==null?e:Pr(s,c)}}var fx=Af(),dx=Af(!0);function pl(){return[]}function ml(){return!1}function gx(){return{}}function px(){return""}function mx(){return!0}function yx(s,c){if(s=mt(s),s<1||s>It)return[];var f=X,p=ce(s,X);c=it(c),s-=X;for(var x=bc(p,c);++f<s;)c(f);return x}function wx(s){return pt(s)?$t(s,fn):Te(s)?[s]:ye($f(Rt(s)))}function vx(s){var c=++Iy;return Rt(s)+c}var bx=vo(function(s,c){return s+c},0),_x=Uc("ceil"),xx=vo(function(s,c){return s/c},1),Sx=Uc("floor");function Cx(s){return s&&s.length?ho(s,be,Mc):e}function Px(s,c){return s&&s.length?ho(s,it(c,2),Mc):e}function Ax(s){return Nh(s,be)}function Nx(s,c){return Nh(s,it(c,2))}function Tx(s){return s&&s.length?ho(s,be,Oc):e}function Ex(s,c){return s&&s.length?ho(s,it(c,2),Oc):e}var Ix=vo(function(s,c){return s*c},1),Mx=Uc("round"),Rx=vo(function(s,c){return s-c},0);function Lx(s){return s&&s.length?vc(s,be):0}function kx(s,c){return s&&s.length?vc(s,it(c,2)):0}return S.after=nb,S.ary=jf,S.assign=Wb,S.assignIn=dd,S.assignInWith=Ro,S.assignWith=Hb,S.at=qb,S.before=td,S.bind=il,S.bindAll=J_,S.bindKey=ed,S.castArray=gb,S.chain=Jf,S.chunk=Sv,S.compact=Cv,S.concat=Pv,S.cond=Q_,S.conforms=Z_,S.constant=hl,S.countBy=L1,S.create=Ub,S.curry=nd,S.curryRight=rd,S.debounce=id,S.defaults=Yb,S.defaultsDeep=Kb,S.defer=rb,S.delay=ib,S.difference=Av,S.differenceBy=Nv,S.differenceWith=Tv,S.drop=Ev,S.dropRight=Iv,S.dropRightWhile=Mv,S.dropWhile=Rv,S.fill=Lv,S.filter=O1,S.flatMap=B1,S.flatMapDeep=V1,S.flatMapDepth=G1,S.flatten=Uf,S.flattenDeep=kv,S.flattenDepth=Ov,S.flip=sb,S.flow=tx,S.flowRight=ex,S.fromPairs=Fv,S.functions=e_,S.functionsIn=n_,S.groupBy=z1,S.initial=Bv,S.intersection=Vv,S.intersectionBy=Gv,S.intersectionWith=zv,S.invert=i_,S.invertBy=s_,S.invokeMap=W1,S.iteratee=fl,S.keyBy=H1,S.keys=ee,S.keysIn=ve,S.map=Ao,S.mapKeys=a_,S.mapValues=c_,S.matches=nx,S.matchesProperty=rx,S.memoize=To,S.merge=l_,S.mergeWith=gd,S.method=ix,S.methodOf=sx,S.mixin=dl,S.negate=Eo,S.nthArg=ax,S.omit=u_,S.omitBy=h_,S.once=ob,S.orderBy=q1,S.over=cx,S.overArgs=ab,S.overEvery=lx,S.overSome=ux,S.partial=sl,S.partialRight=sd,S.partition=U1,S.pick=f_,S.pickBy=pd,S.property=xd,S.propertyOf=hx,S.pull=qv,S.pullAll=Kf,S.pullAllBy=Uv,S.pullAllWith=Yv,S.pullAt=Kv,S.range=fx,S.rangeRight=dx,S.rearg=cb,S.reject=X1,S.remove=Xv,S.rest=lb,S.reverse=nl,S.sampleSize=Q1,S.set=g_,S.setWith=p_,S.shuffle=Z1,S.slice=Jv,S.sortBy=eb,S.sortedUniq=r1,S.sortedUniqBy=i1,S.split=B_,S.spread=ub,S.tail=s1,S.take=o1,S.takeRight=a1,S.takeRightWhile=c1,S.takeWhile=l1,S.tap=C1,S.throttle=hb,S.thru=Po,S.toArray=ud,S.toPairs=md,S.toPairsIn=yd,S.toPath=wx,S.toPlainObject=fd,S.transform=m_,S.unary=fb,S.union=u1,S.unionBy=h1,S.unionWith=f1,S.uniq=d1,S.uniqBy=g1,S.uniqWith=p1,S.unset=y_,S.unzip=rl,S.unzipWith=Xf,S.update=w_,S.updateWith=v_,S.values=si,S.valuesIn=b_,S.without=m1,S.words=bd,S.wrap=db,S.xor=y1,S.xorBy=w1,S.xorWith=v1,S.zip=b1,S.zipObject=_1,S.zipObjectDeep=x1,S.zipWith=S1,S.entries=md,S.entriesIn=yd,S.extend=dd,S.extendWith=Ro,dl(S,S),S.add=bx,S.attempt=_d,S.camelCase=C_,S.capitalize=wd,S.ceil=_x,S.clamp=__,S.clone=pb,S.cloneDeep=yb,S.cloneDeepWith=wb,S.cloneWith=mb,S.conformsTo=vb,S.deburr=vd,S.defaultTo=j_,S.divide=xx,S.endsWith=P_,S.eq=tn,S.escape=A_,S.escapeRegExp=N_,S.every=k1,S.find=F1,S.findIndex=Hf,S.findKey=Xb,S.findLast=D1,S.findLastIndex=qf,S.findLastKey=Jb,S.floor=Sx,S.forEach=Qf,S.forEachRight=Zf,S.forIn=Qb,S.forInRight=Zb,S.forOwn=jb,S.forOwnRight=t_,S.get=cl,S.gt=bb,S.gte=_b,S.has=r_,S.hasIn=ll,S.head=Yf,S.identity=be,S.includes=$1,S.indexOf=Dv,S.inRange=x_,S.invoke=o_,S.isArguments=Tr,S.isArray=pt,S.isArrayBuffer=xb,S.isArrayLike=we,S.isArrayLikeObject=Yt,S.isBoolean=Sb,S.isBuffer=ir,S.isDate=Cb,S.isElement=Pb,S.isEmpty=Ab,S.isEqual=Nb,S.isEqualWith=Tb,S.isError=ol,S.isFinite=Eb,S.isFunction=Dn,S.isInteger=od,S.isLength=Io,S.isMap=ad,S.isMatch=Ib,S.isMatchWith=Mb,S.isNaN=Rb,S.isNative=Lb,S.isNil=Ob,S.isNull=kb,S.isNumber=cd,S.isObject=Ht,S.isObjectLike=qt,S.isPlainObject=cs,S.isRegExp=al,S.isSafeInteger=Fb,S.isSet=ld,S.isString=Mo,S.isSymbol=Te,S.isTypedArray=ii,S.isUndefined=Db,S.isWeakMap=Bb,S.isWeakSet=Vb,S.join=$v,S.kebabCase=T_,S.last=He,S.lastIndexOf=Wv,S.lowerCase=E_,S.lowerFirst=I_,S.lt=Gb,S.lte=zb,S.max=Cx,S.maxBy=Px,S.mean=Ax,S.meanBy=Nx,S.min=Tx,S.minBy=Ex,S.stubArray=pl,S.stubFalse=ml,S.stubObject=gx,S.stubString=px,S.stubTrue=mx,S.multiply=Ix,S.nth=Hv,S.noConflict=ox,S.noop=gl,S.now=No,S.pad=M_,S.padEnd=R_,S.padStart=L_,S.parseInt=k_,S.random=S_,S.reduce=Y1,S.reduceRight=K1,S.repeat=O_,S.replace=F_,S.result=d_,S.round=Mx,S.runInContext=L,S.sample=J1,S.size=j1,S.snakeCase=D_,S.some=tb,S.sortedIndex=Qv,S.sortedIndexBy=Zv,S.sortedIndexOf=jv,S.sortedLastIndex=t1,S.sortedLastIndexBy=e1,S.sortedLastIndexOf=n1,S.startCase=V_,S.startsWith=G_,S.subtract=Rx,S.sum=Lx,S.sumBy=kx,S.template=z_,S.times=yx,S.toFinite=Bn,S.toInteger=mt,S.toLength=hd,S.toLower=$_,S.toNumber=qe,S.toSafeInteger=$b,S.toString=Rt,S.toUpper=W_,S.trim=H_,S.trimEnd=q_,S.trimStart=U_,S.truncate=Y_,S.unescape=K_,S.uniqueId=vx,S.upperCase=X_,S.upperFirst=ul,S.each=Qf,S.eachRight=Zf,S.first=Yf,dl(S,function(){var s={};return un(S,function(c,f){kt.call(S.prototype,f)||(s[f]=c)}),s}(),{chain:!1}),S.VERSION=r,Ve(["bind","bindKey","curry","curryRight","partial","partialRight"],function(s){S[s].placeholder=S}),Ve(["drop","take"],function(s,c){St.prototype[s]=function(f){f=f===e?1:jt(mt(f),0);var p=this.__filtered__&&!c?new St(this):this.clone();return p.__filtered__?p.__takeCount__=ce(f,p.__takeCount__):p.__views__.push({size:ce(f,X),type:s+(p.__dir__<0?"Right":"")}),p},St.prototype[s+"Right"]=function(f){return this.reverse()[s](f).reverse()}}),Ve(["filter","map","takeWhile"],function(s,c){var f=c+1,p=f==dt||f==Nt;St.prototype[s]=function(x){var C=this.clone();return C.__iteratees__.push({iteratee:it(x,3),type:f}),C.__filtered__=C.__filtered__||p,C}}),Ve(["head","last"],function(s,c){var f="take"+(c?"Right":"");St.prototype[s]=function(){return this[f](1).value()[0]}}),Ve(["initial","tail"],function(s,c){var f="drop"+(c?"":"Right");St.prototype[s]=function(){return this.__filtered__?new St(this):this[f](1)}}),St.prototype.compact=function(){return this.filter(be)},St.prototype.find=function(s){return this.filter(s).head()},St.prototype.findLast=function(s){return this.reverse().find(s)},St.prototype.invokeMap=vt(function(s,c){return typeof s=="function"?new St(this):this.map(function(f){return ns(f,s,c)})}),St.prototype.reject=function(s){return this.filter(Eo(it(s)))},St.prototype.slice=function(s,c){s=mt(s);var f=this;return f.__filtered__&&(s>0||c<0)?new St(f):(s<0?f=f.takeRight(-s):s&&(f=f.drop(s)),c!==e&&(c=mt(c),f=c<0?f.dropRight(-c):f.take(c-s)),f)},St.prototype.takeRightWhile=function(s){return this.reverse().takeWhile(s).reverse()},St.prototype.toArray=function(){return this.take(X)},un(St.prototype,function(s,c){var f=/^(?:filter|find|map|reject)|While$/.test(c),p=/^(?:head|last)$/.test(c),x=S[p?"take"+(c=="last"?"Right":""):c],C=p||/^find/.test(c);x&&(S.prototype[c]=function(){var E=this.__wrapped__,I=p?[1]:arguments,k=E instanceof St,H=I[0],q=k||pt(E),Y=function(_t){var Pt=x.apply(S,Qn([_t],I));return p&&J?Pt[0]:Pt};q&&f&&typeof H=="function"&&H.length!=1&&(k=q=!1);var J=this.__chain__,nt=!!this.__actions__.length,at=C&&!J,yt=k&&!nt;if(!C&&q){E=yt?E:new St(this);var ct=s.apply(E,I);return ct.__actions__.push({func:Po,args:[Y],thisArg:e}),new ze(ct,J)}return at&&yt?s.apply(this,I):(ct=this.thru(Y),at?p?ct.value()[0]:ct.value():ct)})}),Ve(["pop","push","shift","sort","splice","unshift"],function(s){var c=Js[s],f=/^(?:push|sort|unshift)$/.test(s)?"tap":"thru",p=/^(?:pop|shift)$/.test(s);S.prototype[s]=function(){var x=arguments;if(p&&!this.__chain__){var C=this.value();return c.apply(pt(C)?C:[],x)}return this[f](function(E){return c.apply(pt(E)?E:[],x)})}}),un(St.prototype,function(s,c){var f=S[c];if(f){var p=f.name+"";kt.call(jr,p)||(jr[p]=[]),jr[p].push({name:c,func:f})}}),jr[wo(e,b).name]=[{name:"wrapper",func:e}],St.prototype.clone=Ky,St.prototype.reverse=Xy,St.prototype.value=Jy,S.prototype.at=P1,S.prototype.chain=A1,S.prototype.commit=N1,S.prototype.next=T1,S.prototype.plant=I1,S.prototype.reverse=M1,S.prototype.toJSON=S.prototype.valueOf=S.prototype.value=R1,S.prototype.first=S.prototype.head,Xi&&(S.prototype[Xi]=E1),S},Jr=Ny();br?((br.exports=Jr)._=Jr,fc._=Jr):se._=Jr}).call(ls)})(xa,xa.exports);var zE=xa.exports;const Hg=hu(zE);function Un(n,t,e,r){if(!(this instanceof Un))return new Un(n,t,e,r);var i,o,a;n.x?(e=n.w,r=n.h,t=n.y,n.w!==0&&!n.w&&n.x2?(e=n.x2-n.x,r=n.y2-n.y):(e=n.w,r=n.h),n=n.x,i=n+e,o=t+r,a=!(r+e)):(i=n+e,o=t+r,a=!(r+e)),this.x1=this.x=function(){return n},this.y1=this.y=function(){return t},this.x2=function(){return i},this.y2=function(){return o},this.w=function(){return e},this.h=function(){return r},this.p=function(){return a},this.overlap=function(l){return a||l.p()?n<=l.x2()&&i>=l.x()&&t<=l.y2()&&o>=l.y():n<l.x2()&&i>l.x()&&t<l.y2()&&o>l.y()},this.expand=function(l){var h,u,d=l.x(),g=l.y(),y=l.x2(),m=l.y2();return n>d?h=d:h=n,t>g?u=g:u=t,i>y?e=i-h:e=y-h,o>m?r=o-u:r=m-u,n=h,t=u,this}}Un.overlapRectangle=function(n,t){return n.h===0&&n.w===0||t.h===0&&t.w===0?n.x<=t.x+t.w&&n.x+n.w>=t.x&&n.y<=t.y+t.h&&n.y+n.h>=t.y:n.x<t.x+t.w&&n.x+n.w>t.x&&n.y<t.y+t.h&&n.y+n.h>t.y};Un.containsRectangle=function(n,t){return n.x+n.w<=t.x+t.w&&n.x>=t.x&&n.y+n.h<=t.y+t.h&&n.y>=t.y};Un.expandRectangle=function(n,t){var e,r,i=n.x+n.w,o=t.x+t.w,a=n.y+n.h,l=t.y+t.h;return n.x>t.x?e=t.x:e=n.x,n.y>t.y?r=t.y:r=n.y,i>o?n.w=i-e:n.w=o-e,a>l?n.h=a-r:n.h=l-r,n.x=e,n.y=r,n};Un.makeMBR=function(n,t){if(!n.length)return{x:0,y:0,w:0,h:0};t=t||{},t.x=n[0].x,t.y=n[0].y,t.w=n[0].w,t.h=n[0].h;for(var e=1,r=n.length;e<r;e++)Un.expandRectangle(t,n[e]);return t};Un.squarifiedRatio=function(n,t,e){var r=(n+t)/2,i=n*t,o=i/(r*r);return i*e/o};var Bu=Un,Xt=Bu;function Oi(n){if(!(this instanceof Oi))return new Oi(n);var t=3,e=6;isNaN(n)||(t=Math.floor(n/2),e=n);var r={x:0,y:0,w:0,h:0,id:"root",nodes:[]};this.root=r;var i=function(v){for(var _=v.slice(),b=[],N;_.length;)N=_.pop(),N.nodes?_=_.concat(N.nodes):N.leaf&&b.push(N);return b},o=function(v,_,b){var N=[],A=[],T=[],P,M,R;if(!v||!Xt.overlapRectangle(v,b))return T;var O={x:v.x,y:v.y,w:v.w,h:v.h,target:_};for(A.push(b.nodes.length),N.push(b);N.length>0;)if(P=N.pop(),M=A.pop()-1,"target"in O)for(;M>=0;){if(R=P.nodes[M],Xt.overlapRectangle(O,R))if(O.target&&"leaf"in R&&R.leaf===O.target||!O.target&&("leaf"in R||Xt.containsRectangle(R,O))){"nodes"in R?T=i(P.nodes.splice(M,1)):T=P.nodes.splice(M,1),Xt.makeMBR(P.nodes,P),delete O.target;break}else"nodes"in R&&(A.push(M),N.push(P),P=R,M=R.nodes.length);M--}else if("nodes"in O){P.nodes.splice(M+1,1),P.nodes.length>0&&Xt.makeMBR(P.nodes,P);for(var V=0;V<O.nodes.length;V++)y(O.nodes[V],P);O.nodes=[],N.length===0&&P.nodes.length<=1?(O.nodes=g(P,!0,O.nodes,P),P.nodes=[],N.push(P),A.push(1)):N.length>0&&P.nodes.length<t?(O.nodes=g(P,!0,O.nodes,P),P.nodes=[]):delete O.nodes}else Xt.makeMBR(P.nodes,P);return T},a=function(v,_){var b=-1,N=[],A,T=!0;N.push(_);for(var P=_.nodes;T||b!==-1;){T?T=!1:(N.push(P[b]),P=P[b].nodes,b=-1);for(var M=P.length-1;M>=0;M--){var R=P[M];if("leaf"in R){b=-1;break}var O=Xt.squarifiedRatio(R.w,R.h,R.nodes.length+1),V=Math.max(R.x+R.w,v.x+v.w)-Math.min(R.x,v.x),$=Math.max(R.y+R.h,v.y+v.h)-Math.min(R.y,v.y),G=Xt.squarifiedRatio(V,$,R.nodes.length+2);(b<0||Math.abs(G-O)<A)&&(A=Math.abs(G-O),b=M)}}return N},l=function(v){for(var _=u(v);v.length>0;)h(v,_[0],_[1]);return _},h=function(v,_,b){for(var N=Xt.squarifiedRatio(_.w,_.h,_.nodes.length+1),A=Xt.squarifiedRatio(b.w,b.h,b.nodes.length+1),T,P,M,R=v.length-1;R>=0;R--){var O=v[R],V={};V.x=Math.min(_.x,O.x),V.y=Math.min(_.y,O.y),V.w=Math.max(_.x+_.w,O.x+O.w)-V.x,V.h=Math.max(_.y+_.h,O.y+O.h)-V.y;var $=Math.abs(Xt.squarifiedRatio(V.w,V.h,_.nodes.length+2)-N),G={};G.x=Math.min(b.x,O.x),G.y=Math.min(b.y,O.y),G.w=Math.max(b.x+b.w,O.x+O.w)-G.x,G.h=Math.max(b.y+b.h,O.y+O.h)-G.y;var Z=Math.abs(Xt.squarifiedRatio(G.w,G.h,b.nodes.length+2)-A);(!P||!T||Math.abs(Z-$)<T)&&(P=R,T=Math.abs(Z-$),M=Z<$?b:_)}var tt=v.splice(P,1)[0];_.nodes.length+v.length+1<=t?(_.nodes.push(tt),Xt.expandRectangle(_,tt)):b.nodes.length+v.length+1<=t?(b.nodes.push(tt),Xt.expandRectangle(b,tt)):(M.nodes.push(tt),Xt.expandRectangle(M,tt))},u=function(v){for(var _=v.length-1,b=0,N=v.length-1,A=0,T,P,M=v.length-2;M>=0;M--){var R=v[M];R.x>v[b].x?b=M:R.x+R.w<v[_].x+v[_].w&&(_=M),R.y>v[A].y?A=M:R.y+R.h<v[N].y+v[N].h&&(N=M)}var O=Math.abs(v[_].x+v[_].w-v[b].x),V=Math.abs(v[N].y+v[N].h-v[A].y);return O>V?_>b?(T=v.splice(_,1)[0],P=v.splice(b,1)[0]):(P=v.splice(b,1)[0],T=v.splice(_,1)[0]):N>A?(T=v.splice(N,1)[0],P=v.splice(A,1)[0]):(P=v.splice(A,1)[0],T=v.splice(N,1)[0]),[{x:T.x,y:T.y,w:T.w,h:T.h,nodes:[T]},{x:P.x,y:P.y,w:P.w,h:P.h,nodes:[P]}]},d=function(v,_){return v.nodes=_.nodes,v.x=_.x,v.y=_.y,v.w=_.w,v.h=_.h,v},g=function(v,_,b,N){var A=[];if(!Xt.overlapRectangle(v,N))return b;for(A.push(N.nodes);A.length>0;)for(var T=A.pop(),P=T.length-1;P>=0;P--){var M=T[P];Xt.overlapRectangle(v,M)&&("nodes"in M?A.push(M.nodes):"leaf"in M&&(_?b.push(M):b.push(M.leaf)))}return b},y=function(v,_){var b;if(_.nodes.length===0){_.x=v.x,_.y=v.y,_.w=v.w,_.h=v.h,_.nodes.push(v);return}for(var N=a(v,_),A=v,T;N.length>0;){if(b&&"nodes"in b&&b.nodes.length===0){T=b,b=N.pop();for(var P=0;P<b.nodes.length;P++)if(b.nodes[P]===T||b.nodes[P].nodes.length===0){b.nodes.splice(P,1);break}}else b=N.pop();if("leaf"in A||"nodes"in A||Array.isArray(A)){if(Array.isArray(A)){for(var M=0;M<A.length;M++)Xt.expandRectangle(b,A[M]);b.nodes=b.nodes.concat(A)}else Xt.expandRectangle(b,A),b.nodes.push(A);if(b.nodes.length<=e)A={x:b.x,y:b.y,w:b.w,h:b.h};else{var R=l(b.nodes);A=R,N.length<1&&(b.nodes.push(R[0]),N.push(b),A=R[1])}}else Xt.expandRectangle(b,A),A={x:b.x,y:b.y,w:b.w,h:b.h}}};this.insertSubtree=y,this.getTree=function(){return r},this.setTree=function(v,_){return _||(_=r),d(_,v)},this.search=function(v,_,b){return b=b||[],g(v,_,b,r)};var m=function(v){for(var _=1,b=[],N;_>0;)N=o(v,!1,r),_=N.length,b=b.concat(N);return b},w=function(v,_){var b=o(v,_,r);return b};this.remove=function(v,_){return!_||typeof _=="function"?m(v):w(v,_)},this.insert=function(v,_){var b=y({x:v.x,y:v.y,w:v.w,h:v.h,leaf:_},r);return b}}Oi.prototype.toJSON=function(n){return JSON.stringify(this.root,!1,n)};Oi.fromJSON=function(n){var t=new Oi;return t.setTree(JSON.parse(n)),t};var $E=Oi;typeof Array.isArray!="function"&&(Array.isArray=function(n){return typeof n=="object"&&{}.toString.call(n)==="[object Array]"});var Vu={},WE=Bu,cr=function(n,t){if(t&&t.bbox)return{leaf:t,x:t.bbox[0],y:t.bbox[1],w:t.bbox[2]-t.bbox[0],h:t.bbox[3]-t.bbox[1]};for(var e=n.length,r=0,i=new Array(e);r<e;)i[r]=[n[r][0],n[r][1]],r++;var o=i[0];e=i.length,r=1;for(var a={min:[].concat(o),max:[].concat(o)};r<e;)i[r][0]<a.min[0]?a.min[0]=i[r][0]:i[r][0]>a.max[0]&&(a.max[0]=i[r][0]),i[r][1]<a.min[1]?a.min[1]=i[r][1]:i[r][1]>a.max[1]&&(a.max[1]=i[r][1]),r++;var l={x:a.min[0],y:a.min[1],w:a.max[0]-a.min[0],h:a.max[1]-a.min[1]};return t&&(l.leaf=t),l},te={};te.point=function(n,t){return t.insertSubtree({x:n.geometry.coordinates[0],y:n.geometry.coordinates[1],w:0,h:0,leaf:n},t.root)};te.multiPointLineString=function(n,t){return t.insertSubtree(cr(n.geometry.coordinates,n),t.root)};te.multiLineStringPolygon=function(n,t){return t.insertSubtree(cr(Array.prototype.concat.apply([],n.geometry.coordinates),n),t.root)};te.multiPolygon=function(n,t){return t.insertSubtree(cr(Array.prototype.concat.apply([],Array.prototype.concat.apply([],n.geometry.coordinates)),n),t.root)};te.makeRec=function(n){return WE(n.x,n.y,n.w,n.h)};te.geometryCollection=function(n,t){if(n.bbox)return t.insertSubtree({leaf:n,x:n.bbox[0],y:n.bbox[1],w:n.bbox[2]-n.bbox[0],h:n.bbox[3]-n.bbox[1]},t.root);for(var e=n.geometry.geometries,r=0,i=e.length,o=[],a;r<i;){switch(a=e[r],a.type){case"Point":o.push(te.makeRec({x:a.coordinates[0],y:a.coordinates[1],w:0,h:0}));break;case"MultiPoint":o.push(te.makeRec(cr(a.coordinates)));break;case"LineString":o.push(te.makeRec(cr(a.coordinates)));break;case"MultiLineString":o.push(te.makeRec(cr(Array.prototype.concat.apply([],a.coordinates))));break;case"Polygon":o.push(te.makeRec(cr(Array.prototype.concat.apply([],a.coordinates))));break;case"MultiPolygon":o.push(te.makeRec(cr(Array.prototype.concat.apply([],Array.prototype.concat.apply([],a.coordinates)))));break;case"GeometryCollection":e=e.concat(a.geometries),i=e.length;break}r++}var l=o[0];for(r=1,i=o.length;r<i;)l.expand(o[r]),r++;return t.insertSubtree({leaf:n,x:l.x(),y:l.y(),h:l.h(),w:l.w()},t.root)};Vu.geoJSON=function(n){var t=this,e,r;if(Array.isArray(n))e=n.slice();else if(n.features&&Array.isArray(n.features))e=n.features.slice();else if(n instanceof Object)e=[n];else throw"this isn't what we're looking for";for(var i=e.length,o=0;o<i;){if(r=e[o],r.type==="Feature")switch(r.geometry.type){case"Point":te.point(r,t);break;case"MultiPoint":te.multiPointLineString(r,t);break;case"LineString":te.multiPointLineString(r,t);break;case"MultiLineString":te.multiLineStringPolygon(r,t);break;case"Polygon":te.multiLineStringPolygon(r,t);break;case"MultiPolygon":te.multiPolygon(r,t);break;case"GeometryCollection":te.geometryCollection(r,t);break}o++}};Vu.bbox=function(){var n,t,e,r;switch(arguments.length){case 1:n=arguments[0][0][0],t=arguments[0][0][1],e=arguments[0][1][0],r=arguments[0][1][1];break;case 2:n=arguments[0][0],t=arguments[0][1],e=arguments[1][0],r=arguments[1][1];break;case 4:n=arguments[0],t=arguments[1],e=arguments[2],r=arguments[3];break}return this.search({x:n,y:t,w:e-n,h:r-t})};var Wa=$E,D0=Vu;Wa.prototype.bbox=D0.bbox;Wa.prototype.geoJSON=D0.geoJSON;Wa.Rectangle=Bu;var HE=Wa;const qg=hu(HE);class qE{constructor(t){this.visGraph=t}rtree=qg(4);renderQueue=[];allElements=[];parent=null;clear(){this.rtree=qg(4),this.allElements.forEach(t=>{t.exit()}),this.allElements=[],this.renderQueue=[]}setRoot(t){if(t.node()===null){console.error("Root group is null");return}this.parent=t,this.allElements.forEach(e=>{e.parentElement=t})}addElement(t){if(!t.boundingBox){console.error("Element has no bounding box");return}this.rtree.insert(t.boundingBox,t),this.renderQueue.push(t)}removeElement(t){if(!t.boundingBox){console.error("Element has no bounding box");return}this.rtree.remove(t.boundingBox,t)}renderAll(t){let e=!1;if(!t){this.allElements.forEach(o=>{e=o.update()||e}),e&&this.sortDomElements();return}const i=[...this.rtree.search(t),...this.renderQueue];i.forEach(o=>{o.updateVisibleArea(t)}),i.forEach(o=>{e=o.update()||e}),this.renderQueue=[],e&&this.sortDomElements()}sortDomElements(){const e=this.parent?.node();if(!e){console.error("Parent group not set");return}const r=Array.from(e.children??[]);r.sort((i,o)=>{const a=parseInt(i.getAttribute("z-order")??"1000"),l=parseInt(o.getAttribute("z-order")??"1000");return a-l}),r.forEach(i=>{e.appendChild(i)})}renderDebuggingShapes(t){t.selectChildren("g.debug").data(this.visGraph.debugShapes).join("g").classed("debug",!0).each((e,r,i)=>{const o=t2(i[r]);switch(o.selectChildren("*").remove(),e.tag){case Qt.Circle:{const a=e;o.append("circle").attr("cx",a.center.x).attr("cy",a.center.y).attr("r",a.r).attr("fill","none").attr("stroke",a._data?.stroke??"blue").attr("stroke-width",.3).attr("opacity",.3);break}case Qt.Segment:{o.append("line").attr("x1",e.start.x).attr("y1",e.start.y).attr("x2",e.end.x).attr("y2",e.end.y).attr("stroke",e._data?.stroke??"gray").attr("stroke-width",e._data?.strokeWidth??.5).attr("opacity",.5);break}case Qt.Point:{const a=e;o.append("circle").attr("cx",a.x).attr("cy",a.y).attr("r",a._data?.r??1).attr("fill",a._data?.fill??"green").attr("stroke","none").attr("opacity",.5);break}case Qt.Ray:{const a=e,h=a.pt.translate(a.norm.rotate90CCW().multiply(500));o.append("line").attr("x1",a.start.x).attr("y1",a.start.y).attr("x2",h.x).attr("y2",h.y).attr("stroke","blue").attr("stroke-width",.5).attr("opacity",.5);break}case"Anchor":{const a=e,l=1.5,h=20,u=.3,d=1;o.append("circle").attr("cx",a.anchorPoint.x).attr("cy",a.anchorPoint.y).attr("r",l).attr("fill",a.anchorPoint._data?.fill??"blue").attr("stroke","none").attr("opacity",a._data?.opacity??u),o.append("line").attr("x1",a.anchorPoint.x).attr("y1",a.anchorPoint.y).attr("x2",a.anchorPoint.x+a.direction.x*(a._data?.length??h)).attr("y2",a.anchorPoint.y+a.direction.y*(a._data?.length??h)).attr("stroke",a._data?.stroke??"red").attr("stroke-width",a._data?.strokeWidth??d).attr("opacity",a._data?.opacity??u)}}})}}class Gu{constructor(t){this.renderer=t,t?.allElements.push(this),t?.renderQueue.push(this)}updateCallbacks=[];parentElement=null;boundingBox={x:0,y:0,w:0,h:0};zOrder=1e3;setBoundingBox(t){this.boundingBox?(this.boundingBox.x!==t.x||this.boundingBox.y!==t.y||this.boundingBox.w!==t.w||this.boundingBox.h!==t.h)&&(this.renderer?.removeElement(this),this.boundingBox=t,this.renderer?.addElement(this)):(this.boundingBox=t,console.log("setBoundingBox",this.boundingBox),this.renderer?.addElement(this))}checkValueAndAddUpdateCallback(t,e){let r=!1;return t.forEach(i=>{if(i.newValue===void 0)return;if(!i.currentValuePath&&(!i.valueGetter||!i.valueSetter))throw new Error("Either currentValuePath or valueGetter & valueSetter must be defined");(i.currentValuePath?Hg.get(this,i.currentValuePath):i.valueGetter())!==i.newValue&&(i.currentValuePath?Hg.set(this,i.currentValuePath,i.newValue):i.valueSetter(i.newValue),r=!0,e&&(this.updateCallbacks.includes(e)||this.updateCallbacks.push(e)))}),r}addUpdateCallback(t,e=!0){e&&(this.updateCallbacks.includes(t,this.updateCallbacks.length-1)||this.updateCallbacks.includes(t))||this.updateCallbacks.push(t)}addSubElement(t,e,r,i){const o=r??this.parentElement;if(!o)throw new Error("No parent element provided");const a=o.append(t);return e&&a.classed(e,!0),a.attr("z-order",i??this.zOrder),a}enter(){this.addSubElements()}exit(){this.updateCallbacks=[],this.removeSubElements()}update(){if(!this.parentElement)return!1;let t=!1;return this.subElementsExist()||(this.enter(),t=!0),this.updateCallbacks.forEach(e=>e.bind(this)()),this.updateCallbacks=[],t}}class UE extends Gu{elRoot;elGroup;elSvg;elText;elBgText;bBox={x:0,y:0,w:0,h:0};_isVisible=!0;get isVisible(){return this._isVisible}set isVisible(t){this._isVisible=t,t?(this.elText?.text(this._text),this.elBgText?.text(this._text)):(this.elText?.text(""),this.elBgText?.text("")),this.zOrder=1500,this.updateBBox()}x=0;y=0;width=0;height=0;anchor=new D(0,0);alignment="center";constructor(t){super(),t&&(this.parentElement=t,this.addSubElements())}updateVisibleArea(t){}subElementsExist(){return this.elSvg!==void 0&&this.elText!==void 0&&this.elGroup!==void 0&&this.elRoot!==void 0&&this.elBgText!==void 0}addSubElements(){if(!this.parentElement){console.error("No parent element set for Label2d");return}this.elRoot=this.elRoot??this.parentElement.append("g"),this.elSvg=this.elSvg??this.elRoot.append("svg"),this.elGroup=this.elGroup??this.elSvg.append("g"),this.elBgText=this.elBgText??this.elGroup.append("text").attr("x",0).attr("y",0).attr("pointer-events","none").attr("fill","white").attr("stroke","white").attr("stroke-width",2).attr("stroke-linejoin","round").attr("opacity",.8).attr("font-family","Nunito").attr("font-size","14px"),this.elText=this.elText??this.elGroup.append("text").attr("x",0).attr("y",0).attr("pointer-events","none").attr("font-family","Nunito").attr("font-size","14px"),this.setTextAlign("bottom-left")}removeSubElements(){this.elText?.remove(),this.elBgText?.remove(),this.elGroup?.remove(),this.elSvg?.remove(),this.elRoot?.remove(),this.elText=void 0,this.elBgText=void 0,this.elGroup=void 0,this.elSvg=void 0,this.elRoot=void 0}_text="";text(t){return t===this._text?this:(this._text=t,this.isVisible?(this.elText?.text(t),this.elBgText?.text(t),this.updateBBox(),this):this)}setAnchorPos(t,e){this.anchor=new D(t,e),this.updateTranslate()}updateBBox(){if(!this.isVisible)return this;const t=this.elGroup?.node()?.getBBox({stroke:!0,fill:!0});t&&(this.bBox={x:t.x-2,y:t.y-2,w:t.width+4,h:t.height+4}),this.elSvg?.attr("viewBox",`${this.bBox.x} ${this.bBox.y} ${this.bBox.w} ${this.bBox.h}`)}setWidth(t){if(!this.isVisible)return this;const e=this.getHeightForWidth(t);return t===this.width&&e===this.height?this:(this.width=t,this.height=e,this.elSvg?.attr("width",t).attr("height",e),this.x=this.anchor.x-t/2,this.y=this.anchor.y-e/2,this.updateTranslate(),this)}getHeightForWidth(t){return this.bBox.h*t/this.bBox.w}getWidthForHeight(t){return this.bBox.w*t/this.bBox.h}setHeight(t){if(!this.isVisible)return this;const e=this.getWidthForHeight(t);return e===this.width&&t===this.height?this:(this.width=e,this.height=t,this.elSvg?.attr("width",e).attr("height",t),this.x=this.anchor.x-e/2,this.y=this.anchor.y-t/2,this.updateTranslate(),this)}setAlignment(t){return this.alignment=t,this.updateTranslate(),this}updateTranslate(){if(!this.isVisible)return this;const t=this.anchor,e=this.alignment,r=this.width,i=this.height;let o=-10,a=-10;switch(e){case"center-left":o=t.x,a=t.y-i/2;break;case"center-right":o=t.x-r,a=t.y-i/2;break;case"center-top":o=t.x-r/2,a=t.y;break;case"center-bottom":o=t.x-r/2,a=t.y-i;break;case"top-left":o=t.x,a=t.y;break;case"top-right":o=t.x-r,a=t.y;break;case"bottom-left":o=t.x,a=t.y-i;break;case"bottom-right":o=t.x-r,a=t.y-i;break;case"center":o=t.x-r/2,a=t.y-i/2}this.elRoot?.attr("transform",`translate(${o}, ${a})`)}setTextAlign(t){switch(t){case"center-left":this.elText?.attr("dominant-baseline","middle").attr("anchor","end"),this.elBgText?.attr("dominant-baseline","middle").attr("anchor","end");break;case"center-right":this.elText?.attr("dominant-baseline","middle").attr("anchor","start"),this.elBgText?.attr("dominant-baseline","middle").attr("anchor","start");break;case"center-top":this.elText?.attr("dominant-baseline","hanging").attr("anchor","middle"),this.elBgText?.attr("dominant-baseline","hanging").attr("anchor","middle");break;case"center-bottom":this.elText?.attr("dominant-baseline","auto").attr("anchor","middle"),this.elBgText?.attr("dominant-baseline","auto").attr("anchor","middle");break;case"top-left":this.elText?.attr("dominant-baseline","hanging").attr("anchor","end"),this.elBgText?.attr("dominant-baseline","hanging").attr("anchor","end");break;case"top-right":this.elText?.attr("dominant-baseline","hanging").attr("anchor","start"),this.elBgText?.attr("dominant-baseline","hanging").attr("anchor","start");break;case"bottom-left":this.elText?.attr("dominant-baseline","auto").attr("anchor","end"),this.elBgText?.attr("dominant-baseline","auto").attr("anchor","end");break;case"bottom-right":this.elText?.attr("dominant-baseline","auto").attr("anchor","start"),this.elBgText?.attr("dominant-baseline","auto").attr("anchor","start");break;case"center":this.elText?.attr("dominant-baseline","middle").attr("anchor","middle"),this.elBgText?.attr("dominant-baseline","middle").attr("anchor","middle");break}return this.updateBBox(),this}}class Xn{stroke;cId;connection;constructor(t){this.connection=t,this.cId=t.id}get startNode(){return this.connection.source}get endNode(){return this.connection.target}get target(){return this.endNode}get source(){return this.startNode}get start(){return this.startAnchor?.anchorPoint??new D(0,0)}get end(){return this.endAnchor?.anchorPoint??new D(0,0)}get startVector(){return this.startAnchor?.direction??new W(0,0)}get endVector(){return this.endAnchor?.direction??new W(0,0)}get svgPath(){return this.getSvgPath()}}class jo extends Xn{get startAnchor(){return this.connection.source.getAnchor(this.connection.target.center).move(this.connection.source.outerRadius-this.connection.source.radius)}get endAnchor(){return this.connection.target.getAnchor(this.connection.source.center).move(this.connection.target.outerRadius-this.connection.target.radius).cloneReversed()}constructor(t){super(t),this.connection=t}getSvgPath(){return`M ${this.start.x} ${this.start.y} L ${this.end.x} ${this.end.y}`}}class Ha extends Xn{segments=[];constructor(t,e){super(t),this.segments=e??[]}get startAnchor(){return this.segments.length===0?new jo(this.connection).startAnchor:this.segments[0].startAnchor}get endAnchor(){return this.segments.length===0?new jo(this.connection).endAnchor:this.segments[this.segments.length-1].endAnchor}getSvgPath(){return this.segments.length===0?new jo(this.connection).getSvgPath():this.segments.filter(t=>t!==void 0).map(t=>t.getSvgPath()).join(" ")}}class YE extends Xn{pathString;startAnchor;endAnchor;constructor(t,e,r,i){super(t),this.pathString=e,this.startAnchor=r,this.endAnchor=i}getSvgPath(){return this.pathString}}class zu extends Xn{startAnchor;endAnchor;ignoreMoveCmd;constructor(t,e,r,i=!1){super(t),this.startAnchor=new st(e,r),this.endAnchor=new st(r,new W(e,r)),this.ignoreMoveCmd=i}getSvgPath(){return this.ignoreMoveCmd?`L ${this.end.x} ${this.end.y}`:`M ${this.start.x} ${this.start.y} L ${this.end.x} ${this.end.y}`}}class KE extends Gu{center;layoutNode;elGroup;elNode;elLabel;elVirtualMarker;label;labelVisible=!0;get id(){return this.layoutNode.id}_radius=10;get radius(){return this._radius}set radius(t){this.updatePositionAndSize(void 0,void 0,t)}get circle(){return new Q(this.center,this.radius)}get score(){return this.layoutNode.score}communities;fill="red";get filled(){return this.layoutNode.filled}strokeStyle=new GE;opacity=1;get x(){return this.center.x}set x(t){this.updatePositionAndSize(t)}get y(){return this.center.y}set y(t){this.updatePositionAndSize(void 0,t)}emitter=mr();constructor(t){super(t.visGraph.renderer),this.zOrder=800,this.center=new D(0,0),this.layoutNode=t,this.updateBoundingBox(),this.updateCallbacks.push(this.renderStyleFill,this.renderStyleStroke,this.renderStyleOpacity,this.renderPositionAndSize)}requireUpdate({position:t=!1,fill:e=!1,stroke:r=!1,opacity:i=!1}={position:!0,fill:!0,stroke:!0,opacity:!0}){t&&this.addUpdateCallback(this.renderPositionAndSize),e&&this.addUpdateCallback(this.renderStyleFill),r&&this.addUpdateCallback(this.renderStyleStroke),i&&this.addUpdateCallback(this.renderStyleOpacity)}updateBoundingBox(){this.setBoundingBox({x:this.center.x-this.radius,y:this.center.y-this.radius,w:this.radius*2,h:this.radius*2})}subElementsExist(){return this.elNode!==void 0&&this.elLabel!==void 0}addSubElements(){this.elGroup=this.elGroup??this.addSubElement("g","node-group"),this.elNode=this.elNode??this.addSubElement("circle","node",this.elGroup).on("mouseenter",()=>{const t=this.id;if(t){const e=this.layoutNode.visGraph,r=e?.userInteractions;if(!r){console.error("No user interactions found for ",e);return}r.addHoveredNode(t,!0)}}).on("mouseleave",()=>{const t=this.id;if(t){const e=this.layoutNode.visGraph,r=e?.userInteractions;if(!r){console.error("No user interactions found for ",e);return}r.removeHoveredNode(t,!0)}}),this.layoutNode.isVirtual&&(this.elVirtualMarker=this.elVirtualMarker??this.addSubElement("path","virtual-marker",this.elGroup),this.renderVirtualMarker()),this.elLabel=this.elLabel??this.addSubElement("g","node-label",void 0,1500),this.label=new UE(this.elLabel),this.label.isVisible=this.labelVisible}removeSubElements(){this.elNode?.remove(),this.label?.removeSubElements(),this.elLabel?.remove(),this.elVirtualMarker?.remove(),this.elGroup?.remove(),this.elNode=this.elLabel=this.label=this.elVirtualMarker=this.elGroup=void 0}updateLabelVisibility(t){this.labelVisible=t,this.label&&(this.label.isVisible=t)}fontSize=20;updateVisibleArea(t){this.updateLabel(t),this.updateVirtualNode(t)}updateLabel(t){if(this.label){this.label?.text(this.layoutNode.label??this.layoutNode.id);const e=this.layoutNode.visGraph.smallestExistingNodeSize*1;let r=e+Math.sqrt(Math.max(0,this.layoutNode.radius*2-e)*1);r*=this.layoutNode.visGraph.commonSettings?.labelSizeMultiplier.getValue()??1;const i=Math.min(this.label?.getHeightForWidth(this.layoutNode.radius*2)??0,r),o=this.label?.getWidthForHeight(r)??-1,a=this.layoutNode.parent?this.layoutNode.parent.x<this.center.x?"left":"right":"center",l=a==="left"?this.center.x+this.layoutNode.radius*1.1:a==="right"?this.center.x-this.layoutNode.radius*1.1:this.center.x;if(this.center.y,a=="left"&&o+l>t.x+t.w||a=="right"&&l-o<t.x||i/t.h>.02||o>t.w*.66)this.label?.setHeight(i).setAlignment("center").setAnchorPos(this.center.x,this.center.y);else{const u=r;a==="left"?this.label?.setAlignment("center-left").setAnchorPos(this.center.x+this.layoutNode.radius*1.1,this.center.y):a==="right"?this.label?.setAlignment("center-right").setAnchorPos(this.center.x-this.layoutNode.radius*1.1,this.center.y):this.label?.setAlignment("center").setAnchorPos(this.center.x,this.center.y),this.label?.setHeight(u)}}}updateVirtualNode(t){if(this.layoutNode.isVirtual){let e=this.layoutNode.parent;for(;e?.parent&&e.children.length<5;)e=e.parent;e&&e.radius*2/Math.min(t.w,t.h),this.updateStyleOpacity(1)}}renderStyleFill(){this.elNode?.attr("fill",this.filled?this.fill:"none"),this.layoutNode.isVirtual&&(this.elNode?.attr("fill-opacity",.1),this.elVirtualMarker?.attr("fill",this.fill).attr("fill-opacity",.1))}updateStyleFill(t){this.checkValueAndAddUpdateCallback([{currentValuePath:"fill",newValue:t}],this.renderStyleFill)}renderStyleStroke(){this.layoutNode.isVirtual?(this.elNode?.attr("stroke",this.fill??"white").attr("stroke-width",this.strokeStyle.strokeWidth*this.radius/5).attr("stroke-opacity",this.strokeStyle.strokeOpacity??1),this.elVirtualMarker?.attr("stroke",this.fill??"white").attr("stroke-linejoin","round").attr("stroke-width",this.strokeStyle.strokeWidth*this.radius/10).attr("stroke-opacity",this.strokeStyle.strokeOpacity??1)):this.elNode?.attr("stroke",this.strokeStyle.stroke??"white").attr("stroke-width",this.strokeStyle.strokeWidth).attr("stroke-opacity",this.strokeStyle.strokeOpacity??1)}updateStyleStroke(t,e,r){this.checkValueAndAddUpdateCallback([{currentValuePath:"strokeStyle.stroke",newValue:t},{currentValuePath:"strokeStyle.strokeWidth",newValue:e??this.layoutNode.strokeWidth},{currentValuePath:"strokeStyle.strokeOpacity",newValue:r}],this.renderStyleStroke)}renderStyleOpacity(){this.elNode?.attr("opacity",this.opacity),this.elLabel?.attr("opacity",this.opacity),this.elVirtualMarker?.attr("opacity",this.opacity)}updateStyleOpacity(t){this.checkValueAndAddUpdateCallback([{currentValuePath:"opacity",newValue:t}],this.renderStyleOpacity)}renderPositionAndSize(){this.layoutNode.isVirtual?this.elNode?.attr("cx",this.x).attr("cy",this.y).attr("r",this.radius-this.strokeStyle.strokeWidth*this.radius/5):this.elNode?.attr("cx",this.x).attr("cy",this.y).attr("r",this.radius)}updatePositionAndSize(t,e,r){this.checkValueAndAddUpdateCallback([{currentValuePath:"center.x",newValue:t},{currentValuePath:"center.y",newValue:e},{currentValuePath:"_radius",newValue:r}],this.renderPositionAndSize)&&(this.updateBoundingBox(),this.emitter.emit("positionUpdated"))}renderVirtualMarker(){if(this.layoutNode.isVirtual){const r=this.layoutNode.virtualParent;if(r){const i=new U(this.center,r.center),o=new Q(this.center,this.radius*(1+.15+1)),a=new Q(this.center,this.radius*(1+.15)),l=o.intersect(i),h=a.intersect(i);if(l.length>0&&h.length>0){const u=l[0],d=h[0],g=F.radOfPoint(d,this.center),w=this.radius*1/(Math.PI*2*this.radius)*Math.PI*2/2,v=F.positionOnCircleAtRad(g-w,a.r,this.center),_=F.positionOnCircleAtRad(g+w,a.r,this.center),b=new _n(this.layoutNode,this.layoutNode.virtualParent),N=new An(b);N.startPoint(v).endPoint(_).radius(a.r).direction("clockwise");const A=new zu(b,_,u,!0),T=new Ha(b);T.segments.push(N,A),this.elVirtualMarker?.attr("d",T.svgPath+" z")}}}}}const xs=class xs{width=10;height=10;filled=!1;set size(t){this.width=t,this.height=t}getSvgPath(t){const e=t.anchorPoint,r=t.direction.rotate(Math.PI),a=Array.from(xs.narrowPoints).map(h=>h.scale(this.width,this.height)).map(h=>h.rotate(r.slope,{x:0,y:0}));return r0().x(h=>h.x+e.x).y(h=>h.y+e.y).curve(Nu)(a)}};Ot(xs,"normalPoints",[new D(1,-.5),new D(0,0),new D(1,.5)]),Ot(xs,"narrowPoints",[new D(1,-.25),new D(0,0),new D(1,.25)]);let eu=xs;class XE extends Gu{layoutConnection;get id(){return this.layoutConnection.id}get pathSegment(){return this.layoutConnection.pathOrDefault}get startAnchor(){return this.layoutConnection.startAnchor}get endAnchor(){return this.layoutConnection.endAnchor}get curveStyle(){return this.layoutConnection.curveStyle}source;target;arrow=new eu;opacity=1;visibilityOpacity=1;_strokeFallback="black";get stroke(){return this.layoutConnection.pathSegment?.stroke??this._strokeFallback}set stroke(t){if(!this.layoutConnection.pathSegment){this._strokeFallback=t??"black";return}this.layoutConnection.pathSegment.stroke=t}strokeWidth=1;maxWidth=10;elGroup;elPath;elArrow;elBackground;constructor(t){super(t.source.visGraph.renderer),this.layoutConnection=t,this.source=t.source,this.target=t.target,this.updateCallbacks.push(this.renderPath,this.renderStyleOpacity,this.renderStyleStroke)}requireUpdate({path:t=!1,stroke:e=!1,opacity:r=!1}={path:!0,stroke:!0,opacity:!0}){t&&this.addUpdateCallback(this.renderPath),e&&this.addUpdateCallback(this.renderStyleStroke),r&&this.addUpdateCallback(this.renderStyleOpacity)}get weight(){return this.layoutConnection.weight??1}get distance(){return this.layoutConnection.distance??1}get startPoint(){return this.pathSegment.start}get endPoint(){return this.pathSegment.end}get curveFactory(){switch(this.curveStyle){case"linear":return Nu;case"basis":return OT;case"natural":return FT;default:return this.curveStyle}}get pathGenerator(){const t=r0().x(e=>e.x).y(e=>e.y).curve(this.curveFactory);return e=>{let r="",i=[];return e.forEach((o,a)=>{o.tag==Qt.Point?i.push(o):o instanceof st?i.push(o.anchorPoint):(i.length>0&&(r+=t(i)+" ",i=[]),r+=o.getSvgPath()+" ")}),r+(i.length>0?t(i):"")}}getSvgPath(){return this.pathSegment.getSvgPath()}getArrowPath(){let t;return this.endAnchor?t=this.endAnchor:t=this.target.getAnchor(this.source.center),this.arrow.getSvgPath(t)}get length(){const t=document.createElementNS("http://www.w3.org/2000/svg","path");return t.setAttribute("d",this.getSvgPath()),t.getTotalLength()}updateBoundingBox(){const t=this.elPath?.node()?.getBBox();t&&this.setBoundingBox({x:t.x,y:t.y,w:t.width,h:t.height})}renderPath(){const t=this.length,e=(this.layoutConnection.commonSettings?.arrowSize.getValue()??5)*this.strokeWidth,r=Math.min(e,t/2*.6);this.arrow.size=r;const i=this.getSvgPath();i!=""&&(this.layoutConnection.commonSettings?.combinePathAndArrow.getValue()??!0?this.elPath?.attr("d",i+" "+this.getArrowPath()):(this.elPath?.attr("d",i),this.elArrow?.attr("d",this.getArrowPath())),this.elBackground?.attr("d",i),this.updateBoundingBox())}updatePath(){this.addUpdateCallback(this.renderPath)}renderStyleOpacity(){this.elGroup?.attr("opacity",this.opacity*this.visibilityOpacity)}updateStyleOpacity(t){this.checkValueAndAddUpdateCallback([{currentValuePath:"opacity",newValue:t}],this.renderStyleOpacity)}updateStyleVisibilityOpacity(t){this.checkValueAndAddUpdateCallback([{currentValuePath:"visibilityOpacity",newValue:t}],this.renderStyleOpacity)}applyStrokeAttributes(t){return t&&(t.attr("stroke",this.stroke??"black").attr("stroke-width",this.strokeWidth),t)}renderStyleStroke(){this.applyStrokeAttributes(this.elPath),this.applyStrokeAttributes(this.elArrow)?.attr("fill",this.stroke??"none"),this.elBackground?.attr("stroke",this.stroke??"white").attr("stroke-width",3*(this.layoutConnection.commonSettings?.linkWidthMultiplier.getValue()??1)),this.renderPath()}updateStyleStroke(t,e){this.checkValueAndAddUpdateCallback([{currentValuePath:"stroke",newValue:t},{currentValuePath:"strokeWidth",newValue:e}],this.renderStyleStroke)}addSubElements(){const t=e=>{e.on("mouseenter",()=>{if(this.id){const i=this.layoutConnection.source.visGraph,o=i?.userInteractions;if(!o){console.error("No user interactions found for ",i);return}o.addHoveredConnection(this.layoutConnection,!0)}}).on("mouseleave",()=>{if(this.id){const i=this.layoutConnection.source.visGraph,o=i?.userInteractions;if(!o){console.error("No user interactions found for ",i);return}o.removeHoveredConnection(this.layoutConnection,!0)}})};this.elGroup=this.elGroup??this.addSubElement("g","connection").call(t),this.elPath=this.elPath??this.addSubElement("path","link",this.elGroup).attr("fill","none").attr("stroke-linecap","round").attr("stroke-linejoin","miter").attr("stroke-miterlimit",1),this.elArrow=this.elArrow??this.addSubElement("path","arrow",this.elGroup).attr("fill","none").attr("stroke-linecap","round").attr("stroke-linejoin","miter").attr("stroke-miterlimit",1),this.elBackground=this.elBackground??this.addSubElement("path","background",void 0,1).call(t).attr("fill","none").attr("opacity",0)}updateVisibleArea(t){this.layoutConnection.isRendered||this.updateStyleVisibilityOpacity(0)}subElementsExist(){return this.elPath!==void 0&&this.elArrow!==void 0&&this.elGroup!==void 0}removeSubElements(){this.elBackground?.remove(),this.elPath?.remove(),this.elArrow?.remove(),this.elGroup?.remove(),this.elPath=this.elArrow=this.elGroup=void 0}}function Tl(n,t,e,r){const i=n*e+t*r,o=Math.sqrt(n*n+t*t),a=Math.sqrt(e*e+r*r);let l=i/(o*a);l>1?l=1:l<-1&&(l=-1);const h=Math.acos(l);return(n*r-t*e>=0?1:-1)*h}const pi=class pi extends Xn{_rx=0;_ry=0;_rotation=0;_largeArc=0;_sweep=1;_start;_end;get startAnchor(){const t=this.getCenterParameters(),e=this._start??new D(0,0),r=new W(t.startAngleGlobal);return this._sweep===pi.SWEEP_CLOCKWISE?new st(e,r.rotate90CW()):new st(e,r.rotate90CCW())}set startAnchor(t){this._start=t?.anchorPoint??new D(0,0)}get endAnchor(){const t=this.getCenterParameters(),e=this._end??new D(0,0),r=new W(t.endAngleGlobal);return this._sweep===pi.SWEEP_CLOCKWISE?new st(e,r.rotate90CW()):new st(e,r.rotate90CCW())}set endAnchor(t){this._end=t?.anchorPoint}constructor(t,e,r,i,o,a=0,l=0,h=1){super(t),this._start=e,this._end=r,this._rx=i??0,this._ry=o??0,this._rotation=a,this._largeArc=l,this._sweep=h}radius(t,e){return this._rx=t,e?this._ry=e:this._ry=t,this}startPoint(t){return this._start=t.clone(),this}endPoint(t){return this._end=t.clone(),this}rotation(t){return this._rotation=t,this}largeArc(t){return this._largeArc=t,this}direction(t){return t==="clockwise"?this._sweep=1:t==="counter-clockwise"?this._sweep=0:this._sweep=t,this}checkIfValid(){if(!this._end)throw new Error("End point is not set");if(!this._rx||!this._ry)throw new Error("Radius is not set")}getSvgPath(){return this.toString()}toString(){try{this.checkIfValid()}catch{return""}let t="";return this._start&&(t=`M ${this._start.x} ${this._start.y} `),t+`A ${this._rx} ${this._ry} ${this._rotation} ${this._largeArc} ${this._sweep} ${this._end.x} ${this._end.y}`}getCenterParameters(){const t=this._start?.x??0,e=this._start?.y??0,r=this._end?.x??0,i=this._end?.y??0,o=this._largeArc==1,a=this._sweep==1;let l=Math.abs(this._rx),h=Math.abs(this._ry);const u=l===h?0:this._rotation*Math.PI/180;if(l===0||h===0)return{center:new D((t+r)/2,(e+i)/2),startAngle:0,deltaAngle:0,endAngle:0,startAngleGlobal:0,deltaAngleGlobal:0,endAngleGlobal:0,startAngleDeg:0,deltaAngleDeg:0,endAngleDeg:0,rx:0,ry:0};const d=Math.cos(u),g=Math.sin(u),y=(t-r)/2,m=(e-i)/2,w=d*y+g*m,v=-g*y+d*m,_=l*l,b=h*h,N=w*w,A=v*v,T=N/(l*l)+A/(h*h);if(T>1){const ot=Math.sqrt(T);l*=ot,h*=ot}const P=_*A+b*N,M=_*b-_*A-b*N,R=Math.max(M,0),V=(o!==a?1:-1)*Math.sqrt(R/P),$=V*(l*v/h),G=V*(-h*w/l),Z=(t+r)/2,tt=(e+i)/2,dt=d*$-g*G+Z,wt=g*$+d*G+tt,Nt=Tl(1,0,w-$,v-G),Lt=[Math.cos(-u),Math.sin(-u)],It=Tl(Lt[0],Lt[1],w-$,v-G),Ct=Tl(w-$,v-G,-w-$,-v-G);let K=Ct*(180/Math.PI)%360;!a&&K>0?K-=360:a&&K<0&&(K+=360);const X=Nt*(180/Math.PI);return{center:new D(dt,wt),rx:l,ry:h,deltaAngleDeg:K,startAngleDeg:X,endAngleDeg:X+K,startAngle:Nt,deltaAngle:Ct,endAngle:Nt+Ct,startAngleGlobal:It,deltaAngleGlobal:Ct,endAngleGlobal:It+Ct}}};Ot(pi,"SWEEP_CLOCKWISE",1),Ot(pi,"SWEEP_COUNTER_CLOCKWISE",0);let An=pi;class JE{topic;channel;weight=1;constructor(t){this.topic=t.topic,this.channel=t.channel,this.weight=t.weight}}class _n{get visGraph(){return this.source.visGraph}get commonSettings(){return this.visGraph.commonSettings}source;target;get id(){return`${this.fromId}->${this.toId}`}debugShapes=[];get fromId(){return this.source.id}get toId(){return this.target.id}opposite;links=[];children=[];parent;isCalculated=!1;get isHyperConnection(){return this.children.length>0}get isPrimaryConnection(){return!!this.parent}get hasParentHyperConnection(){return this.parent!==void 0}get isThroughVirtualNodes(){return this.getConnectionPathViaHyperAndVirtualNodes().slice(1,-1).some(t=>t.isVirtual)}get isDirectVirtualConnection(){return this.getConnectionPathViaHyperAndVirtualNodes().length==2&&(this.source.isVirtual||this.target.isVirtual)}oppositeLinks=[];_weight=0;get weight(){return this._weight}get distance(){return 1/this.weight**2}pathSegment=void 0;get pathOrDefault(){return this.pathSegment??new jo(this)}get startAnchor(){return this.pathOrDefault.startAnchor}get endAnchor(){return this.pathOrDefault.endAnchor}get width(){const i=Au().domain([.1,2]).range([.1,2]).clamp(!0)(this.weight),o=this.commonSettings?.linkWidthMultiplier.getValue()??1;return i*o}get arrowLength(){const t=this.width;return(this.commonSettings?.arrowSize.getValue()??5)*t*.8}finishedLayouting=!1;curveStyle="linear";connector;connection2d;isRendered=!0;constructor(t,e){this.source=t,this.target=e}static copyFromConnection(t){const e=new _n(t.source,t.target);return e._weight=t._weight,e.links=Array.from(t.links),e.oppositeLinks=Array.from(t.oppositeLinks),e.children=Array.from(t.children.map(r=>r.clone())),e}clone(){return _n.copyFromConnection(this)}static combineConnections(t){const e=[];return t.forEach(r=>{const i=r.opposite,o=_n.copyFromConnection(r);i&&o.addOppositeLinks(i.getLinks()),e.push(o)}),e.filter(r=>r._weight>.001)}remove(){this.source.visGraph.removeConnection(this)}addLinks(t){(Array.isArray(t)?t:[t]).forEach(r=>{this.links.push(r),this._weight+=r.weight})}addChildren(t){(Array.isArray(t)?t:[t]).forEach(r=>{this.children.push(r),r.parent&&console.error("Connection already has a parent. This should not happen."),r.parent=this,this._weight+=r.weight})}addOppositeLinks(t){(Array.isArray(t)?t:[t]).forEach(r=>{this.oppositeLinks.push(r),this._weight-=r.weight})}getLinks(){return this.links}getOppositeLinks(){return this.oppositeLinks}getSubNodePathViaHypernodes(){const t=this.parent,e=t.source,r=t.target,i=[];let o=this.source;for(i.push(this.source);o?.parent&&o!=e;)o=o.parent,i.push(o);o=this.target;const a=[];for(a.push(this.target);o?.parent&&o!=r;)o=o.parent,a.push(o);return i.push(...a.reverse()),i}getConnectionPathViaHyperAndVirtualNodes(){const t=this.source,e=this.target,r=[],i=this.parent;if(!i)return[t,e];const o=i.source,a=i.target;let l=this.source;for(r.push(t);l?.parent&&l!=o;){const u=l.parent?.existingVirtualChildren.get(e.id);u&&r.push(u),l=l.parent,r.push(l)}l=this.target;const h=[];for(h.push(this.target);l?.parent&&l!=a;){const u=l.parent?.existingVirtualChildren.get(t.id);u&&h.push(u),l=l.parent,h.push(l)}return r.push(...h.reverse()),r}static combineInAndOutLinks(t){const e=[],r=new Map;t.forEach(l=>{r.has(l.fromId)||r.set(l.fromId,new Map);const h=r.get(l.fromId);if(!h.has(l.toId))h.set(l.toId,l.cloneSimple());else{const u=h.get(l.toId);u._weight+=l._weight}});const i=[];r.forEach(l=>{l.forEach(h=>{i.push(h)})});const o=new Map;i.forEach(l=>{o.has(l.fromId)||o.set(l.fromId,new Map),o.get(l.fromId).set(l.toId,l.cloneSimple())});const a=.001;return i.forEach(l=>{const h=o.get(l.fromId)?.get(l.toId),u=o.get(l.toId)?.get(l.fromId);if(!(!h&&!u)){if(h&&u){const d=h.weight-u.weight;d>a?(h._weight=d,e.push(h)):d<-a&&(u._weight=-d,e.push(u)),o.get(h.fromId)?.delete(h.toId),o.get(h.toId)?.delete(h.fromId);return}if(!h&&u){e.push(u),o.get(u.fromId)?.delete(u.toId);return}if(!u&&h){e.push(h),o.get(h.fromId)?.delete(h.toId);return}}}),e}cloneSimple(){const t=new _n(this.source,this.target);return t._weight=this._weight,t}getInstance(t){return t instanceof Function?t(this):t}calculateLayoutPoints(t){const e=this.getInstance(t??this.connector);e&&e.layoutConnection(this)}createGraphicalElements(){this.connection2d||(this.connection2d=new XE(this))}updatePoints(){this.connection2d?.updatePath()}resetPoints(){this.pathSegment=void 0,this.finishedLayouting=!1}}class Vs{sizeMultiplier;minSizeFraction=.2;minSizeScore=.1;maxSizeScore=1;marginFactor=1.1;scaleScoreToSizeFraction;adaptRadiusBasedOnScore;virtualNodeMultiplier;constructor({sizeMultiplier:t=50,minSizeScore:e=.1,marginFactor:r=1.1,adaptRadiusBasedOnScore:i=!0,virtualNodeMultiplier:o=.7}={}){this.sizeMultiplier=t,this.minSizeScore=e,this.marginFactor=r,this.adaptRadiusBasedOnScore=i,this.virtualNodeMultiplier=o,this.scaleScoreToSizeFraction=t0().domain([this.minSizeScore,this.maxSizeScore]).range([this.minSizeFraction,1])}precalculate(t,e){if(t.children.length==0)this.adaptRadiusBasedOnScore?(t.radius=this.scaleScoreToSizeFraction(Math.max(t.score,this.minSizeScore))*this.sizeMultiplier,t.isVirtual&&(t.radius*=this.virtualNodeMultiplier)):(t.radius=this.sizeMultiplier,t.isVirtual&&(t.radius*=this.virtualNodeMultiplier));else if(t.radius==0){console.warn("Size not calculated for node with children",t.id);const r=Math.max(...t.children.map(h=>h.radius)),i=Br(t.children.map(h=>h.center.x)),o=Br(t.children.map(h=>h.center.y)),a=Math.abs(i[0]-i[1]),l=Math.abs(o[0]-o[1]);t.radius=Math.max(a+r,l+r)}t.radius=Math.max(t.radius,this.minSizeScore),t.outerRadius=t.radius*this.marginFactor}}class Gs{TAG="BaseNodeConnectionLayouter";preHooks=[];postHooks=[];constructor(){}addPreHook(t){this.preHooks.push(t)}addPostHook(t){this.postHooks.push(t)}layoutConnections(t){this.preHooks.forEach(e=>e(t)),this.layoutConnectionsOfChildren(t),this.layoutConnectionsOfNode(t),t.visGraph.rootNode===t&&this.layoutConnectionsOfRootNode(t),this.postHooks.forEach(e=>e(t))}layoutConnectionsOfChildren(t){}layoutConnectionsOfNode(t){}layoutConnectionsOfRootNode(t){}}class wn{visGraph;id;debugShapes=[];constructor(t,e){this.visGraph=t,this.id=e}clone(t,e={cloneConnections:!0}){const r=new wn(this.visGraph,t);r.label=this.label,r.score=this.score;const i=e.parent??this.parent;return this.visGraph.addNode(r,i),e.cloneConnections&&(this.outConnections.forEach(o=>{this.visGraph.addLink(r,o.target,o.getLinks())}),this.inConnections.forEach(o=>{this.visGraph.addLink(o.source,r,o.getLinks())})),r}remove(){this.visGraph.removeNode(this)}commNode;parent;children=[];get isHyperNode(){return this.children.length>0}anchorNode;get isAnchor(){return this.parent?.anchorNode==this}splitParent;get isSplitNode(){return this.splitParent!=null}splitChildren=[];virtualParent;get isVirtual(){return this.virtualParent!=null}get hasVirtualChildren(){return this.virtualChildren.length>0}virtualChildren=[];existingVirtualChildren=new Map;get isRealNode(){return!this.isVirtual&&!this.isSplitNode&&!this.isHyperNode}addSplitChild(t){this.splitChildren.push(t),t.splitParent=this}addVirtualChild(t){this.virtualChildren.push(t),t.virtualParent=this,t.parent?.existingVirtualChildren.set(this.id,t)}static moveNodesToParent(t,e){t.forEach(r=>{const i=r.parent;r.moveNodeToParent(e),i&&i.children.length===1&&i.children[0]===e&&(wn.moveNodesToParent(Array.from(e.children),i),e.remove())})}moveNodeToParent(t){const e=this.parent;if(e){e.children.splice(e.children.indexOf(this),1);const r=this.virtualParent;r&&(e.existingVirtualChildren.delete(r.id),t.existingVirtualChildren.set(r.id,this))}this.parent=t,t.children.push(this)}_index=-1;get index(){return this._index>=0?this._index:this.parent?.children.indexOf(this)??-1}set index(t){this._index=t}precalculator=new Vs;positioner;sorter;connectionLayouter=new Gs;_currentConnectionLayouterIndex=0;outConnections=[];inConnections=[];get outConnectionsWithoutSelfLoops(){return this.outConnections.filter(t=>t.source.id!=t.target.id)}get inConnectionsWithoutSelfLoops(){return this.inConnections.filter(t=>t.source.id!=t.target.id)}_layer=0;_layerCount=0;get layerFromTop(){return this._layer}get layerFromBot(){return this._layerCount-this._layer-1}setLayer(t,e){this._layer=t,this._layerCount=e}hasGraphicalRepresentation=!0;getSuccessors(t){return this.outConnections.map(e=>e.target)}getPredecessors(t){return this.inConnections.map(e=>e.source)}static firstCommonParent(t,e){let r=t;for(;r;){if(e.isDescendantOf(r))return r;r=r.parent}}getCommonParent(t){return wn.firstCommonParent(this,t)}getChildNodeContainingNodeAsDescendant(t){if(t.parent==this)return t;let e=t.parent;for(;e;){if(e.parent==this)return e;e=e.parent}}getFirstParentByCondition(t){let e=this;if(!t)return e.parent;for(;e;){if(t(e))return e;e=e.parent}}isDescendantOf(t){let e=this;for(;e;){if(e==t)return!0;e=e.parent}return!1}isAncestorOf(t){return t.isDescendantOf(this)}isChildOf(t){return this.parent==t}isParentOf(t){return t.isChildOf(this)}get descendants(){const t=[];return this.children.forEach(e=>{t.push(e),t.push(...e.descendants)}),t}get successors(){return this.getSuccessors()}get predecessors(){return this.getPredecessors()}get ancestors(){const t=[];let e=this.parent;for(;e;)t.push(e),e=e.parent;return t}getConnectionTo(t){const e=this.visGraph.getNode(t);return this.visGraph.getConnectionBetweenNodes(this,e)}getBidirectionalConnections(t){return this.outConnections.filter(e=>e.opposite!==void 0)}getOutgoingConnections(t){return this.outConnections}getIncomingConnections(t){return this.inConnections}removeConnections(t){[...this.inConnections.filter(t),...this.outConnections.filter(t)].forEach(r=>{r.remove()})}removeHyperConnections(t=()=>!0){this.removeConnections(e=>e.isHyperConnection&&t(e))}removeCalculatedHyperConnections(){this.removeHyperConnections(t=>t.isCalculated)}score=0;get scoreIncludingChildren(){return this.children.reduce((t,e)=>t+e.scoreIncludingChildren,this.score)}get inDegree(){return this.inConnections.length}get outDegree(){return this.outConnections.length}get degree(){return this.inDegree+this.outDegree}get successorCount(){return this.getSuccessors().length}get predecessorCount(){return this.getPredecessors().length}isDirectSuccessorInSortingTo(t){if(!t)return!1;const e=this.parent,r=t.parent;if(!e||!r||e!=r)return!1;const i=t.index,o=this.index;return o-i==1||i-o==(e?.children.length??0)-1}isDirectPredecessorInSortingTo(t){return t?.isDirectSuccessorInSortingTo(this)??!1}getNextNodeInSorting(){if(!this.parent)return;const t=(this.index+1)%this.parent.children.length;return this.parent.children[t]}getPreviousNodeInSorting(){if(!this.parent)return;const t=(this.index-1+this.parent.children.length)%this.parent.children.length;return this.parent.children[t]}getIndexOfNodeContainingDescendant(t){let e=t;for(;e?.parent!=this;){if(!e)return-1;e=e.parent}return e.index}getNodeAtIndex(t){return t=(t+this.children.length)%this.children.length,this.children[t]}radius=0;_innerRadius;_outerRadius;_innerEnclosingRadius=0;get innerRadius(){return this._innerRadius??this.radius}set innerRadius(t){this._innerRadius=t}set innerEnclosingRadius(t){this._innerEnclosingRadius=t}get innerEnclosingRadius(){return this._innerEnclosingRadius?this._innerEnclosingRadius:this.innerRadius}innerCenterTranslation=new W(0,0);get outerRadius(){return this._outerRadius??this.radius}set outerRadius(t){this._outerRadius=t}sizeFactor=1;center=new D(0,0);get x(){return this.center.x}get y(){return this.center.y}set x(t){this.center.x=t}set y(t){this.center.y=t}get circle(){return new Q(this.center,this.radius)}get innerCircle(){return new Q(this.center.translate(this.innerCenterTranslation.scale(-1)),this.innerRadius)}get innerEnclosingCircle(){return new Q(this.center.translate(this.innerCenterTranslation.scale(-1)),this.innerEnclosingRadius)}get outerCircle(){return new Q(this.center,this.outerRadius)}get translationRelativeToParent(){return new W(this.center.x-(this.parent?.center.x??0),this.center.y-(this.parent?.center.y??0))}rotateChildrenLocally(t,e=new D(0,0)){this.innerCenterTranslation=this.innerCenterTranslation.rotate(t),this.children.forEach(r=>{r.center=r.center.rotate(t,e),r.rotateChildrenLocally(t,e)})}color;childrenColorScheme;childrenColorSchemeRange=[0,1];stroke;strokeWidth;filled=!0;strokeColor;label;showLabel=!0;applyChildrenColorScheme(t,e){this.childrenColorScheme=t,this.childrenColorSchemeRange=e;const r=e[0],i=e[1];let o=0;r<i?o=(r+i)/2:(o=(r+i+1)/2,o>1&&(o-=1)),this.color=t(o);const a=e[1]-e[0];this.children.forEach((l,h,u)=>{const d=h/u.length,g=(h+1)/u.length,y=e[0]+a*d,m=e[0]+a*g;l.applyChildrenColorScheme(t,[y,m])})}getAnchor(t){let e=null;if(t instanceof D?e=new W(t.x-this.center.x,t.y-this.center.y):t instanceof W&&(e=t),!e)throw new Error("Invalid parameter type");const r=e;let i;return r.length==0?i=this.center:i=this.center.translate(r.normalize().multiply(this.radius)),new st(i,r)}getValidInnerRadRange(t=1,e=!1){const r=this.parent,i=this.getNextNodeInSorting(),o=this.getPreviousNodeInSorting();if(!r||!i||!o)return[0,0];let a=[0,0];const l=F.getTangentsFromPointToCircle(this.center,i.outerCircle),h=F.getTangentsFromPointToCircle(this.center,o.outerCircle);let u=F.getClosestShapeToPoint(l,r.center,m=>m.end),d=F.getClosestShapeToPoint(h,r.center,m=>m.end);if(e&&(u=new U(this.center,i.center),d=new U(this.center,o.center)),i==o&&(u=l[0],d=l[1]),!u||!d)return[0,0];const g=F.radOfPoint(u.end,this.center),y=F.radOfPoint(d.end,this.center);if(a=[g,y],i==o){const m=F.radOfPoint(i.center,this.center);F.radIsBetween(m,y,g)?a=[y,g]:a=[g,y];const w=F.forwardRadBetweenAngles(a[0],a[1]),v=a[0]+w/2;a=[v-w,v+w]}if(t!=1){const m=F.forwardRadBetweenAngles(a[0],a[1]),w=a[0]+m/2;a=[w-m/2*t,w+m/2*t]}return a.forEach((m,w,v)=>{v[w]=F.normalizeRad(m)}),a}getValidOuterRadRange(t=1,e=!0){if(this.parent?.children.length==1){const w=new W(this.parent.parent.center,this.center).rotate(0).slope;return[w+.1,w-.1]}const i=this.parent,o=this.getNextNodeInSorting(),a=this.getPreviousNodeInSorting();let l=[0,0];if(!i||!o||!a)return l;const h=F.getTangentsFromPointToCircle(this.center,o.outerCircle),u=F.getTangentsFromPointToCircle(this.center,a.outerCircle);let d=F.getFurthestShapeToPoint(h,i.center,w=>w.end),g=F.getFurthestShapeToPoint(u,i.center,w=>w.end);if(o==a&&(d=h[0],g=h[1]),!d||!g)return l;const y=F.radOfPoint(d.end,this.center),m=F.radOfPoint(g.end,this.center);if(l=[m,y],o==a){const w=F.radOfPoint(o.center,this.center);F.radIsBetween(w,m,y)?l=[y,m]:l=[m,y]}if(e){const w=i.innerCircle,v=F.radOfPoint(i.center,this.center),_=w.intersect(this.outerCircle);if(_.length==2){let b=F.radOfPoint(_[0],this.center),N=F.radOfPoint(_[1],this.center);F.radIsBetween(v,b,N)||([b,N]=[N,b]);const A=F.forwardRadBetweenAngles(N,b),T=F.forwardRadBetweenAngles(l[0],l[1]);A<T&&(l=[N,b])}}if(t!=1){const w=F.forwardRadBetweenAngles(l[0],l[1]),v=l[0]+w/2;l=[v-w/2*t,v+w/2*t]}return l.forEach((w,v,_)=>{_[v]=F.normalizeRad(w)}),l}getValidCircularRadRange(t=0,e=-.3,r){if(!this.parent)return[0,0];const i=this.center,o=this.parent.innerCircle.center,a=this.parent.innerCircle.clone(),l=this.parent.innerCircle.clone(),h=r=="clockwise"?this.getNextNodeInSorting():this.getPreviousNodeInSorting(),u=Math.min(this.outerRadius,h?.outerRadius??0);a.r=a.r+u*t,l.r=l.r+u*e;const d=this.outerCircle.intersect(a),g=this.outerCircle.intersect(l);if(d.length!=2||g.length!=2){d.splice(0,d.length),g.splice(0,g.length);const _=this.parent?.parent;if(_){const b=_.innerCircle.center,N=b.distanceTo(this.center)[0],A=new Q(b,N),T=A.clone(),P=A.clone();T.r=A.r+u*t,P.r=A.r+u*e;const M=this.outerCircle.intersect(T),R=this.outerCircle.intersect(P);M.length==2&&R.length==2&&(d.push(...M),g.push(...R))}if(d.length!=2||g.length!=2)return[0,0]}const y=F.forwardRadBetweenAngles(F.radOfPoint(d[0],o),F.radOfPoint(d[1],o))<Math.PI?d[1]:d[0],m=y==d[0]?d[1]:d[0],w=F.forwardRadBetweenAngles(F.radOfPoint(g[0],o),F.radOfPoint(g[1],o))<Math.PI?g[1]:g[0],v=w==g[0]?g[1]:g[0];return r=="clockwise"?[F.radOfPoint(y,i),F.radOfPoint(w,i)]:[F.radOfPoint(v,i),F.radOfPoint(m,i)]}getInstance(t){return t instanceof Function?t(this):t}calculateNodeSize(t){this.getInstance(t??this.precalculator)?.precalculate(this,this.visGraph)}sortChildren(t){if(this.children.length==0)return;const e=this.getInstance(t??this.sorter);e!=null&&(this.children=e.getSorting(this.children))}propagatePositionToChildNodes(){this.children.forEach(t=>{t.center=t.center.translate(this.center)})}propagateSizeToChildNodes(){this.children.forEach(t=>{const e=this.radius,r=t.radius,o=this.sizeFactor*(r/e);t.sizeFactor=o})}async calculatePositionOfChildren(t){if(this.children.length==0)return;await this.getInstance(t??this.positioner)?.positionChildren(this)}refinePositionOfChildren(t){if(this.children.length==0)return;this.getInstance(t??this.positioner)?.refinePositions(this)}initConnectionLayouter(){this.outConnections.forEach(t=>{t.resetPoints()}),this._currentConnectionLayouterIndex=0}getConnectionLayouter(){return Array.isArray(this.connectionLayouter)?this.connectionLayouter:[this.connectionLayouter]}getConnectionLayouterByTag(t){return this.getConnectionLayouter().find(e=>e.TAG==t)}iterateConnectionLayouter(){const t=Array.isArray(this.connectionLayouter)?this.connectionLayouter:[this.connectionLayouter];return t.length==0||this._currentConnectionLayouterIndex>=t.length?!1:(t[this._currentConnectionLayouterIndex].layoutConnections(this),this._currentConnectionLayouterIndex++,!0)}node2d;createGraphicalElements(){this.hasGraphicalRepresentation&&!this.node2d&&(this.node2d=new KE(this)),this.outConnections.forEach(t=>{t.createGraphicalElements()})}updateGraphicalLayout(){this.node2d?.updatePositionAndSize(this.center.x,this.center.y,this.radius),this.outConnections.forEach(t=>{t.updatePoints()})}}class QE{visGraph;focusedNodeId=void 0;selectedNodeIds=new Set;hoveredNodeIds=new Set;hoveredConnection=new Set;constructor(t){this.visGraph=t}emitter=mr();addSelectedNode(t){this.selectedNodeIds.add(t),this.emitter.emit("update")}addHoveredConnection(t,e=!0){this.hoveredConnection.add(t),e&&t.children.forEach(r=>this.hoveredConnection.add(r)),console.log("Hovered connections",Array.from(this.hoveredConnection)),this.emitter.emit("update")}removeHoveredConnection(t,e=!0){this.hoveredConnection.delete(t),e&&t.children.forEach(r=>this.hoveredConnection.delete(r)),this.emitter.emit("update")}addHoveredNode(t,e=!0){const i=(Array.isArray(t)?t:[t]).map(o=>this.visGraph.getNode(o));i.length>0,i.forEach(o=>this.hoveredNodeIds.add(o.id)),e&&i.forEach(o=>{o.descendants.forEach(a=>this.hoveredNodeIds.add(a.id))}),i.forEach(o=>{o.splitParent&&(this.hoveredNodeIds.add(o.splitParent.id),o.splitParent.splitChildren.map(a=>a.id).forEach(a=>this.hoveredNodeIds.add(a))),o.splitChildren.length>0&&o.splitChildren.map(a=>a.id).forEach(a=>this.hoveredNodeIds.add(a)),o.isVirtual&&this.hoveredNodeIds.add(o.virtualParent.id)}),console.log("Hovered nodes",Array.from(this.hoveredNodeIds).map(o=>this.visGraph.getNode(o))),this.emitter.emit("update")}setFocusedNode(t){this.focusedNodeId=t,this.emitter.emit("update")}clearSelectedNodes(){this.selectedNodeIds.clear(),this.emitter.emit("update")}clearHoveredNodes(){this.hoveredNodeIds.clear(),this.emitter.emit("update")}clearFocusedNode(){this.focusedNodeId=void 0,this.emitter.emit("update")}removeSelectedNode(t){this.selectedNodeIds.delete(t),this.emitter.emit("update")}removeHoveredNode(t,e=!0){const i=(Array.isArray(t)?t:[t]).map(o=>this.visGraph.getNode(o));i.forEach(o=>this.hoveredNodeIds.delete(o.id)),e&&i.forEach(o=>{o.descendants.forEach(a=>this.hoveredNodeIds.delete(a.id))}),i.forEach(o=>{o.splitParent&&(this.hoveredNodeIds.delete(o.splitParent.id),o.splitParent.splitChildren.map(a=>a.id).forEach(a=>this.hoveredNodeIds.delete(a))),o.splitChildren.length>0&&o.splitChildren.map(a=>a.id).forEach(a=>this.hoveredNodeIds.delete(a)),o.isVirtual&&this.hoveredNodeIds.delete(o.virtualParent.id)}),this.emitter.emit("update")}isHovered(t){if(t instanceof _n)return this.hoveredConnection.has(t);const e=t.id??t;return this.hoveredNodeIds.size>0?this.hoveredNodeIds.has(e):!1}isAdjacentToHovered(t){const e=t.id??t;for(const r of this.hoveredNodeIds){const i=this.visGraph.getNode(r);for(const o of i.getSuccessors())if(o.id===e)return!0;for(const o of i.getPredecessors())if(o.id===e)return!0}if(this.hoveredConnection.size>0){for(const r of this.hoveredConnection)if(r.source.id===e||r.target.id===e)return!0}return!1}isSelected(t){const e=t.id??t;return this.selectedNodeIds.has(e)}isFocused(t){const e=t.id??t;return this.focusedNodeId===e}get currentFocusedNode(){return this.focusedNodeId}get currentSelectedNodes(){return this.selectedNodeIds}get currentHoveredNodes(){return this.hoveredNodeIds}get somethingIsFocused(){return this.focusedNodeId!==void 0&&this.focusedNodeId!==null}get somethingIsHovered(){return this.hoveredNodeIds.size>0||this.hoveredConnection.size>0}get somethingIsSelected(){return this.selectedNodeIds.size>0||this.hoveredConnection.size>0}get somethingIsSelectedOrFocusedOrHovered(){return this.somethingIsSelected||this.somethingIsFocused||this.somethingIsHovered}}class zs{constructor(t){this.visGraph=t}getConnectedComponent(t,e,r){if(t===void 0)return[];const i=this.visGraph.getNode(t),o=new Set((r?.map(h=>this.visGraph.getNode(h))??this.visGraph.allLayoutNodes).map(h=>h.id)),a=new Set,l=[i];for(;l.length>0;){const h=l.shift();if(a.has(h.id)||!o.has(h.id))continue;a.add(h.id);const u=h.getSuccessors(e),d=h.getPredecessors(e);l.push(...u,...d)}return Array.from(a).map(h=>this.visGraph.getNode(h))}getConnectedComponents(t,e){t=t??this.visGraph.allLayoutNodes;const r=new Set,i=[];for(const o of t){if(r.has(o.id))continue;const a=this.getConnectedComponent(o,e,t);i.push(a),a.forEach(l=>r.add(l.id))}return i}}class ZE{range=[0,1];extent=[0,0];colorScheme=Jo;getColor(t){if(!this.isExtentValid())return"red";const e=Au().domain(this.extent).range(this.range);return this.colorScheme(e(t))}setColorScheme(t){this.range=[0,1];const e=[.3,1],r=[.2,1];switch(t.toLowerCase()){case"blue":this.range=e,this.colorScheme=uT;break;case"green":this.range=e,this.colorScheme=fT;break;case"orange":this.range=e,this.colorScheme=wT;break;case"red":this.range=e,this.colorScheme=mT;break;case"purple":this.range=e,this.colorScheme=gT;break;case"turbo":this.colorScheme=AT;break;case"viridis":this.colorScheme=NT;break;case"inferno":this.colorScheme=ET;break;case"magma":this.colorScheme=TT;break;case"plasma":this.colorScheme=IT;break;case"cividis":this.colorScheme=vT;break;case"warm":this.colorScheme=bT;break;case"cool":this.colorScheme=_T;break;case"orange-red":this.range=r,this.colorScheme=nT;break;case"yellow-green-blue":this.range=r,this.colorScheme=iT;break;case"yellow-green":this.range=r,this.colorScheme=oT;break;case"yellow-orange-red":this.range=r,this.colorScheme=cT;break;case"red-yellow-green":this.colorScheme=Jo;break;default:this.colorScheme=Jo;break}}calculateExtent(t){this.extent=Br(t,e=>e.score)}isExtentValid(){return Math.abs(this.extent[0])!==1/0&&Math.abs(this.extent[1])!==1/0}}class qa{commonSettings;userInteractions;constructor(t){this.commonSettings=t,this.userInteractions=new QE(this),this.rootNode.hasGraphicalRepresentation=!1,this.addNode(this.rootNode)}static fromCommGraph(t,e){const r=new qa(e);return t.nodes.forEach(o=>{const a=new wn(r,o.id);a.commNode=o,a.score=o.score,r.addNode(a)}),t.getAllLinks(void 0,e.hideLinksThreshold.getValue()).forEach(o=>{const a=new JE(o);r.addLink(o.fromId,o.toId,a)}),console.log("Created vis graph",r),r}rootNode=new wn(this,"__root__");mapIdToLayoutNode=new Map;getNode(t){if(typeof t=="string"){if(!this.mapIdToLayoutNode.has(t))throw new Error(`Node with id ${t} not found`);return this.mapIdToLayoutNode.get(t)}return t}getNextFreeId(t){let e=0;for(;this.mapIdToLayoutNode.has(`${t}_${e}`);)e++;return`${t}_${e}`}getLayeredLayoutNodes(t=!1){const e=[],r=(i,o)=>{e[o]||(e[o]=[]),e[o].push(i),i.children.forEach(a=>r(a,o+1))};return r(this.rootNode,0),t?e.reverse():e}get allLayoutNodes(){return Array.from(this.getLayeredLayoutNodes(!1).flat())}get allLeafLayoutNodes(){return this.allLayoutNodes.filter(t=>t.children.length===0)}addNode(t,e){const r=e??this.rootNode;r!==t&&(r.children.push(t),t.parent=r),this.mapIdToLayoutNode.set(t.id,t)}removeNode(t,e=!1,r=!1){if(t.children.length>0){if(!e)throw new Error("Cannot remove node with children");t.children.forEach(i=>this.removeNode(i,!0))}t.outConnections.forEach(i=>{const o=i.target;o.inConnections.splice(o.inConnections.indexOf(i),1)}),t.inConnections.forEach(i=>{const o=i.source;o.outConnections.splice(o.outConnections.indexOf(i),1)}),r||this.mapIdToLayoutNode.delete(t.id),t.parent?.children.splice(t.parent.children.indexOf(t),1)}getCommunitiesOfConnectionsOfNode(t){const e=new Set;return t.outConnections.forEach(r=>{const i=r.target;i.parent&&i.parent!==t.parent&&e.add(i.parent)}),t.inConnections.forEach(r=>{const i=r.source;i.parent&&i.parent!==t.parent&&e.add(i.parent)}),Array.from(e)}mapSourceNodeIdToTargetNodeIdToConnection=new Map;get allLayoutConnections(){return this.getAllConnections()}addLink(t,e,r){const i=this.getNode(t),o=this.getNode(e),a=i.id,l=o.id;if(this.mapSourceNodeIdToTargetNodeIdToConnection.has(a)||this.mapSourceNodeIdToTargetNodeIdToConnection.set(a,new Map),!this.mapSourceNodeIdToTargetNodeIdToConnection.get(a).has(l)){const u=new _n(i,o);this.mapSourceNodeIdToTargetNodeIdToConnection.get(a).set(l,u);const d=this.mapSourceNodeIdToTargetNodeIdToConnection.get(l)?.get(a);d&&(u.opposite=d,d.opposite=u),i.outConnections.push(u),o.inConnections.push(u)}const h=this.mapSourceNodeIdToTargetNodeIdToConnection.get(a).get(l);return h.addLinks(r),h}addHyperConnection(t,e,r,i=!1){const o=this.getNode(t),a=this.getNode(e),l=o.id,h=a.id;if(this.mapSourceNodeIdToTargetNodeIdToConnection.has(l)||this.mapSourceNodeIdToTargetNodeIdToConnection.set(l,new Map),!this.mapSourceNodeIdToTargetNodeIdToConnection.get(l).has(h)){const d=new _n(o,a);this.mapSourceNodeIdToTargetNodeIdToConnection.get(l).set(h,d);const g=this.mapSourceNodeIdToTargetNodeIdToConnection.get(h)?.get(l);g&&(d.opposite=g,g.opposite=d),o.outConnections.push(d),a.inConnections.push(d)}const u=this.mapSourceNodeIdToTargetNodeIdToConnection.get(l).get(h);u.isCalculated=!i,u.addChildren(r)}removeConnection(t){const e=t.source,r=t.target;e.outConnections=e.outConnections.filter(i=>i!==t),r.inConnections=r.inConnections.filter(i=>i!==t),this.mapSourceNodeIdToTargetNodeIdToConnection.get(e.id).delete(r.id)}moveConnectionsBetweenNodes(t,e,r,i,o=!0){const a=[this.getConnectionBetweenNodes(t,e)],l=[],h=[];return a.forEach(u=>{if(!u)return;console.log("Move connection",`${t.id} -> ${e.id}`,"to",`${r.id} -> ${i.id}`),o?this.removeConnection(u):h.push(u);const d=this.addLink(r,i,u.getLinks());l.push(d)}),{newConnections:l,connectionsToDelete:h}}getOutgoingConnections(t,e){return this.getNode(t).outConnections}getIncomingConnections(t,e){return this.getNode(t).inConnections}getAllConnectionsOfNodes(t,e){const r=[];return t.forEach(i=>{r.push(...this.getOutgoingConnections(i))}),r}getAllConnections(t){return this.getAllConnectionsOfNodes(this.allLayoutNodes)}getConnectionBetweenNodes(t,e,r){return this.mapSourceNodeIdToTargetNodeIdToConnection.get(this.getNode(t).id)?.get(this.getNode(e).id)}setPrecalculator(t){this.allLayoutNodes.forEach(e=>{e.precalculator=t})}setPositioner(t){this.allLayoutNodes.forEach(e=>{e.positioner=t})}setConnectionLayouter(t){this.allLayoutNodes.forEach(e=>{e.connectionLayouter=t})}setSorter(t){this.allLayoutNodes.forEach(e=>{e.sorter=t})}async layout(){const t=this.getLayeredLayoutNodes(!0),e=Array.from(t).reverse(),r=t.length;e.forEach((a,l)=>{a.forEach(h=>{h.setLayer(l,r)})}),await Promise.all(t.map(async a=>{await Promise.all(a.map(async l=>{l.children.length>0&&(l.sortChildren(),await l.calculatePositionOfChildren()),await l.calculateNodeSize()}))})),e.forEach(a=>{a.forEach(l=>{l.propagateSizeToChildNodes(),l.propagatePositionToChildNodes()})}),t.forEach((a,l)=>{a.forEach(h=>{h.refinePositionOfChildren()})}),t.flat().forEach(a=>{a.initConnectionLayouter()});let i=!0;for(;i;)i=!1,t.forEach(a=>{try{a.forEach(l=>{const h=l.iterateConnectionLayouter();i=i||h})}catch(l){console.error(l)}});const o=aa(this.allLayoutNodes.map(a=>a.radius))??0;this.smallestExistingNodeSize=aa(this.allLayoutNodes.filter(a=>!a.isVirtual).map(a=>a.radius))??o,this.createGraphicalElements(),this.updateGraphicalLayout(),this.updateGraphicalStyle()}getLaidOutApiData(){const t=this.allGraphicalLeafNodes.map(r=>({id:r.id,x:r.x,y:r.y,score:r.score,radius:r.radius})),e=this.allGraphicalConnections.map(r=>({source:r.source.id,target:r.target.id,weight:r.weight,distance:r.distance,path:r.getSvgPath()}));return{nodes:t,links:e}}renderer=new qE(this);getAllGraphicalNodes(){return this.allGraphicalNodes}get allGraphicalNodes(){return this.allLayoutNodes.map(t=>t.node2d).filter(t=>t!==void 0)}get allGraphicalLeafNodes(){return this.allLayoutNodes.filter(t=>t.children.length===0).map(t=>t.node2d).filter(t=>t!==void 0)}getAllGraphicalConnections(t=!0){const e=[];return this.allLayoutNodes.forEach(r=>{e.push(...r.outConnections.map(i=>i.connection2d).filter(i=>i!==void 0).filter(i=>!(t&&!i.layoutConnection.isRendered)))}),e}get allGraphicalConnections(){return this.getAllGraphicalConnections()}createGraphicalElements(){this.allLayoutNodes.forEach(t=>{t.createGraphicalElements()})}updateGraphicalLayout(){this.allLayoutNodes.forEach(t=>{t.updateGraphicalLayout()})}get debugShapes(){const t=[];return this.allGraphicalNodes.forEach(e=>{e.layoutNode.debugShapes.length>0&&t.push(...e.layoutNode.debugShapes)}),this.allGraphicalConnections.forEach(e=>{e.layoutConnection.debugShapes.length>0&&t.push(...e.layoutConnection.debugShapes)}),t.push(...this.rootNode.debugShapes),t}smallestExistingNodeSize=0;updateGraphicalStyle(){const t=new ZE;t.calculateExtent(this.allLayoutNodes),t.setColorScheme(this.commonSettings?.nodeScoreColorScheme.getValue()??"red-yellow-green"),t.isExtentValid(),this.allGraphicalNodes.forEach(u=>{if(this.commonSettings?.showNodeScore.getValue()??!0){const d=t.getColor(u.score),g=(this.commonSettings?.showCommunityColors.getValue()?u.layoutNode.color:d)??d;u.updateStyleFill(g)}else{const d=t.getColor(.5);u.updateStyleFill(d)}});const e=this.userInteractions,r=this.commonSettings?.showHyperNodeEdges.getValue()??!0;this.allGraphicalNodes.forEach(u=>{if(u.layoutNode.isHyperNode&&(r?u.updateStyleStroke(void 0,void 0,1):u.updateStyleStroke(void 0,void 0,0)),e.somethingIsSelectedOrFocusedOrHovered&&e.isHovered(u)){u.updateStyleStroke("black");return}if(u.layoutNode.stroke){u.updateStyleStroke(u.layoutNode.stroke);return}if(!u.communities){u.updateStyleStroke("white");return}const d=u.communities.getCommunitiesOfNode(u.id);if(d.length===0)return;const g=u.communities.countOfCommunities;if(g===0)return;const y=d.map(w=>{const v=w/g;return $l(PT(v))}),m=$l(ms(y,w=>w.h),ms(y,w=>w.s),ms(y,w=>w.l));u.updateStyleStroke(m.formatRgb())}),this.allGraphicalNodes.forEach(u=>{let d=1;e.somethingIsSelectedOrFocusedOrHovered&&(e.isHovered(u)?d=1:e.isAdjacentToHovered(u.id)?d=.8:d=.1),u.updateStyleOpacity(d)});const i=this.commonSettings?.linkWidthMultiplier.getValue()??1,o=this.commonSettings?.linkColor.getValue()?.toString()??"black";let a=cn(o)?.copy({opacity:1})?.toString()??"black";const l=cn(o)?.opacity??1,h=this.commonSettings?.showLinkScore.getValue()??!0;this.allGraphicalConnections.forEach(u=>{if(!h){u.updateStyleOpacity(l),u.updateStyleStroke(a,i);return}const d=u.weight,g=u.layoutConnection.width;let y=Math.min(Math.max(.01,d),1)*l;if(!(this.commonSettings?.enableLinkOpacity.getValue()??!0)){const m=cn(o).rgb(),w=N=>Math.round(N*y+255*(1-y)),v=w(m.r),_=w(m.g),b=w(m.b);y=1,a=Gr(v,_,b).toString()}if(u.source,u.target,e.somethingIsSelectedOrFocusedOrHovered){const m=u.source,w=u.target;e.isHovered(u.layoutConnection)||e.isHovered(m)||e.isHovered(w)?y=l:y*=.05}u.updateStyleOpacity(y),u.updateStyleStroke(a,g)}),this.allGraphicalNodes.forEach(u=>{this.commonSettings?.displayNodeLabels.getValue()??!1?u.id.startsWith("p")?u.updateLabelVisibility(!1):u.updateLabelVisibility(u.layoutNode.showLabel):u.updateLabelVisibility(!1)})}setEdgeVisibility({hyperEdges:t=!0,edgesIncludedInHyperEdges:e=!0,virtualEdges:r=!1}){this.allLayoutConnections.forEach(i=>{i.isHyperConnection?i.isRendered=t:i.isPrimaryConnection&&(i.isRendered=e),i.isThroughVirtualNodes&&(i.isRendered=r)})}_hyperNodeId=0;getNewHyperNodeId(){return`__hypernode_${this._hyperNodeId++}`}moveNodesToParent(t,e){wn.moveNodesToParent(t,e)}combineNodesIntoHyperNode(t,e=this.rootNode){const r=new wn(this,this.getNewHyperNodeId());return this.addNode(r,e),this.moveNodesToParent(t,r),r}combineConnectedComponents(){const t=new zs(this),e=this.rootNode.children,r=t.getConnectedComponents(e);if(r.length<=1){console.log("Only one connected component found, no grouping needed");return}console.log(`Found ${r.length} separate connected components`),r.forEach((i,o)=>{if(i.length>1){const a=new wn(this,`__connected_component_${o}`);this.addNode(a,this.rootNode),this.moveNodesToParent(i,a),a.filled=!1,a.stroke="darkgray",a.strokeWidth=2,a.showLabel=!1}}),this.updateHyperConnections()}combineCommunities(t,e=this.rootNode){const r=t.map(d=>d.map(g=>this.getNode(g))),i=this.allLayoutNodes.filter(d=>r.filter(g=>g.includes(d)).length>1);console.log("Nodes having multiple communities",i),i.forEach(d=>{d.children.length>0&&console.error("Node having multiple communities has children, this should not happen");let g=0;const y=r.filter(m=>m.includes(d));y.forEach(m=>{const w=new Set(y.flat().map(M=>M.id)),v=d.clone(d.id+`_${g++}`);d.addSplitChild(v),m.splice(m.indexOf(d),1,v);const _=m.map(M=>M.id),b=y.filter(M=>M!==m).flat().map(M=>M.id),N=new Set(b),A=new Set(_),T=Array.from(w).filter(M=>!A.has(M)),P=new Set(T);v.removeConnections(M=>{const R=M.source.id,O=M.target.id;return A.has(R)&&A.has(O)?!1:!!(P.has(R)||P.has(O)||N.has(R)||N.has(O))})}),this.removeNode(d)});const o=xT,a=[0,1],l=[0,1];i.length>0&&(a[1]=.6,l[0]=.6);const h=a[1]-a[0],u=l[1]-l[0];r.forEach((d,g,y)=>{const m=this.combineNodesIntoHyperNode(d,e),w=g/y.length,v=1/y.length,_=.2,b=a[0]+h*(w+_/2),N=a[0]+h*(w+v-_/2);m.applyChildrenColorScheme(o,[b,N]),m.filled=!1,m.stroke=o(w+v/2),m.strokeWidth=d.length,m.showLabel=!1}),i.forEach((d,g)=>{const y=d.splitChildren,m=g/i.length,w=1/i.length,v=.2,_=l[0]+u*(m+v/2),b=l[0]+u*(m+w-v/2);y.forEach((N,A)=>{const T=o(_+(b-_)*(A/y.length));N.color=T,N.stroke=T})}),this.updateHyperConnections()}addVirtualCommunityNodes(){const t=[];this.allLeafLayoutNodes.forEach(e=>{const r=this.getCommunitiesOfConnectionsOfNode(e);r.length>0&&(console.log("Node",e.id,"is connected to communities",r.map(i=>i.id)),r.forEach(i=>{const o=e.clone(`${e.id}_in_${i.id}`,{cloneConnections:!1,parent:i});o.label=e.label??e.id,e.addVirtualChild(o),i.children.forEach(a=>{if(a===e)return;const l=this.moveConnectionsBetweenNodes(a,e,a,o,!1),h=this.moveConnectionsBetweenNodes(e,a,o,a,!1);t.push(...l.connectionsToDelete),t.push(...h.connectionsToDelete)}),o.outConnections.length,o.inConnections.length}))})}updateHyperConnections(){this.allLayoutNodes.forEach(t=>{t.removeCalculatedHyperConnections()}),this.allLayoutConnections.forEach(t=>{t.parent=void 0}),this.getLayeredLayoutNodes(!0).forEach(t=>{t.forEach(e=>{e.outConnections.forEach(r=>{const i=r.source,o=r.target;if(!i.parent||!o.parent)return;const a=wn.firstCommonParent(i,o);if(i.parent!==o.parent){i.parent,o.parent;const l=i.getFirstParentByCondition(u=>u.parent==a)??i,h=o.getFirstParentByCondition(u=>u.parent==a)??o;this.addHyperConnection(l,h,r,!1)}})})})}combineStronglyCoupledNodes(){const t=new Map,e=(a,l=[],h=!0)=>{const u=a.outConnections,d=a.inConnections,g=new Set([...d.map(_=>_.source)]),y=new Set([...u.map(_=>_.target)]);l.forEach(_=>g.delete(_)),l.forEach(_=>y.delete(_)),h&&(Array.from(g).filter(_=>_.parent!==a.parent).forEach(_=>g.delete(_)),Array.from(y).filter(_=>_.parent!==a.parent).forEach(_=>y.delete(_)));const m=new Set([...y].filter(_=>!g.has(_))),w=new Set([...g].filter(_=>!y.has(_)));let v;if(g.size===1&&m.size===0?v=g.values().next().value:y.size===1&&w.size===0&&(v=y.values().next().value),!(h&&v&&v.parent!==a.parent))return v};this.allLayoutNodes.forEach(a=>{const l=e(a);l&&t.set(a,l)});const r=[],i=new Map;t.forEach((a,l)=>{const h=i.get(a)??{anchor:a,nodes:new Set([a])};i.has(a)||r.push(h),h.nodes.add(l),i.set(a,h),i.set(l,h)});let o=Array.from(r);for(;o.length>0;){const a=new Map;o.forEach(l=>{const h=l.anchor,u=e(h,Array.from(l.nodes));u&&a.set(u,[...a.get(u)??[],h])}),o=[],a.forEach((l,h)=>{if(l.length===1){const u=l[0],d=i.get(u);if(!d){console.error("Group not found for child",u,r,i);return}if(a.has(u)){const g=a.get(u);if(g.length===1&&g[0]===h){const y=h,m=u,w=i.get(y),v=y.score>m.score?y:m;w?.nodes.forEach(_=>{i.set(_,d)}),i.set(v,d),(w?.nodes??[]).forEach(_=>d.nodes.add(_)),d.anchor=v,r.splice(r.indexOf(w),1),o.push(d);return}}d.anchor=h,d.nodes.add(h),i.set(h,d),o.push(d)}})}console.log("Groups",r),r.forEach(a=>{const l=Array.from(a.nodes),h=a.anchor,u=this.combineNodesIntoHyperNode(l,h?.parent);u.anchorNode=h,u.filled=!1,u.showLabel=!1,u.stroke="gray",u.strokeWidth=l.length}),this.updateHyperConnections()}combineBroadcastingNodes(){}combineBySimilarConnections(){}}class B0 extends Fe{stress=0;constructor(t){super(t),console.log("Initializing stress calculator")}async calculate(){try{const t=await xe.fetchMetricsWithPolling(this.graph,"stress");console.log("Stress metric:",t),this.stress=t.value}catch(t){console.error("Error fetching stress metric:",t),this.stress=0}}}Ot(B0,"displayedMetrics",[{key:"stress",optimum:"lowerIsBetter",label:"Stress",abbreviation:"S",description:"Measures how well the Euclidean distances between nodes in the layout match the shortest path distances in the graph structure, with scale invariance. Lower values indicate better preservation of graph structure.",normalizing:"none"}]);class V0 extends Fe{pathContinuity=0;constructor(t){super(t),console.log("Initializing path continuity calculator")}async calculate(){try{const t=await xe.fetchMetricsWithPolling(this.graph,"pathContinuity");console.log("Path continuity metric:",t),this.pathContinuity=t.value}catch(t){console.error("Error fetching path continuity metric:",t),this.pathContinuity=0}}}Ot(V0,"displayedMetrics",[{key:"pathContinuity",optimum:"lowerIsBetter",label:"Path Continuity",abbreviation:"PC",description:"Measures how smoothly the paths change direction when following shortest paths in the graph. Lower values indicate smoother, more continuous paths.",normalizing:"none"}]);class G0 extends Fe{weightedPathContinuity=0;constructor(t){super(t),console.log("Initializing weighted path continuity calculator")}async calculate(){try{const t=await xe.fetchMetricsWithPolling(this.graph,"weightedPathContinuity");console.log("Weighted path continuity metric:",t),this.weightedPathContinuity=t.value}catch(t){console.error("Error fetching weighted path continuity metric:",t),this.weightedPathContinuity=0}}}Ot(G0,"displayedMetrics",[{key:"weightedPathContinuity",optimum:"lowerIsBetter",label:"Weighted Path Continuity",abbreviation:"WPC",description:"Measures how smoothly paths change direction when following shortest paths in the graph, giving more weight to important connections. Lower values indicate smoother, more continuous paths.",normalizing:"none"}]);class z0 extends Fe{pathAngularPrediction=0;constructor(t){super(t),console.log("Initializing path angular prediction calculator")}async calculate(){try{const t=await xe.fetchMetricsWithPolling(this.graph,"pathAngularPrediction");console.log("Path angular prediction metric:",t),this.pathAngularPrediction=t.value}catch(t){console.error("Error fetching path angular prediction metric:",t),this.pathAngularPrediction=0}}}Ot(z0,"displayedMetrics",[{key:"pathAngularPrediction",optimum:"lowerIsBetter",label:"Path Angular Prediction",abbreviation:"PAP",description:"Measures how well paths follow a consistent angular trend. Lower values indicate paths that have more predictable direction changes.",normalizing:"none"}]);class $0 extends Fe{nodeEdgeOverlaps=0;constructor(t){super(t),console.log("Initializing node-edge overlaps calculator")}async calculate(){try{const t=await xe.fetchMetricsWithPolling(this.graph,"nodeEdgeOverlaps");console.log("Node-edge overlaps metric:",t),this.nodeEdgeOverlaps=t.value}catch(t){console.error("Error fetching node-edge overlaps metric:",t),this.nodeEdgeOverlaps=0}}}Ot($0,"displayedMetrics",[{key:"nodeEdgeOverlaps",optimum:"higherIsBetter",label:"Node-Edge Overlaps",abbreviation:"NEO",description:"Measures how well edges avoid passing through unrelated nodes. Higher values indicate fewer unwanted overlaps relative to the maximum possible.",normalizing:"none"}]);class W0 extends Fe{aspectRatio=0;constructor(t){super(t),console.log("Initializing aspect ratio calculator")}async calculate(){try{const t=await xe.fetchMetricsWithPolling(this.graph,"aspectRatio");console.log("Aspect ratio:",t),this.aspectRatio=t.value}catch(t){console.error("Error fetching aspect ratio metric:",t),this.aspectRatio=0}}}Ot(W0,"displayedMetrics",[{key:"aspectRatio",optimum:"higherIsBetter",label:"Aspect Ratio",abbreviation:"AR",description:"The ratio of the longest to the shortest dimension of the graph. A higher value indicates a more elongated graph.",normalizing:"none"}]);class H0 extends Fe{nodeNodeOverlaps=0;constructor(t){super(t),console.log("Initializing node-node overlaps calculator")}async calculate(){try{const t=await xe.fetchMetricsWithPolling(this.graph,"nodeNodeOverlaps");console.log("Node-node overlaps metric:",t),this.nodeNodeOverlaps=t.value}catch(t){console.error("Error fetching node-node overlaps metric:",t),this.nodeNodeOverlaps=0}}}Ot(H0,"displayedMetrics",[{key:"nodeNodeOverlaps",optimum:"higherIsBetter",label:"Node-Node Overlaps",abbreviation:"NNO",description:"Measures how well nodes avoid overlapping with each other. Higher values indicate fewer overlaps relative to the maximum possible.",normalizing:"none"}]);class q0 extends Fe{totalEdgeCrossings=0;constructor(t){super(t),console.log("Calculating total edge crossings")}async calculate(){try{const t=await xe.fetchMetricsWithPolling(this.graph,"totalEdgeCrossings");console.log("Total edge crossings:",t),this.totalEdgeCrossings=t.value}catch(t){console.error("Error fetching total edge crossings metric:",t),this.totalEdgeCrossings=0}}getMetric(t){return t==="totalEdgeCrossings"?this.totalEdgeCrossings:super.getMetric(t)}}Ot(q0,"displayedMetrics",[{key:"totalEdgeCrossings",optimum:"lowerIsBetter",label:"Total Edge Crossings",abbreviation:"TEC",description:"The absolute number of edge crossings in the graph. Lower values indicate cleaner layouts with fewer visual intersections.",normalizing:"none"}]);class U0 extends Fe{totalPathLength=0;constructor(t){super(t),console.log("Calculating total path length")}async calculate(){try{const t=await xe.fetchMetricsWithPolling(this.graph,"totalPathLength");console.log("Total path length:",t),this.totalPathLength=t.value}catch(t){console.error("Error fetching total path length metric:",t),this.totalPathLength=0}}getMetric(t){return t==="totalPathLength"?this.totalPathLength:super.getMetric(t)}}Ot(U0,"displayedMetrics",[{key:"totalPathLength",optimum:"lowerIsBetter",label:"Total Path Length",abbreviation:"TPL",description:"The sum of all edge path lengths in the graph layout. Lower total path length generally indicates a more efficient use of space.",normalizing:"none"}]);const Ss=class Ss{mapIdToMetricsResults=new Map;mapKeyToSingleMetricResults=new Map;get allMetricsResults(){return Array.from(this.mapIdToMetricsResults.values())}getSingleMetricResults(t){return this.mapKeyToSingleMetricResults.has(t)||this.mapKeyToSingleMetricResults.set(t,new tI(t,this)),this.mapKeyToSingleMetricResults.get(t)}getMetricsResults(t){return this.mapIdToMetricsResults.has(t)||this.mapIdToMetricsResults.set(t,new jE(t,this)),this.mapIdToMetricsResults.get(t)}clearMetricResults(t){this.getMetricsResults(t).pending=!0}async calculateMetrics(t,e){if(!e.commonSettings?.calculateMetrics.getValue())return;const r=Ss.metricsToCalculate.map(o=>new o(e));this.getMetricsResults(t).update(r)}initMetrics(t,e=!0){if(e&&this.getMetricsResults(t).results.length>0)return;const r=Ss.metricsToCalculate.map(i=>new i(new qa));this.getMetricsResults(t).update(r)}clearMetrics(t){this.clearMetricResults(t),Array.from(this.mapKeyToSingleMetricResults.values()).forEach(e=>{e.update()})}cleanSettings(t){const e=new Set(t);Array.from(this.mapIdToMetricsResults.keys()).filter(i=>!e.has(i)).forEach(i=>{this.mapIdToMetricsResults.delete(i)})}};Ot(Ss,"metricsToCalculate",[W0,u0,q0,o0,a0,B0,V0,G0,z0,$0,H0,U0]);let nu=Ss;class jE{settingId;collection;mapMetricKeyToResult=new Map;get pending(){return this.results.some(t=>t.pending)}set pending(t){this.results.forEach(e=>{e.pending=t})}emitter=mr();get results(){return Array.from(this.mapMetricKeyToResult.values())}constructor(t,e){this.settingId=t,this.collection=e}getMetricResult(t){const e=t.key;if(!this.mapMetricKeyToResult.has(e)){const r=new eI(this.settingId,t,this.collection.getSingleMetricResults(e));r.emitter.on("relativeValueUpdated",()=>{this.emitDebouncedMetricsUpdated()}),r.emitter.on("valueUpdated",()=>{this.emitDebouncedMetricsUpdated()}),this.mapMetricKeyToResult.set(e,r)}return this.mapMetricKeyToResult.get(e)}update(t){t.forEach(e=>{e.getMetricDefinitions().forEach(r=>{this.getMetricResult(r).update(e)})}),this.emitter.emit("newMetrics")}update_from_api(t){t.forEach(e=>{const r=e.key;this.getMetricResult(e).updateByValue(e.value,e.description),console.log("Updated metric",r,e.value,e.description?`(Error: ${e.description})`:"")}),this.emitter.emit("newMetrics")}emitDebouncedMetricsUpdated=kS(()=>{this.emitter.emit("metricsUpdated")},100)}class tI{metricKey;metricsCollection;get pending(){return this.results.some(t=>t.pending)}constructor(t,e){this.metricKey=t,this.metricsCollection=e}update(){this.results.forEach(t=>{t.updateRelative()})}get results(){return this.metricsCollection.allMetricsResults.map(t=>t.mapMetricKeyToResult.get(this.metricKey)).filter(t=>t!==void 0)}get finishedResults(){return this.results.filter(t=>!t.pending)}get metricValues(){return this.results.map(t=>t.value)}get min(){return Math.min(...this.metricValues)}get max(){return Math.max(...this.metricValues)}get average(){return ms(this.metricValues)}get median(){return Gd(this.metricValues)}get standardDeviation(){return Vd(this.metricValues)}get normalizedValues(){return this.results.map(t=>t.normalizedValue)}get minNormalized(){return Math.min(...this.normalizedValues)}get maxNormalized(){return Math.max(...this.normalizedValues)}get averageNormalized(){return ms(this.normalizedValues)}get medianNormalized(){return Gd(this.normalizedValues)}get standardDeviationNormalized(){return Vd(this.normalizedValues)}}class eI{settingId;definition;calculator;metricKey;relativePlace=0;places=0;pending=!0;error;colorScale=e0(Jo);get value(){return this.error?Number.NaN:this.calculator?.getMetric(this.metricKey)??Number.NaN}get color(){return this.colorScale(this.normalizedValue)}get textColor(){if(this.singleMetricResults.pending)return"black";const t=Gr(cn(this.color));return Ip(t).l>50?"black":"white"}singleMetricResults;emitter=mr();get normalizedValue(){if(!this.calculator)return 0;let t=this.value;const e=this.definition.normalizing,r=this.singleMetricResults;if(e==="byMinimum")t=(t-r.min)/(r.max-r.min);else if(e==="byMaximum")t=(t-r.max)/(r.max-r.min);else if(e==="byAverage")t=(t-r.average)/(r.max-r.min);else if(e==="byMedian")t=(t-r.median)/(r.max-r.min);else if(e==="byShorterLayoutSide"){const i=this.calculator.shorterSide;t=t/i}else if(e==="byLongerLayoutSide"){const i=this.calculator.longerSide;t=t/i}return t}get shortResult(){let t=this.definition.abbreviation??"";return t.length==0&&this.definition.label?.split(" ")?.forEach(i=>{t+=i[0].toUpperCase()}),t+": "+this.normalizedValue.toFixed(2)}constructor(t,e,r){this.settingId=t,this.definition=e,this.metricKey=e.key,this.singleMetricResults=r}update(t){this.calculator=t,this.pending=!0,this.error=void 0,t.calculate().then(()=>{this.pending=!1,this.emitter.emit("valueUpdated",!0),this.singleMetricResults.update()}).catch(e=>{this.pending=!1,this.error=e.message||"Error calculating metric",console.error("Error calculating metric",this.metricKey,this.settingId,e),this.emitter.emit("valueUpdated",!0),this.singleMetricResults.update()})}updateByValue(t,e){this.calculator=void 0,this.pending=!1,this.error=e,this.emitter.emit("valueUpdated",!0),this.singleMetricResults.update()}updateRelative(){let t=[];this.definition.optimum==="higherIsBetter"?t=this.singleMetricResults.results.sort((l,h)=>h.normalizedValue-l.normalizedValue):this.definition.optimum==="lowerIsBetter"&&(t=this.singleMetricResults.results.sort((l,h)=>l.normalizedValue-h.normalizedValue)),this.places=t.length,this.relativePlace=t.indexOf(this);const e=this.singleMetricResults,r=e.maxNormalized,i=e.minNormalized,o=this.colorScale;let a=[i,r];this.definition.optimum==="higherIsBetter"?a=[i,r]:this.definition.optimum==="lowerIsBetter"&&(a=[r,i]),o.domain(a),this.emitter.emit("relativeValueUpdated",!0)}}class $i{settings;visGraph;get debugShapes(){const t=[];return this.visGraph?.allGraphicalNodes.forEach(e=>{e.layoutNode.debugShapes.length>0&&t.push(...e.layoutNode.debugShapes)}),this.visGraph?.allGraphicalConnections.forEach(e=>{e.layoutConnection.debugShapes.length>0&&t.push(...e.layoutConnection.debugShapes)}),t}gParent=null;get userInteractions(){return this.visGraph?.userInteractions}commonSettings;commGraph;nodes=[];center=new D(0,0);calculateMetrics=!0;events={};constructor(t){console.log("Creating layouter",t),this.commGraph=t.commGraph,this.settings=t.settings,this.commonSettings=t.commonSettings,this.nodes=t.nodes,this.resetVisGraph(),t.initOnConstruction&&this.initVisGraph()}resetVisGraph(){this.visGraph?.renderer.clear(),this.visGraph=qa.fromCommGraph(this.commGraph,this.commonSettings)}initVisGraph(){return new Promise((t,e)=>{t()})}get nodes2d(){return this.visGraph?.allGraphicalNodes}get connections2d(){return this.visGraph?.allGraphicalConnections}adaptNodesByCenterTranslation(){this.nodes2d.forEach(t=>{t.x+=this.center.x,t.y+=this.center.y})}updateGraphByCommonSettings(){this.updateStyle()}updateLayout(t=!1){this.initVisGraph().then(()=>{this.updateGraphByCommonSettings(),this.layout(t)})}markConnectionsAsUpdateRequired(){this.connections2d.forEach(t=>{t.requireUpdate()})}markNodesAsUpdateRequired(){this.nodes2d.forEach(t=>{t.requireUpdate()})}async layout(t=!1){throw new Error("Method not implemented.")}reset(){this.nodes2d.forEach(t=>{t.x=0,t.y=0}),this.updateLayout()}emitEvent(t){this.events[t]&&this.events[t].call(this)}on(t,e){if(e==null){delete this.events[t];return}else this.events[t]=e}selectGroup(t){const e=`g.${t}`,r=this.gParent;if(!r)throw new Error("Parent group not set");return r.selectChildren(e).data([0]).join("g").classed(t,!0),r.select(e)}setParentGroup(t){this.gParent=t}get renderer(){return this.visGraph?.renderer}updateStyle(){this.visGraph?.updateGraphicalStyle()}}class Ua{constructor(){}async positionChildren(t){}refinePositions(t){}}class nI extends Ua{settings;visGraph;isVertical=!0;get isHorizontal(){return!this.isVertical}set isHorizontal(t){this.isVertical=!t}constructor(t,e){super(),this.visGraph=e,this.settings=t}setDirection(t){this.isVertical=t=="vertical"}async positionChildren(t){const e=this.settings.getContext({visGraph:this.visGraph}),r=t.children;this.isHorizontal?r.forEach((i,o)=>{i.x=o*(this.settings.size.nodeDistance.getValue(e)??40),i.y=0}):r.forEach((i,o)=>{i.x=0,i.y=o*(this.settings.size.nodeDistance.getValue(e)??40)})}}class rI extends Gs{isVertical=!0;get isHorizontal(){return!this.isVertical}set isHorizontal(t){this.isVertical=!t}layoutConnectionsOfNode(t){t.outConnections.forEach(e=>{e.curveStyle="basis";const r=e.source,i=e.target,o=this.isVertical?"y":"x",l=Math.abs(r[o]-i[o])*.7,h=r[o]<i[o]?"down":"up",u=(w=>w?h=="down"?new W(1,0):new W(-1,0):h=="down"?new W(0,-1):new W(0,1))(this.isVertical),d=r.getAnchor(u),g=i.getAnchor(u),y=d.anchorPoint.clone(),m=g.anchorPoint.clone();e.pathSegment=new An(e).radius(l/2).startPoint(y).endPoint(m)})}}class iI extends $i{async layout(t=!1){const e=this.settings.getContext({visGraph:this.visGraph}),r=this.settings.sorting.getSorter(this.visGraph,this.commonSettings),i=new nI(this.settings,this.visGraph),o=new rI,a=this.settings.size.verticalOrientation.getValue(e)??!0;i.isVertical=a,o.isVertical=a,this.visGraph.setPositioner(i),this.visGraph.setSorter(r),this.visGraph.setConnectionLayouter(o),await this.visGraph.layout(),this.emitEvent("update"),this.emitEvent("end")}}class Xe{constructor(t,e,r=!1){this.visGraph=t,this.reverse=r,this.commonSettings=e}reverse=!1;secondarySorting;startNodeSelectionSorter;commonSettings;sortingImplementation(t){throw new Error("Method not implemented.")}getSorting(t){const e=this.sortingImplementation(t);return this.reverse?e.reverse():e}}class sI extends Xe{sortingImplementation(t){return t.sort(()=>Math.random()-.5)}}class $u extends Xe{sortingImplementation(t){return t.sort((e,r)=>e.id.localeCompare(r.id))}}class oI extends Xe{sortingImplementation(t){return t.sort((e,r)=>e.degree===r.degree?e.id.localeCompare(r.id):e.degree-r.degree).reverse()}}class aI extends Xe{sortingImplementation(t){return t.sort((e,r)=>e.getSuccessors().length===r.getSuccessors().length?e.id.localeCompare(r.id):e.getSuccessors().length-r.getSuccessors().length).reverse()}}class cI extends Xe{sortingImplementation(t){return t.sort((e,r)=>Math.abs(e.scoreIncludingChildren-r.scoreIncludingChildren)<.01?r.id.localeCompare(e.id):e.scoreIncludingChildren-r.scoreIncludingChildren).reverse()}}class lI extends Xe{sortingImplementation(t){this.startNodeSelectionSorter&&(t=this.startNodeSelectionSorter.getSorting(t));const e=new Set,r=[],i=new Set(t.map(o=>o.id));for(;t.length>0;){const o=t.shift();if(e.has(o))continue;const a=[o];for(;a.length>0;){const l=a.shift();e.has(l)||!i.has(l.id)||(e.add(l),r.push(l),a.push(...l.getSuccessors()))}}return r}}class uI extends Xe{sortingImplementation(t){this.startNodeSelectionSorter&&(t=this.startNodeSelectionSorter.getSorting(t));const e=new Set,r=[],i=new Set(t.map(a=>a.id)),o=a=>{e.has(a)||!i.has(a.id)||(e.add(a),r.push(a),a.getSuccessors().forEach(o))};return t.forEach(o),r}}class Wu extends Xe{clusterer;constructor(t,e){super(t,e),this.clusterer=new zs(t)}getTopologicalGenerations(t,e,r){r&&(r=r.map(T=>this.visGraph.getNode(T)));const i=r??this.clusterer.getConnectedComponent(t,e);if(i.length==0)return[];const o=new Map,a=new Set(i),l=new Map,h=new Map;let u=t??i[0],d=0;for(;a.size>0;){const T=[u].filter(P=>P!==null);for(;T.length>0;){const P=T.shift();if(o.has(P))continue;l.has(P)||l.set(P,new Set),h.has(P)||h.set(P,new Set),o.set(P,d),a.delete(P);const M=P.getSuccessors(e).filter(R=>R!=P);r?T.push(...M.filter(R=>r.includes(R))):T.push(...M);for(const R of M)if(l.has(R)||l.set(R,new Set),h.has(R)||h.set(R,new Set),o.has(R)&&o.get(R)==d)if(l.get(P).has(R))h.get(P).add(R),h.get(R).add(P),l.get(R).delete(P),l.get(P).delete(R);else{let O=!1;const V=new Set(l.get(P)),$=new Set;for(;V.size>0;){const G=V.values().next().value;if(V.delete(G),$.add(G),G==R){O=!0;break}Array.from(l.get(G)).forEach(Z=>{$.has(Z)||V.add(Z)})}O||l.get(R).add(P)}else l.get(R).add(P)}u=a.size>0?a.values().next().value:null,d++}const g=new Map,y=new Set(i),m=new Set;for(this.clusterer.getConnectedComponents(r).forEach(T=>{[].length==0&&T.forEach(M=>{(!l.has(M)||l.get(M).size==0)&&(g.set(M,0),m.add(M),y.delete(M))})});y.size>0;)for(const T of y.keys()){if(g.has(T))continue;const P=l.get(T),M=h.get(T);if(P.size>0){if(!Array.from(P).every(O=>g.has(O)))continue;g.set(T,Math.max(...Array.from(P).map(O=>g.get(O)))+1),y.delete(T)}else if(M.size>0){if(!Array.from(M).every(O=>g.has(O)))continue;g.set(T,Math.max(...Array.from(M).map(O=>g.get(O)))),y.delete(T)}else console.error("This should never happen")}const v=new Map;Array.from(g.entries()).forEach(T=>{const P=T[0],M=T[1];v.has(M)||v.set(M,{nodes:new Array,generation:M}),v.get(M).nodes.push(P)});const _=Array.from(v.values()).sort((T,P)=>T.generation-P.generation),b=new Map;for(let T=_.length-1;T>=0;T--){const P=_[T],M=P.generation;for(const R of P.nodes){b.has(R)||b.set(R,M);const O=l.get(R);if(O)for(const V of O)b.has(V)?b.set(V,Math.min(b.get(V),M-1)):b.set(V,M-1)}}const N=new Map;return Array.from(b.entries()).forEach(T=>{const P=T[0],M=T[1];N.has(M)||N.set(M,{nodes:new Array,generation:M}),N.get(M).nodes.push(P)}),Array.from(N.values()).sort((T,P)=>T.generation-P.generation)}sortingImplementation(t){if(this.startNodeSelectionSorter&&(t=this.startNodeSelectionSorter.getSorting(t)),t.length==0)return[];const e=this.getTopologicalGenerations(t[0],void 0,t),r=this.secondarySorting??new $u(this.visGraph,this.commonSettings);return e.map(o=>r.getSorting(o.nodes)).flat()}}class Hu extends Xe{clusterer;topologicalSorter;optimizedGenerationGaps=!0;constructor(t,e){super(t,e),this.clusterer=new zs(t),this.topologicalSorter=new Wu(t,e)}getCycleFreeParentMap(t,e){const r=new Map;t?t=t.map(d=>this.visGraph.getNode(d)):t=this.visGraph.allLayoutNodes,new Set(t.map(d=>d.id));const i=new Map,o=new Map,a=this.visGraph.getAllConnectionsOfNodes(t,e),h=_n.combineInAndOutLinks(a).sort((d,g)=>Math.abs(d.weight-g.weight)<.01?Math.abs(d.source.score-g.source.score)<.01?Math.abs(d.target.score-g.target.score)<.01?d.id.localeCompare(g.id):g.target.score-d.target.score:g.source.score-d.source.score:g.weight-d.weight);for(;h.length>0;){const d=h.shift(),g=d.source,y=d.target;if(g==y||(r.has(y)||r.set(y,new Map),i.has(y)||i.set(y,new Set),i.has(g)||i.set(g,new Set),o.has(g)||o.set(g,new Set),i.get(g).has(y)))continue;r.get(y).set(g,d.weight),o.get(g).add(y);const w=[y],v=Array.from(i.get(g));for(v.push(g);w.length>0;){const _=w.shift();i.has(_)||i.set(_,new Set),v.forEach(b=>i.get(_).add(b)),o.has(_)&&w.push(...Array.from(o.get(_)))}}const u=new Set(t);return Array.from(r.keys()).forEach(d=>u.delete(d)),u.forEach(d=>{r.has(d)||r.set(d,new Map)}),r}getWeightedTopologicalGenerations(t,e){const r=new Array;t&&(t=t.map(a=>this.visGraph.getNode(a)));const i=this.clusterer.getConnectedComponents(t,e);if(i.length==0)return[];i.forEach(a=>{const l=this.getCycleFreeParentMap(a,e),h=new Map,u=new Set(a),d=new Set;for([].length==0&&a.forEach(b=>{(!l.has(b)||l.get(b).size==0)&&(h.set(b,0),d.add(b),u.delete(b))});u.size>0;)for(const b of u.keys()){if(h.has(b))continue;const N=l.get(b);if(N.size>0){if(!Array.from(N.keys()).every(P=>h.has(P)))continue;const T=Math.max(...Array.from(N.keys()).map(P=>h.get(P)));h.set(b,T+1),u.delete(b)}else console.error("This should never happen")}const y=new Map;Array.from(h.entries()).forEach(b=>{const N=b[0],A=b[1];y.has(A)||y.set(A,{nodes:new Array,generation:A}),y.get(A).nodes.push(N)}),y.forEach(b=>{b.nodes.sort((N,A)=>Math.abs(N.score-A.score)<.01?N.id.localeCompare(A.id):A.score-N.score)});const m=Array.from(y.values()).sort((b,N)=>b.generation-N.generation);if(!this.optimizedGenerationGaps){r.push(...m);return}const w=new Map;for(let b=m.length-1;b>=0;b--){const N=m[b],A=N.generation;for(const T of N.nodes){w.has(T)||w.set(T,A);const P=l.get(T);if(P)for(const M of P.keys())w.has(M)?w.set(M,Math.min(w.get(M),A-1)):w.set(M,A-1)}}const v=new Map;Array.from(w.entries()).forEach(b=>{const N=b[0],A=b[1];v.has(A)||v.set(A,{nodes:new Array,generation:A}),v.get(A).nodes.push(N)});const _=Array.from(v.values());r.push(..._)}),r.sort((a,l)=>a.generation-l.generation);const o=new Array;return r.forEach(a=>{const l=o[o.length-1];l&&l.generation==a.generation?l.nodes.push(...a.nodes):o.push(a)}),o.forEach(a=>{a.nodes.sort((l,h)=>Math.abs(l.score-h.score)<.01?l.id.localeCompare(h.id):h.score-l.score)}),o}sortingImplementation(t){if(t.length==0)return[];const e=this.getWeightedTopologicalGenerations(t),r=this.secondarySorting??new $u(this.visGraph,this.commonSettings);return e.map(o=>r.getSorting(o.nodes)).flat()}}class hI extends Hu{constructor(t,e){super(t,e),this.optimizedGenerationGaps=!1}}class fI extends Xe{clusterer;topological;constructor(t,e){super(t,e),this.clusterer=new zs(t),this.topological=new Hu(t,e)}sortingImplementation(t){if(t.length==0)return[];const e=new Set(t.map(m=>m.id));this.topological.secondarySorting=this.secondarySorting;const r=this.topological.getWeightedTopologicalGenerations(t);console.log("[TOPO GENS]",r);const i=this.topological.getCycleFreeParentMap(t),o=new Map;i.forEach((m,w)=>{m.forEach((v,_)=>{o.has(_)||o.set(_,new Map),o.get(_).set(w,v)})});const a=m=>{if(!o.has(m))return[];const w=o.get(m);return Array.from(w).sort((v,_)=>_[1]-v[1]).map(v=>v[0])},l=m=>{if(!i.has(m))return[];const w=i.get(m);return Array.from(w).sort((v,_)=>_[1]-v[1]).map(v=>v[0])};console.log("TopoGens",r);const h=new Map;r.forEach(m=>{m.nodes.forEach(w=>{h.set(w,m.generation)})});const u=[],d=new Set,g=(m,w=new Set)=>{if(d.has(m))return;const v=l(m).filter(P=>e.has(P.id)),_=a(m).filter(P=>e.has(P.id)),b=h.get(m),N=v.length==0||Array.from(v).every(P=>d.has(P)||_.includes(P)||h.get(P)>b);if(Array.from(v).some(P=>h.get(P)>b)&&console.warn("Parent in later generation",m,v),!N)return;d.has(m)||(u.push(m),d.add(m)),_.map(P=>({node:P,successorCount:a(P).length,successorScore:a(P).reduce((M,R)=>M+R.score,0)})).sort((P,M)=>Math.abs(P.successorScore-M.successorScore)<.01?M.node.id.localeCompare(P.node.id):M.successorScore-P.successorScore).map(P=>P.node).forEach(P=>{g(P,w)})};return this.clusterer.getConnectedComponents(t).sort((m,w)=>m.length-w.length).forEach(m=>{const w=this.topological.getSorting(m),v=u.length;for(;u.length-v<w.length;)w.forEach(_=>{g(_)})}),u}}class dI extends Xe{clusterer;topoligicalSorter;constructor(t,e){super(t,e),this.clusterer=new zs(t),this.topoligicalSorter=new Wu(t,e)}sortingImplementation(t){if(this.startNodeSelectionSorter&&(t=this.startNodeSelectionSorter.getSorting(t)),t.length==0)return[];const e=new Set(t.map(u=>u.id));this.topoligicalSorter.startNodeSelectionSorter=this.startNodeSelectionSorter,this.topoligicalSorter.secondarySorting=this.secondarySorting;const r=this.topoligicalSorter.getTopologicalGenerations(t[0],void 0,t),i=new Map;r.forEach(u=>{u.nodes.forEach(d=>{i.set(d,u.generation)})});const o=[],a=new Set,l=(u,d=new Set)=>{if(a.has(u))return;const g=u.getPredecessors().filter(b=>e.has(b.id)),y=u.getSuccessors().filter(b=>e.has(b.id)),m=i.get(u);if(!(g.length==0||Array.from(g).every(b=>a.has(b)||d.has(b)||y.includes(b)||i.get(b)>m)))return;a.has(u)||(o.push(u),a.add(u)),y.map(b=>({node:b,successorCount:b.getSuccessors().length})).sort((b,N)=>N.successorCount-b.successorCount).map(b=>b.node).forEach(b=>{d.has(b)||(d.add(b),l(b,d))})};return this.clusterer.getConnectedComponents(t).sort((u,d)=>u.length-d.length).forEach(u=>{const d=this.topoligicalSorter.getSorting(u),g=o.length;for(;o.length-g<d.length;)d.forEach(y=>{l(y)})}),o}}class Y0 extends Xe{getScore(t){const e=this.visGraph.getNode(t);if(e===void 0)return 0;const r=e.getSuccessors(),i=e.getPredecessors();return r.length-i.length}sortingImplementation(t){return t.sort((e,r)=>this.getScore(e.id)-this.getScore(r.id)).reverse()}}class gI extends Y0{getScore(t){const e=super.getScore(t);return e/(Math.abs(e)+1)}}const ta=[{key:"byId",label:"By ID",canBeUsedAsSecondarySorting:!0,hasSecondarySorting:!1,sorter:$u},{key:"random",label:"Random",canBeUsedAsSecondarySorting:!0,hasSecondarySorting:!1,sorter:sI},{key:"topological",label:"Topological",hasSecondarySorting:!0,canBeUsedAsSecondarySorting:!1,sorter:Wu},{key:"weightedTopological",label:"Weighted Topological",hasSecondarySorting:!0,hasStartNodeSelection:!1,canBeUsedAsSecondarySorting:!1,sorter:Hu},{key:"weightedTopologicalUnadapted",label:"Weighted Topological Unadapted",hasSecondarySorting:!0,hasStartNodeSelection:!1,canBeUsedAsSecondarySorting:!1,sorter:hI},{key:"flowSorting",label:"Flow Sorting",sorter:dI,hasStartNodeSelection:!0,hasSecondarySorting:!0},{key:"commFlowSorting",label:"Weighted Flow Sorting",sorter:fI,hasStartNodeSelection:!1,hasSecondarySorting:!1},{key:"breadthFirst",label:"Breadth First",hasStartNodeSelection:!0,hasSecondarySorting:!1,sorter:lI},{key:"depthFirst",label:"Depth First",hasStartNodeSelection:!0,hasSecondarySorting:!1,sorter:uI},{key:"nodeScore",label:"Node Score",canBeUsedAsSecondarySorting:!0,hasSecondarySorting:!1,sorter:cI},{key:"sourceScoreWeighted",label:"Source Score Weighted",canBeUsedAsSecondarySorting:!0,hasSecondarySorting:!1,sorter:gI},{key:"sourceScoreDifference",label:"Source Score Difference",canBeUsedAsSecondarySorting:!0,hasSecondarySorting:!1,sorter:Y0},{key:"childrenCount",label:"Children Count",canBeUsedAsSecondarySorting:!0,hasSecondarySorting:!1,sorter:aI},{key:"degree",label:"Degree",canBeUsedAsSecondarySorting:!0,hasSecondarySorting:!1,sorter:oI}],El=new Map(ta.map(n=>[n.key,n]));class Ya extends ie{sorting=new Or({key:"sorting",label:"Primary Sorting",description:"The sorting algorithm to use.",defaultValue:"commFlowSorting",optional:!1,choices:ta.map(t=>t.key)});startNodeSelection=new Or({key:"startNodeSelection",label:"Start Node Selection",description:"The node to start the sorting algorithm from.",defaultValue:"sourceScoreWeighted",optional:!1,choices:ta.filter(t=>t.canBeUsedAsSecondarySorting).map(t=>t.key),enabled:()=>this.sorting.textValue!==void 0&&(El.get(this.sorting.textValue)?.hasStartNodeSelection??!1)});secondLevelSorting=new Or({key:"secondarySorting",label:"Secondary Sorting",description:"Secondary sorting algorithm to use (on data where the primary sorting yields no specific order).",defaultValue:"degree",optional:!1,choices:ta.filter(t=>t.canBeUsedAsSecondarySorting).map(t=>t.key),enabled:()=>this.sorting.textValue!==void 0&&(El.get(this.sorting.textValue)?.hasSecondarySorting??!1)});reversed=new rt({key:"reversed",type:"boolean",defaultValue:!1,optional:!1});constructor(){super({key:"sorting",label:"Sorting",description:"Settings for sorting the nodes.",optional:!1})}instantiateSorter(t,e,r,i=!1){const o=El.get(t).sorter;return new o(e,r,i)}getSorter(t,e){if(this.sorting.textValue===void 0)throw new Error("No sorting method selected.");const r=this.reversed.getValue(),i=this.instantiateSorter(this.sorting.textValue,t,e,r);return this.startNodeSelection.textValue!==void 0&&(i.startNodeSelectionSorter=this.instantiateSorter(this.startNodeSelection.textValue,t,e,r)),this.secondLevelSorting.textValue!==void 0&&(i.secondarySorting=this.instantiateSorter(this.secondLevelSorting.textValue,t,e,r)),i}}class pI extends dr{sorting=new Ya}let mI=class extends ie{nodeDistance=new rt({key:"nodeDistance",label:"Node distance",optional:!1,defaultValue:"40"});verticalOrientation=new rt({key:"verticalOrientation",label:"Is vertical",optional:!1,type:"boolean",defaultValue:"true"});constructor(){super({key:"size",label:"Size and Orientation",description:"Size and orientation settings for the radial layout.",optional:!1})}};class yI extends dr{size=new mI;sorting=new Ya;constructor(t,e){super(t,e)}}class wI extends $i{simulation;initVisGraph(){return this.resetVisGraph(),new Promise(t=>{t()})}async layout(t=!1){const e=this.settings.getContext({visGraph:this.visGraph}),r=50;this.visGraph.setPrecalculator(new Vs({sizeMultiplier:r,marginFactor:1.1,adaptRadiusBasedOnScore:this.commonSettings.showNodeScore.getValue()??!0})),this.visGraph.layout(),this.simulation&&this.simulation.stop();const i=xN(this.visGraph.allLeafLayoutNodes).alpha(1);if(i.stop(),this.simulation=i,i.on("tick",()=>{this.visGraph.layout(),this.emitEvent("update")}),i.on("end",()=>{this.visGraph.layout(),this.emitEvent("end")}),this.settings.forceManyBody.active&&i.force("charge",SN().strength(o=>this.settings.forceManyBody.strength.getValue(o,e)??-20)),this.settings.forceLink.active){const o=gN(this.visGraph.allLayoutConnections);this.settings.forceLink.strength.active&&o.strength(a=>this.settings.forceLink.strength.getValue(a,e)??1),this.settings.forceLink.distance.active&&o.distance(a=>this.settings.forceLink.distance.getValue(a,e)??30),i.force("link",o)}this.settings.forceCenter.active&&(i.force("x",CN().strength(this.settings.forceCenter.strength.getValue(e)??1)),i.force("y",PN().strength(this.settings.forceCenter.strength.getValue(e)??1))),this.settings.forceCollide.active&&(console.log("Adding force collide",this.settings.forceCollide.radius.getValue(),this.settings.forceCollide.strength.getValue()),i.force("collide",fN(o=>this.settings.forceCollide.radius.getValue(o,e)??5).strength(Math.min(1,Math.max(0,this.settings.forceCollide.strength.getValue(e)??.5))))),i.alpha(t?.5:1).alphaMin(.01).restart()}}class vI extends ie{strength=new ia({key:"strength",optional:!1,defaultValue:-100});constructor(){super({key:"forceManyBody",label:"Force Many Body",description:"Many-body forces between nodes.",optional:!0,active:!0})}}class bI extends ie{strength=new rt({key:"strength",optional:!1,active:!0,defaultValue:.1});constructor(){super({key:"forceCenter",label:"Force Center",description:"Attracts nodes to the center.",optional:!0,active:!0})}}class _I extends ie{distance=new As({key:"distance",optional:!0,active:!0,defaultValue:30});strength=new As({key:"strength",optional:!0,active:!0,defaultValue:"Math.max(0.1, Math.min(1, w))"});constructor(){super({key:"forceLink",label:"Force Link",description:"Links nodes together.",optional:!0,active:!0})}}class xI extends ie{radius=new ia({key:"radius",optional:!0,active:!0,defaultValue:"r"});strength=new rt({key:"strength",optional:!0,active:!0,defaultValue:1});constructor(){super({key:"forceCollide",label:"Force Collide",description:"Prevents nodes from overlapping.",optional:!0,active:!0})}}class SI extends dr{forceManyBody=new vI;forceCenter=new bI;forceLink=new _I;forceCollide=new xI;constructor(t,e){super(t,e)}}class Ka extends Gs{layoutSelfLinks=!1;combineBidirectionalLinks=!1;forwardBackwardThreshold=270;straightForwardLineAtDegreeDelta=135;backwardLineCurvature=120;constructor({forwardBackwardThreshold:t=270,straightForwardLineAtDegreeDelta:e=135,backwardLineCurvature:r=120}={}){super(),this.forwardBackwardThreshold=t,this.straightForwardLineAtDegreeDelta=e,this.backwardLineCurvature=r}layoutConnectionsOfNode(t){t.outConnections.forEach(e=>{const r=e.source,i=e.target,o=r.parent??i.parent;if(!o)throw new Error("Parent node of connection is not set");if(r==i)return;const a=F.radOfPoint(r,o),l=F.radOfPoint(i,o),h=nn(a),d=nn(l)-h,y=(d<0?d+360:d)<=this.forwardBackwardThreshold;try{y?e.pathSegment=this.getForwardLink(r,i,o):e.pathSegment=this.getBackwardLink(r,i,o)}catch(m){console.error("Error in layouting connection",m)}})}static getCircularArcBetweenCircles(t,e,r,i,o="clockwise"){const a=F.radOfPoint(e.center,i.center),l=F.radOfPoint(r.center,i.center),h=nn(a),d=nn(l)-h,g=d<0?d+360:d,y=ar(g),m=360-g,w=ar(m),v=i,_=i.r,b=i.center,N=o=="clockwise"?F.positionOnCircleAtRad(a+y/2,_,b):F.positionOnCircleAtRad(a-w/2,_,b),A=v.intersect(e),T=v.intersect(r);if(A.length==0||T.length==0)throw console.error("No intersections found between circles",e,r,i),new Error("No intersections found between circles");const P=A[0].distanceTo(N)[0],M=A[1].distanceTo(N)[0],R=T[0].distanceTo(N)[0],O=T[1].distanceTo(N)[0],V=P<M?A[0]:A[1],$=R<O?T[0]:T[1],G=o=="clockwise"?new W(b,V).normalize().rotate90CW():new W(b,V).normalize().rotate90CCW(),Z=o=="clockwise"?new W(b,$).normalize().rotate90CW():new W(b,$).normalize().rotate90CCW(),tt=new st(V,G),dt=new st($,Z);return new An(t).radius(_).startPoint(tt.anchorPoint).endPoint(dt.anchorPoint).largeArc(0).direction(o)}getDirectCircularLink(t,e,r){const i=t.getConnectionTo(e);return Ka.getCircularArcBetweenCircles(i,t.outerCircle,e.outerCircle,r.innerCircle)}getForwardLink(t,e,r){const i=r.innerCircle.r,o=r.innerCircle.center,a=t.index,l=e.index,h=t.getConnectionTo(e),u=F.radOfPoint(t.center,o),d=F.radOfPoint(e.center,o),g=nn(u),m=nn(d)-g,w=m<0?m+360:m,v=ar(w);r.innerCircle;const _=t.center,b=e.center,N=new U(_,b).middle(),A=F.positionOnCircleAtRad(u+v/2,i,o);if(l-a==1||a-l==(r?.children.length??0)-1)return this.getDirectCircularLink(t,e,r);const P=ar(this.straightForwardLineAtDegreeDelta);if(Math.abs(w-this.straightForwardLineAtDegreeDelta)<1){const De=t.getAnchor(e.center),me=e.getAnchor(t.center);return De.anchorPoint=De.getPointInDirection(t.outerRadius-t.radius),me.anchorPoint=me.getPointInDirection(e.outerRadius-e.radius),new zu(h,De.anchorPoint,me.anchorPoint)}const M=F.positionOnCircleAtRad(u+P,i,o),R=new W(_,M),O=R.rotate90CW();new et(_,O);const V=new et(_,R),$=new et(N,A),G=V.intersect($)[0],Z=new W(G,_).length,tt=new Q(G,Z),dt=tt.intersect(t.outerCircle),wt=tt.intersect(e.outerCircle),Nt=dt[0].distanceTo(A)[0],Lt=dt[1].distanceTo(A)[0],It=wt[0].distanceTo(A)[0],Ct=wt[1].distanceTo(A)[0],K=Nt<Lt?dt[0]:dt[1],X=It<Ct?wt[0]:wt[1];let ot,ht;w>this.straightForwardLineAtDegreeDelta?(ot=new W(G,K).normalize().rotate90CW(),ht=new W(G,X).normalize().rotate90CCW()):(ot=new W(G,K).normalize().rotate90CCW(),ht=new W(G,X).normalize().rotate90CW());const Ft=new st(K,ot),ft=new st(X,ht),Wt=w>this.straightForwardLineAtDegreeDelta?"clockwise":"counter-clockwise";return new An(h).radius(Z).startPoint(Ft.anchorPoint).endPoint(ft.anchorPoint).largeArc(0).direction(Wt)}getBackwardLink(t,e,r){const i=t.getConnectionTo(e),o=r.innerRadius,a=r.innerCircle.center,l=F.radOfPoint(t,a),h=F.radOfPoint(e,a),u=nn(l),g=nn(h)-u,m=360-(g<0?g+360:g),w=ar(m),v=t.center,_=e.center,b=new U(v,_).middle(),N=F.positionOnCircleAtRad(l-w/2,o,a),A=ar(this.backwardLineCurvature),T=F.positionOnCircleAtRad(h+A,o,a),P=A==0?new et(_,new W(_,a).rotate90CW()):new et(_,T),M=F.positionOnCircleAtRad(l-A,o,a),R=A==0?new et(v,new W(v,a).rotate90CCW()):new et(v,M),V=P.intersect(R).length==0?b:P.intersect(R)[0],$=new W(V,_).length,G=new Q(V,$),Z=G.intersect(t.outerCircle),tt=G.intersect(e.outerCircle),dt=Z[0].distanceTo(N)[0],wt=Z[1].distanceTo(N)[0],Nt=tt[0].distanceTo(N)[0],Lt=tt[1].distanceTo(N)[0],It=dt<wt?Z[0]:Z[1],Ct=Nt<Lt?tt[0]:tt[1],K=new W(V,It).normalize().rotate90CCW(),X=new W(V,Ct).normalize().rotate90CW(),ot=new st(It,K),ht=new st(Ct,X),Ft="counter-clockwise",ft=m>this.backwardLineCurvature?1:0;return new An(i).radius($).startPoint(ot.anchorPoint).endPoint(ht.anchorPoint).largeArc(ft).direction(Ft)}}class K0 extends Ua{nodeMarginFactor=1;radiusMarginFactor=1.1;hyperNodeMarginFactor=.4;hyperRadiusMarginFactor=1.1;adaptEnclosingCircle=!0;center=new D(0,0);rotateBasedOnConnections=!1;gapBetweenStartAndEnd=0;constructor({nodeMarginFactor:t=1,radiusMarginFactor:e=1.1,adaptEnclosingCircle:r=!0,rotateBasedOnConnections:i=!1,hyperNodeMarginFactor:o=.4,hyperRadiusMarginFactor:a=1.1}={}){super(),this.nodeMarginFactor=t,this.radiusMarginFactor=e,this.adaptEnclosingCircle=r,this.rotateBasedOnConnections=i,this.hyperNodeMarginFactor=o,this.hyperRadiusMarginFactor=a,console.log("Created RadialPositionerDynamicDistribution",this.adaptEnclosingCircle)}getPositionOnCircleAtAngleRad(t,e,r){return F.positionOnCircleAtRad(t,e,r??this.center)}async positionChildren(t){const e=t.children;if(e.length==0)return;const r=new Map,i=g=>g.isHyperNode?this.hyperNodeMarginFactor:this.nodeMarginFactor,o=this.radiusMarginFactor;let a=0;e.forEach((g,y)=>{const m=i(g),w=g.outerRadius;a+=w*m,a+=w,r.set(g,a),a+=w,a+=w*m});let l=a/(2*Math.PI);const h=a;r.forEach((g,y)=>{r.set(y,r.get(y)/h)});const d=ar(-90);if(e.length==1){const g=e[0].radius;e[0].x=this.center.x,e[0].y=this.center.y;const y=i(e[0]);l=g,t.radius=l*y,t.innerRadius=l}else if(e.length==2){const g=e[0].radius,y=e[1].radius,m=Math.max(i(e[0]),i(e[1])),w=g+y,v=w*m,_=w+v,b=w+v/2;e[0].x=this.center.x-w/2-v/2,e[0].y=this.center.y,e[1].x=this.center.x+w/2+v/2,e[1].y=this.center.y,t.innerRadius=_/2,t.radius=b*o}else{const g=new Map;e.forEach((m,w)=>{const v=r.get(m),_=d+v*2*Math.PI;g.set(m,_);const b=this.getPositionOnCircleAtAngleRad(_,l);m.x=b.x,m.y=b.y;const N=m.anchorNode;if(N){const A=new D(0,0),T=new W(N.center,A).slope;m.rotateChildrenLocally(_-T)}});const y=Math.max(...e.map(m=>m.radius));t.radius=(l+y)*o,t.innerRadius=l}if(this.adaptEnclosingCircle){const g=e.map(w=>{try{const v=t.center,_=new W(v,w.center).normalize();return w.center.translate(_.scale(w.outerRadius))}catch{return w.center}}),y=F.getMinimumEnclosingCircle(g);t.radius=y.r*o,t.innerEnclosingRadius=y.r;const m=new W(t.center,y.center);t.innerCenterTranslation=m,t.children.forEach(w=>{w.center=w.center.translate(m.scale(-1))})}}computeNetOutsideConnectionRotation(t){let e=new W(0,0);const r=t.descendants,i=new Set(r),o=r.flatMap(a=>a.outConnections.concat(a.inConnections)).filter(a=>!i.has(a.source)||!i.has(a.target));for(const a of o){const l=i.has(a.source)?"out":"in";let h=l=="out"?a.source:a.target,u=l=="out"?a.target:a.source;const d=a.getConnectionPathViaHyperAndVirtualNodes();l=="out"?(d[1]&&d[1].isVirtual&&(h=d[1]),d[d.length-2]&&d[d.length-2].isVirtual&&(u=d[d.length-2])):(d[d.length-2]&&d[d.length-2].isVirtual&&(h=d[d.length-2]),d[1]&&d[1].isVirtual&&(u=d[1])),new W(h.center,u.center);const g=new W(t.center,h.center),m=new W(t.center,u.center).slope-g.slope;e=e.add(new W(m).normalize().multiply(a.weight))}return e.slope}refinePositions(t){if(!this.rotateBasedOnConnections||t.children.some(i=>i.anchorNode))return;const e=t.center,r=this.computeNetOutsideConnectionRotation(t);t.rotateChildrenLocally(r,e)}}class CI extends $i{getRadius(){return this.settings.size.radius.getValue(this.settings.getContext({visGraph:this.visGraph}))??5}getPositionForRad(t,e,r){const i=e??this.getRadius(),o=r??this.center,a=o.x+i*Math.cos(t),l=o.y+i*Math.sin(t);return new D(a,l)}async layout(t=!1){this.visGraph.setPrecalculator(new Vs({sizeMultiplier:50,adaptRadiusBasedOnScore:this.commonSettings.showNodeScore.getValue()??!0}));const e=this.settings.getContext({visGraph:this.visGraph});this.visGraph.setPositioner(new K0({nodeMarginFactor:this.settings.spacing.nodeMarginFactor.getValue(e)??1,radiusMarginFactor:this.settings.spacing.radiusMarginFactor.getValue(e)??1.1,hyperNodeMarginFactor:this.settings.spacing.hyperNodeMarginFactor.getValue(e)??.4,hyperRadiusMarginFactor:this.settings.spacing.hyperRadiusMarginFactor.getValue(e)??1.1,adaptEnclosingCircle:this.settings.spacing.adaptEnclosingCircle.getValue(e)??!0,rotateBasedOnConnections:this.settings.spacing.rotateBasedOnConnections.getValue(e)??!1}));const r=this.settings.sorting.getSorter(this.visGraph,this.commonSettings);this.visGraph.setSorter(r);const i=this.settings.edges.forwardBackwardThreshold.getValue(this.settings.getContext({visGraph:this.visGraph}))??270,o=this.settings.edges.straightForwardLineAtDegreeDelta.getValue(this.settings.getContext({visGraph:this.visGraph}))??135,a=this.settings.edges.backwardLineCurvature.getValue(this.settings.getContext({visGraph:this.visGraph}))??120;this.visGraph.setConnectionLayouter(new Ka({forwardBackwardThreshold:i,straightForwardLineAtDegreeDelta:o,backwardLineCurvature:a})),await this.visGraph.layout(),this.markConnectionsAsUpdateRequired(),this.emitEvent("end")}}class X0 extends ie{nodeMarginFactor=new rt({key:"nodeMarginFactor",label:"Margin factor between nodes",description:"The factor to multiply the node radius with to get the margin between the nodes inside a circle.",optional:!1,defaultValue:.7,type:"number"});hyperNodeMarginFactor=new rt({key:"hyperNodeMarginFactor",label:"Margin factor between hypernodes",description:"The factor to multiply the node radius with to get the margin between nodes when placing hypernodes.",optional:!1,defaultValue:.4,type:"number"});radiusMarginFactor=new rt({key:"radiusMarginFactor",label:"Margin fac. for outer r of hypernodes",optional:!1,defaultValue:1.2,type:"number"});hyperRadiusMarginFactor=new rt({key:"hyperRadiusMarginFactor",label:"Margin fac. for outer r of hypernodes",description:"The margin factor for the radius of nodes within nested hypernodes.",optional:!1,defaultValue:1.1,type:"number",enabled:!1});adaptEnclosingCircle=new rt({key:"adaptEnclosingCircle",label:"Adapt Enclosing Circle",description:"Adapt the enclosing circle to the size of the nodes.",optional:!1,defaultValue:!0,type:"boolean"});rotateBasedOnConnections=new rt({key:"rotateBasedOnConnections",label:"Rotate children based on connections",description:"Rotate the nodes based on their connections.",optional:!1,defaultValue:!0,type:"boolean"})}class PI extends ie{forwardBackwardThreshold=new rt({key:"forwardBackwardThreshold",label:"Forw.-Back. Edge ° Thresh.",description:"The threshold angle in the radial layout for edges to be handled as backward edges (in degree).",optional:!1,defaultValue:270});straightForwardLineAtDegreeDelta=new rt({key:"straightForwardLineAtDegreeDelta",label:"Straight Line @ Delta°",description:"The threshold angle in the radial layout for forward edges to be drawn as straight lines (in degree). Lines above this threshold will be drawn as concave curves, lines below this threshold will be drawn as convex curves.",optional:!1,defaultValue:135});backwardLineCurvature=new rt({key:"backwardLineCurvature",label:"Backward Line Curvature°",description:"The curvature of the backward edges (between 0° and 180°).",optional:!1,defaultValue:120})}class AI extends dr{spacing=new X0({key:"spacing",label:"Spacing",description:"Spacing settings for the radial layout.",optional:!1});sorting=new Ya;edges=new PI({key:"edges",label:"Edges",description:"Settings for the edges.",optional:!1});constructor(t,e){super(t,e)}}class NI extends ie{calculateMetrics=new rt({type:"boolean",key:"calculateMetrics",label:"Calculate Metrics",description:"Calculate metrics during layout",optional:!1,defaultValue:!1});notifyWhenFinished=new rt({type:"boolean",key:"notifyWhenFinished",label:"Notify When Metrics Finished",description:"Show a notification when metrics calculation is complete",optional:!1,defaultValue:!1});tileSize=new rt({type:"number",key:"tileSize",label:"Visualization Tile Size",description:"The size of the tiles",optional:!1,defaultValue:200});nodeScoreColorScheme=new Or({choices:["warm","cool","blue","green","orange","red","purple","orange-red","yellow-green-blue","yellow-green","yellow-orange-red","turbo","viridis","inferno","magma","plasma","cividis","red-yellow-green"],key:"nodeScoreColorScheme",label:"Node Score Color Scheme",description:"The color scheme for node scores",optional:!1,defaultValue:"yellow-green-blue"});hideLinksThreshold=new rt({type:"number",key:"hideLinksThreshold",label:"Threshold to Hide Links",description:"Hide links with a weight below this threshold. A commonly good value is something below 0.25.",optional:!1,defaultValue:.2});linkColor=new As({type:"color",key:"linkColor",label:"Link Color",description:"The color of the links",optional:!1,defaultValue:"#2b303dab"});enableLinkOpacity=new rt({type:"boolean",key:"enableLinkOpacity",label:"Enable Link Opacity",description:"Enable link opacity based on link score",optional:!1,defaultValue:!0});linkWidthMultiplier=new rt({type:"number",key:"linkWidthMultiplier",label:"Link Width Multiplier",description:"The multiplier for the link width",optional:!1,defaultValue:2});showLinkScore=new rt({type:"boolean",key:"showLinkScore",label:"Display Link Score",description:"Adapt link width based on link score",optional:!1,defaultValue:!0});arrowSize=new rt({type:"number",key:"arrowSize",label:"Arrow Size",description:"The size of the arrows",optional:!1,defaultValue:5});combinePathAndArrow=new rt({type:"boolean",key:"combinePathAndArrow",label:"Combine Path And Arrow",description:"Combine path and arrow (for better PDF export, but metrics could be wrong)",optional:!1,defaultValue:!1});displayNodeLabels=new rt({type:"boolean",key:"displayNodeLabels",label:"Show Node Labels",description:"Display the names of the nodes as labels",optional:!1,defaultValue:!0});labelSizeMultiplier=new rt({type:"number",key:"labelSizeMultiplier",label:"Label Size Multiplier",description:"The multiplier for the label size",optional:!1,defaultValue:1});showNodeScore=new rt({type:"boolean",key:"showNodeScore",label:"Display Node Score",description:"Display node score as node radius",optional:!1,defaultValue:!0});showCommunityColors=new rt({type:"boolean",key:"showCommunityColors",label:"Community Colors for Nodes",description:"Nodes are colored by community",optional:!1,defaultValue:!0});showHyperNodeEdges=new rt({type:"boolean",key:"showHyperNodeEdges",label:"Display Hyper Node Outlines",description:"Show hyper node outlines",optional:!1,defaultValue:!0})}function TI(n){return n*(Math.PI/180)}const Ta=class Ta{variables;constants;axiom;rules;moveRules;constructor({variables:t,constants:e,axiom:r,rules:i,moveRules:o}){this.variables=t,this.constants=e,this.axiom=r,this.rules=i,this.moveRules=o}generateString(t){let e=this.axiom;for(let r=0;r<t;r++){let i="";for(const o of e)this.variables.includes(o)?i+=this.rules[o]:this.constants.includes(o)&&(i+=o);e=i}return e}getOrderForMinPoints(t){const e=i=>{const o=new J0(this);return o.move(i),o.points.length>0};let r=0;for(let i=0;i<Ta.MAX_ORDER;i++)if(this.generateString(i).split("").filter(e).length>=t){r=i;break}return r}static get(t){switch(t=t.toLowerCase(),t){case"hilbert":return EI;case"sierpinski curve":return LI;case"gosper":return RI;case"moore":return MI;case"peano":return II;case"sierpinski arrowhead":return kI;default:throw new Error(`Unknown curve type ${t}`)}}};Ot(Ta,"MAX_ORDER",7);let Yn=Ta;class J0{constructor(t,e=new D(0,0),r=new W(1,0)){this.lSystem=t,this.currentPosition=e,this.currentDirection=r}currentPosition;currentDirection;points=[];addCurrentPositionToPoints(){this.points.push(this.currentPosition)}execute(t){this.points=[this.currentPosition];const e=this.lSystem.generateString(t);for(const r of e)this.move(r)}move(t){this.lSystem.moveRules[t]&&this.lSystem.moveRules[t](this)}goForward(t){this.currentPosition=this.currentPosition.translate(this.currentDirection.multiply(t)),this.addCurrentPositionToPoints()}turnDegrees(t){this.currentDirection=this.currentDirection.rotate(-TI(t))}}class Q0{order;lSystem;lState;points=[];xExtent=[0,0];yExtent=[0,0];constructor(t,e){this.order=e,this.lSystem=t,this.lState=new J0(t),this.lState.execute(e),this.points=this.lState.points,this.xExtent=Br(this.points,r=>r.x),this.yExtent=Br(this.points,r=>r.y)}get totalPointCount(){return this.points.length}getPointAtUnitInterval(t,e=i=>i,r=i=>i){if(t<0||t>1)throw new Error("t must be in [0, 1]");const i=this.totalPointCount,o=Math.floor(t*i),a=Math.ceil(t*i),l=t*i-o,h=this.getPointAtIndex(o),u=this.getPointAtIndex(a),d=e(h.x+l*(u.x-h.x)),g=r(h.y+l*(u.y-h.y));return new D(d,g)}getPointAtIndex(t,e=!0){if(e&&(t=Math.max(0,Math.min(this.points.length-1,t))),t<0||t>=this.points.length)throw new Error(`Index out of bounds: ${t} / ${this.points.length}`);return this.points[t]}}Ot(Q0,"MAX_ORDER",7);const EI=new Yn({variables:["X","Y"],constants:["F","+","-"],axiom:"X",rules:{X:"+YF-XFX-FY+",Y:"-XF+YFY+FX-"},moveRules:{F:n=>n.goForward(1),"+":n=>n.turnDegrees(90),"-":n=>n.turnDegrees(-90)}}),II=new Yn({variables:["X","Y"],constants:["F","+","-"],axiom:"X",rules:{X:"XFYFX-F-YFXFY+F+XFYFX",Y:"YFXFY+F+XFYFX-F-YFXFY"},moveRules:{F:n=>n.goForward(1),"+":n=>n.turnDegrees(90),"-":n=>n.turnDegrees(-90)}}),MI=new Yn({variables:["L","R"],constants:["F","+","-"],axiom:"LFL+F+LFL",rules:{L:"-RF+LFL+FR-",R:"+LF-RFR-FL+"},moveRules:{F:n=>n.goForward(1),"+":n=>n.turnDegrees(90),"-":n=>n.turnDegrees(-90)}}),RI=new Yn({variables:["G","F"],constants:["+","-"],axiom:"F",rules:{F:"F-G--G+F++FF+G-",G:"+F-GG--G-F++F+G"},moveRules:{F:n=>n.goForward(1),G:n=>n.goForward(1),"+":n=>n.turnDegrees(60),"-":n=>n.turnDegrees(-60)}}),LI=new Yn({variables:["X"],constants:["F","+","-"],axiom:"F--XF--F--XF",rules:{X:"XF+F+XF--F--XF+F+X"},moveRules:{F:n=>n.goForward(1),"+":n=>n.turnDegrees(45),"-":n=>n.turnDegrees(-45)}}),kI=new Yn({variables:["F","G"],constants:["+","-"],axiom:"F",rules:{F:"G-F-G",G:"F+G+F"},moveRules:{F:n=>n.goForward(1),"+":n=>n.turnDegrees(60),"-":n=>n.turnDegrees(-60)}});class OI extends Ua{order;curveType;size;constructor(t,e,r){super(),this.order=t,this.curveType=e,this.size=r}async positionChildren(t){const e=t.children,r=new Map;e.forEach((a,l)=>{r.set(a,l/e.length)});const i=Yn.get(this.curveType),o=new Q0(i,this.order);e.forEach(a=>{const l=r.get(a),h=o.getPointAtUnitInterval(l,u=>u*10*this.size,u=>u*10*this.size);a.x=h.x,a.y=h.y})}}class FI extends $i{async layout(t=!1){const e=this.settings.getContext({visGraph:this.visGraph}),r=this.settings.sorting.getSorter(this.visGraph,this.commonSettings);this.visGraph.setSorter(r);const i=this.settings.curve.order.getValue(e)??2,o=this.settings.curve.curveType.getValue()??"Hilbert",a=this.settings.size.size.getValue()??20;this.visGraph.setPositioner(new OI(i,o,a)),await this.visGraph.layout(),this.emitEvent("end")}}class DI extends ie{size=new rt({key:"size",optional:!1,defaultValue:"20"});constructor(){super({key:"size",label:"Size",description:"Size settings for the layout.",optional:!1})}}class BI extends ie{order=new rt({key:"order",optional:!1,defaultValue:"2"});curveType=new Or({key:"curveType",optional:!1,defaultValue:"Hilbert",choices:["Hilbert","Moore","Peano","Gosper","Sierpinski Arrowhead","Sierpinski Curve"]});constructor(){super({key:"curve",label:"Curve",description:"Curve settings for the layout.",optional:!1})}}class VI extends pI{size=new DI;curve=new BI}class ru extends Xn{startAnchor;endAnchor;_control1;_control2;get control1(){return this._control1}set control1(t){this._control1=t,this.startAnchor.direction=new W(this.start,t)}get control2(){return this._control2}set control2(t){this._control2=t,this.endAnchor.direction=new W(t,this.end)}constructor(t,e,r,i,o){super(t),this.startAnchor=new st(e,r),this.endAnchor=new st(o,new W(i,o)),this._control1=r,this._control2=i}getSvgPath(){return`M ${this.start.x} ${this.start.y} C ${this.control1.x} ${this.control1.y}, ${this.control2.x} ${this.control2.y}, ${this.end.x} ${this.end.y}`}}class _s extends Xn{startAnchor;endAnchor;controlPointDistanceFactor=.4;extendArrow;extendStart;constructor(t,e,r,i=.4,o=!0,a=!1){super(t),this.connection=t,this.startAnchor=e,this.endAnchor=r,this.controlPointDistanceFactor=i,this.extendArrow=o,this.extendStart=a}get arrowLength(){return this.connection.arrowLength}get arrowStartPoint(){return this.endAnchor?.getPointInDirection(-this.arrowLength)??new D(0,0)}get extendedStartPoint(){return this.startAnchor?.getPointInDirection(this.arrowLength)??new D(0,0)}getSvgPath(){const t=this.startAnchor,e=this.endAnchor;if(!t||!e)return"";const r=this.extendStart?this.extendedStartPoint:t.anchorPoint,i=new st(r,t.direction),o=this.extendArrow?this.arrowStartPoint:e.anchorPoint,a=new st(o,e.direction),h=i.anchorPoint.distanceTo(o)[0]*this.controlPointDistanceFactor,u=i.getPointInDirection(h),d=e.getPointInDirection(-Math.max(this.extendArrow?this.arrowLength:0,h)),g=new ru(this.connection,i.anchorPoint,u,d,a.anchorPoint);let y="";return this.extendStart&&(y=`M ${t.anchorPoint.x} ${t.anchorPoint.y} L ${r.x} ${r.y}`),this.extendArrow?y+=g.getSvgPath()+` L ${e.anchorPoint.x} ${e.anchorPoint.y}`:y+=g.getSvgPath(),y}}class Ug extends Xn{startAnchor;endAnchor;segmentCircle;constructor(t,e,r,i){super(t),this.startAnchor=e,this.endAnchor=r,this.segmentCircle=i}getConnectingPathSegments(t,e,r){const i=t.direction;e.direction;const o=F.radOfPoint(t.connectingAnchor.anchorPoint,r.center),a=F.radOfPoint(e.connectingAnchor.anchorPoint,r.center),l=F.normalizeRad(a-o),h=t.connectingAnchor.getDirectionRegardingCircle(r),u=t.circle.clone(),d=e.circle.clone();if(u._data={stroke:"green"},d._data={stroke:"red"},l>0&&h=="clockwise"||l<0&&h=="counter-clockwise"){const g=F.getArcFromConnectingCircle(t,this.connection),y=F.getArcFromConnectingCircle(e,this.connection,!0),m=t.connectingAnchor.getDirectionRegardingCircle(r),w=new An(this.connection,t.connectingAnchor.anchorPoint,e.connectingAnchor.anchorPoint,r.r,r.r).direction(m),v=F.radOfPoint(t.connectingAnchor.anchorPoint,r.center),_=F.radOfPoint(e.connectingAnchor.anchorPoint,r.center),b=F.normalizeRad(_-v);return{segments:[g,w,y],length:Math.abs(b)}}else{const y=F.getInnerTangentsBetweenCircles(t.circle,e.circle).find(N=>new st(N.start,N.end).getDirectionRegardingCircle(t.circle)==i);if(!y)return console.error("No tangent found",this.connection.id,this),{segments:[],length:Number.MAX_VALUE};t.connectingAnchor.anchorPoint=y.start,e.connectingAnchor.anchorPoint=y.end;const m=F.getArcFromConnectingCircle(t,this.connection),w=F.getArcFromConnectingCircle(e,this.connection,!0),v=F.radOfPoint(t.connectingAnchor.anchorPoint,r.center),_=F.radOfPoint(e.connectingAnchor.anchorPoint,r.center),b=F.normalizeRad(_-v);return{segments:[m,new zu(this.connection,y.start,y.end),w],length:Math.abs(b)}}}getSvgPath(){const t=F.getConnectingCirclesForAnchorAndCircle(this.startAnchor,this.segmentCircle,this.connection),e=F.getConnectingCirclesForAnchorAndCircle(this.endAnchor,this.segmentCircle,this.connection),r=this.startAnchor.clone(),i=this.endAnchor.clone();r._data={stroke:"green"},i._data={stroke:"red"};const o=[];t.forEach(h=>{e.forEach(u=>{h.direction!=u.direction&&o.push([h,u])})});let a=Number.MAX_VALUE,l=[];return o.forEach(([h,u])=>{const d=this.getConnectingPathSegments(h,u,this.segmentCircle);d.length<a&&(a=d.length,l=d.segments)}),l.map(h=>h.getSvgPath()).join(" ")}}class Yg extends Xn{startAnchor;endAnchor;nodeCircle;controlPointDistanceFactor=.4;extendArrow;extendStart;constructor(t,e,r,i,o=.4,a=!0,l=!1){super(t),this.connection=t,this.startAnchor=e,this.endAnchor=r,this.controlPointDistanceFactor=o,this.extendArrow=a,this.extendStart=l,this.nodeCircle=i}get arrowLength(){return this.connection.arrowLength}get arrowStartPoint(){return this.endAnchor?.getPointInDirection(-this.arrowLength)??new D(0,0)}get extendedStartPoint(){return this.startAnchor?.getPointInDirection(this.arrowLength)??new D(0,0)}getArrowStartPoint(t){return this.endAnchor?.getPointInDirection(-Math.min(t,this.arrowLength))??new D(0,0)}getExtendedStartPoint(t){return this.startAnchor?.getPointInDirection(Math.min(t,this.arrowLength))??new D(0,0)}getSvgPath(){const t=this.startAnchor,e=this.endAnchor;if(!t||!e)return"";const r=yn.getClosestShapeToPoint([t,e],this.nodeCircle.center,K=>K.anchorPoint),i=r===t?e:t,o=i==t?"pathToNode":"nodeToPath",a=i.anchorPoint,l=r.anchorPoint,h=this.nodeCircle.center,u=this.nodeCircle.r,d=a.distanceTo(h)[0],g=d-u,y=this.controlPointDistanceFactor,m=g*y,w=i.getPointInDirection(o=="pathToNode"?m:-m),v=new U(a,h),_=new et(h,v.vector),b=new Q(h,d),[N,A]=_.intersect(b),T=yn.getClosestShapeToPoint([N,A],l,K=>K);new U(w,N),new U(w,A);const P=new U(w,T),R=new et(l,r.direction.rotate90CW()).intersect(P);if(R.length===0)return new _s(this.connection,this.startAnchor,this.endAnchor,this.controlPointDistanceFactor,this.extendArrow,this.extendStart).getSvgPath();const O=R[0],V=t==i?w:O,$=e==i?w:O,G=V.distanceTo(t.anchorPoint)[0],Z=$.distanceTo(e.anchorPoint)[0],tt=this.extendStart?this.getExtendedStartPoint(G/3):t.anchorPoint,dt=new st(tt,t.direction),wt=this.extendArrow?this.getArrowStartPoint(Z/2):e.anchorPoint,Nt=new st(wt,e.direction);let Lt=!1;if(Lt=!1,Lt){const K=new U(N,A);this.connection.debugShapes.push(K),this.connection.debugShapes.push(P),this.connection.debugShapes.push(v),this.connection.debugShapes.push(b),this.connection.debugShapes.push(r),this.connection.debugShapes.push(i),this.connection.debugShapes.push(V),this.connection.debugShapes.push($),this.connection.debugShapes.push(dt),this.connection.debugShapes.push(Nt)}const It=new ru(this.connection,dt.anchorPoint,V,$,Nt.anchorPoint);let Ct="";return this.extendStart&&(Ct=`M ${t.anchorPoint.x} ${t.anchorPoint.y} L ${tt.x} ${tt.y}`),this.extendArrow?Ct+=It.getSvgPath()+` L ${e.anchorPoint.x} ${e.anchorPoint.y}`:Ct+=It.getSvgPath(),Ct}getSvgPathOld(){const t=this.startAnchor,e=this.endAnchor;if(!t||!e)return"";const r=yn.getClosestShapeToPoint([t,e],this.nodeCircle.center,wt=>wt.anchorPoint),i=r===t?e:t,o=i==t?"pathToNode":"nodeToPath",a=i.anchorPoint.distanceTo(this.nodeCircle.center)[0],h=(a-this.nodeCircle.r)*this.controlPointDistanceFactor;h+this.nodeCircle.r;const u=i.getPointInDirection(o=="pathToNode"?h:-h),d=new U(this.nodeCircle.center,i.anchorPoint),g=new et(this.nodeCircle.center,d.vector),y=new Q(this.nodeCircle.center,a),[m,w]=g.intersect(y),v=yn.getClosestShapeToPoint([m,w],r.anchorPoint,wt=>wt),_=new et(u,v);new U(u,v);const b=new et(r.anchorPoint,r.direction.rotate90CW()),N=_.intersect(b);let A=!1;N.length===0&&(A=!0);const T=N[0];if(y.contains(T)||(A=!0),A)return new _s(this.connection,this.startAnchor,this.endAnchor,this.controlPointDistanceFactor,this.extendArrow,this.extendStart).getSvgPath();const P=t==i?u:T,M=e==i?u:T,R=P.distanceTo(t.anchorPoint)[0],O=M.distanceTo(e.anchorPoint)[0],V=this.extendStart?this.getExtendedStartPoint(R/2):t.anchorPoint,$=new st(V,t.direction),G=this.extendArrow?this.getArrowStartPoint(O/2):e.anchorPoint,Z=new st(G,e.direction),tt=new ru(this.connection,$.anchorPoint,P,M,Z.anchorPoint);let dt="";return this.extendStart&&(dt=`M ${t.anchorPoint.x} ${t.anchorPoint.y} L ${V.x} ${V.y}`),this.extendArrow?dt+=tt.getSvgPath()+` L ${e.anchorPoint.x} ${e.anchorPoint.y}`:dt+=tt.getSvgPath(),dt}}class qu{get nodePath(){return this.dynamicSubPath.nodePath}dynamicSubPath;get connection(){return this.dynamicSubPath.connection}get nodeToConnect(){return this.dynamicSubPath.nodeToConnect}get nodeAtPathAnchor(){return this.dynamicSubPath.nodeAtPathAnchor}get pathAnchor(){return this.dynamicSubPath.pathAnchor}get constrainingNodes(){return this.dynamicSubPath.nodePath}get connectionType(){return this.dynamicSubPath.connectionType}get isPathToNode(){return this.connectionType==="pathToNode"}get isNodeToPath(){return this.connectionType==="nodeToPath"}constructor(t){this.dynamicSubPath=t}isValidPath(){return this.constrainingNodes.every(t=>this.isValidForNode(t))}}class GI extends qu{arcCircle;nodeIntersection;constructor(t){if(super(t),(isNaN(this.pathAnchor.direction.x)||isNaN(this.pathAnchor.direction.y))&&console.error("Invalid path anchor",this.pathAnchor),!this.nodeToConnect)throw new Error("Node to connect is not defined");this.arcCircle=F.getCircleFromCoincidentPointAndTangentAnchor(this.nodeToConnect.layoutNode.center,this.pathAnchor);try{const e=this.arcCircle?this.nodeToConnect.outerCircle.intersect(this.arcCircle):[];this.nodeIntersection=F.getClosestShapeToPoint(e,this.pathAnchor.anchorPoint)}catch(e){throw console.error("Error in direct circular arc connection layouting",{connection:this.connection,arcCircle:this.arcCircle,node:this.nodeToConnect,pathAnchor:this.pathAnchor}),e}}isValidForNode(t){if(!this.arcCircle||!this.nodeIntersection)return!1;if(this.nodeToConnect?.outerRange.hasPath(this.dynamicSubPath.subPath)){const r=this.nodeToConnect?.outerRange.getRangeForPath(this.dynamicSubPath.subPath),i=this.nodeToConnect?.outerRange.getRadOfPoint(this.nodeIntersection);if(r&&i&&!this.nodeToConnect?.outerRange.radIsInside(i,r))return!1}const e=t.layoutNode.innerCircle.intersect(this.arcCircle);if(e.length>0){const r=this.pathAnchor.getDirectionRegardingCircle(this.arcCircle),i=F.getClosestShapeToPoint(e,this.pathAnchor.anchorPoint),o=F.radOfPoint(this.pathAnchor.anchorPoint,this.arcCircle.center),a=F.radOfPoint(this.nodeIntersection,this.arcCircle.center),l=F.radOfPoint(i,this.arcCircle.center);return F.forwardRadBetweenAngles(o,a),F.forwardRadBetweenAngles(o,l),this.connectionType=="nodeToPath"?r=="counter-clockwise"?F.forwardRadBetweenAngles(o,l)>F.forwardRadBetweenAngles(o,a):F.forwardRadBetweenAngles(l,o)>F.forwardRadBetweenAngles(a,o):r=="counter-clockwise"?F.forwardRadBetweenAngles(l,o)>F.forwardRadBetweenAngles(a,o):F.forwardRadBetweenAngles(o,l)>F.forwardRadBetweenAngles(o,a)}return!0}getPath(){const t=this.connectionType==="pathToNode";if(this.arcCircle&&this.nodeIntersection){const e=t?this.pathAnchor.anchorPoint:this.nodeIntersection,r=t?this.nodeIntersection:this.pathAnchor.anchorPoint,i=new An(this.connection,e,r,this.arcCircle.r,this.arcCircle.r).direction("clockwise"),o=t?i.startAnchor:i.endAnchor;return this.pathAnchor.isSimilarTo(o)||i.direction("counter-clockwise"),i}}}class zI extends qu{vectorForNode;anchorForNode;constructor(t){if(super(t),!this.nodeToConnect)throw new Error("Node to connect is not defined");const e=this.dynamicSubPath.subPath.getDesiredNodeAnchor(this.nodeToConnect);this.anchorForNode=this.nodeToConnect.outerRange.getValidAnchorTowardsDirectionForPath(this.dynamicSubPath.subPath,e?.anchorPoint??this.pathAnchor.anchorPoint),this.vectorForNode=this.anchorForNode.direction}isValidForNode(t){return!0}getPath(){const t=this.connectionType==="pathToNode",e=this.nodeToConnect==this.dynamicSubPath.subPath.targetVisNode,r=this.nodeToConnect==this.dynamicSubPath.subPath.sourceVisNode,i=this.anchorForNode;return t?new Yg(this.connection,this.pathAnchor,i.cloneReversed(),this.nodeToConnect.circle,.4,e):new Yg(this.connection,i,this.pathAnchor,this.nodeToConnect.circle,.4,!1,r)}}class $I extends qu{anchorForNode;constructor(t){if(super(t),!this.nodeToConnect||!this.nodeAtPathAnchor)throw new Error("Node to connect is not defined");this.anchorForNode=this.nodeToConnect.outerRange.getValidAnchorTowardsDirectionForPath(this.dynamicSubPath.subPath,this.pathAnchor.anchorPoint),this.dynamicSubPath.subPath.getDesiredNodeAnchor(this.nodeToConnect),this.connection.debugShapes.push(this.anchorForNode)}isValidForNode(t){return!0}getPath(){const t=this.nodeAtPathAnchor.circle.clone(),e=[.9,.9],r=Math.random()*(e[1]-e[0])+e[0];return t.r*=r,this.isPathToNode?new Ug(this.connection,this.pathAnchor,this.anchorForNode.cloneReversed(),t):new Ug(this.connection,this.anchorForNode,this.pathAnchor,t)}}const mi=class mi extends Ha{nodePath=[];pathAnchor;subPath;get connectionType(){return this.subPath.connectionType}get nodeToConnect(){if(this.nodePath.length!==0){if(this.connectionType==="nodeToPath")return this.nodePath[0];if(this.connectionType==="pathToNode")return this.nodePath[this.nodePath.length-1]}}get nodeAnchor(){if(this.connectionType=="pathToNode")return this.nodePath.length>0?this.segments[this.segments.length-1].endAnchor:void 0;if(this.connectionType=="nodeToPath")return this.nodePath.length>0?this.segments[0].startAnchor:void 0}get nodeAtPathAnchor(){if(this.nodePath.length!==0){if(this.connectionType==="nodeToPath")return this.nodePath[this.nodePath.length-1];if(this.connectionType==="pathToNode")return this.nodePath[0]}}constructor(t,e,r){if(super(t.connection),this.subPath=t,e=e??t.nodePath,this.nodePath=Array.from(e),r=r??t.fixedPathAnchor,!r)throw new Error("Path anchor is not defined");this.pathAnchor=r,(isNaN(this.pathAnchor.direction.x)||isNaN(this.pathAnchor.direction.y))&&console.error("Invalid FLEX NODE PATH",this.pathAnchor)}layout(){let t=!1;this.connection.source.id=="drive_manager"&&this.connection.target.id=="camera"&&(t=!0);for(let e=0;e<mi.candidates.length;e++){const r=mi.candidates[e];t&&console.log("Try candidate",r.name,this.nodePath.map(a=>a.id).join(" -> "),this);const i=new r(this);if(i.isValidPath())return this.segments=[i.getPath()],t&&console.log("Valid path found with candidate",r.name),!0;const o=this.nodePath.length;for(let a=1;a<o-1;a++){this.nodePath.length-a;const{shortenedPath:l,shortenedRestPath:h}=this.getShortenedPath(a);t&&console.log("Shortened path",{i:a,nodePath:this.nodePath.map(g=>g.id).join(" -> "),shortenedPath:l.map(g=>g.id).join(" -> "),shortenedRestPath:h.map(g=>g.id).join(" -> ")});const u=this.createDynamicSubPath(l);if(u.layout()){const g=u.nodeAnchor;(!g||isNaN(g.direction.x)||isNaN(g.direction.y))&&console.error("Invalid node anchor",g,u);const y=this.createDynamicSubPath(h,u.nodeAnchor);if(y.layout())return this.segments=[u,y],!0}}}return console.warn("No valid path found",this),!1}createDynamicSubPath(t,e=this.pathAnchor){return new mi(this.subPath,t,e)}getShortenedPath(t){if(this.connectionType==="pathToNode"){const e=this.nodePath.slice(0,this.nodePath.length-t),r=this.nodePath.slice(this.nodePath.length-t);return{shortenedPath:e,shortenedRestPath:r}}else{const e=t,r=this.nodePath.slice(e),i=this.nodePath.slice(0,e);return{shortenedPath:r,shortenedRestPath:i}}}};Ot(mi,"candidates",[GI,zI,$I]);let iu=mi;class WI{_laidOutSubPath;get laidOutSubPath(){return this._laidOutSubPath}set laidOutSubPath(t){this._laidOutSubPath=t,this.linkedSubPaths.forEach(e=>{e.segments=[t]})}linkedSubPaths=[];source;target;rangeRepresentative;constructor(t,e){this.source=t,this.target=e}addSubPath(t){this.linkedSubPaths.push(t),this.rangeRepresentative||(this.rangeRepresentative=t)}}class Il extends Ha{levelType;connectionType;cachable=!1;group;visConnection;constraints=[];nodePath=[];get layouter(){return this.visConnection.layouter}get id(){return this.sourceVisNode.id+" -> "+this.targetVisNode.id}cachedSubPath;getOppositeNodeThan(t){if(t){if(this.sourceVisNode==t)return this.targetVisNode;if(this.targetVisNode==t)return this.sourceVisNode}}getLayoutNodeInDirectionOf(t){if(t){if(this.sourceVisNode==t)return this.connectionSourceNode;if(this.targetVisNode==t)return this.connectionTargetNode}}getNextNonHyperNodeBetween(t,e){const r=this.visConnection.nodePath;let i=!1;for(let o=0;o<r.length;o++){const a=r[o],l=a.layoutNode;if(a==t){i=!0;continue}if(a==e){if(i)return e;break}if(i&&!l.isHyperNode)return a}i=!1;for(let o=r.length-1;o>=0;o--){const a=r[o],l=a.layoutNode;if(a==t){i=!0;continue}if(a==e){if(i)return e;break}if(i&&!l.isHyperNode)return a}}isCounterPathOf(t,e=!0){return!t||this.levelType!="sameLevel"&&!e?!1:this.source===t.target&&this.target===t.source}hasSameParent(){return this.sourceVisNode.parent===this.targetVisNode.parent}isCircleArcForward(){return this.sourceVisNode.layoutNode.isDirectPredecessorInSortingTo(this.targetVisNode.layoutNode)}isCircleArcBackward(){return this.sourceVisNode.layoutNode.isDirectSuccessorInSortingTo(this.targetVisNode.layoutNode)}isCircleArc(){return this.isCircleArcForward()!==this.isCircleArcBackward()}get isHyperEdge(){return this.source.isHyperNode||this.target.isHyperNode}sourceVisNode;targetVisNode;get connectionSourceNode(){return this.connection.source}get connectionTargetNode(){return this.connection.target}get level(){return this.levelFromTop}get minLevelFromTop(){return Math.min(this.sourceVisNode.layoutNode.layerFromTop,this.targetVisNode.layoutNode.layerFromTop)}get levelFromBot(){return Math.min(this.sourceVisNode.layoutNode.layerFromBot,this.targetVisNode.layoutNode.layerFromBot)}get levelFromTop(){return Math.max(this.sourceVisNode.layoutNode.layerFromTop,this.targetVisNode.layoutNode.layerFromTop)}previousSubPath;nextSubPath;get fixedPathAnchor(){if(this.connectionType!="nodeToNode"){if(this.connectionType=="nodeToPath")return this.nextSubPath?.startAnchor;if(this.connectionType=="pathToNode")return this.previousSubPath?.endAnchor}}get fixedPathAnchorPoint(){return this.fixedPathAnchor?.anchorPoint}getDesiredNodeAnchor(t,e){const r=e?.ignoreLevelDifference??!1,i=e?.directConnectionAtHypernode??!0,o=this.getOppositeNodeThan(t),a=this.getLayoutNodeInDirectionOf(t),l=this.getLayoutNodeInDirectionOf(o);let h=!1;if(h=!1,!(!r&&Math.abs(t.layoutNode.layerFromTop-(o?.layoutNode.layerFromTop??t.layoutNode.layerFromTop))>1)){if(this.connectionType=="nodeToNode"){if(this.levelType=="sameLevel"){if(!a||!l)return;const u=this.getNextNonHyperNodeBetween(t,this.layouter.getVisNode(l));if(h&&console.error({visNode:t.id,sourceLayoutNode:a,nextNonHyperNode:u,otherLayoutNode:l,type:this.connectionType}),t.layoutNode.isHyperNode){const d=this.getNextNonHyperNodeBetween(t,this.layouter.getVisNode(a));if(h&&console.log({isHyperNode:!0,nextNonHyperNode:d?.id,nPath:this.nodePath.map(g=>g.id),nVisPath:this.visConnection.nodePath.map(g=>g.id),sVis:t.id,eVis:this.layouter.getVisNode(a)?.id}),i&&d){this.layouter.getVisNode(d);const g=new U(d.center,l.center);h&&t.layoutNode.debugShapes.push(g);const y=t.outerCircle.intersect(g);if(y.length>0)return new st(y[0],new W(g.slope))}return new st(t.center,new W(t.center,d?.center??a.center)).move(t.outerCircle.r)}else{if(l){const d=this.getNextNonHyperNodeBetween(t,this.layouter.getVisNode(l));return d?new st(t.center,new W(t.center,d.center)).move(t.outerCircle.r):new st(t.center,new W(t.center,l.center)).move(t.outerCircle.r)}return}}else if(this.levelType=="levelChanging"&&o){if(o.outerRange.pointIsInside(t.center)&&t.outerRange.pointIsInside(o.center))return new st(t.center,new W(t.center,o.center)).move(t.outerCircle.r);{const u=this.layouter.getVisNode(l.parent);if(u){const d=u.innerCircle.center,g=new W(t.center,d),y=g.slope,m=new W(d,o.center).slope;let v=F.forwardRadBetweenAngles(y,m)-Math.PI;d.distanceTo(o.center)[0]<.1&&(v=0);const b=3*u.innerCircle.r*v/Math.PI,N=new st(d,g.clone().rotate90CCW()).move(b).anchorPoint;return new st(t.center,new W(t.center,N)).move(t.outerCircle.r)}}}}else if(this.connectionType=="nodeToPath"){const u=this.getLayoutNodeInDirectionOf(t);if(h&&console.error({visNode:t.id,endLayoutNode:u?.id}),u==t.layoutNode){const d=this.nextSubPath?.startAnchor;if(t&&d){const g=F.getCircleFromCoincidentPointAndTangentAnchor(t.layoutNode.center,d);try{const y=g?t.outerCircle.intersect(g):[],m=F.getClosestShapeToPoint(y,d.anchorPoint);if(m)return new st(m,new W(t.center,m))}catch(y){throw console.error("Error in direct circular arc connection layouting",{}),y}}return d}else{const g=this.previousSubPath?.endAnchor;if(g)return new st(t.center,new W(g.anchorPoint,t.center)).move(t.outerCircle.r)}}else if(this.connectionType=="pathToNode")if(this.getLayoutNodeInDirectionOf(t)==t.layoutNode){const d=this.previousSubPath?.endAnchor;if(t&&d){const g=F.getCircleFromCoincidentPointAndTangentAnchor(t.layoutNode.center,d);try{const y=g?t.outerCircle.intersect(g):[],m=F.getClosestShapeToPoint(y,d.anchorPoint);if(m)return new st(m,new W(t.center,m))}catch(y){throw console.error("Error in direct circular arc connection layouting",{}),y}}return d}else{const g=this.nextSubPath?.endAnchor;if(g)return new st(t.center,new W(g.anchorPoint,t.center)).move(t.outerCircle.r)}}}getOppositeConnectionPoint(t){if(this.connectionType=="nodeToNode")return this.getOppositeNodeThan(t)?.center;if(this.connectionType=="nodeToPath")return t==this.sourceVisNode?this.nextSubPath?.startAnchor?.anchorPoint:this.sourceVisNode.center;if(this.connectionType=="pathToNode")return t==this.targetVisNode?this.previousSubPath?.endAnchor?.anchorPoint:this.targetVisNode.center;throw new Error("Not implemented")}constructor(t){super(t.visConnection.connection),this.visConnection=t.visConnection,this.sourceVisNode=this.layouter.getVisNode(t.startNode),this.targetVisNode=this.layouter.getVisNode(t.endNode),t.constraints&&(this.constraints=t.constraints.map(r=>this.layouter.getVisNode(r))),t.nodePath&&(this.nodePath=t.nodePath.map(r=>this.layouter.getVisNode(r))),t.previousSubPath&&(this.previousSubPath=t.previousSubPath,t.previousSubPath.nextSubPath=this),this.hasSameParent()?this.levelType="sameLevel":this.levelType="levelChanging",this.hasSameParent()?this.sourceVisNode==this.targetVisNode&&this.sourceVisNode.layoutNode.isVirtual?this.connectionType="pathToPath":this.connectionType="nodeToNode":this.sourceVisNode.layoutNode.isHyperNode?this.connectionType="pathToNode":this.targetVisNode.layoutNode.isHyperNode?this.connectionType="nodeToPath":this.connectionType="nodeToNode";const e=this.layouter.useHyperEdges;if(this.levelType=="sameLevel"&&this.connectionType=="nodeToNode"&&(this.sourceVisNode.layoutNode.isVirtual||this.targetVisNode.layoutNode.isVirtual?this.cachable=!0:this.cachable=e),this.cachable){const r=this.sourceVisNode.getSubPathGroup(this.targetVisNode);r.addSubPath(this),this.group=r}!e&&this.isHyperEdge||(this.addToNodeRange(),this.layouter.addPathToLayouter(this))}addToNodeRange(){if(this.source,this.target,this.hasSameParent()){if(this.connectionType=="pathToPath"){this.sourceVisNode.path2pathSubPaths.push(this);return}this.isCircleArc()?this.isCircleArcForward()?(this.sourceVisNode.circularRangeForward.registerSubPath(this,this.targetVisNode.circularRangeBackward),this.targetVisNode.circularRangeBackward.registerSubPath(this,this.sourceVisNode.circularRangeForward)):this.isCircleArcBackward()&&(this.sourceVisNode.circularRangeBackward.registerSubPath(this,this.targetVisNode.circularRangeForward),this.targetVisNode.circularRangeForward.registerSubPath(this,this.sourceVisNode.circularRangeBackward)):(this.sourceVisNode.innerRange.registerSubPath(this,this.targetVisNode.innerRange),this.targetVisNode.innerRange.registerSubPath(this,this.sourceVisNode.innerRange))}else this.sourceVisNode.outerRange.registerSubPath(this,this.targetVisNode.outerRange),this.targetVisNode.outerRange.registerSubPath(this,this.sourceVisNode.outerRange)}layoutCompleted=!1;getSvgPath(){return this.segments.length===0?"":this.segments.filter(t=>t!==void 0).map(t=>t.getSvgPath()).join(" ")}layout(){if(this.isHyperEdge&&console.error("Layouting hyper edge",this),!this.layoutCompleted){if(this.layoutCompleted=!0,this.group)if(this.group.laidOutSubPath){this.segments=[this.group.laidOutSubPath];return}else this.group.laidOutSubPath=this;if(this.levelType=="sameLevel"){if(this.isCircleArc()){this.layoutCircleArc();return}if(this.connectionType=="pathToPath"){this.layoutPathToPathConnection();return}this.layoutInsideParent();return}else this.connectionType=="pathToNode"||this.connectionType=="nodeToPath"?this.layoutPathNodeConnection():this.layoutDirectOutsideConnection()}}layoutCircleArc(){const t=this.isCircleArcForward(),e=this.sourceVisNode.layoutNode,r=this.targetVisNode.layoutNode,i=e.getCommonParent(r),o=e.outerCircle,a=r.outerCircle;let l=i?.innerCircle.clone();const h=t?this.sourceVisNode.circularRangeForward:this.sourceVisNode.circularRangeBackward;t?this.targetVisNode.circularRangeBackward:this.targetVisNode.circularRangeForward;const u=h.getRadForPath(this),d=F.positionOnCircleAtRad(u,o.r,o.center),g=i.innerCircle.center.distanceTo(d)[0];if(!l||!o||!a){console.error("No segment circle for connection",this.connection,o,a);return}const y=t?"clockwise":"counter-clockwise";if(l.r=g,i?.children.length===2){const w=new W(o.center,a.center),v=t?w.rotate90CW():w.rotate90CCW(),_=i.center.translate(v),b=r.radius<e.radius?r:e,N=_.distanceTo(b.center)[0],A=i.innerRadius/g,T=N/A;l=new Q(_,T)}let m;try{m=Ka.getCircularArcBetweenCircles(this.connection,o,a,l,y),this.sourceVisNode.adaptRanges(m.startAnchor),this.targetVisNode.adaptRanges(m.endAnchor),this.segments=[m]}catch(w){throw this.connection.debugShapes.push(o),this.connection.debugShapes.push(a),this.connection.debugShapes.push(l),console.error("Error in circular arc connection layouting",{connection:this.connection,source:e,target:r,segmentCircle:l}),w}}layoutInsideParent(){const t=this.sourceVisNode.innerRange.getAnchorForPath(this,"out"),e=this.targetVisNode.innerRange.getAnchorForPath(this,"in");this.segments=[new _s(this.connection,t,e)]}layoutPathToPathConnection(){const e=this.previousSubPath?.endAnchor,i=this.nextSubPath?.startAnchor;if(!e||!i){console.error("No source or target anchor for path to path connection",this);return}this.segments=[new _s(this.connection,e,i,.4,!1,!1)]}layoutPathNodeConnection(){const t=new iu(this);t.layout(),this.segments=[t]}layoutDirectOutsideConnection(){this.source.id=="sensor2";const t=this.sourceVisNode.outerRange.getAnchorForPath(this,"out"),e=this.targetVisNode.outerRange.getAnchorForPath(this,"in");this.segments=[new _s(this.connection,t,e,.5)]}}class Sa extends Ha{nodePath=[];subPaths=[];layouter;visNodeSource;visNodeTarget;constructor(t,e){super(t),this.layouter=e,this.visNodeSource=e.getVisNode(t.source),this.visNodeTarget=e.getVisNode(t.target),this.connection.pathSegment=this,this.initSubPaths()}initSubPaths(){const t=this.connection.getConnectionPathViaHyperAndVirtualNodes(),e=t.map(r=>this.layouter.getVisNode(r));this.nodePath=e,t.map(r=>r.id).join(" -> "),this.subPaths=Sa.createSubPathsFromNodePath(t,this),this.segments=this.subPaths.map(r=>r)}static createSubPathsFromNodePath(t,e){const r=[];let i;const o=e.layouter.useHierarchicalSubPaths;for(let a=0;a<t.length-1;a++){const l=t[a];let h;l.isVirtual&&(i?(h=new Il({visConnection:e,startNode:l,endNode:l,nodePath:[l],previousSubPath:i}),r.push(h)):console.error("Path2path without previous subpath",l,t));let u=a+1,d=t[u];if(o)for(;d.parent!=l.parent;){const g=t[u+1];if(!g||g.parent==d.parent)break;d=g,u++}else for(;!l.isHyperNode&&d.isHyperNode;)if(u++,d=t[u],!d){console.error("No next node found",l,t);break}if(l.parent==d.parent){const g=new Il({visConnection:e,startNode:l,endNode:d,nodePath:t.slice(a,u+1),previousSubPath:i});r.push(g),i=g}else{const g=new Il({visConnection:e,startNode:l,endNode:d,nodePath:t.slice(a,u+1),previousSubPath:i});r.push(g),i=g}a=u-1,h&&(h.nextSubPath=i)}return r}}class qo{type;node;range;backsideRad;subPaths=[];calculated=!1;sorted=!1;oppositeRanges=new Map;subPathInformation=[];mappedSubPathInformation=new Map;lastAssignedRad=0;assignedRads=new Map;assignedRadRanges=new Map;minimumDistanceBetweenPathsFactor=.5;pathRangeMarginFactor=.1;outerMargin;constructor(t,e,r=.9){this.type=e,this.node=t,this.outerMargin=0;const i=.2,o=-.4;e==="outside"?(this.range=t.layoutNode.getValidOuterRadRange(r,!1),this.outerMargin=F.forwardRadBetweenAngles(t.layoutNode.getValidOuterRadRange(1,!1)[0],this.range[0]),this.node.parent?this.backsideRad=F.normalizeRad(new W(this.node.center,this.node.parent.innerCircle.center).slope):this.backsideRad=F.normalizeRad(this.getMiddleRadOnBackside())):e==="inside"?(this.range=t.layoutNode.getValidInnerRadRange(r,!1),this.outerMargin=F.forwardRadBetweenAngles(t.layoutNode.getValidInnerRadRange(1,!1)[0],this.range[0]),this.backsideRad=this.getMiddleRadOnBackside()):e==="circleArcForward"?(this.range=t.layoutNode.getValidCircularRadRange(i,o,"clockwise"),this.backsideRad=this.getMiddleRad(t.layoutNode.getValidCircularRadRange(i,o,"counterclockwise"))):e==="circleArcBackward"?(this.range=t.layoutNode.getValidCircularRadRange(i,o,"counterclockwise"),this.backsideRad=this.getMiddleRad(t.layoutNode.getValidCircularRadRange(i,o,"clockwise"))):(this.range=[0,0],this.backsideRad=0)}registeredSubPaths=new Set;registerSubPath(t,e){if(this.oppositeRanges.set(t,e),t.group){if(!t.group.rangeRepresentative)throw new Error("Group has no range representative");if(this.registeredSubPaths.has(t.group.rangeRepresentative))return;this.subPaths.push(t.group.rangeRepresentative),this.registeredSubPaths.add(t.group.rangeRepresentative),this.calculated=!1,this.sorted=!1;return}this.subPaths.push(t),this.registeredSubPaths.add(t),this.calculated=!1,this.sorted=!1}getRepresentedSubPath(t){return t.group?.rangeRepresentative??t}hasPath(t){return this.registeredSubPaths.has(this.getRepresentedSubPath(t))}trimToAnchor(t){let e=!1;e=!1;const r=this.getRadOfPoint(t.anchorPoint);if(this.pointIsInside(t.anchorPoint,[this.range[0]-this.outerMargin,this.range[1]+this.outerMargin])){const i=F.forwardRadBetweenAngles(this.getMiddleRad(),r),o=this.range.slice();i<Math.PI?this.range[1]=r-this.outerMargin:this.range[0]=r+this.outerMargin,e&&console.warn("[TRIM]",{anchorRad:r,margin:this.outerMargin,id:this.node.id,rangeBefore:o,rangeAfter:this.range}),this.calculated=!1,this.sorted=!1}else e&&console.warn("[N TRIM] Anchor not inside range",{anchorRad:r,margin:this.outerMargin,range:this.range,id:this.node.id})}getRadForPath(t){if(!this.registeredSubPaths.has(t))throw new Error(`Path ${t.id} not in continuum`);if(this.calculated||this.calculate(),t=this.getRepresentedSubPath(t),this.assignedRads.has(t))return this.assignedRads.get(t);const e=this.mappedSubPathInformation.get(t);if(!e)throw new Error(`Path ${t.id} not in continuum. This should not happen`);const r=this.getRangeForPath(t);if(!e.desiredAnchor)return r[0]+F.forwardRadBetweenAngles(r[0],r[1])/2;const i=this.getRadOfPoint(e.desiredAnchorPoint);return F.putRadBetween(i,r[0],r[1])}getRangeForPath(t){if(!this.registeredSubPaths.has(t))throw new Error(`Path ${t.id} not in continuum`);return this.calculated||this.calculate(),t=this.getRepresentedSubPath(t),this.assignedRadRanges.has(t)?this.assignedRadRanges.get(t):this.range}radIsInside(t,e){return e=e??this.range,F.radIsBetween(t,e[0],e[1])}pointIsInside(t,e){return t?(e=e??this.range,this.radIsInside(this.getRadOfPoint(t),e)):!1}getRadOfPoint(t){return F.radOfPoint(t,this.node.layoutNode.center)}getAnchorForPath(t,e){const r=this.getRadForPath(t),i=this.mappedSubPathInformation.get(t);if(i&&i.desiredAnchor){const o=this.getRadOfPoint(i.desiredAnchorPoint);if(Math.abs(r-o)<.01)return e==="in"?i.desiredAnchor.cloneReversed():i.desiredAnchor.clone()}return this.getAnchorForRad(r,e)}getAnchorForRad(t,e){const r=new st(this.node.layoutNode.center,new W(t)).move(this.node.layoutNode.outerRadius);return e==="in"?r.cloneReversed():r}getValidVectorTowardsDirection(t,e){e||(e=this.range);const r=F.radOfPoint(t,this.node.layoutNode.center),i=F.putRadBetween(r,e[0],e[1]);return new W(i)}getValidAnchorTowardsDirection(t,e){e||(e=this.range);const r=this.getValidVectorTowardsDirection(t,e);return new st(this.node.layoutNode.center,r).move(this.node.layoutNode.outerRadius)}getValidAnchorTowardsDirectionForPath(t,e,r=!0){if(!this.hasPath(t)){if(!r)throw new Error("Path not registered.");return this.getValidAnchorTowardsDirection(e)}const i=this.getRangeForPath(t),o=this.getValidVectorTowardsDirection(e,i);return new st(this.node.layoutNode.center,o).move(this.node.layoutNode.outerRadius)}getValidAnchorsOfRange(t){t=t??this.range;const e=new st(this.node.layoutNode.center,new W(t[0])),r=new st(this.node.layoutNode.center,new W(t[1])),i=new st(this.node.layoutNode.center,new W(this.backsideRad)),o=1;return e._data={length:this.node.layoutNode.outerRadius,stroke:"green",strokeWidth:4,opacity:o},r._data={length:this.node.layoutNode.outerRadius,stroke:"red",strokeWidth:4,opacity:o},i._data={length:this.node.layoutNode.outerRadius,stroke:"blue",strokeWidth:4,opacity:o},{startAnchor:e,endAnchor:r,backsideAnchor:i,all:[e,r,i]}}getMiddleRadOnBackside(){return F.normalizeRad(this.range[1]+F.forwardRadBetweenAngles(this.range[1],this.range[0])/2)}getMiddleRad(t){return t=t??this.range,F.normalizeRad(t[0]+F.forwardRadBetweenAngles(t[0],t[1])/2)}getSortedSubPathInfo(){if(this.sorted)return this.subPathInformation;const t=this.node.parentLayouter.useHierarchicalSubPaths,e=.01,r=this.backsideRad,i=this.subPaths.map((l,h)=>{const u=l.getOppositeConnectionPoint(this.node)?.clone(),d=l.getOppositeNodeThan(this.node);if(!u||!d)throw new Error("Opposite connection point not found");const g=this.oppositeRanges.get(l);if(!g)throw console.warn({t:this,subPath:l,oppositeRanges:this.oppositeRanges}),new Error("Opposite range not found");const y=g.backsideRad,m=this.getRadOfPoint(u),w=F.forwardRadBetweenAngles(r,m),v=l.getLayoutNodeInDirectionOf(l.getOppositeNodeThan(this.node)),_=v?this.getRadOfPoint(v.center):w,b=l.getDesiredNodeAnchor(this.node,{directConnectionAtHypernode:!1}),N=l.getDesiredNodeAnchor(this.node,{directConnectionAtHypernode:t}),A=N?.anchorPoint,T=b?.anchorPoint,P=0*Math.PI/180,M=T?F.forwardRadBetweenAngles(r,this.getRadOfPoint(T)-P):void 0,R=d?l.getDesiredNodeAnchor(d,{directConnectionAtHypernode:!1}):void 0,O=d?l.getDesiredNodeAnchor(d,{directConnectionAtHypernode:t}):void 0,V=O?.anchorPoint,$=R?.anchorPoint,G=$?F.forwardRadBetweenAngles(y,g.getRadOfPoint($)-P):void 0,Z=d.parentVisNode,tt=this.node.parentVisNode,dt=Z?F.forwardRadBetweenAngles(r,new W(this.node.center,Z.center).slope):void 0,wt=tt?F.forwardRadBetweenAngles(y,new W(d.center,tt.center).slope):void 0;return{subPath:l,desiredAnchor:N,desiredAnchorPoint:A,level:l.minLevelFromTop,forwardRadToConnectionPoint:w,forwardRadToTargetNode:_,sourceVisNode:l.sourceVisNode,targetVisNode:l.targetVisNode,oppositeConnectionPoint:u,isInsideRange:!1,hasCounterPath:!1,hasCounterPathBefore:!1,hasCounterPathAfter:!1,desiredForwardRad:M,node:this.node,otherLayoutNode:v,oppositeVisNode:d,desiredCounterAnchor:O,desiredCounterAnchorPoint:V,desiredCounterForwardRad:G,forwardParentRad:dt,oppositeParentRad:wt}});i.sort((l,h)=>l.level!=h.level?(l.level<h.level?l:h).forwardRadToConnectionPoint<Math.PI?l.level-h.level:h.level-l.level:l.desiredForwardRad&&h.desiredForwardRad&&Math.abs(l.desiredForwardRad-h.desiredForwardRad)>e?l.desiredForwardRad-h.desiredForwardRad:l.desiredCounterForwardRad&&h.desiredCounterForwardRad&&Math.abs(l.desiredCounterForwardRad-h.desiredCounterForwardRad)>e?h.desiredCounterForwardRad-l.desiredCounterForwardRad:Math.abs(l.forwardRadToConnectionPoint-h.forwardRadToConnectionPoint)<e?l.sourceVisNode===this.node&&h.sourceVisNode===this.node?l.forwardRadToTargetNode-h.forwardRadToTargetNode:l.sourceVisNode===this.node?-1:1:l.forwardRadToConnectionPoint-h.forwardRadToConnectionPoint);const o=i.slice();o.sort((l,h)=>l.level!=h.level?(l.level<h.level?l:h).forwardRadToConnectionPoint<Math.PI?l.level-h.level:h.level-l.level:l.desiredCounterForwardRad&&h.desiredCounterForwardRad&&Math.abs(l.desiredCounterForwardRad-h.desiredCounterForwardRad)>e?h.desiredCounterForwardRad-l.desiredCounterForwardRad:l.desiredForwardRad&&h.desiredForwardRad&&Math.abs(l.desiredForwardRad-h.desiredForwardRad)>e?l.desiredForwardRad-h.desiredForwardRad:Math.abs(l.forwardRadToConnectionPoint-h.forwardRadToConnectionPoint)<e?l.sourceVisNode===this.node&&h.sourceVisNode===this.node?l.forwardRadToTargetNode-h.forwardRadToTargetNode:l.sourceVisNode===this.node?-1:1:l.forwardRadToConnectionPoint-h.forwardRadToConnectionPoint);const a=[];if(this.node.parentLayouter.useHierarchicalSubPaths||a.push(...i),a.length==0){this.type=="circleArcBackward"&&(o.reverse(),i.reverse());const l=new Set;let h=0,u=0;for(;;){let d,g;for(;h<i.length;){if(d=i[h].subPath.cId,l.has(d)){h++;continue}break}for(;u<o.length;){if(g=o[u].subPath.cId,l.has(g)){u++;continue}break}if(h==i.length&&(d=void 0),u==o.length&&(g=void 0),d==null||g==null){for(;h<i.length;){if(l.has(i[h].subPath.cId)){h++;continue}a.push(i[h]),h++}for(;u<o.length;){if(l.has(o[u].subPath.cId)){u++;continue}a.push(o[u]),u++}break}if(d==g){a.push(i[h]),l.add(d);continue}else{const y=[i[h],o[u]];y.sort((m,w)=>m.subPath.source.score!=w.subPath.source.score?w.subPath.source.score-m.subPath.source.score:m.subPath.cId.localeCompare(w.subPath.cId)),a.push(y[0]),l.add(y[0].subPath.cId)}}this.type=="circleArcBackward"&&(o.reverse(),i.reverse(),a.reverse())}return this.subPathInformation=a,this.node.id=="sensor3",i.forEach((l,h,u)=>{const d=l.subPath,g=h+1<u.length?u[h+1].subPath:void 0,y=h>0?u[h-1].subPath:void 0;let m=!1,w=!1,v=!1;g&&d.isCounterPathOf(g)?(m=!0,v=!0):y&&d.isCounterPathOf(y)&&(m=!0,w=!0),l.hasCounterPath=m,l.hasCounterPathBefore=w,l.hasCounterPathAfter=v}),i.forEach(l=>{this.mappedSubPathInformation.set(l.subPath,l)}),this.sorted=!0,i}calculate(){this.sorted||this.getSortedSubPathInfo(),this.lastAssignedRad=this.range[0],this.assignedRads=new Map,this.assignedRadRanges=new Map;const t=new Map,e=new Map,r=1;let i=0;const o=this.subPathInformation;o.forEach((A,T)=>{const P=A.subPath;o[T+1]?.subPath,T>0&&o[T-1].subPath;const M=[i,i];M[1]+=r,e.set(P,M),i=M[1]});const a=F.forwardRadBetweenAngles(this.range[0],this.range[1]),l=i;e.forEach((A,T)=>{A[0]=A[0]/l*a+this.range[0],A[1]=A[1]/l*a+this.range[0];const P=(A[1]-A[0])*0;A[0]+=P/2,A[1]-=P/2});let h=this.node.parentLayouter.optimizeConnectionAnchors;const u=this.type=="circleArcBackward"||this.type=="circleArcForward";h&&u&&(h=!1);const d=new Map,g=Math.max(6,this.subPaths.length),y=F.forwardRadBetweenAngles(this.range[0],this.range[1]);this.pathRangeMarginFactor*y/g;const w=Math.min(Math.max(0,this.node.parentLayouter.minimumRangeSizeFactor),1)*y/g;if(h){this.range[0];const A=this.range[1],T=F.normalizeRad(this.range[0]+w/2);F.normalizeRad(this.range[1]-w/2);let P=T,M=!0;o.forEach((R,O)=>{const V=F.normalizeRad(A-w*(o.length-O-1)-w/2);if(P=F.putRadBetween(P,T,V,"closer"),!R.desiredAnchor)M?(d.set(R.subPath,P),P+=w):d.set(R.subPath,V);else{M=!1;let $=this.getRadOfPoint(R.desiredAnchorPoint),G="closer";G="closer",$=F.putRadBetween($,P,V,G),d.set(R.subPath,$),P=$+w}}),o.forEach((R,O)=>{const V=O>0?o[O-1].subPath:void 0,$=O<o.length-1?o[O+1].subPath:void 0,G=R.subPath,Z=d.get(G);e.get(G);let tt=this.range[0],dt=this.range[1];if(V){const wt=d.get(V);tt=wt+F.forwardRadBetweenAngles(wt,Z)/2}if($){const wt=d.get($);dt=wt-F.forwardRadBetweenAngles(Z,wt)/2}e.set(G,[tt,dt])})}let v=Math.min(Math.max(0,this.node.parentLayouter.rangePaddingFactor),1),_=this.node.parentLayouter.combineCounterPaths;const b=Math.max(0,Math.min(1,this.node.parentLayouter.combinedPathsDistanceFactor));u&&(_=!1,v=.9),o.forEach((A,T)=>{const P=A.subPath,M=e.get(P);let R=M[0],O=M[1],V=F.forwardRadBetweenAngles(R,O);const $=h?Math.min(v*w,v*V):v*V;if(!_||!A.hasCounterPath)R+=$/2,O-=$/2;else{if(A.hasCounterPathAfter){const tt=o[T+1].subPath,dt=e.get(tt),wt=F.forwardRadBetweenAngles(dt[0],dt[1]);if(V<wt){const Nt=[dt[0],dt[0]+V];e.set(tt,Nt)}else if(wt<V){O=M[1],R=M[1]-wt;const Nt=[R,O];e.set(P,Nt),V=F.forwardRadBetweenAngles(R,O)}}const G=V*b,Z=V-G/2-G;A.hasCounterPathAfter?(O-=G/2,R+=Z):(R+=G/2,O-=Z)}e.set(P,[R,O])}),e.forEach((A,T)=>{const P=T.getDesiredNodeAnchor(this.node)?.anchorPoint;if(!P){const M=F.forwardRadBetweenAngles(A[0],A[1]);t.set(T,A[0]+M/2);return}if(this.pointIsInside(P,A)){t.set(T,this.getRadOfPoint(P));return}else{let M="closer",R=this.getRadOfPoint(P);this.pointIsInside(P,this.range)||(F.rad1ComesAfterRad2(R,this.backsideRad,this.getMiddleRad())?M="clockwise":M="counter-clockwise"),R=F.putRadBetween(R,A[0],A[1],M);const O=this.getAnchorForRad(R,"out");t.set(T,this.getRadOfPoint(O.anchorPoint))}});let N=!1;N=!1,N&&(this.node.layoutNode.debugShapes.push(this.getValidAnchorsOfRange().startAnchor,this.getValidAnchorsOfRange().endAnchor),e.forEach((A,T)=>{const P=this.getAnchorForRad(A[0],"out"),M=this.getAnchorForRad(A[1],"out");P._data={length:10,stroke:"green",opacity:1},M._data={length:10,stroke:"red",opacity:1},T.connection.debugShapes.push(P,M);const R=this.subPathInformation.find(V=>V.subPath==T)?.desiredAnchor;if(R){R._data={length:5,stroke:"blue"},T.connection.debugShapes.push(R);const V=new U(R.anchorPoint,P.anchorPoint);T.connection.debugShapes.push(V)}const O=T.getDesiredNodeAnchor(this.node)?.anchorPoint;if(O&&T.fixedPathAnchorPoint){const V=new U(T.fixedPathAnchorPoint,O);V._data={stroke:"orange"}}if(d.has(T)){const V=d.get(T),$=this.getAnchorForRad(V,"out");$._data={length:5,stroke:"blue"}}})),this.assignedRads=t,this.assignedRadRanges=e,this.calculated=!0}}class Kg{layoutNode;get id(){return this.layoutNode.id}get center(){return this.layoutNode.center}get outerCircle(){return this.layoutNode.outerCircle}get circle(){return this.layoutNode.circle}get innerCircle(){return this.layoutNode.innerCircle}get parent(){return this.layoutNode.parent}get parentVisNode(){return this.layoutNode.parent?this.parentLayouter.getVisNode(this.layoutNode.parent):void 0}innerRange;outerRange;circularRangeForward;circularRangeBackward;path2pathSubPaths=[];circularSubPaths=[];adaptRanges(t){[this.innerRange,this.outerRange].forEach(e=>{e.trimToAnchor(t)})}connections=[];outConnections=[];inConnections=[];initConnections(t=!1){this.connections=[],this.outConnections=[],this.inConnections=[],t?(this.layoutNode.outConnections.forEach(e=>{this.addConnection(e)}),this.layoutNode.inConnections.forEach(e=>{this.addConnection(e)})):(this.layoutNode.outConnectionsWithoutSelfLoops.forEach(e=>{this.addConnection(e)}),this.layoutNode.inConnectionsWithoutSelfLoops.forEach(e=>{this.addConnection(e)}))}addConnection(t){const e=this.parentLayouter.getVisConnection(t);this.connections.push(e),e.source===this.layoutNode?this.outConnections.push(e):this.inConnections.push(e)}subPathGroups=new Map;getSubPathGroup(t){return this.subPathGroups.has(t)||this.subPathGroups.set(t,new WI(this,t)),this.subPathGroups.get(t)}getSortedSubPaths(){return[...this.circularSubPaths,...this.innerRange.getSortedSubPathInfo().map(t=>t.subPath),...this.outerRange.getSortedSubPathInfo().map(t=>t.subPath)]}parentLayouter;constructor(t,e){this.layoutNode=t,this.parentLayouter=e,this.innerRange=new qo(this,"inside"),this.outerRange=new qo(this,"outside"),this.circularRangeForward=new qo(this,"circleArcForward"),this.circularRangeBackward=new qo(this,"circleArcBackward")}}class HI extends Gs{connections=[];mapLayoutNodeToVisNode=new Map;mapLayoutConnectionToVisConnection=new Map;mapLayerToSubPaths=new Map;optimizeConnectionAnchors=!0;minimumRangeSizeFactor=.4;rangePaddingFactor=.1;combinedPathsDistanceFactor=.2;combineCounterPaths=!0;useHierarchicalSubPaths=!0;useHyperEdges=!1;constructor(t){super(),this.optimizeConnectionAnchors=t?.optimizeConnectionAnchors??!0,this.minimumRangeSizeFactor=t?.minimumRangeSizeFactor??.4,this.rangePaddingFactor=t?.rangePaddingFactor??.1,this.combinedPathsDistanceFactor=t?.combinedPathsDistanceFactor??.2,this.combineCounterPaths=t?.combinePaths??!0,this.useHierarchicalSubPaths=t?.useHierarchicalSubPaths??!0,this.useHyperEdges=t?.useHyperEdges??!1,this.useHierarchicalSubPaths||(this.useHyperEdges=!1)}get visNodes(){return Array.from(this.mapLayoutNodeToVisNode.values())}getVisNode(t){const e=t instanceof Kg?t.layoutNode:t;return this.mapLayoutNodeToVisNode.has(e)||this.mapLayoutNodeToVisNode.set(e,new Kg(e,this)),this.mapLayoutNodeToVisNode.get(e)}getVisConnection(t){const e=t instanceof Sa?t.connection:t;if(!this.mapLayoutConnectionToVisConnection.has(e)){const r=new Sa(e,this);this.mapLayoutConnectionToVisConnection.set(e,r)}return this.mapLayoutConnectionToVisConnection.get(e)}addPathToLayouter(t){this.mapLayerToSubPaths.has(t.level)||this.mapLayerToSubPaths.set(t.level,[]),this.mapLayerToSubPaths.get(t.level).push(t)}getSubPathsOfLayer(t){return(this.mapLayerToSubPaths.get(t)??[]).sort((r,i)=>r.levelType==="sameLevel"?-1:1)}getAllSubPaths(t="asc"){const e=Array.from(this.mapLayerToSubPaths.keys()).sort(),r=[];return e.forEach(i=>{r.push(this.getSubPathsOfLayer(i))}),t==="asc"?r:r.reverse()}getAllVisNodes(t="asc"){const e=this.visNodes.slice().sort((r,i)=>r.layoutNode.layerFromTop-i.layoutNode.layerFromTop);return t==="asc"?e:e.reverse()}layoutConnectionsOfNode(t){this.getVisNode(t).initConnections()}layoutConnectionsOfRootNode(t){const e=this.getAllVisNodes("asc");console.log("[VISCOM] sortedNodes",e.map(r=>r.layoutNode.id+" "+r.layoutNode.layerFromTop)),e.forEach(r=>{r.circularRangeForward.getSortedSubPathInfo().forEach(o=>{o.subPath.layout()})}),e.forEach(r=>{r.innerRange.getSortedSubPathInfo().forEach(o=>{o.subPath.layout()})}),e.forEach(r=>{r.outerRange.getSortedSubPathInfo().forEach(o=>{o.subPath.layout()})}),e.forEach(r=>{r.path2pathSubPaths.forEach(i=>{i.layout()})})}}class qI extends $i{hyperRadius=0;initVisGraph(){return this.resetVisGraph(),console.log({n:this.visGraph.allLeafLayoutNodes.length,m:this.visGraph.allLayoutConnections.length,l:this.visGraph.allLayoutConnections.flatMap(t=>t.getLinks()).length}),this.settings.community.fetchCommunities(this.visGraph).then(t=>{console.log("Fetched communities",t),this.visGraph.combineCommunities(t),(this.settings.algorithm.combineConnectedComponents.getValue()??!1)&&this.visGraph.combineConnectedComponents(),(this.settings.community.addVirtualNodes.getValue()??!1)&&this.visGraph.addVirtualCommunityNodes()}).then(()=>{for(let t=0;t<(this.settings.algorithm.combiningSteps.getValue()??0);t++)this.visGraph.combineStronglyCoupledNodes();this.visGraph.setEdgeVisibility({hyperEdges:this.settings.display.showHyperEdges.getValue()??!0,edgesIncludedInHyperEdges:this.settings.display.showIncludedInHyperEdges.getValue()??!0,virtualEdges:this.settings.display.showVirtualPaths.getValue()??!0}),console.log("Combined communities",this.visGraph,this.commGraph.communities.getAsIdLists())})}async layout(t=!1){console.log("Layouting",this.visGraph,this.commGraph.communities.getAsIdLists()),this.visGraph.setPrecalculator(new Vs({sizeMultiplier:50,marginFactor:1.1,adaptRadiusBasedOnScore:this.commonSettings.showNodeScore.getValue()??!0,virtualNodeMultiplier:.5}));const e=this.settings.sorting.getSorter(this.visGraph,this.commonSettings);this.visGraph.setSorter(e),this.visGraph.setPositioner(new K0({nodeMarginFactor:this.settings.radial.nodeMarginFactor.getValue(this.settings.getContext({visGraph:this.visGraph}))??1,radiusMarginFactor:this.settings.radial.radiusMarginFactor.getValue(this.settings.getContext({visGraph:this.visGraph}))??1.1,adaptEnclosingCircle:this.settings.radial.adaptEnclosingCircle.getValue(this.settings.getContext({visGraph:this.visGraph}))??!0,rotateBasedOnConnections:this.settings.radial.rotateBasedOnConnections.getValue(this.settings.getContext({visGraph:this.visGraph}))??!0,hyperNodeMarginFactor:this.settings.radial.hyperNodeMarginFactor.getValue(this.settings.getContext({visGraph:this.visGraph}))??.4,hyperRadiusMarginFactor:this.settings.radial.hyperRadiusMarginFactor.getValue(this.settings.getContext({visGraph:this.visGraph}))??1.1})),this.visGraph.setConnectionLayouter([new HI({optimizeConnectionAnchors:this.settings.algorithm.optimizeConnectionAnchors.getValue(this.settings.getContext({visGraph:this.visGraph}))??!0,minimumRangeSizeFactor:this.settings.algorithm.minimumRangeSizeFactor.getValue(this.settings.getContext({visGraph:this.visGraph}))??.4,rangePaddingFactor:this.settings.algorithm.rangePaddingFactor.getValue(this.settings.getContext({visGraph:this.visGraph}))??.1,combinedPathsDistanceFactor:this.settings.algorithm.combinedPathsDistanceFactor.getValue(this.settings.getContext({visGraph:this.visGraph}))??.2,combinePaths:this.settings.algorithm.combinePaths.getValue(this.settings.getContext({visGraph:this.visGraph}))??!0,useHierarchicalSubPaths:this.settings.algorithm.useHierarchicalSubPaths.getValue(this.settings.getContext({visGraph:this.visGraph}))??!0,useHyperEdges:this.settings.algorithm.useHyperEdges.getValue(this.settings.getContext({visGraph:this.visGraph}))??!1})]),await this.visGraph.layout(),console.log("After layout",this.visGraph),this.emitEvent("end")}}class UI extends ie{}class YI extends UI{generatorMethods=new Od({});generatorMethodNames=[];communityDetectionMethod=new Or({key:"communityDetectionMethod",label:"Community Detection Method",description:"The method used to detect communities.",optional:!1,defaultValue:"None",choices:["None","louvain"]});addVirtualNodes=new rt({key:"addVirtualNodes",label:"Add Virtual Nodes",description:"Add virtual nodes to other communities.",optional:!1,defaultValue:!1,type:"boolean"});static fetchCommunityDetectionMethods(){console.log("Fetching community detection methods");const t=gi().generatorApiUrl;return fetch(`${t}/analyze/communities/methods`).then(e=>e.json()).then(e=>new Od(e))}fetchCommunities(t){const e=this.communityDetectionMethod.getValue();if(!e||e==="None")return Promise.resolve([]);const i=`${gi().generatorApiUrl}/analyze/communities/${e}`,o=new URLSearchParams,a=`${i}?${o.toString()}`;return fetch(a,{method:"POST",body:JSON.stringify(ZS(t)),headers:{"Content-Type":"application/json"}}).then(l=>l.json())}}class KI extends ie{combineConnectedComponents=new rt({key:"combineConnectedComponents",label:"Combine Connected Components",description:"Combine connected components.",optional:!1,defaultValue:!1,type:"boolean"});combiningSteps=new rt({key:"combiningSteps",label:"Combining Steps",description:"The count of steps to combine strongly coupled nodes.",optional:!1,defaultValue:0,type:"number"});optimizeConnectionAnchors=new rt({key:"optimizeConnectionAnchors",label:"Optimize Connection Anchors",description:"Optimize connection anchors.",optional:!1,defaultValue:!0,type:"boolean"});minimumRangeSizeFactor=new rt({key:"minimumRangeSizeFactor",label:"Minimum Range Size Factor",description:"The minimum range size factor.",optional:!1,defaultValue:.5,type:"number"});rangePaddingFactor=new rt({key:"rangePaddingFactor",label:"Range Padding Factor",description:"The range padding factor.",optional:!1,defaultValue:.1,type:"number"});combinePaths=new rt({key:"combinePaths",label:"Combine Counter Paths",description:"Bring counter paths closer together.",optional:!1,defaultValue:!0,type:"boolean"});combinedPathsDistanceFactor=new rt({key:"combinedPathsDistanceFactor",label:"Combined Paths Distance Factor",description:"The combined paths distance factor.",optional:!1,defaultValue:.2,type:"number"});useHierarchicalSubPaths=new rt({key:"useHierarchicalSubPaths",label:"Use Hierarchical Sub Paths",description:"Use hierarchical sub paths for connection routing.",optional:!1,defaultValue:!1,type:"boolean"});useHyperEdges=new rt({key:"useHyperEdges",label:"Use Hyper Edges",description:"Use hyper edges for connection routing. (Only available if hierarchical sub paths are enabled)",optional:!1,defaultValue:!1,type:"boolean"})}class XI extends ie{showHyperEdges=new rt({key:"showHyperEdges",optional:!1,defaultValue:!0,type:"boolean"});showIncludedInHyperEdges=new rt({key:"showEdgesIncludedInHyperEdges",optional:!1,defaultValue:!0,type:"boolean"});showVirtualPaths=new rt({key:"showVirtualPaths",optional:!1,defaultValue:!1,type:"boolean"})}class JI extends dr{radial=new X0({key:"radial",label:"Radial Placement",description:"Placement settings for the radial layout.",optional:!1});sorting=new Ya;display=new XI({key:"display",label:"Display",description:"Display settings for the viscom layout.",optional:!1});algorithm=new KI({key:"algorithm",label:"Algorithm",description:"Algorithm settings for the viscom layout.",optional:!1});community=new YI({key:"community",label:"Community",description:"Community settings for the viscom layout.",optional:!1})}function QI(n,t){const e=t?.allConnections??!1,r=t?.adaptSizeToScore??!1,i=t?.includeEdgeLabels??!1;let o=`digraph G {
`;return r&&(o+="{",n.allLeafLayoutNodes.forEach(a=>{const l=a.radius/10,h=a.radius/10;o+=`  "${a.id}" [label="${a.id}" shape=circle, width=${l}, height=${h} fixedsize=true];
`}),o+=`}
`),e?n.getAllConnections().forEach(a=>{a.getLinks().forEach(l=>{const h=l.topic.id;i?o+=`  "${a.fromId}" -> "${a.toId}" [label="${h}"];
`:o+=`  "${a.fromId}" -> "${a.toId}";
`})}):n.getAllConnections().forEach(a=>{o+=`  "${a.fromId}" -> "${a.toId}";
`}),o+="}",o}async function ZI(n,t="dot"){const e="http://localhost:5000/render/graphViz";try{const r=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({dot:n,engine:t})});if(!r.ok){const o=await r.json();throw new Error(`API error: ${o.error||r.statusText}`)}return(await r.json()).svg}catch(r){throw console.error("Error rendering GraphViz:",r),r}}class jI extends Ua{savedSVG;settings;constructor(t){super(),this.settings=t}async positionNodesFromSVG(t,e){console.log("Positioning nodes from SVG",t),new DOMParser().parseFromString(t,"image/svg+xml").querySelectorAll("g.node").forEach(a=>{const l=a.querySelector("title");if(!l||!l.textContent)return;const h=l.textContent,u=e.visGraph.getNode(h);if(!u)return;const d=a.querySelector("ellipse");if(d){const g=parseFloat(d.getAttribute("cx")||"0"),y=parseFloat(d.getAttribute("cy")||"0"),m=parseFloat(d.getAttribute("rx")||"0");u.x=g,u.y=y,u.radius=m,console.log(`Positioned node ${h} at (${u.x}, ${u.y})`)}})}async positionChildren(t){const e=t.visGraph;if(t!=e.rootNode)return;const r=this.settings.nodes.adaptSizeToScore.getValue(),i=!0,o=this.settings.edges.allConnections.getValue(),a=this.settings.edges.includeEdgeLabels.getValue(),l=this.settings.engine.layoutEngine.getValue(),h=this.settings.engine.horizontalLayout.getValue();let u=`digraph G {
`;h&&(u+=`  rankdir=LR;
`),u+=QI(e,{allConnections:o,adaptSizeToScore:r,includeEdgeLabels:a,includeNodeLabels:i}).substring(11),console.log("Graphviz DOT string:",u);try{this.savedSVG=await ZI(u,l),await this.positionNodesFromSVG(this.savedSVG,t)}catch(d){console.error("Failed to render graph:",d)}}}class tM extends Gs{positioner;constructor(t){super(),this.positioner=t}extractPathFromSVG(t){const r=new DOMParser().parseFromString(t,"image/svg+xml"),i=new Map;return r.querySelectorAll("g.edge").forEach(a=>{const l=a.querySelector("title");if(!l||!l.textContent)return;const h=l.textContent,[u,d]=h.split("->");if(!u||!d)return;const g=a.querySelector("path"),y=a.querySelector("polygon");if(!g)return;const m=g.getAttribute("d")||"",w=y?.getAttribute("points")||"",v=`${u}->${d}`;i.set(v,{path:m,source:u.trim(),target:d.trim(),arrowPolygon:w})}),i}calculateAnchorFromPath(t,e,r,i){if(i&&e){const o=e.trim().split(/\s+/).map(a=>{const[l,h]=a.split(",").map(parseFloat);return{x:l,y:h}});if(o.length>=3){const a=new D(o[1].x,o[1].y),l=new D((o[0].x+o[2].x)/2,(o[0].y+o[2].y)/2),h=new W(a.x-l.x,a.y-l.y);return new st(a,h).cloneReversed()}}if(i){const o=t.trim().split(/[\s,]+/);if(o[0]==="M"&&o.length>=3){const a=parseFloat(o[1]),l=parseFloat(o[2]),h=parseFloat(o[4]||o[1]),u=parseFloat(o[5]||o[2]),d=new D(a,l),g=new W(h-a,u-l);return new st(d,g)}}}layoutConnectionsOfRootNode(t){const e=this.positioner.savedSVG;if(!e)return;const r=this.extractPathFromSVG(e);t.visGraph.allLayoutConnections.forEach(i=>{const o=`${i.fromId}->${i.toId}`,a=r.get(o);if(a){const l=a.path,h=this.calculateAnchorFromPath(l,a.arrowPolygon,i.source,!0)?.cloneReversed(),u=void 0;i.pathSegment=new YE(i,l,u,h)}})}}class eM extends $i{async layout(t=!1){this.visGraph.setPrecalculator(new Vs({sizeMultiplier:10}));const e=new jI(this.settings);this.visGraph.setPositioner(e);const r=new tM(e);this.visGraph.setConnectionLayouter(r),await this.visGraph.layout(),this.markConnectionsAsUpdateRequired(),this.emitEvent("end"),console.log("Graphviz layout completed")}}class nM extends ie{layoutEngine=new Or({key:"layoutEngine",label:"Layout Engine",description:"The GraphViz layout engine to use",optional:!1,defaultValue:"dot",choices:["dot","circo","fdp","neato","twopi","sfdp","osage","patchwork"]});horizontalLayout=new rt({key:"horizontalLayout",label:"Horizontal Layout",description:"Set layout direction from left to right instead of top to bottom",optional:!1,defaultValue:!0,type:"boolean"})}class rM extends ie{adaptSizeToScore=new rt({key:"adaptSizeToScore",label:"Adapt Node Size To Score",description:"Scale node size according to its score/rank",optional:!1,defaultValue:!0,type:"boolean"})}class iM extends ie{allConnections=new rt({key:"allConnections",label:"Show All Connections",description:"Show all connections including topic details",optional:!1,defaultValue:!1,type:"boolean",enabled:!1});includeEdgeLabels=new rt({key:"includeEdgeLabels",label:"Include Edge Labels",description:"Include edge/connection labels in the visualization",optional:!1,defaultValue:!1,type:"boolean"})}class sM extends dr{engine=new nM({key:"engine",label:"Engine",description:"GraphViz engine settings",optional:!1});nodes=new rM({key:"nodes",label:"Nodes",description:"Node visualization settings",optional:!1});edges=new iM({key:"edges",label:"Edges",description:"Edge visualization settings",optional:!1});constructor(t,e){super(t,e)}}const hi={viscom:{label:"VisCom Layouts",layouter:qI,settings:JI},radial:{label:"Radial Layouts",layouter:CI,settings:AI},fdg:{label:"Force Directed Graphs",layouter:wI,settings:SI},graphviz:{label:"Graphviz Layouts",layouter:eM,settings:sM},arc:{label:"Arc Layouts",layouter:iI,settings:yI},spaceFilling:{label:"Space Filling Layouts",layouter:FI,settings:VI}};class oM{mapLayoutTypeToListOfSettings=new Map;mapIdToSettings=new Map;emitter=mr();commonSettings=new NI({key:"commonSettings",label:"Common Settings",description:"Common settings for all layouters",optional:!0});constructor(){}get length(){return this.mapIdToSettings.size}getSettings(t){return this.mapIdToSettings.get(t)}deleteSetting(t){console.log("Deleting settings",t);const e=this.mapIdToSettings.get(t);if(!e){console.warn("No settings found for id",t);return}console.log("Deleting settings",e);const r=this.mapLayoutTypeToListOfSettings.get(e.type);if(!r){console.warn("No settings list found for type",e.type);return}const i=r.indexOf(e);if(i===-1){console.warn("Setting not found in list",e);return}r.splice(i,1),this.mapIdToSettings.delete(t),this.emitter.emit("newSettings",{currentIds:Array.from(this.mapIdToSettings.keys())})}addSetting(t){if(!hi[t]){console.warn("No layouter found for type",t);return}this.mapLayoutTypeToListOfSettings.get(t)===void 0&&this.mapLayoutTypeToListOfSettings.set(t,[]);const e=this.mapLayoutTypeToListOfSettings.get(t),r=hi[t];if(!r){console.warn("No layouter found for type",t);return}const i=r.settings.createSettings(r.settings,t);if(e.length>0){const o=e[e.length-1];i.loadFromJson(o.getJson())}e.push(i),this.mapIdToSettings.set(i.id,i),console.log(this),this.emitter.emit("newSettings",{currentIds:Array.from(this.mapIdToSettings.keys())})}loadFromJson(t){this.mapLayoutTypeToListOfSettings.clear(),this.mapIdToSettings.clear();for(const e in hi){this.mapLayoutTypeToListOfSettings.get(e)===void 0&&this.mapLayoutTypeToListOfSettings.set(e,[]);const r=this.mapLayoutTypeToListOfSettings.get(e),i=hi[e];if(!i||!t.settings){console.warn("No settings found for layouter",e);continue}const o=t.settings.find(a=>a.type===e);if(!o){console.warn("No settings found for layouter",e);continue}for(const a of o.settingsList){const l=i.settings.createSettings(i.settings,e);l.loadFromJson(a),r.push(l),this.mapIdToSettings.set(l.id,l)}}this.commonSettings.loadFromJson(t.commonSettings),this.emitter.emit("newSettings",{currentIds:Array.from(this.mapIdToSettings.keys())})}getJson(){const t={commonSettings:[],settings:[]};t.commonSettings=this.commonSettings.getJson();for(const e in hi){hi[e];const i=this.mapLayoutTypeToListOfSettings.get(e).map(o=>o.getJson());t.settings.push({type:e,settingsList:i})}return t}}const LM=Zg("graph",{state:()=>({graph:new sa([],[]),currentSettings:void 0,activeSettingId:-1,layouterSettingsCollectionJson:Dl("layouterSettingsCollectionJson","{}"),settingsCollection:new oM,metricsCollection:new nu}),getters:{},actions:{setGraph(n){this.graph=n},downloadSettingsAsJson(n=""){const t=this.settingsCollection.getJson(),e=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),r=URL.createObjectURL(e),i=document.createElement("a");i.href=r;const o=new Date().toISOString().slice(0,19).replace(/:/g,"-"),a=n?`settings_${n}_${o}.json`:`settings_${o}.json`;i.download=a,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r)},uploadSettingsFromJson(n){return new Promise((t,e)=>{const r=new FileReader;r.onload=i=>{try{const o=JSON.parse(i.target?.result);this.settingsCollection.loadFromJson(o),this.layouterSettingsCollectionJson=JSON.stringify(o),t()}catch(o){e(o)}},r.onerror=i=>e(i),r.readAsText(n)})},downloadDatasetAsJson(n,t){const e=this.graph,r=e.nodes,i=e.getChannels("PubSub"),o=e.getChannels("Services"),a={version:"1.0.0",name:n,description:t,created_at:new Date().toISOString(),nodeCount:r.length,author:"user",cc_by_sa_consent:!0,nodes:r.map(v=>{const _=new Map,b=new Map,N=new Map,A=new Map;return this.graph.getOutgoingLinks(v,i).forEach(T=>{_.has(T.topic.id)||_.set(T.topic.id,{name:T.topic.id,type:T.topic.messageType.name})}),this.graph.getIncomingLinks(v,i).forEach(T=>{b.has(T.topic.id)||b.set(T.topic.id,{name:T.topic.id,type:T.topic.messageType.name})}),this.graph.getOutgoingLinks(v,o).forEach(T=>{N.has(T.topic.id)||N.set(T.topic.id,{name:T.topic.id,type:T.topic.messageType.name})}),this.graph.getIncomingLinks(v,o).forEach(T=>{A.has(T.topic.id)||A.set(T.topic.id,{name:T.topic.id,type:T.topic.messageType.name})}),{name:v.id,namespace:"/",localhost_only:!1,publishers:Array.from(_.values()),subscribers:Array.from(b.values()),services:Array.from(N.values()),clients:Array.from(A.values())}})},l=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),h=URL.createObjectURL(l),u=document.createElement("a");u.href=h;const d=r.length.toString().padStart(4,"0"),g=new Date,y=g.toISOString().slice(0,10),m=g.toISOString().slice(11,19).replace(/:/g,"_"),w=`${d}nodes_${y}_${m}_${n.replace(/\s+/g,"_")}.json`;u.download=w,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(h)},areAllMetricsCalculated(){const n=Array.from(this.settingsCollection.mapIdToSettings.keys());return n.length===0?!1:!n.some(t=>this.metricsCollection.getMetricsResults(t).pending)},downloadMetricsAsJson(n="",t=""){const e=new Date().toISOString().slice(0,19).replace(/:/g,"-"),r=Array.from(this.settingsCollection.mapIdToSettings.keys()),i={},o={},a={title:n||"Metrics Results",description:t||"Metrics results for multiple visualizations",timestamp:e,nodeCount:this.graph.nodes.length,connectionCount:this.graph.getAllLinks().length,visualizationCount:r.length,isSynthetic:n.startsWith("S_")||!1};r.forEach(m=>{const w=this.settingsCollection.getSettings(m);if(!w)return;const v=w.type,_=w.name||`Setting ${m}`,b=v+"_"+_.replace(/\s+/g,"_"),N=this.metricsCollection.getMetricsResults(m),A={};N.results.forEach(P=>{A[P.metricKey]={value:P.value,definition:{key:P.definition.key,label:P.definition.label,optimum:P.definition.optimum,unit:P.definition.unit,abbreviation:P.definition.abbreviation},error:P.error||void 0},o[P.metricKey]||(o[P.metricKey]={}),o[P.metricKey][b]=P.pending?null:P.normalizedValue});const T=w.getJson();i[m.toString()]={id:m,name:b,type:v,metrics:A,configuration:T}});const l=this.generateMetricsCsv(o),h={dataset:a,visualizations:i,csvSummary:l},u=new Blob([JSON.stringify(h,null,2)],{type:"application/json"}),d=URL.createObjectURL(u),g=document.createElement("a");g.href=d;const y=n?`metrics_${n.replace(/\s+/g,"_")}_${e}.json`:`metrics_${e}.json`;g.download=y,document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(d)},generateMetricsCsv(n){const t=Object.keys(n);if(t.length===0)return"";const e=new Set;t.forEach(o=>{Object.keys(n[o]).forEach(a=>{e.add(a)})});const r=Array.from(e);let i="Metric,"+r.join(",")+`
`;return t.forEach(o=>{i+=o+",";const a=r.map(l=>{const h=n[o][l];return h===null?"N/A":h.toFixed(4)});i+=a.join(",")+`
`}),i}}}),aM={xs:2,sm:4,md:6,lg:10,xl:14};function Xg(n,t,e){return{transform:t===!0?`translateX(${e.lang.rtl===!0?"-":""}100%) scale3d(${-n},1,1)`:`scale3d(${n},1,1)`}}const kM=Fi({name:"QLinearProgress",props:{...au,...eS,value:{type:Number,default:0},buffer:Number,color:String,trackColor:String,reverse:Boolean,stripe:Boolean,indeterminate:Boolean,query:Boolean,rounded:Boolean,animationSpeed:{type:[String,Number],default:2100},instantFeedback:Boolean},setup(n,{slots:t}){const{proxy:e}=Kn(),r=cu(n,e.$q),i=nS(n,aM),o=zt(()=>n.indeterminate===!0||n.query===!0),a=zt(()=>n.reverse!==n.query),l=zt(()=>({...i.value!==null?i.value:{},"--q-linear-progress-speed":`${n.animationSpeed}ms`})),h=zt(()=>"q-linear-progress"+(n.color!==void 0?` text-${n.color}`:"")+(n.reverse===!0||n.query===!0?" q-linear-progress--reverse":"")+(n.rounded===!0?" rounded-borders":"")),u=zt(()=>Xg(n.buffer!==void 0?n.buffer:1,a.value,e.$q)),d=zt(()=>`with${n.instantFeedback===!0?"out":""}-transition`),g=zt(()=>`q-linear-progress__track absolute-full q-linear-progress__track--${d.value} q-linear-progress__track--${r.value===!0?"dark":"light"}`+(n.trackColor!==void 0?` bg-${n.trackColor}`:"")),y=zt(()=>Xg(o.value===!0?1:n.value,a.value,e.$q)),m=zt(()=>`q-linear-progress__model absolute-full q-linear-progress__model--${d.value} q-linear-progress__model--${o.value===!0?"in":""}determinate`),w=zt(()=>({width:`${n.value*100}%`})),v=zt(()=>`q-linear-progress__stripe absolute-${n.reverse===!0?"right":"left"} q-linear-progress__stripe--${d.value}`);return()=>{const _=[an("div",{class:g.value,style:u.value}),an("div",{class:m.value,style:y.value})];return n.stripe===!0&&o.value===!1&&_.push(an("div",{class:v.value,style:w.value})),an("div",{class:h.value,style:l.value,role:"progressbar","aria-valuemin":0,"aria-valuemax":1,"aria-valuenow":n.indeterminate===!0?void 0:n.value},rS(t.default,_))}}});export{zA as $,Nd as A,np as B,Md as C,uS as D,xS as E,sa as F,NM as G,Ce as H,LM as I,gi as J,Dl as K,xM as L,Od as M,PM as N,AM as O,wM as P,_M as Q,bM as R,vM as S,kM as T,t2 as U,fu as V,IM as W,di as X,G2 as Y,mM as Z,hu as _,cu as a,TM as a0,hi as a1,CM as a2,SM as a3,ls as a4,hM as b,bS as c,Ll as d,oS as e,aS as f,pM as g,yM as h,mS as i,cS as j,yl as k,pS as l,gS as m,dS as n,vS as o,_S as p,dM as q,fM as r,yS as s,gM as t,au as u,uM as v,Id as w,SS as x,sS as y,iS as z};
